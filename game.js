function GetRealPath(t){return ReplacePathMap[t]&&(t=ReplacePathMap[t]),void 0==gFileMd5||null==gFileMd5?t:gFileMd5[t]||t}function hex_md5(t){return binl2hex(core_md5(str2binl(t),t.length*chrsz))}function b64_md5(t){return binl2b64(core_md5(str2binl(t),t.length*chrsz))}function str_md5(t){return binl2str(core_md5(str2binl(t),t.length*chrsz))}function hex_hmac_md5(t,e){return binl2hex(core_hmac_md5(t,e))}function b64_hmac_md5(t,e){return binl2b64(core_hmac_md5(t,e))}function str_hmac_md5(t,e){return binl2str(core_hmac_md5(t,e))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc")}function core_md5(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,a=-271733879,s=-1732584194,r=271733878,n=0;n<t.length;n+=16){var o=i,c=a,l=s,_=r;i=md5_ff(i,a,s,r,t[n+0],7,-680876936),r=md5_ff(r,i,a,s,t[n+1],12,-389564586),s=md5_ff(s,r,i,a,t[n+2],17,606105819),a=md5_ff(a,s,r,i,t[n+3],22,-1044525330),i=md5_ff(i,a,s,r,t[n+4],7,-176418897),r=md5_ff(r,i,a,s,t[n+5],12,1200080426),s=md5_ff(s,r,i,a,t[n+6],17,-1473231341),a=md5_ff(a,s,r,i,t[n+7],22,-45705983),i=md5_ff(i,a,s,r,t[n+8],7,1770035416),r=md5_ff(r,i,a,s,t[n+9],12,-1958414417),s=md5_ff(s,r,i,a,t[n+10],17,-42063),a=md5_ff(a,s,r,i,t[n+11],22,-1990404162),i=md5_ff(i,a,s,r,t[n+12],7,1804603682),r=md5_ff(r,i,a,s,t[n+13],12,-40341101),s=md5_ff(s,r,i,a,t[n+14],17,-1502002290),a=md5_ff(a,s,r,i,t[n+15],22,1236535329),i=md5_gg(i,a,s,r,t[n+1],5,-165796510),r=md5_gg(r,i,a,s,t[n+6],9,-1069501632),s=md5_gg(s,r,i,a,t[n+11],14,643717713),a=md5_gg(a,s,r,i,t[n+0],20,-373897302),i=md5_gg(i,a,s,r,t[n+5],5,-701558691),r=md5_gg(r,i,a,s,t[n+10],9,38016083),s=md5_gg(s,r,i,a,t[n+15],14,-660478335),a=md5_gg(a,s,r,i,t[n+4],20,-405537848),i=md5_gg(i,a,s,r,t[n+9],5,568446438),r=md5_gg(r,i,a,s,t[n+14],9,-1019803690),s=md5_gg(s,r,i,a,t[n+3],14,-187363961),a=md5_gg(a,s,r,i,t[n+8],20,1163531501),i=md5_gg(i,a,s,r,t[n+13],5,-1444681467),r=md5_gg(r,i,a,s,t[n+2],9,-51403784),s=md5_gg(s,r,i,a,t[n+7],14,1735328473),a=md5_gg(a,s,r,i,t[n+12],20,-1926607734),i=md5_hh(i,a,s,r,t[n+5],4,-378558),r=md5_hh(r,i,a,s,t[n+8],11,-2022574463),s=md5_hh(s,r,i,a,t[n+11],16,1839030562),a=md5_hh(a,s,r,i,t[n+14],23,-35309556),i=md5_hh(i,a,s,r,t[n+1],4,-1530992060),r=md5_hh(r,i,a,s,t[n+4],11,1272893353),s=md5_hh(s,r,i,a,t[n+7],16,-155497632),a=md5_hh(a,s,r,i,t[n+10],23,-1094730640),i=md5_hh(i,a,s,r,t[n+13],4,681279174),r=md5_hh(r,i,a,s,t[n+0],11,-358537222),s=md5_hh(s,r,i,a,t[n+3],16,-722521979),a=md5_hh(a,s,r,i,t[n+6],23,76029189),i=md5_hh(i,a,s,r,t[n+9],4,-640364487),r=md5_hh(r,i,a,s,t[n+12],11,-421815835),s=md5_hh(s,r,i,a,t[n+15],16,530742520),a=md5_hh(a,s,r,i,t[n+2],23,-995338651),i=md5_ii(i,a,s,r,t[n+0],6,-198630844),r=md5_ii(r,i,a,s,t[n+7],10,1126891415),s=md5_ii(s,r,i,a,t[n+14],15,-1416354905),a=md5_ii(a,s,r,i,t[n+5],21,-57434055),i=md5_ii(i,a,s,r,t[n+12],6,1700485571),r=md5_ii(r,i,a,s,t[n+3],10,-1894986606),s=md5_ii(s,r,i,a,t[n+10],15,-1051523),a=md5_ii(a,s,r,i,t[n+1],21,-2054922799),i=md5_ii(i,a,s,r,t[n+8],6,1873313359),r=md5_ii(r,i,a,s,t[n+15],10,-30611744),s=md5_ii(s,r,i,a,t[n+6],15,-1560198380),a=md5_ii(a,s,r,i,t[n+13],21,1309151649),i=md5_ii(i,a,s,r,t[n+4],6,-145523070),r=md5_ii(r,i,a,s,t[n+11],10,-1120210379),s=md5_ii(s,r,i,a,t[n+2],15,718787259),a=md5_ii(a,s,r,i,t[n+9],21,-343485551),i=safe_add(i,o),a=safe_add(a,c),s=safe_add(s,l),r=safe_add(r,_)}return Array(i,a,s,r)}function md5_cmn(t,e,i,a,s,r){return safe_add(bit_rol(safe_add(safe_add(e,t),safe_add(a,r)),s),i)}function md5_ff(t,e,i,a,s,r,n){return md5_cmn(e&i|~e&a,t,e,s,r,n)}function md5_gg(t,e,i,a,s,r,n){return md5_cmn(e&a|i&~a,t,e,s,r,n)}function md5_hh(t,e,i,a,s,r,n){return md5_cmn(e^i^a,t,e,s,r,n)}function md5_ii(t,e,i,a,s,r,n){return md5_cmn(i^(e|~a),t,e,s,r,n)}function core_hmac_md5(t,e){var i=str2binl(t);i.length>16&&(i=core_md5(i,t.length*chrsz));for(var a=Array(16),s=Array(16),r=0;r<16;r++)a[r]=909522486^i[r],s[r]=1549556828^i[r];var n=core_md5(a.concat(str2binl(e)),512+e.length*chrsz);return core_md5(s.concat(n),640)}function safe_add(t,e){var i=(65535&t)+(65535&e),a=(t>>16)+(e>>16)+(i>>16);return a<<16|65535&i}function bit_rol(t,e){return t<<e|t>>>32-e}function str2binl(t){for(var e=Array(),i=(1<<chrsz)-1,a=0;a<t.length*chrsz;a+=chrsz)e[a>>5]|=(t.charCodeAt(a/chrsz)&i)<<a%32;return e}function binl2str(t){for(var e="",i=(1<<chrsz)-1,a=0;a<32*t.length;a+=chrsz)e+=String.fromCharCode(t[a>>5]>>>a%32&i);return e}function binl2hex(t){for(var e=hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",a=0;a<4*t.length;a++)i+=e.charAt(t[a>>2]>>a%4*8+4&15)+e.charAt(t[a>>2]>>a%4*8&15);return i}function binl2b64(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",a=0;a<4*t.length;a+=3)for(var s=(t[a>>2]>>8*(a%4)&255)<<16|(t[a+1>>2]>>8*((a+1)%4)&255)<<8|t[a+2>>2]>>8*((a+2)%4)&255,r=0;r<4;r++)i+=8*a+6*r>32*t.length?b64pad:e.charAt(s>>6*(3-r)&63);return i}function ConvertToJson(t){try{return JSON.parse(t||"{}")}catch(t){return{}}}function IsNull(t){return null===t||void 0===t}function GenUuid(){for(var t=[],e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-";var a=t.join("");return a}function getTimestamp(){return Date.parse(new Date)/1e3}function saveScreenShot(t,e){var i=cc.director.getWinSize(),a=cc.director.getRunningScene();a.width=i.width,a.height=i.height;var s=(new Date,"screenShot.jpg");if(e){var r=new cc.RenderTexture(parseInt(i.height),parseInt(i.width));a.anchorX=0,a.anchorY=0;var n=a.getRotation();a.setRotation(270);var o=a.x;a.x=i.height,r.begin(),a.visit(),r.end(),r.saveToFile(s,cc.IMAGE_FORMAT_JPEG,!1,function(){a.x=o,a.setRotation(n),a.anchorX=.5,a.anchorY=.5,t&&t()})}else{var r=new cc.RenderTexture(parseInt(i.width),parseInt(i.height));r.begin(),a.visit(),r.end(),r.saveToFile(s,cc.IMAGE_FORMAT_JPEG,!1,t)}return jsb.fileUtils.getWritablePath()+s}function checkPhone(t){var e=/^(((13[0-9]{1})|(15[0-9]{1})|(16[6]{1})|(17[0-9]{1})|(14[57]{1})|(18[0-9]{1})|(19[89]{1}))+\d{8})$/;return!!e.test(t)}function gSetMusic(t){t?(cc.audioEngine.pauseMusic(),cc.audioEngine.setMusicVolume(0),cc.sys.localStorage.setItem("musicVolume",0)):(cc.audioEngine.resumeMusic(),cc.audioEngine.setMusicVolume(100),cc.sys.localStorage.setItem("musicVolume",100),playMuisc(lastMusicName))}function playLastMusic(){playMuisc(lastMusicName)}function getLastMusicName(){return lastMusicName}function gSetMusicEffect(t){if(t)cc.audioEngine.pauseAllEffects(),cc.sys.localStorage.setItem("effectsVolume",0);else{for(var e in cc.audioEngine._audioPool)cc.audioEngine.unloadEffect(e);cc.audioEngine.resumeAllEffects(),cc.sys.localStorage.setItem("effectsVolume",100)}}function RemoveGet(t,e){var i=t[e];return delete t[e],i}function getNodeWorldRect(t){var e=t.convertToWorldSpace(cc.p(0,0)),i=e.x,a=e.y,s=t.getContentSize(),r=t.getScaleX(),n=t.getScaleY(),o=s.width*r,c=s.height*n;return cc.rect(i,a,o,c)}function gGetRad(t){return t*PI/180}function gGetGreatCircleDistance(t,e,i,a){var s=gGetRad(t),r=gGetRad(i),n=s-r,o=gGetRad(e)-gGetRad(a),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(n/2),2)+Math.cos(s)*Math.cos(r)*Math.pow(Math.sin(o/2),2)));return c*=EARTH_RADIUS,c=Math.round(1e4*c)/1e4}function calDate(t){var e=Math.floor(t/86400),i=Math.floor(t%86400/3600),a=Math.floor(t%86400%3600/60),s=Math.floor(t%86400%3600%60);return[e,i,a,s]}function parseSecond(t,e){var i=calDate(t),a={"d+":i[0],"h+":i[1],"m+":i[2],"s+":i[3]};for(var s in a)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[s]:("00"+a[s]).substr((""+a[s]).length)));return e}function toDecodeURIComponent(t){try{return decodeURIComponent(t)}catch(e){return t}}function sizeofStr(t,e){var i,a,s,r=0;if(e=e?e.toLowerCase():"","utf-16"===e||"utf16"===e)for(a=0,s=t.length;a<s;a++)i=t.charCodeAt(a),r+=i<=65535?2:4;else for(a=0,s=t.length;a<s;a++)i=t.charCodeAt(a),r+=i<=127?1:2;return r}function isChineseChar(t){var e=!1,i=t.charCodeAt(0);return i>=1&&i<=126||65376<=i&&i<=65439||(e=!0),e}function cutOffStr(t,e,i){if(sizeofStr(t)>e){var a=/[\u4e00-\u9fa5]+/i;if(a.test(t)){for(var s=0,r=0,n=0;n<t.length&&(r+=this.isChineseChar(t[n])?2:1,!(r>e));n++)s++;t=t.substr(0,s),i||(t+="...")}else t=t.substr(0,e),i||(t+="...")}return t}function unique(t){for(var e=[],i={},a=0,s=t.length;a<s;++a)i[t[a]]||(i[t[a]]=!0,e.push(t[a]));return e}function lengthOfObj(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;return e}function isInteger(t){return"number"==typeof t&&t%1===0}function create_h5_cut_img(t,e,i,a){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=cc.winSize.width,r=cc.winSize.height,n=document.getElementById("gameCanvas");if(!n)return;var o=n.getContext("webgl");if(!o)return;var c=o.drawingBufferWidth,l=o.drawingBufferHeight,_=c/s,u=l/r;t=parseInt(t>0?t*_:0),e=parseInt(e>0?e*u:0),i=parseInt(i>0?i*_:o.drawingBufferWidth),a=parseInt(a>0?a*u:o.drawingBufferHeight);var h=document.getElementById("canvas2D");if(!h)return;var g=h.getContext("2d");if(!g)return;h.width=i,h.height=a,o.clear(gl.COLOR_BUFFER_BIT),cc.director.drawScene();var d=g.createImageData(i,a),m=new Uint8Array(i*a*4);o.readPixels(t,e,i,a,o.RGBA,o.UNSIGNED_BYTE,m);for(var f=4*i,p=a,M=0,C=p/2;M<C;++M)for(var D=0,b=f;D<b;++D){var y=M*f+D,v=(p-M-1)*f+D;d.data[y]=m[v],d.data[v]=m[y]}g.putImageData(d,0,0);var E=cc.view.getDevicePixelRatio()||1,I=h.toDataURL();h.width=0,h.height=0,gShareImag&&(document.body.removeChild(gShareImag),gShareImag=null);var S=document.createElement("img");gShareImag=S,S.src=I,S.width=i/E,S.height=a/E,S.style.left=t+"px",S.style.bottom=e+"px",S.style.position="absolute",document.body.appendChild(S)}else if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var n=document.getElementById("gameCanvas");if(!n)return;var P=n.getContext("2d");if(!P)return;var h=document.getElementById("canvas2D");if(!h)return;var g=h.getContext("2d");if(!g)return;var s=cc.winSize.width,r=cc.winSize.height,T=n.width,w=n.height,_=T/s,u=w/r,N=parseInt(t>0?t*_:0),A=parseInt(e>0?e*u:0);t*=_,e=parseInt(e>=0?(r-e-a)*u:r),i=parseInt(i>0?i*_:T),a=parseInt(a>0?a*u:w),h.width=i,h.height=a;var d=P.getImageData(t,e,i,a);g.putImageData(d,0,0),gShareImag&&(document.body.removeChild(gShareImag),gShareImag=null);var S=document.createElement("img");gShareImag=S;var E=cc.view.getDevicePixelRatio()||1;S.src=h.toDataURL(),S.width=i/E,S.height=a/E,S.style.left=N+"px",S.style.bottom=A+"px",S.style.position="absolute",document.body.appendChild(S)}}function remove_h5_cut_img(){gShareImag&&(document.body.removeChild(gShareImag),gShareImag=null)}function request4Http(t,e,i,a){var s=GAME_WEB_PORT;1==e.ignorePort&&(s="");var r={method:a||"POST",timeout:5e3,url:GAME_WEB_URL+s+t,data:JSON.stringify(e)};HttpNetworkRequest(r,function(t,e){if(t)return void ModuleMgr.showTipMsg(t);var a=ConvertToJson(e);return a.ret==-1?void ModuleMgr.showTipMsg(a.err_msg||a.error):void i(a)})}function requestWaiting4Http(t,e,i,a,s){var r=GAME_WEB_PORT;1==e.ignorePort&&(r="");var n={method:s||"POST",timeout:5e3,url:GAME_WEB_URL+r+t,data:JSON.stringify(e)};a=a||"",ModuleMgr.showWaitMsg(a,0),HttpNetworkRequest(n,function(t,e){if(ModuleMgr.removeWaitMsg(),t)return void ModuleMgr.showTipMsg(t);var a=ConvertToJson(e);return a.ret==-1?void(a.err_msg?ModuleMgr.showTipMsg(a.err_msg):a.error&&ModuleMgr.showTipMsg(a.error)):void i(a)})}function set_king_map(t){MJ_KING_MAP={},MJ_KING_ARR=[];for(var e=0;e<t.length;e++)MJ_KING_MAP[t[e]]=!0,MJ_KING_ARR.push(t[e])}function get_card_color(t){return t&LOGIC_MASK_COLOR}function get_card_value(t){return t&LOGIC_MASK_VALUE}function getCodeByNum(t){return get_card_color(t)/16*10+get_card_value(t)}function getNumByCode(t){var e=parseInt(t/10);return 16*e+(t-10*e)}function get_card_logic_value(t){return t}function sort_card_normal(t,e){var i=t,a=e;return MJ_KING_MAP[i]&&(i-=1e3),MJ_KING_MAP[a]&&(a-=1e3),i-a}function sort_card_ndmjOpenKing(t,e){var i=t,a=e,s=DataMgr.gameCtrl.randPokerList[0];return s==i&&(i+=1e3),s==a&&(a+=1e3),MJ_KING_ARR.length>0?(MJ_KING_MAP[i]&&(i-=1e3),MJ_KING_MAP[a]&&(a-=1e3)):(67==i&&(i=s),67==a&&(a=s)),i-a}function sort_card_xmmj(t,e){var i=t,a=e;return MJ_KING_MAP[i]&&(i-=1e3),MJ_KING_MAP[a]&&(a-=1e3),i==BAI_BANG&&(i=MJ_KING_ARR[0]||BAI_BANG),a==BAI_BANG&&(a=MJ_KING_ARR[0]||BAI_BANG),i-a}function sub_poker(t,e){for(var i={},a=0;a<t.length;a++){var s=t[a];i[s]=(i[s]||0)+1}for(var a=0;a<e.length;a++){var s=e[a];if(null==i[s]||void 0==i[s])return null;if(i[s]=i[s]-1,i[s]<0)return null}var r=[];for(var n in i)for(var s=i[n],a=0;a<=s-1;a++)r.push(parseInt(n));return r.sort(sort_card),r}function analyse_card_data(t){for(var e=["single","double","three","four"],a={single_count:0,single_list:[],double_count:0,double_list:[],three_count:0,three_list:[],four_count:0,four_list:[]},s=0;s<t.length;){var r=1,n=get_card_logic_value(t[s]);if(n<0)return null;for(i=s+1;i<t.length&&get_card_logic_value(t[i])==n;i++)r+=1;var o=e[r-1];if(!o)return null;var c=o+"_count",l=o+"_list";for(a[c]=a[c]+1,i=0;i<r;i++)a[l].push(t[s+i]);s+=r}return a}function get_flower_count_data(t){t=t||[];for(var e=0,i=0,a=0;a<t.length;a++){var s=t[a];s>80&&s<96?e+=1:s>96&&s<112&&(i+=1)}return{count1:e,count2:i}}function calc_tip_chi_poker(t,e){var i=[];if(e>=49&&e<=52){for(var a=[{49:1,50:1,51:1},{49:1,50:1,52:1},{49:1,51:1,52:1},{50:1,51:1,52:1}],s={},r=0;r<t.length;r++){var n=t[r];n>=49&&n<=52&&(s[n]=1)}for(var r=0;r<a.length;r++){var o=a[r];if(o[e]){var c=[];for(var l in o)if(l!=e){if(!s[l])break;c.push(l)}else c.push(l);3==c.length&&(c.sort(sort_card),i.push(c))}}return i}for(var _=[[-2,-1],[-1,1],[1,2]],u=0;u<_.length;u++){var c=[0,0,0];c[0]=e;for(var h=_[u],r=0;r<t.length;r++)t[r]-e==h[0]&&(c[1]=t[r]),t[r]-e==h[1]&&(c[2]=t[r]);for(var g=!0,d=0;d<c.length;d++)if(!c[d]){g=!1;break}g&&(c.sort(sort_card),i.push(c))}return i}function calc_tip_chi_poker_xmmj(t,e){for(var i=[],a=[[-2,-1],[-1,1],[1,2]],s=0;s<a.length;s++){var r=[0,0,0];r[0]=e;var n=a[s],o=e;o==BAI_BANG&&(o=MJ_KING_ARR[0]||o);for(var c=0;c<t.length;c++){var l=t[c];l!=MJ_KING_ARR[0]&&(l==BAI_BANG&&(l=MJ_KING_ARR[0]||l),l-o==n[0]&&(r[1]=t[c]),l-o==n[1]&&(r[2]=t[c]))}for(var _=!0,u=0;u<r.length;u++)if(!r[u]){_=!1;break}_&&(r.sort(sort_card),i.push(r))}return i}function calc_tip_gang_poker(t,e){}function get_card_color(t){return t&LOGIC_MASK_COLOR}function get_card_value(t){return t&LOGIC_MASK_VALUE}function check_can_hu(t){for(var e=[],i=DataMgr.gameCtrl.getRealpokerList(t),a=!1,s=0;s<=4;s++){var r=get_sub_poker_color(i,s),n=arrayToMap(r);for(var o in n)if(n[o]>4)return null;var c=r.length;if(0!=c){if(c%3==1)return null;if(c%3==0){var n=arrayToMap(r),l=check_can_hu_by_map(n);if(!l)return null;e=e.concat(l)}if(c%3==2){if(a)return null;a=!0;var _=!1,n=arrayToMap(r),l=null;for(var o in n){if(l=null,n[o]>=2)if(2==c)_=!0,l=[{mj_action:MJ_DUI,poker_list:[parseInt(o),parseInt(o)]}],e=e.concat(l);else{var u=gDup(n);u[o]-=2,l=check_can_hu_by_map(u),l&&(_=!0,l.push({mj_action:MJ_DUI,poker_list:[parseInt(o),parseInt(o)]}),e=e.concat(l))}if(_)break}if(!_)return null}}}return e}function get_ting_list(t){var e=[];if(!t)return e;for(var i=0;i<POKER_DATA_TYPE.length;i++){var a=POKER_DATA_TYPE[i];if(a<81){var s=gDup(t);s.push(a),check_can_hu(s)&&e.push(a)}}return e}function get_all_ting_list(t){for(var e=[],i=unique(t),a=0;a<i.length;a++){var s={};s.dropCard=i[a],s.tingCards=[];var r=this.removeOneItemList(copyArray(t),s.dropCard);s.tingCards=get_ting_list(r),s.tingCards.length>0&&e.push(s)}return e}function copyArray(t){for(var e=[],i=0;i<t.length;i++){var a=t[i];"object"==typeof a?e[i]=copyArray(a):e[i]=a}return e}function removeOneItemList(t,e){for(var i=[],a=0;a<t.length;a++)i.push(t[a]);for(var a=0;a<i.length;a++)if(e&&i[a]==e){i.splice(a,1);break}return i}function testMing(){for(var t=[1,4,7,10,13],e=0;e<1e6;e++){for(var i=t[parseInt(Math.random()*t.length)],a=[],s=0;s<i;s++)a.push(POKER_DATA_TYPE[parseInt(Math.random()*POKER_DATA_TYPE.length)]);get_ting_list(a)}}function test(){var t=[1],t=(get_ting_list(t),[49,49,50,51,51]),e=52,t=(calc_tip_chi_poker(t,e),[20,20,39,39,39,40,41]),t=(get_ting_list(t),[17,17,21,21,21,22,23,33,34,35,38,39,40]);get_ting_list(t);if(DataMgr.gameCtrl&&DataMgr.gameCtrl.getMingMap){var t=[21,22,22,22,23,17,17],i=[17,22],t=(DataMgr.gameCtrl.getMingMap(t,i),[20,21,22,22,23,24,21,22,23,23,24,17,17]),i=[19,22,25],t=(DataMgr.gameCtrl.getMingMap(t,i),[23,23,24,25]),i=[23],t=(DataMgr.gameCtrl.getMingMap(t,i),[17,18,18,19,19,20,23,24,25,36,37,35,38]),i=[35,38],t=(DataMgr.gameCtrl.getMingMap(t,i),[17,17,34,35,36,21,22,23,24,25]),i=[20,23],t=(DataMgr.gameCtrl.getMingMap(t,i),[20,20,20,22]),i=[21],t=(DataMgr.gameCtrl.getMingMap(t,i),[18,19,20,21,22]),i=[17,20,23],t=(DataMgr.gameCtrl.getMingMap(t,i),[17,18,19,20,20,21,21,22,35,35,36,36,36]),i=[19,22],a=[36],t=(DataMgr.gameCtrl.getMingMap(t,i,a),[18,19,20,20,33,34,35,37,37,22]),i=[21],t=(DataMgr.gameCtrl.getMingMap(t,i),[19,23,23,23,36,37,38,38,39,40]),i=[19],t=(DataMgr.gameCtrl.getMingMap(t,i),[22,23,24,36,37,38,66,66,19,19,20,20,21]),i=[18,21],t=(DataMgr.gameCtrl.getMingMap(t,i),[22,22,22,33,33,36,37,38,66,66]),i=[33,66],s=[22],t=(DataMgr.gameCtrl.getMingMap(t,i,s),[18,19,19,20,20,21,21]),i=[18,21],t=(DataMgr.gameCtrl.getMingMap(t,i),[18,19,19,20,20,21,21,18]);check_can_hu(t)}}function getQueryString(t){if(cc.sys.isNative)try{var e="";return cc.sys.os==cc.sys.OS_ANDROID?e=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getQueryString","(Ljava/lang/String;)Ljava/lang/String;",t):cc.sys.os==cc.sys.OS_IOS&&(e=jsb.reflection.callStaticMethod("AppController","getQueryString:",t)),""==e?null:e}catch(t){return null}if(null==window||null==window.location)return null;var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(i);return null!=a?unescape(a[2]):null}function getAndroidIpAdd(t){if(cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID){var e=parseFloat(getQueryString("android_version"))||0;if(e+.001<3.3)return t;try{var i=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getIpAdd","(Ljava/lang/String;)Ljava/lang/String;",t);return i?i:t}catch(e){return t}}return t}function copyStrToClipboard(t){var e=0;if(t=t||"",t+="",cc.sys.isNative){try{cc.sys.os==cc.sys.OS_ANDROID?e=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","copyStrToClipboard","(Ljava/lang/String;)I",t):cc.sys.os==cc.sys.OS_IOS&&(e=jsb.reflection.callStaticMethod("AppController","copyStrToClipboard:",t))}catch(t){return-1}return e}return-2}function setScreenSize(){cc.sys.dump();var t=640,e=1024,i=1136,a=cc.view.getFrameSize();if(!cc.sys.isNative&&!simulator)return void(cc.sys.isMobile?(a.height<e?(n=e/a.height,r=e):a.height>i&&(n=i/a.height,r=i),1!=n&&(s=n*a.width),s<t&&(n=t/a.width,s=t,r=a.height*n),winSizeWidthBigger.width=r,winSizeWidthBigger.height=s,cc.view.setDesignResolutionSize(s,r,cc.ResolutionPolicy.SHOW_ALL)):(cc.view.setDesignResolutionSize(640,1136,cc.ResolutionPolicy.SHOW_ALL),winSizeWidthBigger.width=1136,winSizeWidthBigger.height=640,cc.log("setScreenSize coming the not Native")));var s=a.width,r=a.height,n=1;s<r?(designOrientation=SCREEN_ORIENTATION_PROTRAIT,a.height<e?(n=e/a.height,r=e):a.height>i&&(n=i/a.height,r=i),1!=n&&(s=n*a.width),s<t&&(n=t/a.width,s=t,r=a.height*n),winSizeWidthBigger.width=r,winSizeWidthBigger.height=s):(designOrientation=SCREEN_ORIENTATION_LANDSCAPE,a.width<e?(n=e/a.width,s=e):a.width>i&&(n=i/a.width,s=i),1!=n&&(r=n*a.height),r<t&&(n=t/a.height,r=t,s=a.width*n),winSizeWidthBigger.width=s,winSizeWidthBigger.height=r),cc.view.setDesignResolutionSize(s,r,cc.ResolutionPolicy.NO_BORDER)}function initAudio(){var t=cc.sys.localStorage.getItem("musicVolume"),e=cc.sys.localStorage.getItem("effectsVolume");if(null==t){var i=!0;cc.sys.isNative&&(i=!1),gSetMusic(i)}if(null==e){var i=!1;gSetMusicEffect(!1)}}UILayer=ccui.Widget.extend({isControlNode:!1,_listeners:null,_cacheParent:null,_waitPathNum:0,_isCallLoaded:!1,ctor:function(t,e,i){ccui.Widget.prototype.ctor.call(this),this.uiPath=t,this._onSuccessInit(),this.setAnchorPoint(cc.p(0,0)),this._isWaitLoad=!0,this._listeners=[],this._cacheParent=e,this._cacheControlNode=i,this._loadPaths=[];var a=this;a._addWaitPath(t),UIUtils.GetCurJsonData(t,function(i,s){if(!i){var r=UIUtils.CalcNeedLoadImage(s);cc.loader.load(r,function(t,e,i){},function(){if(!a._isWaitLoad)return void a._tryLoaded(t);a._isWaitLoad=!1;var i=UIUtils.GetControlNode(a,e);UIUtils.CocosGenBaseNodeByData(s,a,e,i),cc.eventManager.dispatchCustomEvent("Loaded:"+a.__instanceId),a._subUILoaded(t)})}})},onSuccessInit:function(){},_onSuccessInit:function(){this.onSuccessInit()},_addWaitPath:function(t){this._waitPathNum+=1},_tryLoaded:function(t){return this._waitPathNum<=0&&!this._isCallLoaded&&(this.onLoaded(),this._isCallLoaded=!0,UIUtils.TryNoticeUILoaded({path:this.uiPath},this._cacheControlNode||this._cacheParent)),this._isCallLoaded},_subUILoaded:function(t){return this._waitPathNum-=1,this._tryLoaded(t)},onLoaded:function(){},uiLoaded:function(t){},isWaitLoad:function(){return this._isWaitLoad},isLoaded:function(){return!this._isWaitLoad},eventListener:function(t){var e="";if(t.target&&(e=t.target.getName()||""),e){var i="tap_"+e;if(!this[i])return;"ended"==t.name&&this[i].call(this,t)}},close:function(){this.stopAllActions(),this.removeFromParent(!0)},show:function(){},addListener:function(t,e){var i=cc.eventManager.addCustomListener(t,e);return this._listeners.push(i),i},removeListener:function(t){var e=this._listeners.indexOf(t);e>=0&&this._listeners.splice(e,1),cc.eventManager.removeListener(t)},onExit:function(){ccui.Widget.prototype.onExit.call(this);for(var t=0;t<this._listeners.length;t++)cc.eventManager.removeListener(this._listeners[t])}}),UILayer.canMultiOpen=function(){return!1},UILayer.create=function(t,e,i){return new UILayer(t,e,i)},UIRichText=ccui.RichText.extend({_originConfig:null,_curConfig:null,_text:"",_font:"",ctor:function(t,e,i){ccui.RichText.prototype.ctor.call(this),this.allElement=[],this.initWithConfig(i||{}),this.setContentSize(e.width||100,e.height||100),this.ignoreContentAdaptWithSize(!1),this.setText(t)},initWithConfig:function(t){this._originConfig=UIUtils.merge({color:cc.color.WHITE,fontSize:20,ocolor:cc.color.BLACK,osize:0},t),this._curConfig=UIUtils.dup(this._originConfig)},clearAllElement:function(){for(var t=0;t<this.allElement.length;t++)this.removeElement(this.allElement[t]);this.allElement=[]},setString:function(t){this.setText(t)},setText:function(t){this._text!=t&&(this.clearAllElement(),this._curConfig=UIUtils.dup(this._originConfig),this._text=t||"",this.parseText(this._text),this.formatText())},addNewLineElement:function(){var t=ccui.RichElementNewLine.create(1,this._curConfig.color,255);this.pushBackElement(t),this.allElement.push(t)},addRichElement:function(t){var e=null;if(cc.sys.isNative)e=ccui.RichElementText.create(1,this._curConfig.color,255,t,this._curConfig.font,this._curConfig.fontSize,this._curConfig.osize>0?32:0,"",this._curConfig.ocolor,this._curConfig.osize);else{var i=new cc.FontDefinition({fillStyle:this._curConfig.color,fontName:this._curConfig.font,fontSize:this._curConfig.fontSize,strokeEnabled:this._curConfig.osize>0,strokeStyle:this._curConfig.ocolor,lineWidth:this._curConfig.osize});e=ccui.RichElementText.create(1,i,255,t)}this.pushBackElement(e),this.allElement.push(e)},forceUpdate:function(){this.setText(this._text)},richTextGetRGB:function(t){var e=/c(\d{1,3}):(\d{1,3}):(\d{1,3})/g,i=e.exec(t);return null==i?null:new cc.Color(parseInt(i[1]),parseInt(i[2]),parseInt(i[3]))},parseConfig:function(t){t.length;if("/c"==t)this._curConfig.color=this._originConfig.color;else if("cr"==t)this._curConfig.color=cc.color.RED;else if("cw"==t)this._curConfig.color=cc.color.WHITE;else if("cg"==t)this._curConfig.color=cc.color.GREEN;else if("co"==t)this._curConfig.color=cc.color.ORANGE;else if("cb"==t)this._curConfig.color=cc.color.BLUE;else if("cy"==t)this._curConfig.color=cc.color.YELLOW;else if("c"==t.charAt(0)){var e=this.richTextGetRGB(t);e&&(this._curConfig.color=e)}else if("ocr"==t)this._curConfig.ocolor=cc.color.RED;else if("ocw"==t)this._curConfig.ocolor=cc.color.WHITE;else if("ocg"==t)this._curConfig.ocolor=cc.color.GREEN;else if("co"==t)this._curConfig.ocolor=cc.color.ORANGE;else if("ocb"==t)this._curConfig.ocolor=cc.color.BLUE;else if("ocy"==t)this._curConfig.ocolor=cc.color.YELLOW;else if(0==t.indexOf("oc")){var e=this.richTextGetRGB(t.substring(1));e&&(this._curConfig.color=e)}else 0==t.indexOf("f")?this._curConfig.fontSize=parseInt(t.substring(1)):0==t.indexOf("of")?this._curConfig.osize=parseInt(t.substring(2)):"/f"==t?this._curConfig.fontSize=this._originConfig.fontSize:"/of"==t?this._curConfig.osize=this._originConfig.osize:"br"==t&&this.addNewLineElement()},parseText:function(t){for(var e=!1,i=0,a=0;i<t.length;){var s=t.charAt(i),r=i>0&&"\\"==t.charAt(i-1);if("["==s&&!r){i>a&&(this.addRichElement(t.substring(a,i)),a=i),e=!0;var n=function(e,i){for(i=t.indexOf("]",i);i>0&&"\\"==t.charAt(i-1);)i=t.indexOf("]",i);return i},o=n(t,i+1);if(o<0)break;this.parseConfig(t.substring(i+1,o)),i=o,a=o+1,e=!1}e=!1,i+=1}e||this.addRichElement(t.substring(a))}});var ReplacePathMap={},gFileMd5=gFileMd5||{};RegisterReplacePathMap=function(t,e){ReplacePathMap[t]=e},UIDataUtils={};var CacheDataTable={},MultiLanguageData={},CurrentLanguageSet="Zh",UIPrefix="",JsonLoadCacheCallback={},JsonLoadingFlag={};UIDataUtils.AddJsonLoadedCallback=function(t,e){JsonLoadCacheCallback[t]=JsonLoadCacheCallback[t]||[],JsonLoadCacheCallback[t].push(e)},UIDataUtils.DoJsonLoadedCallback=function(t,e,i){for(var a=JsonLoadCacheCallback[t]||[],s=0;s<a.length;s++)a[s](e,i);JsonLoadCacheCallback[t]=[],JsonLoadingFlag[t]=null},UIDataUtils.GetJsonDataFromFile=function(t,e){t=this.CalcUIPath(t),this.AddJsonLoadedCallback(t,e);var i=this;if(CacheDataTable[t])return void i.DoJsonLoadedCallback(t,null,CacheDataTable[t]);try{if(JsonLoadingFlag[t])return;JsonLoadingFlag[t]=!0,cc.loader.loadJson(t,function(a,s){return a?e(a,s):(CacheDataTable[t]=s,void i.DoJsonLoadedCallback(t,null,s))})}catch(e){i.DoJsonLoadedCallback(t,null,null)}},UIDataUtils.CalcUIPath=function(t){return t?GetRealPath(UIPrefix+t):null},UIDataUtils.SetUIPrefix=function(t,e){UIPrefix=t},UIDataUtils.GetUIPrexifx=function(){return UIPrefix},UIDataUtils.SetLanguagePath=function(t){UIDataUtils.GetJsonDataFromFile(t,function(t,e){t||(MultiLanguageData=e)})},UIDataUtils.SetLanguageData=function(t){MultiLanguageData=t},UIDataUtils.SetCurrentLangSet=function(t){CurrentLanguageSet=t},UIDataUtils.GetLangFromConfig=function(t){return null==MultiLanguageData[t]?null:MultiLanguageData[t][CurrentLanguageSet]||""},UIDataUtils.TryAnalyseLang=function(t){var e={isKey:!1};if(0==t.indexOf("@")){var i=t.substring(1),a=this.GetLangFromConfig(i);null!=a&&(e.value=a,e.isKey=!0,e.key=i)}return e},SCREEN_ORIENTATION_PROTRAIT=1,SCREEN_ORIENTATION_LANDSCAPE=2,SCREEN_ORIENTATION=SCREEN_ORIENTATION_PROTRAIT,SCREEN_CUR_ORIENTATION=SCREEN_ORIENTATION,UIUtils={};var CacheDataTable={},PathTemple={},OrientationPath={};UIUtils.isNum=function(t){return"number"==typeof t},UIUtils.isNull=function(t){return null===t||void 0===t},UIUtils.isValue=function(t){return!UIUtils.isNull(t)},UIUtils.CheckPathRepeat=function(t,e){for(var i=t;i;){if(e==i._path||e==i._sceneSubPath)return!0;i=i.getParent()}return!1},UIUtils.RegisterOrientationPath=function(t){OrientationPath[t]=1},UIUtils.bolOrientationPath=function(t){return OrientationPath[t]},UIUtils.RegisterPathTemple=function(t,e){PathTemple[t]=e},UIUtils.GetPathTemple=function(t){return PathTemple[t]},UIUtils.GetCurJsonData=function(t,e){"string"==typeof t?UIDataUtils.GetJsonDataFromFile(t,e):"object"==typeof t?e(null,t):e(null,{})},UIUtils.TryAddWaitUILoaded=function(t,e,i){if(t.path&&e){for(e.getParent()&&(i=null);i;)i instanceof UILayer&&i._addWaitPath(t.path),i=i.getParent();for(i=e;i;)i instanceof UILayer&&i._addWaitPath(t.path),i=i.getParent()}},UIUtils.TryNoticeUILoaded=function(t,e){if(t.path&&e)for(var i=e;i;)i instanceof UILayer&&(i.uiLoaded(t.path),i._subUILoaded(t.path)),i=i.getParent()},UIUtils.CalcNeedLoadImage=function(t){var e=this.GetNeedLoadImage(t),i=[];for(var a in e)i.push(a);return i},UIUtils.GetNeedLoadImage=function(t,e){e=e||{};var i=function(t){t&&(e[UIDataUtils.CalcUIPath(t)]=!0)};"UIInput"==t.type?i(t.spriteFrame):"UIImage"==t.type?i(t.spriteFrame):"UIScale9"==t.type?i(t.spriteFrame):"UISlider"==t.type?(i(t.barBg),i(t.barProgress),i(t.barNormalBall),i(t.barSelectBall),i(t.barDisableBall)):"UIButton"==t.type?(i(t.bgNormal),i(t.bgSelect),i(t.bgDisable)):"UICheckBox"==t.type?(i(t.back),i(t.backSelect),i(t.active),i(t.backDisable),i(t.activeDisable)):"UITextAtlas"==t.type&&i(t.charMapFile),t.children=t.children||{};for(var a=0;a<t.children.length;a++)UIUtils.GetNeedLoadImage(t.children[a],e);return e},UIUtils.CovertToColor=function(t){return!t||UIUtils.isNull(t[1])?null:cc.color(t[0],t[1],t[2],t[3])},UIUtils.CalcWidth=function(t,e,i){UIUtils.isNull(e)&&t&&(e=t.getContentSize().width),e=""+(e||0);var a=e.indexOf("%");if(!i||a<0)return parseInt(e);var s=e.substring(0,a);return e=i.getContentSize().width*parseFloat(s)/100,parseInt(e)},UIUtils.CalcHeight=function(t,e,i){UIUtils.isNull(e)&&t&&(e=t.getContentSize().height),e=""+(e||0);var a=e.indexOf("%");if(!i||a<0)return parseInt(e);var s=e.substring(0,a);return e=i.getContentSize().height*parseFloat(s)/100,parseInt(e)},UIUtils.GetControlNode=function(t,e){if(t.isControlNode)return t;for(var i=null;e;){if(e instanceof UILayer&&e.isControlNode){i=e;break}e=e.getParent()}return i?i:t},UIUtils.AddTouchEvent=function(t,e,i,a,s){if(i&&a){var r=a;s&&i[s]&&(r=i[s]),e(t,function(t){r.call(i,t)})}},UIUtils.addTouchListenerCallback=function(t,e){t.addTouchEventListener(function(t,i){var a={};0==i?a.name="began":1==i?a.name="moved":2==i?(a.name="ended",playEffect("btn_click.mp3")):a.name="canceled",a.target=t,e(a)})},UIUtils.onSliderEvent=function(t,e){t.addEventListener(function(t,i){var a={};i==ccui.Slider.EVENT_PERCENT_CHANGED&&(a.name="ON_PERCENTAGE_CHANGED"),a.target=t,e(a)})},UIUtils.onCheckBoxEvent=function(t,e){t.addEventListener(function(t,i){var a={};i==ccui.CheckBox.EVENT_SELECTED?a.name="selected":a.name="unselected",a.target=t,e(a)})},UIUtils.onEditboxEvent=function(t,e){var i={},a={editBoxEditingDidBegin:function(t){i.name="begin",i.target=t,e(i)},editBoxEditingDidEnd:function(t){i.name="end",i.target=t,e(i)},editBoxTextChanged:function(t,a){i.name="changed",i.target=t,e(i)},editBoxReturn:function(t){i.name="return",i.target=t,e(i)}};t.setDelegate(a)},UIUtils.CocosGenBaseNodeByData=function(t,e,i,a){if(!t)return null;var s=null,r=!1;t.touchEnabled&&(r=t.touchEnabled);var n=this;if(e);else if(t.path){if(UIUtils.TryAddWaitUILoaded(t,i),this.CheckPathRepeat(i,t.path))return null;var o=this.GetPathTemple(t.path);o||(o=UILayer),e=o.create(t.path,i,a),r&&this.AddTouchEvent(e,this.addTouchListenerCallback,a,a.eventListener,t.touchListener)}else if("UIImage"==t.type)e=ccui.ImageView.create(),r&&this.AddTouchEvent(e,this.addTouchListenerCallback,a,a.eventListener,t.touchListener);else if("UIScale9"==t.type)e=ccui.Scale9Sprite.create(UIDataUtils.CalcUIPath(t.spriteFrame));else if("UIText"==t.type)e=ccui.Text.create();else if("UITextAtlas"==t.type)e=ccui.TextAtlas.create();else if("UIArmature"==t.type)t.plistPath&&cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath(t.plistPath),UIDataUtils.CalcUIPath(t.imagePath)),t.configFilePath&&ccs.armatureDataManager.addArmatureFileInfo(UIDataUtils.CalcUIPath(t.configFilePath)),e=ccs.Armature.create(t.actionName);else if("UIInput"==t.type){var c=UIDataUtils.CalcUIPath(t.spriteFrame)||"",l=this.CalcWidth(e,t.width,i),_=this.CalcHeight(e,t.height,i);e=c?cc.EditBox.create(cc.size(l,_),ccui.Scale9Sprite.create(c)):cc.EditBox.create(cc.size(l,_),ccui.Scale9Sprite.create()),t.isSizeSeted=!0,this.AddTouchEvent(e,this.onEditboxEvent,a,a.eventListener,t.touchListener)}else if("UISlider"==t.type)e=ccui.Slider.create(),this.AddTouchEvent(e,this.onSliderEvent,a,a.eventListener,t.touchListener);else if("UIButton"==t.type)e=ccui.Button.create(),this.AddTouchEvent(e,this.addTouchListenerCallback,a,a.eventListener,t.touchListener);else if("UICheckBox"==t.type)e=ccui.CheckBox.create(),
this.AddTouchEvent(e,this.onCheckBoxEvent,a,a.eventListener,t.touchListener);else if("UIScrollView"==t.type)e=ccui.ScrollView.create(),r&&this.AddTouchEvent(e,this.addTouchListenerCallback,a,a.eventListener,t.touchListener);else if("UIListView"==t.type)e=ccui.ListView.create(),r&&this.AddTouchEvent(e,this.addTouchListenerCallback,a,a.eventListener,t.touchListener);else if("UIRichText"==t.type){var u={};t.oriFontSize&&(u.fontSize=t.oriFontSize),t.oriOSize&&(u.osize=t.oriOSize);var s=this.CovertToColor(t.oriColor);s&&(u.color=s),s=this.CovertToColor(t.oriOColor),s&&(u.ocolor=s);var h=t.text||"",g=UIDataUtils.TryAnalyseLang(h);h=g.isKey?g.value:t.text;var l=this.CalcWidth(e,t.width,i),_=this.CalcHeight(e,t.height,i);e=new UIRichText(t.text||"",{width:l,height:_},u)}else e=ccui.Widget.create(),r&&this.AddTouchEvent(e,this.addTouchListenerCallback,a,a.eventListener,t.touchListener);if(i&&!e.getParent()&&i.addChild(e),e._isWaitLoad)var n=this,d=cc.eventManager.addCustomListener("Loaded:"+e.__instanceId,function(){n.SetBaseNodeProp(e,t,i,a),cc.eventManager.removeListener(d)});else this.SetBaseNodeProp(e,t,i,a);t.children=t.children||{};for(var m=0;m<t.children.length;m++){var f=t.children[m];this.CocosGenBaseNodeByData(f,null,e,a)}return e},UIUtils.SetBaseNodeProp=function(t,e,i,a){if("boolean"==typeof e.touchEnabled&&t.setTouchEnabled&&t.setTouchEnabled(e.touchEnabled),e.id&&(t.setName(e.id),a&&(a[e.id]&&console.log("WAINING!!! You have same tag name("+e.id+") node"),a[e.id]=t)),!e.isSizeSeted&&(e.width||e.height)){var s=t.setPreferredSize||t.setContentSize,r=this.CalcWidth(t,e.width,i),n=this.CalcHeight(t,e.height,i);s.call(t,cc.size(r,n))}if(e.autoLayout&&(i&&t!=i?t.setContentSize(i.getContentSize()):t.setContentSize(cc.winSize),SCREEN_CUR_ORIENTATION!=SCREEN_ORIENTATION)){var o=t.getContentSize();t.setContentSize(cc.size(o.height,o.width))}var c=this.isNull,l=this.CovertToColor;if(!c(e.x)&&(t.x=parseFloat(e.x)),!c(e.y)&&(t.y=parseFloat(e.y)),!c(e.left)&&(t.x=parseFloat(e.left),t.left=e.left),!c(e.right)&&i&&(t.x=i.width-parseFloat(e.right),t.right=e.right),!c(e.horizontal)&&i&&(t.x=i.width/2+e.horizontal,t.horizontal=e.horizontal),!c(e.bottom)&&(t.y=parseFloat(e.bottom),t.bottom=e.bottom),!c(e.top)&&i&&(t.y=i.height-parseFloat(e.top),t.top=e.top),!c(e.vertical)&&i&&(t.y=i.height/2+e.vertical,t.vertical=e.vertical),!c(e.anchorX)&&(t.anchorX=parseFloat(e.anchorX)),!c(e.anchorY)&&(t.anchorY=parseFloat(e.anchorY)),!c(e.scaleX)&&(t.scaleX=parseFloat(e.scaleX)),!c(e.scaleY)&&(t.scaleY=parseFloat(e.scaleY)),!c(e.opacity)&&(t.opacity=parseFloat(e.opacity)),!c(e.rotation)&&(t.rotation=parseFloat(e.rotation)),!c(e.visible)&&t.setVisible(e.visible),l(e.color)&&(t.color=l(e.color)),!c(e.touchListener)&&(t.touchListener=e.touchListener),e.path)e.setCustomData&&e.setCustomData(e);else if("UIText"==e.type){if(e.string){var _=UIDataUtils.TryAnalyseLang(e.string);_.isKey?t.setString(_.value):t.setString(e.string)}e.textAlign&&t.setTextHorizontalAlignment(e.textAlign),e.verticalAlign&&t.setTextVerticalAlignment(e.verticalAlign),e.fontSize&&t.setFontSize(e.fontSize),e.fontName&&t.setFontName(e.fontName),color=l(e.outlineColor),color&&t.enableOutline(color,e.outlineSize||1),(e.boundingWidth||e.boundingHeight)&&t.setTextAreaSize(cc.size(e.boundingWidth||0,e.boundingHeight||0))}else"UIInput"==e.type?(e.string&&t.setString(e.string),color=l(e.fontColor),color&&t.setFontColor(color),e.maxLength&&t.setMaxLength(e.maxLength),e.placeHolder&&t.setPlaceHolder(e.placeHolder),e.placeHolderFontSize&&t.setPlaceholderFontSize(e.placeHolderFontSize),e.placeHolderFontName&&t.setPlaceholderFontName(e.placeHolderFontName),e.inputFlag&&t.setInputFlag(parseInt(e.inputFlag)),e.inputMode&&t.setInputMode(parseInt(e.inputMode)),e.returnType&&t.setReturnType(parseInt(e.returnType))):"UIImage"==e.type?(this.SetNodeBySpriteFrameName(e.spriteFrame,t,t.loadTexture),e.blendSrc&&t.setBlendFunc({src:e.blendSrc,dst:t.getBlendFunc().dst}),e.blendDst&&t.setBlendFunc({src:t.getBlendFunc().src,dst:e.blendDst})):"UIScale9"==e.type?(e.insetLeft&&(t.insetLeft=e.insetLeft),e.insetTop&&(t.insetTop=e.insetTop),e.insetRight&&(t.insetRight=e.insetRight),e.insetBottom&&(t.insetBottom=e.insetBottom)):"UISlider"==e.type?(e.percent&&t.setPercent(e.percent),this.SetNodeBySpriteFrameName(e.barBg,t,t.loadBarTexture),this.SetNodeBySpriteFrameName(e.barProgress,t,t.loadProgressBarTexture),this.SetNodeBySpriteFrameName(e.barNormalBall,t,t.loadSlidBallTextureNormal),this.SetNodeBySpriteFrameName(e.barSelectBall,t,t.loadSlidBallTexturePressed),this.SetNodeBySpriteFrameName(e.barDisableBall,t,t.loadSlidBallTextureDisabled)):"UIButton"==e.type?(e.scale9Enable&&t.setScale9Enabled(e.scale9Enable),this.SetNodeBySpriteFrameName(e.bgNormal,t,t.loadTextureNormal),this.SetNodeBySpriteFrameName(e.bgSelect,t,t.loadTexturePressed),this.SetNodeBySpriteFrameName(e.bgDisable,t,t.loadTextureDisabled),e.titleText&&t.setTitleText(e.titleText),e.fontSize&&t.setTitleFontSize(e.fontSize),e.fontName&&t.setTitleFontName(e.fontName),color=l(e.fontColor),color&&t.setTitleColor(color)):"UICheckBox"==e.type?(this.SetNodeBySpriteFrameName(e.back,t,t.loadTextureBackGround),this.SetNodeBySpriteFrameName(e.backSelect,t,t.loadTextureBackGroundSelected),this.SetNodeBySpriteFrameName(e.active,t,t.loadTextureFrontCross),this.SetNodeBySpriteFrameName(e.backDisable,t,t.loadTextureBackGroundDisabled),this.SetNodeBySpriteFrameName(e.activeDisable,t,t.loadTextureFrontCrossDisabled),e.select&&t.setSelected(e.select),e.enable&&t.setTouchEnabled(e.enable)):"UITextAtlas"==e.type?e.charMapFile&&(t.uiData=e,t.setProperty(e.string,UIDataUtils.CalcUIPath(e.charMapFile),e.itemWidth,e.itemHeight,e.mapStartChar)):"UIArmature"==e.type?t.getAnimation().play("stand",-1,1):"UIScrollView"==e.type||"UIListView"==e.type?(t.setClippingType(1),(e.innerPosX||e.innerPosY)&&t.setInnerContainerPosition(cc.p(e.innerPosX||0,e.innerPosY||0)),(e.innerSizeW||e.innerSizeH)&&t.setInnerContainerSize(cc.size(e.innerSizeW||0,e.innerSizeH||0)),e.direction&&t.setDirection(e.direction),"boolean"==typeof e.scrollBarEnabled&&t.setScrollBarEnabled(e.scrollBarEnabled),"boolean"==typeof e.inertiaScrollEnabled&&t.setInertiaScrollEnabled(e.inertiaScrollEnabled),"boolean"==typeof e.bounceEnabled&&t.setBounceEnabled(e.bounceEnabled)):"UIRichText"==e.type&&(e.textAlign&&t.setTextHorizontalAlignment(e.textAlign),e.verticalAlign&&t.setTextVerticalAlignment(e.verticalAlign));return"UIListView"==e.type&&(e.gravity&&t.setGravity(e.gravity),e.itemsMargin&&t.setItemsMargin(e.itemsMargin)),t},UIUtils.SetNodeBySpriteFrame=function(t,e,i){if(t){t=UIDataUtils.CalcUIPath(t);var a=this.GetSpriteFrameForName(t);a&&i.call(e,a)}},UIUtils.SetNodeBySpriteFrameName=function(t,e,i,a){if(t){t=UIDataUtils.CalcUIPath(t);var s=this.GetSpriteFrameForName(t);s&&i.call(e,t,a||1)}},UIUtils.GetSpriteFrameForName=function(t){if("string"!=typeof t)return null;var e=cc.spriteFrameCache.getSpriteFrame(t);if(!e){var i=cc.textureCache.getTextureForKey(t);i&&(e=cc.SpriteFrame.create(i,cc.rect(0,0,i.getContentSize().width,i.getContentSize().height)),cc.spriteFrameCache.addSpriteFrame(e,t))}return e},UIUtils.GetTextureForName=function(t){if("string"!=typeof t)return null;var e=cc.textureCache.getTextureForKey(t);return e},UIUtils.merge=function(t,e){if("object"!=typeof t||"object"!=typeof e)return t;for(var i in e)t[i]=e[i];return t},UIUtils.dup=function(t){if("object"!=typeof t)return t;var e={};for(var i in t)e[i]=t[i];return e};var hexcase=0,b64pad="",chrsz=8;HEEPAY_META_AGENT_ID=function(){return 2105998},HEEPAY_META_OPTION_IOS=function(){var t='{"s":"IOS","n":"南昌麻将","id":"com.gongpa.ncmj"}';return IsGameTypeFzmjOrNdmj()&&(t='{"s":"IOS","n":"福州麻将","id":"com.gongpa.fjmj"}'),t},HEEPAY_META_OPTION_ANDROID=function(){var t='{"s":"Android","n":"南昌麻将","id":"com.gongpa.ncmj"}';return IsGameTypeFzmjOrNdmj()&&(t='{"s":"Android","n":"福州麻将","id":"com.gongpa.fjmj"}'),t},HEEPAY_META_OPTION_WAP=function(t){var e='{"s":"WAP","n":"南昌麻将","id":"'+t+'"}";)';return IsGameTypeFzmjOrNdmj()&&(e='{"s":"WAP","n":"福州麻将","id":"'+t+'"}";)'),e},HEEPAY_PAY_WEB=function(t,e,i){var a={};this.moeny=t,a.chargeType=i||"room_card",a.totalCard=e,a.agent_id=HEEPAY_META_AGENT_ID(),a.is_phone=1,a.is_frame=1,a.pay_type=30,a.pay_amt=t,a.return_url=encodeURIComponent(getPayReturnUrl(0,0)),cc.sys.isNative&&(a.return_url="http://ywt2.gongpaa.com/chargesuccess/"),a.notify_url="unknow",a.user_ip=ME_D.get_user().client_ip,a.goods_name=encodeURIComponent(ROOM_CARD_NAME),a.goods_num=this.reward,a.goods_note=encodeURIComponent("x"+ROOM_CARD_NAME),a.pay_code="",a.remark="",a.ownMoney=ME_D.get_user().room_card,a.ownStone=ME_D.get_user().stone,a.extendUid=ME_D.get_user().extend_uid,a.userName=ME_D.get_user().name,a.userRid=ME_D.get_user().rid,a.userUid=ME_D.get_user().account_uid,a.detail=GAME_TYPE,cc.sys.isNative?(a.is_frame=0,cc.sys.os===cc.sys.OS_IOS?a.meta_option=encodeURIComponent(HEEPAY_META_OPTION_IOS()):a.meta_option=encodeURIComponent(HEEPAY_META_OPTION_ANDROID())):a.meta_option=encodeURIComponent(HEEPAY_META_OPTION_WAP(a.return_url));var s=GAME_WEB_PORT;({method:"POST",timeout:5e3,url:GAME_WEB_URL+GAME_WEB_PORT+"/apihfbpay/ApiRequestSign",data:JSON.stringify(a)});a.userName=encodeURIComponent(a.userName),a.is_frame=0,a.meta_option=encodeURIComponent(HEEPAY_META_OPTION_IOS()),a.hfbpayurl=encodeURIComponent(GAME_WEB_URL+s+"/apihfbpay/ApiRequestSign"),a.zyfpayurl=encodeURIComponent(GAME_WEB_URL+s+"/apizyfpay/ApiRequestSign"),a.payurl=encodeURIComponent(GAME_WEB_URL+s);var r=GAME_WEB_URL+"/paynew?";for(var n in a)r+=n+"="+a[n]+"&";return void cc.sys.openURL(r)};var lastEffectAudio;playEffect=function(t){if(t&&!MUSIC_NONE_MAP[t]){var e=cc.sys.localStorage.getItem("effectsVolume");e<=0||(cc.audioEngine.setEffectsVolume(e/100),lastEffectAudio=cc.audioEngine.playEffect(GetRealPath("res/music/"+t)))}};var lastMusicName="",lastMusicAudio;playMuisc=function(t){if(t){var e=cc.sys.localStorage.getItem("musicVolume");return e<=0?void(lastMusicName=t):void(lastMusicName!=t&&(lastMusicName=t,cc.audioEngine.setMusicVolume(e/100),lastMusicAudio=cc.audioEngine.playMusic(GetRealPath("res/music/"+t),1)))}},Array.prototype.remove=function(t){if(isNaN(t)||t>this.length)return!1;for(var e=0,i=0;e<this.length;e++)this[e]!=this[t]&&(this[i++]=this[e]);this.length-=1},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t},parseTime=function(t){t=t||0;var e=new Date(1e3*t),i="";return i+=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",i+=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",i+=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",i+=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes()},zeroMemory=function(t,e){memset(t,0,e)},memset=function(t,e,i){for(var a=0;a<i;a++)t[a]=e},isEmptyObject=function(t){if("object"!=typeof t)return!1;for(var e in t)return!1;return!0};var EARTH_RADIUS=6378137,PI=Math.PI;gDup=function(t){if("object"!=typeof t)return t;if(!t)return t;if(void 0!=t.length){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}var a={};for(var s in t)a[s]=t[s];return a},gDeepDup=function(t){if("object"!=typeof t)return t;if(null===t)return null;if(void 0!=t.length){for(var e=[],i=0;i<t.length;i++)e[i]=gDeepDup(t[i]);return e}var a={};for(var s in t)a[s]=gDeepDup(t[s]);return a},String.prototype.format=function(){var t=this,e=arguments,i=e.length;if(i<1)return t;var a=0,s=t.replace(/(%d)|(%i)|(%s)|(%f)|(%o)/g,function(t){if(e.length<=a)return t;var i=e[a++];return"%d"==t||"%i"==t?parseInt(i):i});return s},arrayToMap=function(t){var e={};if(!t)return e;for(var i=0;i<t.length;i++){var a=t[i];e[a]=(e[a]||0)+1}return e},gBolObjectNull=function(t){if(!t)return!0;if("object"==typeof t){if("undefined"==typeof t.length){var e=0;for(var i in t)e++;if(e>0)return!0}else if(t.length<=0)return!0;return!1}return!0};var gShareImag=null;ModuleMgr={},g_dlgLayer=null;var g_scene=null,DLG_ZORDER=100,MSG_ZORDER=200,GUILD_ZORDER=900,WAIT_MSG_TAG=-200,CONFIRM_MSG_TAG=-201,clsMap={},loadGameMap={};ModuleMgr.runScene=function(t,e){function i(t,e){var i=clsMap[t];if(!i)return void console.log("========can not find the scene == "+t+"====");var a=i.create(e);cc.director.runScene(a),g_scene=a,g_scene.name=t,g_dlgLayer=cc.Node.create(),g_dlgLayer.setContentSize(cc.winSize),g_scene.addChild(g_dlgLayer)}g_scene&&g_scene.name==t||(!loadGameMap[t]&&ModuleLoadGame[t]?cc.loader.loadJs(ModuleLoadGame[t],function(){loadGameMap[t]=!0,i(t,e)}):i(t,e))};var dlgList={};ModuleMgr.runDlg=function(){function t(t,e,i,a){function s(){n.setAnchorPoint(.5,.5),n.setPositionX(cc.winSize.width/2),n.setPositionY(cc.winSize.height/2),a&&a(n)}var r=clsMap[t];if(!r)return void console.log("========can not find the dlg == "+t+"====");ModuleMgr.getDlg(t)&&(r.canMultiOpen&&r.canMultiOpen()||ModuleMgr.closeDlg(t));var n=r.create(e,i);if(n.setName(t),e&&void 0!=e.dlgZorder?n.setLocalZOrder(e.dlgZorder):n.setLocalZOrder(DLG_ZORDER),n.isLoaded())s();else var o=cc.eventManager.addCustomListener("Loaded:"+n.__instanceId,function(){s(),cc.eventManager.removeListener(o)});SCREEN_CUR_ORIENTATION!=SCREEN_ORIENTATION&&n.setRotation(ModuleMgr.getScreenRotation()),n.getParent()||i.addChild(n)}var e,i,a,s;e=arguments[0],2==arguments.length&&(s=arguments[1]),arguments.length>=3&&(i=arguments[1],a=arguments[2],s=arguments[3]),dlgList[e]=[arguments[0],arguments[1],arguments[2],arguments[3]],a=a||g_dlgLayer,"function"==typeof i&&(s=i,i=null),!loadGameMap[e]&&ModuleLoadGame[e]?cc.loader.loadJs(ModuleLoadGame[e],function(){loadGameMap[e]=!0,t(e,i,a,s)}):t(e,i,a,s)},cc.eventManager.addCustomListener("screen_change",function(t){if(cc.log("screen_change!"),0==cc.sys.isNative&&__BrowserGetter){for(var e=__BrowserGetter.availWidth(cc.EGLView._getInstance()._frame),i=__BrowserGetter.availHeight(cc.EGLView._getInstance()._frame),a=ModuleMgr.getAllDlg(),s=[],r=0;r<a.length;r++){var n=a[r].getName(),o=dlgList[n];o&&s.push(o)}ModuleMgr.removeAllDlg();for(var c=0,l=0,r=0;r<s.length;r++)c=.2*r+.2,g_dlgLayer.scheduleOnce(function(){var t=s[l++];ModuleMgr.runDlg(t[0],t[1],t[2],t[3])},c);e>i&&g_dlgLayer.scheduleOnce(function(){ModuleMgr.showConfirmTxtMsg("手机锁定屏幕,体验更佳 ")},c+.2)}}),ModuleMgr.runNode=function(){function t(t,e,i){function a(){s&&s(n),n.release()}var r=clsMap[t];if(!r)return void console.log("========can not find the dlg == "+t+"====");var n=r.create(e,i);if(n.setName(t),n.retain(),n.attr({x:0,y:0,anchorX:0,anchorY:0}),n.isLoaded())a();else var o=cc.eventManager.addCustomListener("Loaded:"+n.__instanceId,function(){a(),cc.eventManager.removeListener(o)});i&&!n.getParent()&&i.addChild(n)}var e,i,a,s;e=arguments[0],2==arguments.length&&(s=arguments[1]),arguments.length>=3&&(i=arguments[1],a=arguments[2],s=arguments[3]),"function"==typeof i&&(s=i,i=null,a=null),!loadGameMap[e]&&ModuleLoadGame[e]?cc.loader.loadJs(ModuleLoadGame[e],function(){loadGameMap[e]=!0,t(e,i,a)}):t(e,i,a)},ModuleMgr.createNode=function(){function t(){s&&s(r),r.release()}var e,i,a,s;e=arguments[0],2==arguments.length&&(s=arguments[1]),arguments.length>=3&&(i=arguments[1],a=arguments[2],s=arguments[3]);var r=e.create(i,a);if(r.retain(),a&&!r.getParent()&&a.addChild(r),r.isLoaded())t();else var n=cc.eventManager.addCustomListener("Loaded:"+r.__instanceId,function(){t(),cc.eventManager.removeListener(n)});return r},ModuleMgr.createTouchDlg=function(t){var e=cc.LayerColor.create(cc.color(0,0,0,155)),i=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e,a){return t&&t()&&cc.eventManager.removeListener(i),!0}});return e.onExit=function(){cc.LayerColor.prototype.onExit.call(e),cc.eventManager.removeListener(i)},cc.eventManager.addListener(i,e),e},ModuleMgr.getAllDlg=function(){return g_dlgLayer.getChildren()},ModuleMgr.removeAllDlg=function(){g_dlgLayer.removeAllChildren()},ModuleMgr.getDlg=function(t){return g_dlgLayer.getChildByName(t)},ModuleMgr.closeDlg=function(t){var e=ModuleMgr.getDlg(t);e&&e.close&&e.close()},ModuleMgr.registerModule=function(t,e){clsMap[t]=e},ModuleMgr.showTipMsg=function(t,e){if(t){var i=t,a={};a.type=MsgMgr.MSG_TYPE.TIP,a.text=i,a.strArr=e,ModuleMgr.showMsg(a)}},ModuleMgr.showConfirmCancelMsg=function(t,e,i,a){var s={};s.type=MsgMgr.MSG_TYPE.CONFIRM,s.text=t,s.okFunc=e,s.cancelFunc=i,s.time=a,ModuleMgr.showMsg(s)},ModuleMgr.showConfirmTxtMsg=function(t,e,i){var a={};a.type=MsgMgr.MSG_TYPE.CONFIRM,a.text=t,a.font_size=i,null==e&&(e=function(){}),a.okFunc=e;var s=ModuleMgr.showMsg(a);s.hideCancel()},ModuleMgr.waitView=null,ModuleMgr.showWaitMsg=function(t,e,i,a){if(ModuleMgr.waitView)return void ModuleMgr.waitView.updateTxt(t||"");null==i&&(i=!0),ModuleMgr.removeWaitMsg(),null==e&&(e=2);var s={};s.type=MsgMgr.MSG_TYPE.WAIT,s.text=t||"",s.black=i,s.time=e,s.noClose=a||!1;var r=ModuleMgr.showMsg(s);r.setTag(WAIT_MSG_TAG),ModuleMgr.waitView=r},ModuleMgr.removeWaitMsg=function(){ModuleMgr.waitView&&(ModuleMgr.waitView.close(),ModuleMgr.waitView=null)},ModuleMgr.getScreenRotation=function(){if(SCREEN_CUR_ORIENTATION!=SCREEN_ORIENTATION){if(designOrientation==SCREEN_ORIENTATION_LANDSCAPE)return 0;if(0==cc.sys.isNative&&__BrowserGetter){var t="1"==(getQueryString("lanscape_dev")||getQueryString("ld")||"0");if(t)return-90;var e=__BrowserGetter.availWidth(cc.EGLView._getInstance()._frame),i=__BrowserGetter.availHeight(cc.EGLView._getInstance()._frame);return e>i?-90:90}return 90}return 0},ModuleMgr.switchNodeRect=function(t){if(t){if(ModuleMgr.getScreenRotation()==-90){var e=t.width;t.x=t.x-t.height,t.y=t.y+t.width,t.width=t.height,t.height=e,t.y-=t.height}else if(90==ModuleMgr.getScreenRotation()){var e=t.width;t.width=t.height,t.height=e,t.y-=t.height}return t}},ModuleMgr.MsgViewList=[],ModuleMgr.showMsg=function(t){var e=MsgMgr.showMsg(t);if(console.log("msg object = "+e),e)return e.setLocalZOrder(MSG_ZORDER),e.setTag(MSG_ZORDER),g_dlgLayer.addChild(e),e.setRotation(ModuleMgr.getScreenRotation()),ModuleMgr.MsgViewList.push(e),e},ModuleMgr.removeAllMsg=function(){for(var t=0;t<ModuleMgr.MsgViewList.length;t++)ModuleMgr.MsgViewList[t]&&ModuleMgr.MsgViewList[t].close();ModuleMgr.MsgViewList=[]},ModuleMgr.showAwardConfirm=function(t,e,i){var a={};a.type=MsgMgr.MSG_TYPE.AWARD_CONFIRM,a.text=t,a.extraData=e,null==i&&(i=function(){}),a.okFunc=i;ModuleMgr.showMsg(a)},ModuleLoadGame={},MsgMgr={},MsgMgr.MSG_TYPE={TIP:1,WAIT:2,CONFIRM:3,FZ_CONFIRM:4,AWARD_CONFIRM:5},MsgMgr.msgList={},MsgMgr.registerMsg=function(t,e){this.msgList[t]||(this.msgList[t]=e)},MsgMgr.showMsg=function(t){var e=t.type,i=t.text;t.func,t.id,t.font_size;IsGameTypeFzmjOrNdmj()&&e==MsgMgr.MSG_TYPE.CONFIRM&&(e=MsgMgr.MSG_TYPE.FZ_CONFIRM);var a=this.msgList[e];if(!a)return void console.log("===================== can not find then msg type  "+e);t.text=i;var s=a.create();if(s.isLoaded())s.setData(t),s.show();else var r=cc.eventManager.addCustomListener("Loaded:"+s.__instanceId,function(){s.setData(t),s.show(),cc.eventManager.removeListener(r)});return s},QPLayer=UILayer.extend({isControlNode:!0,_textTempMap:{},events:{},isAllLoaded:!1,eventStack:{},ctor:function(t,e,i){UILayer.prototype.ctor.call(this,t,e,i);for(var a=this,s=0;s<this.events.length;s++){var r=this.events[s],n=function(t){var e=t.getEventName();if(0==a.isAllLoaded)return void(a.eventStack[e]=t.getUserData());var i=a["deal_"+e];i&&i.call(a,t)};this.addListener(r,n)}},onExit:function(){this.unscheduleUpdate(),UILayer.prototype.onExit.call(this)},dealEventStack:function(){this.isAllLoaded=!0;for(var t in this.eventStack)cc.eventManager.dispatchCustomEvent(t,this.eventStack[t])},setText:function(){var t=arguments[0],e=this[t];if(e){var i=this._textTempMap[t];i||(this._textTempMap[t]=e.getString(),i=this._textTempMap[t]),i||(i="");for(var a="",s=[],r=1;r<arguments.length;r++)s.push(arguments[r]);for(var n=i.split("%s"),r=0;r<n.length;r++)a+=n[r],null!=s[r]&&void 0!=s[r]&&(a+=s[r]);e.setString(a)}},sortGrp:function(t,e,a,s){var t=t,a=a||0,e=e||0,s=s||0,r=this[t];if(r){var n=r.getChildren()||[],o=0,c=0;for(i=0;i<n.length;i++){var l=n[i];if(l&&l.isVisible()){var _=l.getContentSize(),u=_.width*l.getScaleX(),h=_.height*l.getScaleY();0==a?(o=o+u+e,h>c&&(c=h)):(c=c+h+e,u>o&&(o=u))}}0==a?o-=e:c-=e,r.setContentSize(cc.size(o,c));var g=0;for(1==a&&(g=c),1==s&&(g=o),i=0;i<n.length;i++){var l=n[i];if(l&&l.isVisible()){var _=l.getContentSize(),u=_.width*l.getScaleX(),h=_.height*l.getScaleY();0==a?1==s?(l.setAnchorPoint(1,0),l.setPositionY(0),l.setPositionX(g),g=g-u-e):(l.setAnchorPoint(0,0),l.setPositionY(0),l.setPositionX(g),g=g+u+e):(l.setAnchorPoint(0,1),l.setPositionX(0),l.setPositionY(g),g=g-h-e)}}return r}},refreshList:function(t){var e=this,i=t.name,a=t.itemCell||e[i+"_item"],s=t.list,r=t.selectId||0,n=t.async||!1;if(s&&a){var o=e[i];if(o){o.setClippingType(ccui.Layout.CLIPPING_STENCIL),o.setBounceEnabled(!0);var c=0;ModuleMgr.createNode(a,function(l){function _(t,e){d=a.create();var i=d.getContentSize();d.setAnchorPoint(.5,.5),d.setPositionX(i.width/2),d.setPositionY(i.height/2),d.setTouchEnabled(!0),o.pushBackCustomItem(d),d.setTag(e),d.setData&&d.setData(t),r==e?d.setSelect&&d.setSelect():d.setNormal&&d.setNormal()}function u(t,i,a){e.scheduleOnce(function(){_(t,i)},a)}var h=o.getItems()||[];for(f=0;f<s.length;f++){var g=s[f],d=h[f];d?(d.setTag(f),d.setData&&d.setData(g),r==f?d.setSelect&&d.setSelect():d.setNormal&&d.setNormal()):n?(c+=.01,u(g,f,c)):_(g,f)}if(s.length<h.length)for(var m=h.length,f=s.length;f<m;f++)o.removeLastItem();t.isNotAddListen||o.addEventListener(function(t,a){var s=t.getCurSelectedIndex();if(0==a){var r="tap_begin_"+i;e[r]&&e[r](s)}else{var r="tap_end_"+i;e[r]&&e[r](s);for(var n=t.getItems(),o=0;o<n.length;o++){var c=n[o];o==s?c.setSelect&&c.setSelect():c.setNormal&&c.setNormal()}}},e)})}}}}),QPLayer.create=function(t,e,i){return new QPLayer(t,e,i)},QPDlg=QPLayer.extend({isTouchClose:!1,isAllLoaded:!1,isDlgActionEnd:!1,bolDlgAction:!0,bgLayerOpacity:150,ctor:function(t,e,i){QPLayer.prototype.ctor.call(this,t,e,i)},onSuccessInit:function(){QPLayer.prototype.onSuccessInit.call(this);var t=this,e=cc.LayerColor.create(cc.color(0,0,0));e.setContentSize(cc.size(3*cc.winSize.width,3*cc.winSize.height)),e.setPosition(cc.p(-cc.winSize.width,-cc.winSize.height));var i=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(t,e){return!0},onTouchEnded:function(e,i){t.isTouchClose&&t.close()}});if(e.setOpacity(this.bgLayerOpacity),e.onExit=function(){cc.LayerColor.prototype.onExit.call(e),cc.eventManager.removeListener(i)},cc.eventManager.addListener(i,e),t.addChild(e),this.bolDlgAction){t.scale=.1;var a=function(e){t.isDlgActionEnd=!0,t.isAllLoaded&&t.dlgActionEnd()},s=cc.Sequence.create(cc.ScaleTo.create(.15,1.05),cc.ScaleTo.create(.1,1),cc.CallFunc.create(a));this.runAction(s)}},dlgActionEnd:function(){},onLoaded:function(){this.isAllLoaded=!0,this.isDlgActionEnd&&this.dlgActionEnd()},tap_btn_close:function(t){this.close()}}),QPDlg.create=function(t,e,i){return new QPDlg(t,e,i)},QPListItem=QPLayer.extend({_isSeclet:!1,onLoaded:function(){this._onNormal()},setData:function(t){},setSelect:function(){this._isSeclet||(this._isSeclet=!0,this._onSelect())},setNormal:function(){this._isSeclet&&(this._isSeclet=!1,this._onNormal())},_onSelect:function(){},_onNormal:function(){}}),QPListItem.create=function(t,e,i){return new QPListItem(t,e,i)},WaitMgr={},WaitMgr.msgKeyMap={},WaitMgr.msgStr="",WaitMgr.showWait=function(t,e,i){WaitMgr.msgStr=t,ModuleMgr.showWaitMsg("网络连接中",i)},WaitMgr.hideWait=function(t){WaitMgr.msgStr==t&&ModuleMgr.removeWaitMsg()},EVENT_ENTER_GAME="EVENT_ENTER_GAME",EVENT_ENTER_ROOM="EVENT_ENTER_ROOM",EVENT_ENTER_DESK="EVENT_ENTER_DESK",EVENT_DESK_INFO="EVENT_DESK_INFO",EVENT_ROOM_DETAIL="EVENT_ROOM_DETAIL",EVENT_ROOM_MSG_RECEIVE="EVENT_ROOM_MSG_RECEIVE",EVENT_CONNECTION_LOST="EVENT_CONNECTION_LOST",EVENT_GAME_RULE_DLG_ITEM_CLICK="EVENT_GAME_RULE_DLG_ITEM_CLICK",EVENT_NOTICE_DLG_ITEM_CLICK="EVENT_NOTICE_DLG_ITEM_CLICK",EVENT_NEW_CLUB_DLG_ITEM_CLICK="EVENT_NEW_CLUB_DLG_ITEM_CLICK",EVENT_MJ_ROOM_CK_ROUND_CHANGE="EVENT_MJ_ROOM_CK_ROUND_CHANGE",GAME_FZMJ_MENU_ITEM_ID=1,GAME_NDMJ_BAI_MENU_ITEM_ID=2,GAME_NDMJ_KAI_MENU_ITEM_ID=3,SHOP_ALL_MENU_ITEM_ID=1,SHOP_OWN_MENU_ITEM_ID=2,NEW_CLUB_MENU_ITEM_ID_CTREATE=1,NEW_CLUB_MENU_ITEM_ID_SEARCH=2,NEW_CLUB_MENU_ITEM_ID_XINXI_BIG=3,NEW_CLUB_MENU_ITEM_ID_ZHANJI=4,NEW_CLUB_MENU_ITEM_ID_LIAOTIAN=5,NEW_CLUB_MENU_ITEM_ID_CLUB_ZUJU=6,NEW_CLUB_MENU_ITEM_ID_QUICK_ZUJU=7,NEW_CLUB_MENU_ITEM_ID_SAIZHI_ZUJU=8,NEW_CLUB_MENU_ITEM_ID_XINXI_SECOND=11,NEW_CLUB_MENU_ITEM_ID_GUANLI=12,NEW_CLUB_MENU_ITEM_ID_SAIZHI=13,NEW_CLUB_MENU_ITEM_ID_FENXIANG=14,NEW_CLUB_MENU_ITEM_ID_TUICHU=15,NEW_CLUB_MENU_ITEM_ID_ZHANJI_NORMAL=21,NEW_CLUB_MENU_ITEM_ID_ZHANJI_SAIZHI=22,NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU=23,LOCAL_Z_ORDER_OF_HEAD_FRAME=10,IS_TEST_CARD=0,H5_FOCUS_PUBLIC_URL="http://mp.weixin.qq.com/s/7ankBO1vIrxLZtXAUSgIig",cc.loader.register(["ui"],cc._jsonLoader),GAME_TYPE="fzmj",DISSOLVE_TIME=60;var gameTypeMap={};RegisterGameType=function(t){gameTypeMap[t]=t},GetGameType=function(t){return gameTypeMap[t]},GetGameTypeByRoomId=function(t){var e=GAME_TYPE,i=""+t;return GAME_TYPE!==GAME_TYPE_FZMJ&&GAME_TYPE!==GAME_TYPE_NDMJ||(parseInt(i)>=7e5&&parseInt(i)<72e4?e=GAME_TYPE_FZMJ:parseInt(i)>=73e4&&(e=GAME_TYPE_NDMJ)),e},HELP_IMG_CFG=[GetRealPath("res/uires/new/wanfa/wf_fzmj1.png"),GetRealPath("res/uires/new/wanfa/wf_fzmj2.png"),GetRealPath("res/uires/new/wanfa/wf_ndmj_bai1.png"),GetRealPath("res/uires/new/wanfa/wf_ndmj_bai2.png"),GetRealPath("res/uires/new/wanfa/wf_ndmj_kai.png")],HELP_IMG_CFG_FZMJ=[GetRealPath("res/uires/new/wanfa/wf_fzmj1.png"),GetRealPath("res/uires/new/wanfa/wf_fzmj2.png")],HELP_IMG_CFG_NDMJ_BAI=[GetRealPath("res/uires/new/wanfa/wf_ndmj_bai1.png"),GetRealPath("res/uires/new/wanfa/wf_ndmj_bai2.png")],HELP_IMG_CFG_NDMJ_KAI=[GetRealPath("res/uires/new/wanfa/wf_ndmj_kai.png")],GET_CHAYE_COST_BY_ROOM_DATA=function(t){var e=0;return 8===t.full_round?e=4===t.full_num?5:4:16===t.full_round&&(e=4===t.full_num?10:8),e},LOCATE_PLAFORM={WECHAT:0,MOSTONE:1},CMD_INTERNAL_AUTH="cmd_internal_auth",CMD_LOGIN="cmd_login",CMD_USER_LIST="cmd_user_list",MSG_USER_LIST="msg_user_list",CMD_CREATE_USER="cmd_create_user",MSG_CREATE_USER="msg_create_user",CMD_SELECT_USER="cmd_select_user",MSG_ENTER_GAME="msg_enter_game",MSG_LOGIN_NOTIFY_STATUS="msg_login_notify_status",NEW_CLIENT_INIT="new_client_init",LOSE_CLIENT="lose_client",CMD_COMMON_OP="cmd_common_op",MSG_COMMON_OP="msg_common_op",MSG_OBJECT_UPDATED="msg_object_updated",MSG_PROPERTY_LOADED="msg_property_loaded",MSG_BONUS="msg_bonus",CMD_SALE_OBJECT="cmd_sale_object",MSG_SALE_OBJECT="msg_sale_object",MSG_PROPERTY_DELETE="msg_property_delete",CMD_CHAT="cmd_chat",MSG_CHAT="msg_chat",CMD_LEAVE_ROOM="cmd_leave_room",MSG_DB_RESULT="msg_db_result",CMD_ROOM_MESSAGE="cmd_room_message",CMD_ENTER_DESK="cmd_enter_desk",MSG_ENTER_DESK="msg_enter_desk",CMD_CREATE_DESK="cmd_create_desk",MSG_CREATE_DESK="msg_create_desk",CMD_BIND_EXTEND="cmd_bind_extend",MSG_BIND_EXTEND="msg_bind_extend",CMD_SHARE_GAME="cmd_share_game",MSG_SHARE_GAME="msg_share_game",MSG_NEW_DAY="msg_new_day",CMD_SHARE_AWARD="cmd_share_award",MSG_SHARE_AWARD="msg_share_award",CMD_SUB_TURN_TIMES="cmd_sub_turn_times",MSG_SUB_TURN_TIMES="msg_sub_turn_times",CMD_CHECK_HEART="cmd_check_heart",MSG_CHECK_HEART="msg_check_heart",CMD_UNION_OPER="cmd_union_oper",MSG_UNION_OPER="msg_union_oper",CMD_UNION_MESSAGE="cmd_union_message",MSG_UNION_MESSAGE="msg_union_message",CMD_GET_RANK="cmd_get_rank",MSG_GET_RANK="msg_get_rank",CMD_BIND_RECOMMEND="cmd_bind_recommend",MSG_BIND_RECOMMEND="msg_bind_recommend",CMD_RECOMMEND_INFO="cmd_recommend_info",MSG_RECOMMEND_INFO="msg_recommend_info",CMD_RECOMMEND_GET="cmd_recommend_get",MSG_RECOMMEND_GET="msg_recommend_get",CMD_ITEM_OPER="cmd_item_oper",MSG_ITEM_OPER="msg_item_oper",HTTP_IFACE_WECHAT_LOGIN="/apiwechatlogin",HTTP_IFACE_GUEST_LOGIN="/apiguestlogin",HTTP_IFACE_TELEPHONE_LOGIN="/apitelephonelogin",HTTP_IFACE_API_LOGIN="/apilogin",HTTP_IFACE_MOST_LOGIN="/ApiMoWangLogin",HTTP_BIND_PHONE="/apibindtele",HTTP_TURN_ACTIVITY="/apiactivity",HTTP_TURN_DO="/apiactivity/doTurn",HTTP_FULL_NAME="/apifullname",HTTP_FORECE_USERCODE_OPEN="/apisettings/isForeceUserCodeOpen",HTTP_GET_MATCH_RECORD="/apigame/getGameMatchRecord",HTTP_GET_MATCH_RANK="/ApiRank/getrank",HTTP_GET_MATCH_DEAL_RECORD="/apigame/getTelChangeLog",HTTP_GET_DIFT_INFO="/apiactivity/getRankGiftInfo",HTTP_IFACE_GET_RECORD="/apigame/getRecord",HTTP_IFACE_GET_ONE_RECORD="/apigame/getonerecord",HTTP_IFACE_GET_RECEIVE_GIFT="/apigame/receiveGift",HTTP_IFACE_GET_REPLAY_RECORD="/apigame/getGameDetailRecord",HTTP_IFACE_GET_NEWS="/apinews",HTTP_IFACE_GET_SCROLL="/apinews/getScroll",HTTP_IFACE_GET_NOTICE_OPEN="/apinews/getNoticeOpen?gameType="+GAME_TYPE,HTTP_IFACE_GET_NOTICE_CLOSE="/apinews/getNoticeClose?gameType="+GAME_TYPE,HTTP_IFACE_TEL_REQUEST_MSG_CODE="/apitelephone/requestMsgCode",HTTP_IFACE_TEL_BINDING_TEL="/apitelephone/bindingTel",HTTP_IFACE_TEL_LOOK_FOR_PASSWARD="/apitelephone/lookforPassword",HTTP_IFACE_TEL_CHANGE_PASSWARD="/apitelephone/changePassword",NetMsg={},NetMsg.stackMsg=[],NetMsg.isPushStack=!1,NetMsg.testErrMsg="",NetMsg.msg_object_updated=function(t,e){if(t==ME_D.get_rid()){e.desk_idx&&(DataMgr.gameCtrl.deskIdx=e.desk_idx);for(var i in e)ME_D.get_user()[i]=e[i];cc.eventManager.dispatchCustomEvent("userChange")}},NetMsg.msg_check_heart=function(t){if(t.timestamp&&DataMgr.timeCtrl.setServerTime(t.timestamp),t.cmstime){var e=parseInt((new Date).getTime()%1e7);DataMgr.timeCtrl.disMstime=(e-t.cmstime)/2,DataMgr.timeCtrl.cmstime=t.cmstime,DataMgr.timeCtrl.setServerMsTime(t.mstime)}},NetMsg.msg_login_notify_status=function(t){console.log("info = ",t),t.ret&&(ModuleMgr.removeWaitMsg(),ModuleMgr.showConfirmTxtMsg("验证出错"))},NetMsg.msg_user_list=function(t){console.log("list = ",t)},NetMsg.msg_create_user=function(t){console.log("list = ",t)},NetMsg.msg_close_reason=function(t){LOGIN_D.reason=t.reason},NetMsg.msg_enter_game=function(t){cc.log("msg_enter_game---info",t),ME_D.me_updated(t);var e=parseInt((new Date).getTime()%1e7);WsNetwork.getInstance().sendMessage(CMD_CHECK_HEART,{cmstime:e}),logSaveServer(),DataMgr.timeCtrl.initData(t.time_map),DataMgr.gameCtrl.deskIdx=t.user.desk_idx,DataMgr.gameCtrl.gameType=t.user.game_type;var i=GAME_TYPE;if(0!=DataMgr.gameCtrl.deskIdx)null==NetMsg.firstEnterRoom&&(NetMsg.firstEnterRoom=!0),i=GetGameTypeByRoomId(DataMgr.gameCtrl.deskIdx),ME_D.send_message(CMD_ENTER_DESK,{game_type:i,desk_idx:t.user.desk_idx,oncestr:t.user.oncestr});else if(NetMsg.firstEnterRoom=!1,1!=NetMsg.hasQuery){NetMsg.hasQuery=!0;var a=parseInt(getQueryString("desk")),s=getQueryString("oncestr");if(a>0){var r=getQueryString("desk_union_rid")||"",n=getQueryString("desk_match_rid")||"";i=GetGameTypeByRoomId(a),ME_D.send_message(CMD_ENTER_DESK,{game_type:i,desk_idx:a,oncestr:s,union_rid:r,match_rid:n})}}ME_D.send_message(CMD_COMMON_OP,{oper:"get_activity",game_type:i}),ME_D.send_message(CMD_ITEM_OPER,{oper:"get_wear_list",game_type:GAME_TYPE}),ME_D.send_message(CMD_ITEM_OPER,{oper:"get_item_list",game_type:GAME_TYPE})},NetMsg.msg_create_desk=function(t){cc.log("msg_create_desk-----info",t),ME_D.send_message(CMD_ENTER_DESK,{game_type:t.game_type,desk_idx:t.desk_idx})},NetMsg.msg_create_desk_err=function(t){t.ret==-5&&ModuleMgr.showConfirmCancelMsg("未实名认证玩家不能创建房间，\n点击确定前往认证",function(){ModuleMgr.runDlg("UserCodeDlg")})},NetMsg.msg_enter_room=function(t){},NetMsg.msg_enter_desk_err=function(t){if(cc.log("msg_enter_desk_err-----info",t),t.ret==-5)return void ModuleMgr.showConfirmCancelMsg("未实名认证玩家不能创建房间，\n点击确定前往认证",function(){ModuleMgr.runDlg("UserCodeDlg")});if(1==NetMsg.firstEnterRoom){var e=parseInt(getQueryString("desk"));
if(e>0){var i=GetGameTypeByRoomId(e);ME_D.send_message(CMD_ENTER_DESK,{game_type:i,desk_idx:e})}}else{var a=t.err_msg;ModuleMgr.showConfirmTxtMsg(a)}DataMgr.gameCtrl.deskIdx=0,NetMsg.firstEnterRoom=!1},NetMsg.msg_enter_desk=function(t){cc.log("msg_enter_desk-----info",t)},NetMsg.msg_bind_extend=function(t){if(t.ret==-1&&t.err_msg)return void ModuleMgr.showTipMsg(t.err_msg);ME_D.get_user().extend_uid=t.extend_uid,cc.eventManager.dispatchCustomEvent("SuccessBind");var e="您已成功绑定 \n代理Id:"+t.extend_uid+" 代理名字:"+toDecodeURIComponent(t.name)+"\n前往充值";ModuleMgr.showConfirmTxtMsg(e,function(){cc.sys.isNative?ModuleMgr.runDlg("MallDlg"):ModuleMgr.showConfirmCancelMsg("请下载客户端充值",function(){var t=getNativeDownUrl();return t?void cc.sys.openURL(t):ModuleMgr.showTipMsg("敬请期待！")})})},NetMsg.msg_new_day=function(t){DataMgr.timeCtrl.newData()},NetMsg.msg_share_game=function(t){DataMgr.timeCtrl.addTodayShareTime(1),cc.eventManager.dispatchCustomEvent("SuccessShareGame")},NetMsg.msg_share_award=function(t){ModuleMgr.showTipMsg("领取成功");var e=DataMgr.timeCtrl.getShareStatusList();e[t.idx-1]=1,DataMgr.timeCtrl.setShareStatusList(e),cc.eventManager.dispatchCustomEvent("SuccessShareAward")},NetMsg.msg_sub_turn_times=function(t){DataMgr.timeCtrl.subLeftTurnTimes(1)},NetMsg.msg_common_op=function(t){"receive_native"==t.oper?(ModuleMgr.showTipMsg("领取成功"),DataMgr.timeCtrl.setReceiveNativeRewards(GAME_TYPE),cc.eventManager.dispatchCustomEvent("success_receive_native_rewards")):"notify_error"==t.oper&&t.err_msg?gInReview||(NetMsg.testErrMsg=t.err_msg):"get_activity"==t.oper?DataMgr.activityCtrl.activityData=ConvertToJson(t.str):"new_day"==t.oper&&(DataMgr.accountCtrl.receiveAwardNum=t.stone,cc.eventManager.dispatchCustomEvent("OnReceiveAward"))},NetMsg.msg_room_message=function(t,e){return e.ret==-1&&e.err_msg?void ModuleMgr.showTipMsg(e.err_msg):NetMsg.isPushStack?void NetMsg.stackMsg.push({oper:t,info:e}):void NetMsg.msg_room_message_game(t,e)},NetMsg.dealStackMsg=function(){for(var t=0;t<NetMsg.stackMsg.length;t++)NetMsg.msg_room_message_game(NetMsg.stackMsg[t].oper,NetMsg.stackMsg[t].info);NetMsg.isPushStack=!1,NetMsg.stackMsg=[]},NetMsg.msg_room_message_base=function(t,e){if("success_enter_desk"==t){DataMgr.gameCtrl.online[e.wheel_idx]=!0;var i=DataMgr.gameCtrl.addPlayer(e);e.info&&e.rid!=ME_D.get_rid()&&(i?ModuleMgr.showTipMsg(toDecodeURIComponent(e.info.name)+"加入游戏"):ModuleMgr.showTipMsg(toDecodeURIComponent(e.info.name)+"重新连接")),cc.eventManager.dispatchCustomEvent("SuccessEnterDesk",i)}else if("user_location_change"==t)DataMgr.gameCtrl.location=e.user_location_info;else if("success_leave_desk"==t)if(DataMgr.gameCtrl.online[e.wheel_idx]=!1,DataMgr.gameCtrl.wheelInfos[e.wheel_idx]&&(DataMgr.gameCtrl.wheelInfos[e.wheel_idx].is_ready=1),e.wheel_idx!=DataMgr.gameCtrl.myWheelIdx){var a=DataMgr.gameCtrl.players[e.wheel_idx];0==e.is_playing?(DataMgr.gameCtrl.removePlayer(e.wheel_idx),cc.eventManager.dispatchCustomEvent("SuccessLeaveDesk",!0),a&&a.info&&DataMgr.gameCtrl.deskInfo.cur_step!=MJ_STEP_GAME_END&&ModuleMgr.showTipMsg(toDecodeURIComponent(a.info.name)+"离开游戏")):(cc.eventManager.dispatchCustomEvent("SuccessLeaveDesk",!1),a&&a.info&&ModuleMgr.showTipMsg(toDecodeURIComponent(a.info.name)+"掉线了"))}else 0==DataMgr.gameCtrl.isOwer()&&(DataMgr.gameCtrl.deskIdx=0),DataMgr.gameCtrl.deskIdx=0,cc.eventManager.dispatchCustomEvent("SuccessOwnLeaveDesk",!1);else if("chat"==t||"face"==t){var s=DataMgr.gameCtrl.getChairIdxByRid(e.rid);if(e.txt)return void cc.eventManager.dispatchCustomEvent("SuccessPlayChatTxt",{chair:s,txt:e.txt});if(e.faceId)return e.faceId>=1e3&&e.faceId<2e3?void cc.eventManager.dispatchCustomEvent("FaceInter",e):void cc.eventManager.dispatchCustomEvent("SuccessPlayChatFace",{chair:s,faceId:e.faceId});DataMgr.gameCtrl.deskChat[e.media_id]=s,cc.sys.isNative?"html5"!=e.platform&&platform.downRecord(e.media_id):"html5"==e.platform?platform.downRecord(e.media_id):"native"==e.platform&&cc.loader.load(e.media_id,function(t){if(t=cc.loader.getRes(e.media_id)){t=t.cloneNode(),t.setVolume(1),t.play(),cc.eventManager.dispatchCustomEvent("SuccessStartPlayRecord",e.media_id),document.addEventListener("WeixinJSBridgeReady",function(){t.play()},!1);var i=setInterval(function(){0==t.getPlaying()&&(cc.eventManager.dispatchCustomEvent("SuccessEndPlayRecord",e.media_id),window.clearInterval(i))},10)}})}else if("success_user_ready"==t){var r=e.idx;DataMgr.gameCtrl.wheelInfos[r]&&(DataMgr.gameCtrl.wheelInfos[r].is_ready=1),cc.eventManager.dispatchCustomEvent("SuccessUserReady",e)}else if("dissolve_success"==t)DataMgr.gameCtrl.deskIdx=0,cc.eventManager.dispatchCustomEvent("SuccessDissolve",e);else if("user_apply_dissolve"==t)DataMgr.gameCtrl.dissovle=[],zeroMemory(DataMgr.gameCtrl.dissovle,5),DataMgr.gameCtrl.dissovle[e.idx]=1,DataMgr.gameCtrl.deskTime=getTimestamp(),IsGameTypeFzmjOrNdmj()?ModuleMgr.runDlg("NewGameDissolve"):ModuleMgr.runDlg("GameDissolve");else if("user_agree_dissolve"==t)DataMgr.gameCtrl.dissovle[e.idx]=1,cc.eventManager.dispatchCustomEvent("AGREE_DISSOLVE");else if("user_refuse_dissolve"==t){DataMgr.gameCtrl.dissovle[e.idx]=2,cc.eventManager.dispatchCustomEvent("REFUSE_DISSOLVE");var a=DataMgr.gameCtrl.players[e.idx];a&&a.info&&ModuleMgr.showTipMsg(toDecodeURIComponent(a.info.name)+"拒绝解散")}else if("room_create"==t)DataMgr.gameCtrl.deskInfo.cur_round=0,DataMgr.gameCtrl.deskInfo.desk_own_rid=e.desk_own_rid,DataMgr.gameCtrl.myCards=[],cc.eventManager.dispatchCustomEvent("SUCCECES_ROOM_CREATE");else if("start_game_error"==t)ModuleMgr.showTipMsg(e.err_msg);else if("desk_info"==t){DataMgr.gameCtrl.deskInfo=e,DataMgr.gameCtrl.deskIdx=e.desk_idx,DataMgr.gameCtrl.curStep=e.cur_step,DataMgr.gameCtrl.online={},DataMgr.gameCtrl.dissovle=[],zeroMemory(DataMgr.gameCtrl.dissovle,5);for(var n={},o=0;o<e.wheels.length;o++)n[e.wheels[o].rid]=o+1;for(var o=0;o<e.details.length;o++)if(e.details[o].rid){var c={};c.info=e.details[o],c.poker_num=e.wheels[o].poker_num,c.left_time=e.wheels[o].left_time,c.rid=e.details[o].rid,c.wheel_idx=n[c.rid],DataMgr.gameCtrl.addPlayer(c);for(var l=null,_=0;e.users.length;_++)if(e.details[o].rid==e.users[_].rid){l=e.users[_];break}l&&null==l.last_logout_time?DataMgr.gameCtrl.online[l.idx]=!0:DataMgr.gameCtrl.online[o+1]=!1}if(e.desk_dissolve_info)for(var o=0;o<e.desk_dissolve_info.length;o++)1==e.desk_dissolve_info[o].spec5&&(DataMgr.gameCtrl.dissovle[o+1]=1);DataMgr.clubCtrl.bolOpenClub=e.union_rid,DataMgr.gameCtrl.deskStatus=e.desk_status,DataMgr.gameCtrl.deskTime=e.desk_status_time;for(var o=0;o<e.wheels.length;o++)DataMgr.gameCtrl.wheelInfos[o+1]=e.wheels[o],e.wheels[o].rid==ME_D.get_rid()&&(DataMgr.gameCtrl.myWheelInfo=e.wheels[o]);DataMgr.gameCtrl.myWheelInfo&&DataMgr.gameCtrl.initMyCards(DataMgr.gameCtrl.myWheelInfo.poker_list),DataMgr.gameCtrl.getLocation()}else if("success_start_game"==t)cc.eventManager.dispatchCustomEvent("SuccessStartGame",e);else if("new_ttw_record"==t)DataMgr.gameCtrl.recordId=e.rid;else if("step_change"==t)DataMgr.gameCtrl.curStep=e.cur_step,DataMgr.gameCtrl.deskInfo&&(DataMgr.gameCtrl.deskInfo.cur_step=e.cur_step);else if("check_user_wheel"==t){for(var u=!1,h=e.details,o=0;o<h.length;o++){var e=h[o],g=o+1;if(!DataMgr.gameCtrl.players[g]){var c={};c.wheel_idx=g,c.info=e,c.rid=e.rid,DataMgr.gameCtrl.online[c.wheel_idx]=!0,DataMgr.gameCtrl.addPlayer(c),u=!0}}u&&cc.eventManager.dispatchCustomEvent("SuccesRefreshPlayers",e)}else"share_to_match"==t&&ModuleMgr.showTipMsg("好友圈分享成功")},NetMsg.msg_room_message_game=function(t,e){},NetMsg.msg_notify_time=function(t){DataMgr.timeCtrl.changeTimeIngo(t)},NetMsg.msg_union_oper=function(t,e){return e.ret==-1?ModuleMgr.showTipMsg(e.err_msg):void("msg_list"==t?DataMgr.clubCtrl.setUnionList(e.union_list):"enter_union"==t?(DataMgr.clubCtrl.setClubData(e.union_union_data),DataMgr.clubCtrl.setClubSelfInfo(e.union_char_data),cc.eventManager.dispatchCustomEvent("EnterUnionSucces")):"create_union"==t?(DataMgr.clubCtrl.pushUnionList(e.union_union_data),ModuleMgr.showTipMsg("创建成功"),cc.eventManager.dispatchCustomEvent("CreateUnionSucces"),IsGameTypeFzmjOrNdmj()?ModuleMgr.runDlg("NewClubRoomDlg"):ModuleMgr.runDlg("ClubRoomDlg")):"search_union"==t?cc.eventManager.dispatchCustomEvent("SearchUnionSucces",e):"recommend_union"==t?cc.eventManager.dispatchCustomEvent("RecommendUnionSucces",e):"level_up_union"==t?(ModuleMgr.showTipMsg("升级成功"),DataMgr.clubCtrl.setClubData(e.union_union_data),cc.eventManager.dispatchCustomEvent("LevelUpUnionSucces",e)):"create_match"==t?(DataMgr.clubCtrl.setMatchData(e.map),DataMgr.clubCtrl.curClubData.match_rid=e.map&&e.map.rid,e.map&&e.map.cost_ratio&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_cost_ratio",{game_type:GAME_TYPE,cost_match_ratio:e.map.cost_ratio,cost_ratio:DataMgr.clubCtrl.curClubData.cost_ratio}),cc.eventManager.dispatchCustomEvent("CreateMatchSucces",e)):"continue_match"==t?(DataMgr.clubCtrl.setMatchData(e.map),cc.eventManager.dispatchCustomEvent("ContinueMatchSucces",e)):"append_match_money"==t?(DataMgr.clubCtrl.setClubData(e.map),cc.eventManager.dispatchCustomEvent("AppendMatchMoneySucces",e)):"append_union_auto_play_money"==t?(DataMgr.clubCtrl.curClubData.match_money=e.map.match_money,cc.eventManager.dispatchCustomEvent("AppendUnionAutoMoneySucces",e.map)):"stop_match"==t?(ModuleMgr.showTipMsg("赛制已停止！"),DataMgr.clubCtrl.setMatchData(e.map),cc.eventManager.dispatchCustomEvent("StopMatchSucces",e)):"close_match"==t&&(ModuleMgr.showTipMsg("赛制已关闭！"),DataMgr.clubCtrl.setMatchData(e.map),cc.eventManager.dispatchCustomEvent("CloseMatchSucces",e)))},NetMsg.msg_union_message=function(t,e){if(e.ret==-1)return ModuleMgr.showTipMsg(e.err_msg);if("apply_union"==t){var i;i=IsGameTypeFzmjOrNdmj()?ModuleMgr.getDlg("NewClubCreateDlg"):ModuleMgr.getDlg("ClubCreateDlg"),i||ModuleMgr.showConfirmTxtMsg("申请加入好友圈成功！"),DataMgr.clubCtrl.pushApplyList(e.union_rid),cc.eventManager.dispatchCustomEvent("ApplyUnionSucces")}else if("get_apply_list"==t)DataMgr.clubCtrl.setApplyList(e.str_list);else if("get_union_applyed_list"==t)DataMgr.clubCtrl.setApplyCount(e.count),DataMgr.clubCtrl.setClubApplyList(e.map_list),cc.eventManager.dispatchCustomEvent("GetUnionApplyedListSucces",e);else if("get_union_donate_log_list"==t)DataMgr.clubCtrl.clubDonateLogCount=e.count,cc.eventManager.dispatchCustomEvent("GetUnionDonateListSuccess",e);else if("get_union_auto_play_log_list"==t)DataMgr.clubCtrl.clubAutoPlayLogCount=e.count,cc.eventManager.dispatchCustomEvent("GetUnionAutoPlayListSuccess",e);else if("get_union_money"==t)DataMgr.clubCtrl.curClubData.match_money=e.match_money,cc.eventManager.dispatchCustomEvent("GetUnionMoneySucces",e);else if("refuse_apply"==t)DataMgr.clubCtrl.setApplyCount(DataMgr.clubCtrl.clubApplyCount-1),cc.eventManager.dispatchCustomEvent("RefuseApplySucces",e);else if("agree_apply"==t)DataMgr.clubCtrl.setApplyCount(DataMgr.clubCtrl.clubApplyCount-1),cc.eventManager.dispatchCustomEvent("AgreeApplySucces",e);else if("join_union"==t){var i;i=IsGameTypeFzmjOrNdmj()?ModuleMgr.getDlg("NewClubCreateDlg"):ModuleMgr.getDlg("ClubCreateDlg"),i&&(i.close&&i.close(),IsGameTypeFzmjOrNdmj()?ModuleMgr.runDlg("NewClubRoomDlg"):ModuleMgr.runDlg("ClubRoomDlg")),ModuleMgr.showTipMsg("您已加入好友圈 "),DataMgr.clubCtrl.pushUnionList(e.union_char_data)}else if("leave_union"==t)DataMgr.clubCtrl.delUnionList(e.union_char_data);else if("union_dissolve"==t)DataMgr.clubCtrl.setClubData(e.union_union_data),cc.eventManager.dispatchCustomEvent("UnionDissolveSucces",e);else if("get_union_chat_list"==t)cc.eventManager.dispatchCustomEvent("GetUnionChatListSucces",e);else if("member_list"==t)DataMgr.clubCtrl.setClubMemberList(e.map_list),DataMgr.clubCtrl.setMemCount(e.count),cc.eventManager.dispatchCustomEvent("MemberListSucces");else if("union_exit"==t)ModuleMgr.showTipMsg("成功退出好友圈！"),IsGameTypeFzmjOrNdmj()?ModuleMgr.closeDlg("NewClubRoomDlg"):ModuleMgr.closeDlg("ClubRoomDlg"),DataMgr.clubCtrl.exitClub(),cc.eventManager.dispatchCustomEvent("UnionExitSucces");else if("union_chat"==t)cc.eventManager.dispatchCustomEvent("UnionChatSucces",e);else if("char_online"==t)DataMgr.clubCtrl.clubMemberOnline(e.user_rid);else if("char_offline"==t)DataMgr.clubCtrl.clubMemberOffline(e.user_rid);else if("char_add"==t)DataMgr.clubCtrl.addClubMember(e.union_char_data);else if("char_del"==t)DataMgr.clubCtrl.delClubMember(e.user_rid);else if("member_kick"==t)DataMgr.clubCtrl.setMemCount(DataMgr.clubCtrl.clubMemCount-1),cc.eventManager.dispatchCustomEvent("MemberKickSucces",e);else if("member_appoint"==t)cc.eventManager.dispatchCustomEvent("MemberAppointSucces",e);else if("get_match_info"==t)DataMgr.clubCtrl.setMatchData(e.map),cc.eventManager.dispatchCustomEvent("GetMatchInfoSucces");else if("modify_match_min_money"==t)DataMgr.clubCtrl.setMatchData(e.map),cc.eventManager.dispatchCustomEvent("ModifyMatchMinMoneySucces");else if("modify_cost_ratio"==t)DataMgr.clubCtrl.setClubData(e.map),cc.eventManager.dispatchCustomEvent("ModifyCostRatioSucces");else if("modify_match_char_money"==t)DataMgr.clubCtrl.changeClubMember(e.union_union_data),cc.eventManager.dispatchCustomEvent("ModifyMatchCharSucces",e.union_union_data);else if("get_match_log_list"==t)cc.eventManager.dispatchCustomEvent("GetMatchLogListSucces",e);else if("modify_apply_notice"==t)DataMgr.clubCtrl.curClubData.apply_notice=e.apply_notice,ModuleMgr.showTipMsg("申请公告修改成功！"),cc.eventManager.dispatchCustomEvent("ModifyApplyNoticeSucces",e);else if("modify_notice"==t)DataMgr.clubCtrl.curClubData.notice=e.notice,ModuleMgr.showTipMsg("公告修改成功！"),cc.eventManager.dispatchCustomEvent("ModifyNoticeSucces",e);else if("get_union_log_list"==t)cc.eventManager.dispatchCustomEvent("GetMatchLogListSucces",e);else if("modify_match_name"==t)DataMgr.clubCtrl.setMatchData(e.map),cc.eventManager.dispatchCustomEvent("ModifyMatchNameSucces",e);else if("member_money_list"==t)DataMgr.clubCtrl.setSaiZhiList(e.map_list),DataMgr.clubCtrl.setSaiZhiCount(e.count),DataMgr.clubCtrl.setSelfSaiZhiRank(e.cur_value),cc.eventManager.dispatchCustomEvent("RefreshMatchList",e);else if("get_auto_desk_list"==t)DataMgr.clubCtrl.setClubAutoDeskList(e.map_list),DataMgr.clubCtrl.setClubAutoDeskAllCount(e.count),cc.eventManager.dispatchCustomEvent("GetAutoDeskInfo");else if("get_auto_desk_setting_list"==t)DataMgr.clubCtrl.setClubAutoDeskSettingList(e.map_list),cc.eventManager.dispatchCustomEvent("GetAutoDeskSettingInfo");else if("close_auto_desk_setting"===t){var a={idx:e.idx,status:0,create_time:Date.now()/1e3};DataMgr.clubCtrl.updateClubAutoDeskSetting(a),cc.eventManager.dispatchCustomEvent("AutoDeskSettingChange",a)}else if("open_auto_desk_setting"===t){var a={idx:e.idx,status:1,create_time:Date.now()/1e3,desk_detail:{game_type:e.game_type,full_round:e.full_round,result_data:e.result_data,cost:e.cost,full_num:e.full_num,spec_type:e.spec_type}};DataMgr.clubCtrl.updateClubAutoDeskSetting(a),cc.eventManager.dispatchCustomEvent("AutoDeskSettingChange",a)}else if("union_auto_setting_change"===t){var a;if(0===e.status)a={idx:e.idx,status:0,create_time:Date.now()/1e3};else{var s=ConvertToJson(e.desk_detail||"{}");a={idx:e.idx,status:1,create_time:Date.now()/1e3,desk_detail:{game_type:s.game_type,full_round:s.full_round,result_data:s.result_data,cost:s.cost,full_num:s.full_num,spec_type:s.spec_type}}}DataMgr.clubCtrl.updateClubAutoDeskSetting(a),cc.eventManager.dispatchCustomEvent("AutoDeskSettingChange",a)}else"round_change"===t?(DataMgr.clubCtrl.updateClubAutoDeskCurRound(e),cc.eventManager.dispatchCustomEvent("AutoDeskRoundChange",e)):"desk_user_enter"===t?(DataMgr.clubCtrl.addClubAutoDeskUser(e),cc.eventManager.dispatchCustomEvent("AddAutoDeskUser",e)):"desk_user_leave"===t?(DataMgr.clubCtrl.removeClubAutoDeskUser(e),cc.eventManager.dispatchCustomEvent("RemoveAutoDeskUser",e)):"game_end"===t||"desk_dissolved"===t?(DataMgr.clubCtrl.removeClubAutoDeskByDeskIdx(e.desk_idx),cc.eventManager.dispatchCustomEvent("RemoveAutoDesk",e.desk_idx)):"new_auto_desk"===t&&(DataMgr.clubCtrl.addClubAutoDesk(e),cc.eventManager.dispatchCustomEvent("AutoDeskNew",e))},NetMsg.msg_get_rank=function(t){cc.eventManager.dispatchCustomEvent("SuccessGetRankData",t)},NetMsg.msg_recommend_info=function(t){cc.eventManager.dispatchCustomEvent("SuccessGetRecommendInfo",t)},NetMsg.msg_bind_recommend=function(t){cc.eventManager.dispatchCustomEvent("SuccessBindRecommmend",t)},NetMsg.msg_recommend_get=function(t){cc.eventManager.dispatchCustomEvent("SuccessGetRcommendAward",t)},NetMsg.msg_item_oper=function(t){var e=t.oper;if(t.ret==-1)return ModuleMgr.showTipMsg(t.err_msg);if("get_shop_list"==e)t.map_list;else if("get_item_list"==e)t.map_list&&(DataMgr.propCtrl.setPropList(t.map_list),cc.eventManager.dispatchCustomEvent("SUCCESS_GET_OWN_PROP"));else if("get_wear_list"==e)t.map_list&&(DataMgr.propCtrl.usedMapList=t.map_list,DataMgr.propCtrl.extendUsedPropObj(t.map_list),DataMgr.propCtrl.ownPropListUsed(),cc.eventManager.dispatchCustomEvent("HEAD_USE_PROP"));else if("put_on"==e)DataMgr.propCtrl.updateUsedMapList({class_id:t.class_id,end_time:t.end_time}),DataMgr.propCtrl.extendUsedPropObj([{class_id:t.class_id,end_time:t.end_time}]),DataMgr.propCtrl.ownPropListUsed(),cc.eventManager.dispatchCustomEvent("HEAD_USE_PROP"),cc.eventManager.dispatchCustomEvent("SUCCESS_GET_OWN_PROP");else if("buy"==e){var i=DataMgr.propCtrl.getPropInfoById(t.class_id);if(i){var a=DataMgr.propCtrl.getOwnPropById(t.class_id);a?a.end_time=t.end_time:DataMgr.propCtrl.addOwnProp({class_id:t.class_id,end_time:t.end_time}),cc.eventManager.dispatchCustomEvent("SUCCESS_GET_OWN_PROP"),ModuleMgr.showConfirmTxtMsg("    购买 "+i.name+" 成功！\n 请前往已拥有界面点击使用")}}else"take_off"==e&&(DataMgr.propCtrl.takeOffUsedProp(t.position),DataMgr.propCtrl.ownPropListUsed(),cc.eventManager.dispatchCustomEvent("HEAD_USE_PROP"),cc.eventManager.dispatchCustomEvent("SUCCESS_GET_OWN_PROP"))};var csv_json_str='{"union":{"thirteen-water:create":{"key":"thirteen-water:create","game_type":"thirteen-water","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"thirteen-water:match":{"key":"thirteen-water:match","game_type":"thirteen-water","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"thirteen-water:1":{"key":"thirteen-water:1","game_type":"thirteen-water","level":1,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"thirteen-water:2":{"key":"thirteen-water:2","game_type":"thirteen-water","level":2,"max_num":50,"leader_num":2,"partner_num":2,"cost":200,"comment":""},"thirteen-water:3":{"key":"thirteen-water:3","game_type":"thirteen-water","level":3,"max_num":65,"leader_num":3,"partner_num":3,"cost":300,"comment":""},"thirteen-water:4":{"key":"thirteen-water:4","game_type":"thirteen-water","level":4,"max_num":80,"leader_num":4,"partner_num":3,"cost":400,"comment":""},"thirteen-water:5":{"key":"thirteen-water:5","game_type":"thirteen-water","level":5,"max_num":100,"leader_num":5,"partner_num":4,"cost":500,"comment":""},"thirteen-water:6":{"key":"thirteen-water:6","game_type":"thirteen-water","level":6,"max_num":120,"leader_num":6,"partner_num":4,"cost":600,"comment":""},"thirteen-water:7":{"key":"thirteen-water:7","game_type":"thirteen-water","level":7,"max_num":140,"leader_num":7,"partner_num":4,"cost":700,"comment":""},"thirteen-water:8":{"key":"thirteen-water:8","game_type":"thirteen-water","level":8,"max_num":160,"leader_num":8,"partner_num":4,"cost":800,"comment":""},"thirteen-water:9":{"key":"thirteen-water:9","game_type":"thirteen-water","level":9,"max_num":180,"leader_num":9,"partner_num":4,"cost":900,"comment":""},"thirteen-water:10":{"key":"thirteen-water:10","game_type":"thirteen-water","level":10,"max_num":200,"leader_num":10,"partner_num":4,"cost":1000,"comment":""},"xymj:create":{"key":"xymj:create","game_type":"xymj","level":0,"max_num":60,"leader_num":1,"partner_num":2,"cost":10,"comment":"创建费用"},"xymj:match":{"key":"xymj:match","game_type":"xymj","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"xymj:1":{"key":"xymj:1","game_type":"xymj","level":1,"max_num":60,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"xymj:2":{"key":"xymj:2","game_type":"xymj","level":2,"max_num":70,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"xymj:3":{"key":"xymj:3","game_type":"xymj","level":3,"max_num":80,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"xymj:4":{"key":"xymj:4","game_type":"xymj","level":4,"max_num":90,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"xymj:5":{"key":"xymj:5","game_type":"xymj","level":5,"max_num":100,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"xymj:6":{"key":"xymj:6","game_type":"xymj","level":6,"max_num":110,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"xymj:7":{"key":"xymj:7","game_type":"xymj","level":7,"max_num":120,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"xymj:8":{"key":"xymj:8","game_type":"xymj","level":8,"max_num":130,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"xymj:9":{"key":"xymj:9","game_type":"xymj","level":9,"max_num":140,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"xymj:10":{"key":"xymj:10","game_type":"xymj","level":10,"max_num":150,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ncmj:create":{"key":"ncmj:create","game_type":"ncmj","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"ncmj:match":{"key":"ncmj:match","game_type":"ncmj","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"ncmj:1":{"key":"ncmj:1","game_type":"ncmj","level":1,"max_num":30,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"ncmj:2":{"key":"ncmj:2","game_type":"ncmj","level":2,"max_num":40,"leader_num":1,"partner_num":2,"cost":200,"comment":""},"ncmj:3":{"key":"ncmj:3","game_type":"ncmj","level":3,"max_num":50,"leader_num":2,"partner_num":3,"cost":300,"comment":""},"ncmj:4":{"key":"ncmj:4","game_type":"ncmj","level":4,"max_num":60,"leader_num":2,"partner_num":3,"cost":400,"comment":""},"ncmj:5":{"key":"ncmj:5","game_type":"ncmj","level":5,"max_num":70,"leader_num":2,"partner_num":4,"cost":500,"comment":""},"ncmj:6":{"key":"ncmj:6","game_type":"ncmj","level":6,"max_num":80,"leader_num":2,"partner_num":4,"cost":600,"comment":""},"ncmj:7":{"key":"ncmj:7","game_type":"ncmj","level":7,"max_num":90,"leader_num":2,"partner_num":4,"cost":700,"comment":""},"ncmj:8":{"key":"ncmj:8","game_type":"ncmj","level":8,"max_num":100,"leader_num":2,"partner_num":4,"cost":800,"comment":""},"ncmj:9":{"key":"ncmj:9","game_type":"ncmj","level":9,"max_num":110,"leader_num":2,"partner_num":4,"cost":900,"comment":""},"ncmj:10":{"key":"ncmj:10","game_type":"ncmj","level":10,"max_num":120,"leader_num":2,"partner_num":4,"cost":1000,"comment":""},"qzmj:create":{"key":"qzmj:create","game_type":"qzmj","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"qzmj:match":{"key":"qzmj:match","game_type":"qzmj","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"qzmj:1":{"key":"qzmj:1","game_type":"qzmj","level":1,"max_num":30,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"qzmj:2":{"key":"qzmj:2","game_type":"qzmj","level":2,"max_num":40,"leader_num":1,"partner_num":2,"cost":200,"comment":""},"qzmj:3":{"key":"qzmj:3","game_type":"qzmj","level":3,"max_num":50,"leader_num":2,"partner_num":3,"cost":300,"comment":""},"qzmj:4":{"key":"qzmj:4","game_type":"qzmj","level":4,"max_num":60,"leader_num":2,"partner_num":3,"cost":400,"comment":""},"qzmj:5":{"key":"qzmj:5","game_type":"qzmj","level":5,"max_num":70,"leader_num":2,"partner_num":4,"cost":500,"comment":""},"qzmj:6":{"key":"qzmj:6","game_type":"qzmj","level":6,"max_num":80,"leader_num":2,"partner_num":4,"cost":600,"comment":""},"qzmj:7":{"key":"qzmj:7","game_type":"qzmj","level":7,"max_num":90,"leader_num":2,"partner_num":4,"cost":700,"comment":""},"qzmj:8":{"key":"qzmj:8","game_type":"qzmj","level":8,"max_num":100,"leader_num":2,"partner_num":4,"cost":800,"comment":""},"qzmj:9":{"key":"qzmj:9","game_type":"qzmj","level":9,"max_num":110,"leader_num":2,"partner_num":4,"cost":900,"comment":""},"qzmj:10":{"key":"qzmj:10","game_type":"qzmj","level":10,"max_num":120,"leader_num":2,"partner_num":4,"cost":1000,"comment":""},"qzmj_ff:create":{"key":"qzmj_ff:create","game_type":"qzmj_ff","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"qzmj_ff:match":{"key":"qzmj_ff:match","game_type":"qzmj_ff","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"qzmj_ff:1":{"key":"qzmj_ff:1","game_type":"qzmj_ff","level":1,"max_num":30,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"qzmj_ff:2":{"key":"qzmj_ff:2","game_type":"qzmj_ff","level":2,"max_num":40,"leader_num":1,"partner_num":2,"cost":200,"comment":""},"qzmj_ff:3":{"key":"qzmj_ff:3","game_type":"qzmj_ff","level":3,"max_num":50,"leader_num":2,"partner_num":3,"cost":300,"comment":""},"qzmj_ff:4":{"key":"qzmj_ff:4","game_type":"qzmj_ff","level":4,"max_num":60,"leader_num":2,"partner_num":3,"cost":400,"comment":""},"qzmj_ff:5":{"key":"qzmj_ff:5","game_type":"qzmj_ff","level":5,"max_num":70,"leader_num":2,"partner_num":4,"cost":500,"comment":""},"qzmj_ff:6":{"key":"qzmj_ff:6","game_type":"qzmj_ff","level":6,"max_num":80,"leader_num":2,"partner_num":4,"cost":600,"comment":""},"qzmj_ff:7":{"key":"qzmj_ff:7","game_type":"qzmj_ff","level":7,"max_num":90,"leader_num":2,"partner_num":4,"cost":700,"comment":""},"qzmj_ff:8":{"key":"qzmj_ff:8","game_type":"qzmj_ff","level":8,"max_num":100,"leader_num":2,"partner_num":4,"cost":800,"comment":""},"qzmj_ff:9":{"key":"qzmj_ff:9","game_type":"qzmj_ff","level":9,"max_num":110,"leader_num":2,"partner_num":4,"cost":900,"comment":""},"qzmj_ff:10":{"key":"qzmj_ff:10","game_type":"qzmj_ff","level":10,"max_num":120,"leader_num":2,"partner_num":4,"cost":1000,"comment":""},"nniu:create":{"key":"nniu:create","game_type":"nniu","level":0,"max_num":60,"leader_num":1,"partner_num":2,"cost":10,"comment":"创建费用"},"nniu:match":{"key":"nniu:match","game_type":"nniu","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"nniu:1":{"key":"nniu:1","game_type":"nniu","level":1,"max_num":60,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"nniu:2":{"key":"nniu:2","game_type":"nniu","level":2,"max_num":70,"leader_num":2,"partner_num":2,"cost":20,"comment":""},"nniu:3":{"key":"nniu:3","game_type":"nniu","level":3,"max_num":80,"leader_num":3,"partner_num":3,"cost":20,"comment":""},"nniu:4":{"key":"nniu:4","game_type":"nniu","level":4,"max_num":90,"leader_num":4,"partner_num":3,"cost":20,"comment":""},"nniu:5":{"key":"nniu:5","game_type":"nniu","level":5,"max_num":100,"leader_num":5,"partner_num":4,"cost":20,"comment":""},"nniu:6":{"key":"nniu:6","game_type":"nniu","level":6,"max_num":110,"leader_num":6,"partner_num":4,"cost":20,"comment":""},"nniu:7":{"key":"nniu:7","game_type":"nniu","level":7,"max_num":120,"leader_num":7,"partner_num":4,"cost":20,"comment":""},"nniu:8":{"key":"nniu:8","game_type":"nniu","level":8,"max_num":130,"leader_num":8,"partner_num":4,"cost":20,"comment":""},"nniu:9":{"key":"nniu:9","game_type":"nniu","level":9,"max_num":140,"leader_num":9,"partner_num":4,"cost":20,"comment":""},"nniu:10":{"key":"nniu:10","game_type":"nniu","level":10,"max_num":150,"leader_num":10,"partner_num":4,"cost":20,"comment":""},"nniu_ff:create":{"key":"nniu_ff:create","game_type":"nniu_ff","level":0,"max_num":60,"leader_num":1,"partner_num":2,"cost":10,"comment":"创建费用"},"nniu_ff:match":{"key":"nniu_ff:match","game_type":"nniu_ff","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"nniu_ff:1":{"key":"nniu_ff:1","game_type":"nniu_ff","level":1,"max_num":60,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"nniu_ff:2":{"key":"nniu_ff:2","game_type":"nniu_ff","level":2,"max_num":70,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"nniu_ff:3":{"key":"nniu_ff:3","game_type":"nniu_ff","level":3,"max_num":80,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"nniu_ff:4":{"key":"nniu_ff:4","game_type":"nniu_ff","level":4,"max_num":90,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"nniu_ff:5":{"key":"nniu_ff:5","game_type":"nniu_ff","level":5,"max_num":100,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_ff:6":{"key":"nniu_ff:6","game_type":"nniu_ff","level":6,"max_num":110,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_ff:7":{"key":"nniu_ff:7","game_type":"nniu_ff","level":7,"max_num":120,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_ff:8":{"key":"nniu_ff:8","game_type":"nniu_ff","level":8,"max_num":130,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_ff:9":{"key":"nniu_ff:9","game_type":"nniu_ff","level":9,"max_num":140,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_ff:10":{"key":"nniu_ff:10","game_type":"nniu_ff","level":10,"max_num":150,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ttw_ff:create":{"key":"ttw_ff:create","game_type":"ttw_ff","level":0,"max_num":60,"leader_num":1,"partner_num":2,"cost":10,"comment":"创建费用"},"ttw_ff:match":{"key":"ttw_ff:match","game_type":"ttw_ff","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"ttw_ff:1":{"key":"ttw_ff:1","game_type":"ttw_ff","level":1,"max_num":60,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"ttw_ff:2":{"key":"ttw_ff:2","game_type":"ttw_ff","level":2,"max_num":70,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"ttw_ff:3":{"key":"ttw_ff:3","game_type":"ttw_ff","level":3,"max_num":80,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"ttw_ff:4":{"key":"ttw_ff:4","game_type":"ttw_ff","level":4,"max_num":90,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"ttw_ff:5":{"key":"ttw_ff:5","game_type":"ttw_ff","level":5,"max_num":100,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ttw_ff:6":{"key":"ttw_ff:6","game_type":"ttw_ff","level":6,"max_num":110,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ttw_ff:7":{"key":"ttw_ff:7","game_type":"ttw_ff","level":7,"max_num":120,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ttw_ff:8":{"key":"ttw_ff:8","game_type":"ttw_ff","level":8,"max_num":130,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ttw_ff:9":{"key":"ttw_ff:9","game_type":"ttw_ff","level":9,"max_num":140,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ttw_ff:10":{"key":"ttw_ff:10","game_type":"ttw_ff","level":10,"max_num":150,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_q8:create":{"key":"nniu_q8:create","game_type":"nniu_q8","level":0,"max_num":60,"leader_num":1,"partner_num":2,"cost":10,"comment":"创建费用"},"nniu_q8:match":{"key":"nniu_q8:match","game_type":"nniu_q8","level":0,"max_num":30,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"nniu_q8:1":{"key":"nniu_q8:1","game_type":"nniu_q8","level":1,"max_num":60,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"nniu_q8:2":{"key":"nniu_q8:2","game_type":"nniu_q8","level":2,"max_num":70,"leader_num":1,"partner_num":2,"cost":20,"comment":""},"nniu_q8:3":{"key":"nniu_q8:3","game_type":"nniu_q8","level":3,"max_num":80,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"nniu_q8:4":{"key":"nniu_q8:4","game_type":"nniu_q8","level":4,"max_num":90,"leader_num":2,"partner_num":3,"cost":20,"comment":""},"nniu_q8:5":{"key":"nniu_q8:5","game_type":"nniu_q8","level":5,"max_num":100,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_q8:6":{"key":"nniu_q8:6","game_type":"nniu_q8","level":6,"max_num":110,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_q8:7":{"key":"nniu_q8:7","game_type":"nniu_q8","level":7,"max_num":120,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_q8:8":{"key":"nniu_q8:8","game_type":"nniu_q8","level":8,"max_num":130,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_q8:9":{"key":"nniu_q8:9","game_type":"nniu_q8","level":9,"max_num":140,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"nniu_q8:10":{"key":"nniu_q8:10","game_type":"nniu_q8","level":10,"max_num":150,"leader_num":2,"partner_num":4,"cost":20,"comment":""},"ttw_bh:create":{"key":"ttw_bh:create","game_type":"ttw_bh","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"ttw_bh:match":{"key":"ttw_bh:match","game_type":"ttw_bh","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"ttw_bh:1":{"key":"ttw_bh:1","game_type":"ttw_bh","level":1,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"ttw_bh:2":{"key":"ttw_bh:2","game_type":"ttw_bh","level":2,"max_num":50,"leader_num":2,"partner_num":2,"cost":200,"comment":""},"ttw_bh:3":{"key":"ttw_bh:3","game_type":"ttw_bh","level":3,"max_num":65,"leader_num":3,"partner_num":3,"cost":300,"comment":""},"ttw_bh:4":{"key":"ttw_bh:4","game_type":"ttw_bh","level":4,"max_num":80,"leader_num":4,"partner_num":3,"cost":400,"comment":""},"ttw_bh:5":{"key":"ttw_bh:5","game_type":"ttw_bh","level":5,"max_num":100,"leader_num":5,"partner_num":4,"cost":500,"comment":""},"ttw_bh:6":{"key":"ttw_bh:6","game_type":"ttw_bh","level":6,"max_num":120,"leader_num":6,"partner_num":4,"cost":600,"comment":""},"ttw_bh:7":{"key":"ttw_bh:7","game_type":"ttw_bh","level":7,"max_num":140,"leader_num":7,"partner_num":4,"cost":700,"comment":""},"ttw_bh:8":{"key":"ttw_bh:8","game_type":"ttw_bh","level":8,"max_num":160,"leader_num":8,"partner_num":4,"cost":800,"comment":""},"ttw_bh:9":{"key":"ttw_bh:9","game_type":"ttw_bh","level":9,"max_num":180,"leader_num":9,"partner_num":4,"cost":900,"comment":""},"ttw_bh:10":{"key":"ttw_bh:10","game_type":"ttw_bh","level":10,"max_num":200,"leader_num":10,"partner_num":4,"cost":1000,"comment":""},"ttw_bh2:create":{"key":"ttw_bh2:create","game_type":"ttw_bh2","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"ttw_bh2:match":{"key":"ttw_bh2:match","game_type":"ttw_bh2","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"ttw_bh2:1":{"key":"ttw_bh2:1","game_type":"ttw_bh2","level":1,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"ttw_bh2:2":{"key":"ttw_bh2:2","game_type":"ttw_bh2","level":2,"max_num":50,"leader_num":2,"partner_num":2,"cost":200,"comment":""},"ttw_bh2:3":{"key":"ttw_bh2:3","game_type":"ttw_bh2","level":3,"max_num":65,"leader_num":3,"partner_num":3,"cost":300,"comment":""},"ttw_bh2:4":{"key":"ttw_bh2:4","game_type":"ttw_bh2","level":4,"max_num":80,"leader_num":4,"partner_num":3,"cost":400,"comment":""},"ttw_bh2:5":{"key":"ttw_bh2:5","game_type":"ttw_bh2","level":5,"max_num":100,"leader_num":5,"partner_num":4,"cost":500,"comment":""},"ttw_bh2:6":{"key":"ttw_bh2:6","game_type":"ttw_bh2","level":6,"max_num":120,"leader_num":6,"partner_num":4,"cost":600,"comment":""},"ttw_bh2:7":{"key":"ttw_bh2:7","game_type":"ttw_bh2","level":7,"max_num":140,"leader_num":7,"partner_num":4,"cost":700,"comment":""},"ttw_bh2:8":{"key":"ttw_bh2:8","game_type":"ttw_bh2","level":8,"max_num":160,"leader_num":8,"partner_num":4,"cost":800,"comment":""},"ttw_bh2:9":{"key":"ttw_bh2:9","game_type":"ttw_bh2","level":9,"max_num":180,"leader_num":9,"partner_num":4,"cost":900,"comment":""},"ttw_bh2:10":{"key":"ttw_bh2:10","game_type":"ttw_bh2","level":10,"max_num":200,"leader_num":10,"partner_num":4,"cost":1000,"comment":""},"ttw_qq:create":{"key":"ttw_qq:create","game_type":"ttw_qq","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"ttw_qq:match":{"key":"ttw_qq:match","game_type":"ttw_qq","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"ttw_qq:1":{"key":"ttw_qq:1","game_type":"ttw_qq","level":1,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"ttw_qq:2":{"key":"ttw_qq:2","game_type":"ttw_qq","level":2,"max_num":50,"leader_num":2,"partner_num":2,"cost":200,"comment":""},"ttw_qq:3":{"key":"ttw_qq:3","game_type":"ttw_qq","level":3,"max_num":65,"leader_num":3,"partner_num":3,"cost":300,"comment":""},"ttw_qq:4":{"key":"ttw_qq:4","game_type":"ttw_qq","level":4,"max_num":80,"leader_num":4,"partner_num":3,"cost":400,"comment":""},"ttw_qq:5":{"key":"ttw_qq:5","game_type":"ttw_qq","level":5,"max_num":100,"leader_num":5,"partner_num":4,"cost":500,"comment":""},"ttw_qq:6":{"key":"ttw_qq:6","game_type":"ttw_qq","level":6,"max_num":120,"leader_num":6,"partner_num":4,"cost":600,"comment":""},"ttw_qq:7":{"key":"ttw_qq:7","game_type":"ttw_qq","level":7,"max_num":140,"leader_num":7,"partner_num":4,"cost":700,"comment":""},"ttw_qq:8":{"key":"ttw_qq:8","game_type":"ttw_qq","level":8,"max_num":160,"leader_num":8,"partner_num":4,"cost":800,"comment":""},"ttw_qq:9":{"key":"ttw_qq:9","game_type":"ttw_qq","level":9,"max_num":180,"leader_num":9,"partner_num":4,"cost":900,"comment":""},"ttw_qq:10":{"key":"ttw_qq:10","game_type":"ttw_qq","level":10,"max_num":200,"leader_num":10,"partner_num":4,"cost":1000,"comment":""},"fzmj:create":{"key":"fzmj:create","game_type":"fzmj","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"fzmj:match":{"key":"fzmj:match","game_type":"fzmj","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"fzmj:1":{"key":"fzmj:1","game_type":"fzmj","level":1,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"fzmj:2":{"key":"fzmj:2","game_type":"fzmj","level":2,"max_num":50,"leader_num":2,"partner_num":2,"cost":200,"comment":""},"fzmj:3":{"key":"fzmj:3","game_type":"fzmj","level":3,"max_num":65,"leader_num":3,"partner_num":3,"cost":300,"comment":""},"fzmj:4":{"key":"fzmj:4","game_type":"fzmj","level":4,"max_num":80,"leader_num":4,"partner_num":3,"cost":400,"comment":""},"fzmj:5":{"key":"fzmj:5","game_type":"fzmj","level":5,"max_num":100,"leader_num":5,"partner_num":4,"cost":500,"comment":""},"fzmj:6":{"key":"fzmj:6","game_type":"fzmj","level":6,"max_num":120,"leader_num":6,"partner_num":4,"cost":600,"comment":""},"fzmj:7":{"key":"fzmj:7","game_type":"fzmj","level":7,"max_num":140,"leader_num":7,"partner_num":4,"cost":700,"comment":""},"fzmj:8":{"key":"fzmj:8","game_type":"fzmj","level":8,"max_num":160,"leader_num":8,"partner_num":4,"cost":800,"comment":""},"fzmj:9":{"key":"fzmj:9","game_type":"fzmj","level":9,"max_num":180,"leader_num":9,"partner_num":4,"cost":900,"comment":""},"fzmj:10":{"key":"fzmj:10","game_type":"fzmj","level":10,"max_num":200,"leader_num":10,"partner_num":4,"cost":1000,"comment":""},"ndmj:create":{"key":"ndmj:create","game_type":"ndmj","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":"创建费用"},"ndmj:match":{"key":"ndmj:match","game_type":"ndmj","level":0,"max_num":40,"leader_num":1,"partner_num":2,"cost":10,"comment":"赛制一天的费用"},"ndmj:1":{"key":"ndmj:1","game_type":"ndmj","level":1,"max_num":40,"leader_num":1,"partner_num":2,"cost":100,"comment":""},"ndmj:2":{"key":"ndmj:2","game_type":"ndmj","level":2,"max_num":50,"leader_num":2,"partner_num":2,"cost":200,"comment":""},"ndmj:3":{"key":"ndmj:3","game_type":"ndmj","level":3,"max_num":65,"leader_num":3,"partner_num":3,"cost":300,"comment":""},"ndmj:4":{"key":"ndmj:4","game_type":"ndmj","level":4,"max_num":80,"leader_num":4,"partner_num":3,"cost":400,"comment":""},"ndmj:5":{"key":"ndmj:5","game_type":"ndmj","level":5,"max_num":100,"leader_num":5,"partner_num":4,"cost":500,"comment":""},"ndmj:6":{"key":"ndmj:6","game_type":"ndmj","level":6,"max_num":120,"leader_num":6,"partner_num":4,"cost":600,"comment":""},"ndmj:7":{"key":"ndmj:7","game_type":"ndmj","level":7,"max_num":140,"leader_num":7,"partner_num":4,"cost":700,"comment":""},"ndmj:8":{"key":"ndmj:8","game_type":"ndmj","level":8,"max_num":160,"leader_num":8,"partner_num":4,"cost":800,"comment":""},"ndmj:9":{"key":"ndmj:9","game_type":"ndmj","level":9,"max_num":180,"leader_num":9,"partner_num":4,"cost":900,"comment":""},"ndmj:10":{"key":"ndmj:10","game_type":"ndmj","level":10,"max_num":200,"leader_num":10,"partner_num":4,"cost":1000,"comment":""}},"NewItemInfo":{"101":{"class_id":101,"position":1,"icon":"touxiang1","name":"好运来","class_name":"头像","describe":"尊贵身份象征","ob_type":2,"quality":1},"102":{"class_id":102,"position":1,"icon":"touxiang2","name":"三顺子","class_name":"头像","describe":"不重复，不孤独！","ob_type":2,"quality":2},"103":{"class_id":103,"position":1,"icon":"touxiang3","name":"连赢","class_name":"头像","describe":"尊贵身份象征","ob_type":2,"quality":3},"104":{"class_id":104,"position":1,"icon":"touxiang4","name":"清龙","class_name":"头像","describe":"享受牌局，玩转拱趴！","ob_type":2,"quality":5},"105":{"class_id":105,"position":1,"icon":"touxiang5","name":"通吃","class_name":"头像","describe":"尊贵身份象征","ob_type":2,"quality":4},"106":{"class_id":106,"position":1,"icon":"touxiang6","name":"一条龙","class_name":"头像","describe":"打牌的意义不是守护，是征服！","ob_type":2,"quality":4},"107":{"class_id":107,"position":1,"icon":"touxiang7","name":"钱来拉","class_name":"头像","describe":"尊贵身份象征","ob_type":2,"quality":5},"108":{"class_id":108,"position":1,"icon":"touxiang8","name":"六对半","class_name":"头像","describe":"勇者无惧，强者无敌！","ob_type":2,"quality":3},"109":{"class_id":109,"position":1,"icon":"touxiang9","name":"海洋之心","class_name":"头像","describe":"我不曾凝视海洋，我便是海洋！","ob_type":2,"quality":5},"110":{"class_id":110,"position":1,"icon":"touxiang10","name":"童年记忆","class_name":"头像","describe":"其实我曾是个少年......","ob_type":2,"quality":3},"201":{"class_id":201,"position":2,"icon":"gun1","name":"唯你独尊","class_name":"枪","describe":"尊贵身份象征","ob_type":2,"quality":1},"202":{"class_id":202,"position":2,"icon":"gun2","name":"心想事成","class_name":"枪","describe":"牌运将至，如影随形！","ob_type":2,"quality":2},"203":{"class_id":203,"position":2,"icon":"gun3","name":"一本万利","class_name":"枪","describe":"牌局之中，屹立不倒！","ob_type":2,"quality":3},"204":{"class_id":204,"position":2,"icon":"gun4","name":"全垒打","class_name":"枪","describe":"你，已经是我的猎物了！","ob_type":2,"quality":5},"205":{"class_id":205,"position":2,"icon":"gun5","name":"必胜","class_name":"枪","describe":"斑马，斑马，牌中来钢啊！","ob_type":2,"quality":4},"206":{"class_id":206,"position":2,"icon":"gun6","name":"劲爆全场","class_name":"枪","describe":"西港钢枪，一波带走！","ob_type":2,"quality":5}},"NewShop":{"1":{"id":1,"class_id":101,"game_type":"fzmj","day":"9999","money_type":"stone","money":"68","is_close":1,"weight":85,"ob_type":0},"2":{"id":2,"class_id":102,"game_type":"fzmj","day":"1#3","money_type":"stone#stone","money":"30#80","is_close":0,"weight":92,"ob_type":2},"3":{"id":3,"class_id":103,"game_type":"fzmj","day":"9999","money_type":"stone","money":"88","is_close":1,"weight":86,"ob_type":0},"4":{"id":4,"class_id":104,"game_type":"fzmj","day":"1#3","money_type":"stone#stone","money":"98#268","is_close":0,"weight":96,"ob_type":1},"5":{"id":5,"class_id":105,"game_type":"fzmj","day":"9999","money_type":"stone","money":"168","is_close":1,"weight":87,"ob_type":0},"6":{"id":6,"class_id":106,"game_type":"fzmj","day":"1#3","money_type":"stone#stone","money":"98#268","is_close":0,"weight":94,"ob_type":0},"7":{"id":7,"class_id":107,"game_type":"fzmj","day":"9999","money_type":"stone","money":"668","is_close":1,"weight":88,"ob_type":0},"8":{"id":8,"class_id":108,"game_type":"fzmj","day":"1#3","money_type":"stone#stone","money":"68#168","is_close":0,"weight":93,"ob_type":0}},"face":{"1001":{"id":1001,"money":0,"name":"大拇指","type":0,"effect_name":"face_zan","is_open":1,"dialogue":"0","scale":90},"1002":{"id":1002,"money":0,"name":"扔鞋","type":0,"effect_name":"face_shoe","is_open":1,"dialogue":"0","scale":80},"1003":{"id":1003,"money":1,"name":"炸弹","type":0,"effect_name":"face_bomb","is_open":1,"dialogue":"0","scale":100},"1004":{"id":1004,"money":1,"name":"鸡蛋","type":0,"effect_name":"face_egg","is_open":1,"dialogue":"0","scale":100},"1005":{"id":1005,"money":1,"name":"一束玫瑰","type":0,"effect_name":"face_flower","is_open":0,"dialogue":"0","scale":100},"1006":{"id":1006,"money":1,"name":"大拇指2","type":0,"effect_name":"face_zan2","is_open":0,"dialogue":"0","scale":100},"1007":{"id":1007,"money":1,"name":"小刀","type":0,"effect_name":"face_knife","is_open":1,"dialogue":"0","scale":100},"1008":{"id":1008,"money":1,"name":"砖头","type":0,"effect_name":"face_block","is_open":1,"dialogue":"0","scale":100},"1009":{"id":1009,"money":1,"name":"抓鸡","type":0,"effect_name":"face_chicken","is_open":1,"dialogue":"0","scale":100},"1010":{"id":1010,"money":1,"name":"一个玫瑰","type":0,"effect_name":"face_rose","is_open":1,"dialogue":"0","scale":100},"1011":{"id":1011,"money":1,"name":"亲亲","type":0,"effect_name":"face_kiss","is_open":1,"dialogue":"0","scale":100},"1012":{"id":1012,"money":1,"name":"扔鞋2","type":0,"effect_name":"face_shoe2","is_open":1,"dialogue":"0","scale":100},"1013":{"id":1013,"money":1,"name":"啤酒","type":0,"effect_name":"face_beer","is_open":1,"dialogue":"0","scale":80},"1014":{"id":1014,"money":1,"name":"走你","type":0,"effect_name":"face_zouni","is_open":1,"dialogue":"0","scale":90},"1015":{"id":1015,"money":1,"name":"好运来","type":0,"effect_name":"face_good_luck","is_open":1,"dialogue":"0","scale":90},"1016":{"id":1016,"money":1,"name":"烧香","type":0,"effect_name":"face_shaoxiang","is_open":1,"dialogue":"0","scale":90},"1017":{"id":1017,"money":6,"name":"关公","type":1,"effect_name":"effect_guanyu","is_open":1,"dialogue":"天官赐福，喜笑颜开！","scale":100},"1018":{"id":1018,"money":6,"name":"财神","type":1,"effect_name":"effect_money_man","is_open":1,"dialogue":"财神一挥手，好运跟着走！","scale":100},"1019":{"id":1019,"money":6,"name":"八卦","type":1,"effect_name":"effect_bagua","is_open":1,"dialogue":"天地人和，一招八卦定乾坤！","scale":100},"1020":{"id":1020,"money":6,"name":"洗手","type":1,"effect_name":"effect_wash_hands","is_open":1,"dialogue":"搓手去霉，牌运通畅！","scale":100}}}',csvMap=null;
CsvMgr={},CsvMgr.getDataWithFile=function(t){return void 0==typeof csv_json_str?(console.error("can not find the csv_json_str"),null):(csvMap||(csvMap=ConvertToJson(csv_json_str)),csvMap[t]?csvMap[t]:(console.error("can not find the csv "+t),null))},CsvMgr.getDataWithFileAndId=function(t,e){var i=CsvMgr.getDataWithFile(t);return i?i[e]:(console.error("can not find the csv "+t),null)},UNION_APPLY_NEED_AGREE=0,UNION_APPLY_REFUSE_ALL=1,UNION_POSITION_MASTER=1,UNION_POSITION_ASSISTANT=2,UNION_POSITION_OLDER=3,UNION_POSITION_NORMAL=4,UNION_APPLY_NEED_AGREE=0,UNION_APPLY_NONE_AGREE=1,UNION_APPLY_REFUSE_ALL=2,CHAT_TYPE_OPEN_DESK=1,CHAT_TYPE_SHARE_SCORE=2,UNION_MATCH_LOG_MANGER_SCORE="manger_score_change",UNION_MATCH_LOG_USER_PLAY_SCORE="user_score_change",UNION_POSITION_NAME_TABLE={},UNION_POSITION_NAME_TABLE[UNION_POSITION_MASTER]="部长",UNION_POSITION_NAME_TABLE[UNION_POSITION_ASSISTANT]="副部长",UNION_POSITION_NAME_TABLE[UNION_POSITION_OLDER]="荣誉会员",UNION_POSITION_NAME_TABLE[UNION_POSITION_NORMAL]="会员",ClubCtrl=cc.Class.extend({unionList:[],applyList:[],clubMemberList:[],curClubData:null,matchData:null,clubApplyCount:0,clubApplyList:[],bolOpenClub:!1,clubSelfInfo:null,clubMemCount:0,clubMasterData:null,clubSaiZhiCount:0,clubSaiZhiList:[],union_online_num:0,union_mem_num:0,clubAutoDeskSettingList:[],clubAutoDeskList:[],clubAutoDeskAllCount:0,clubDonateLogCount:0,clubAutoPlayLogCount:0,ctor:function(t){},clearData:function(){this.unionList=[],this.bolOpenClub=!1,this.clubClearData()},clubClearData:function(){this.applyList=[],this.clubMemberList=[],this.clubApplyList=[],this.curClubData=null,this.matchData=null,this.clubSelfInfo=null,this.clubMasterData=null,this.clubMemCount=0,this.clubApplyCount=0,this.clubSaiZhiCount=0,this.clubSaiZhiList=[],this.union_online_num=0,this.union_mem_num=0,this.clubDonateLogCount=0,this.clubAutoPlayLogCount=0,this.clubAutoDeskSettingList=[],this.clubAutoDeskList=[],this.clubAutoDeskAllCount=0},setUnionList:function(t){this.unionList=t||[];for(var e=0;e<this.unionList.length;e++){var i=this.unionList[e];i.game_type==GAME_TYPE&&(this.curClubData=i)}},exitClub:function(){for(var t=0;t<this.unionList.length;t++)if(this.unionList[t].game_type==GAME_TYPE){this.unionList.splice(t,1);break}DataMgr.accountCtrl.bolFromHall()&&DataMgr.accountCtrl.setUnionList&&DataMgr.accountCtrl.setUnionList(this.unionList)},pushUnionList:function(t){t&&(this.unionList.push(t),DataMgr.accountCtrl.bolFromHall()&&DataMgr.accountCtrl.setUnionList&&DataMgr.accountCtrl.setUnionList(this.unionList))},delUnionList:function(t){if(t){for(var e=0;e<this.unionList.length;e++)if(this.unionList[e].union_rid==t.union_rid){this.unionList.splice(e,1);break}DataMgr.accountCtrl.bolFromHall()&&DataMgr.accountCtrl.setUnionList&&DataMgr.accountCtrl.setUnionList(this.unionList),t.rid==ME_D.get_rid()&&DataMgr.clubCtrl.clearData()}},getMyClub:function(){if(this.curClubData)return this.curClubData;for(var t=0;t<this.unionList.length;t++){var e=this.unionList[t];if(e.game_type==GAME_TYPE)return e}return null},setApplyList:function(t){this.applyList=t||[]},setClubApplyList:function(t){for(var e=0;e<t.length;++e)DataMgr.accountCtrl.setExtraData(t[e]);this.clubApplyList=t||[]},setApplyCount:function(t){this.clubApplyCount=t||0},getApplyCount:function(){return this.clubApplyCount},pushApplyList:function(t){this.applyList.push(t)},setClubData:function(t){this.curClubData=null,this.curClubData=t,this.union_online_num=this.union_online_num||t.union_online_num,this.union_mem_num=this.union_mem_num||t.union_mem_num;for(var e=0;e<this.unionList.length;e++){var i=this.unionList[e];if(i.game_type==GAME_TYPE){this.unionList[e]=this.curClubData;break}}},setClubMemberList:function(t){for(var e=0;e<t.length;++e)DataMgr.accountCtrl.setExtraData(t[e]);this.clubMemberList=t||[],this.clubMemberList[0]&&this.clubMemberList[0].position==UNION_POSITION_MASTER&&(this.clubMasterData=gDeepDup(this.clubMemberList[0]))},setMemCount:function(t){this.clubMemCount=t||0},setSaiZhiList:function(t){for(var e=0;e<t.length;++e)DataMgr.accountCtrl.setExtraData(t[e]);this.clubSaiZhiList=t||[]},setSaiZhiCount:function(t){this.clubSaiZhiCount=t||0},setSelfSaiZhiRank:function(t){this.clubSelfInfo&&(this.clubSelfInfo.rank=t)},getClubOnlineNum:function(){var t=this.union_online_num;return t},getClubMemNum:function(){var t=this.union_mem_num;return this.clubMemCount?this.clubMemCount:t},getClubPositionNum:function(t){for(var e=0,i=0;i<this.clubMemberList.length;i++)t==this.clubMemberList[i].position&&e++;return e},clubMemberOnline:function(t){for(var e=0;e<this.clubMemberList.length;e++)if(t==this.clubMemberList[e].rid){this.clubMemberList[e].last_login_time=DataMgr.timeCtrl.getServerTime();break}},clubMemberOffline:function(t){for(var e=0;e<this.clubMemberList.length;e++)if(t==this.clubMemberList[e].rid){this.clubMemberList[e].last_logout_time=DataMgr.timeCtrl.getServerTime();break}},addClubMember:function(t){if(t){for(var e=0;e<this.clubMemberList.length;e++)if(t.rid==this.clubMemberList[e].rid)return void(this.clubMemberList[e]=t);this.clubMemberList.push(t)}},delClubMember:function(t){for(var e=0;e<this.clubMemberList.length;e++)if(t==this.clubMemberList[e].rid){this.clubMemberList.splice(e,1);break}t==ME_D.get_rid()&&DataMgr.clubCtrl.clearData()},changeClubMember:function(t){for(var e=0;e<this.clubMemberList.length;e++)if(t.rid==this.clubMemberList[e].rid){this.clubMemberList[e]=t;break}},getMemberByRid:function(t){for(var e=0;e<this.clubMemberList.length;e++)if(t==this.clubMemberList[e].rid)return this.clubMemberList[e];return null},memberPositionChange:function(t,e){for(var i=0;i<this.clubMemberList.length;i++)if(t==this.clubMemberList[i].rid){this.clubMemberList[i].position=e;break}},getClubMaster:function(){return this.clubMasterData},setClubSelfInfo:function(t){this.clubSelfInfo=t},isIWasClubManager:function(){return!!(this.clubSelfInfo&&this.clubSelfInfo.position===UNION_POSITION_MASTER||this.clubSelfInfo.position===UNION_POSITION_ASSISTANT)},getSelfInfo:function(){return this.clubSelfInfo},calChatData:function(t){var e={name:"",content:"",time:"",headimgurl:""};if(t){e.name=toDecodeURIComponent(t.send_name),e.headimgurl=t.headimgurl,"system"===e.name&&(e.name="系统");var i=t.chat_info||{};if(t.chat_type==CHAT_TYPE_OPEN_DESK)e.content="[c0:0:0]"+i.title+"[/c][br][c100:100:100]"+i.content+"[/c]";else if(t.chat_type==CHAT_TYPE_SHARE_SCORE){e.content="[c0:0:0]战绩：[/c][br]";for(var a=ConvertToJson(i.record_detail),s=a.users||[],r=a.score,n=0;n<s.length;n++){var o=n+1,c=s[n];if(c.rid){var l=toDecodeURIComponent(c.name),_=r["idx"+o],u="[c255:0:0]";_<=0&&(u="[c0:255:0]"),e.content=e.content+"[c100:100:100]"+l+"[/c]  "+u+_+"[/c][br]"}}}else e.content="[c100:100:100]"+i.send_content+"[/c]";if(i&&i.send_time){var h=new Date(1e3*i.send_time);e.time=h.format("yyyy/MM/dd hh:mm:ss")}return e}},getMaxClubPeople:function(t){var e=CsvMgr.getDataWithFile("union");return e?(info=e[GAME_TYPE+":"+t]||0,info?info.max_num:0):0},setMatchData:function(t){this.matchData=t},bolMatchOver:function(){if(!this.matchData)return!0;if(1===this.matchData.is_close)return!0;var t=this.matchData.vaild_time,e=t-DataMgr.timeCtrl.getServerTime();return!(e>=0)},bolMatchExist:function(){return!!this.curClubData&&!(!this.curClubData.match_rid||this.matchData.is_close)},isAllClubAutoDeskSettingClose:function(){for(var t=!0,e=0;e<this.clubAutoDeskSettingList.length;e++)if(this.clubAutoDeskSettingList[e]&&1===this.clubAutoDeskSettingList[e].status){t=!1;break}return t},getClubAutoDeskSettingList:function(){return this.clubAutoDeskSettingList},setClubAutoDeskSettingList:function(t){this.clubAutoDeskSettingList=this.clubAutoDeskSettingList||[];for(var e=0;e<3;e++)this.clubAutoDeskSettingList[e]=this.clubAutoDeskSettingList[e]||{};for(var i=0;i<t.length;i++){var a=t[i].idx;if(0===a||1===a||2===a){var s=t[i];s.desk_detail=JSON.parse(s.desk_detail||"{}"),this.clubAutoDeskSettingList[a]=s}}},updateClubAutoDeskSetting:function(t){this.clubAutoDeskSettingList=this.clubAutoDeskSettingList||[];for(var e=t.idx,i=0;i<3;i++)this.clubAutoDeskSettingList[i]=this.clubAutoDeskSettingList[i]||{},i===e&&(this.clubAutoDeskSettingList[i]=null,this.clubAutoDeskSettingList[i]=t)},setClubAutoDeskList:function(t,e){for(var i,a,s=[],r=0;r<t.length;r++)a=t[r],i=JSON.parse(t[r].desk_detail||"{}"),a.desk_detail=i,a.users=a.users||[],s.push(a);s=this.refreshClubAutoDesk(s),this.clubAutoDeskList=s},refreshClubAutoDesk:function(t){return t.sort(function(t,e){var i=t.desk_detail.full_num-t.users.length,a=e.desk_detail.full_num-e.users.length;return i>a?-1:t.create_time>e.create_time?-1:0}),t},setClubAutoDeskAllCount:function(t){this.clubAutoDeskAllCount=t},getClubAutoDeskAllCount:function(){return this.clubAutoDeskAllCount},getClubAutoDeskDataByIndex:function(t){return this.clubAutoDeskList[t]},getClubAutoDeskDatasLength:function(){return this.clubAutoDeskList.length},getClubAutoDeskIndexByDeskIdx:function(t){for(var e=0;e<this.clubAutoDeskList.length;e++)if(this.clubAutoDeskList[e].idx===t)return e},updateClubAutoDeskCurRound:function(t){for(var e=0;e<this.clubAutoDeskList.length;e++)if(this.clubAutoDeskList[e].desk_idx===t.desk_idx)return cc.log(" old auto_desk_data=",this.clubAutoDeskList[e]," new_desk_data ===",t),this.clubAutoDeskList[e].cur_round=t.cur_round,this.clubAutoDeskList[e].full_round=t.full_round,e},addClubAutoDeskUser:function(t){for(var e=0;e<this.clubAutoDeskList.length;e++)if(this.clubAutoDeskList[e].desk_idx===t.desk_idx){this.clubAutoDeskList[e].users=this.clubAutoDeskList[e].users||[],this.clubAutoDeskList[e].users.push({union_rid:t.union_rid,desk_idx:t.desk_idx,user_rid:t.user_rid,name:t.name,headimgurl:t.headimgurl});break}},removeClubAutoDeskUser:function(t){for(var e=!1,i=0;i<this.clubAutoDeskList.length;i++){if(this.clubAutoDeskList[i].desk_idx===t.desk_idx)for(var a=0;a<this.clubAutoDeskList[i].users.length;a++){var s=this.clubAutoDeskList[i].users[a].user_rid;if(s===t.user_rid){this.clubAutoDeskList[i].users[a]=null,this.clubAutoDeskList[i].users.splice(a,1),e=!0;break}}if(e)break}},updateClubAutoDeskData:function(t){for(var e=0;e<this.clubAutoDeskList.length;e++)if(this.clubAutoDeskList[e].idx===t.idx)return cc.log(" old auto_desk_data=",this.clubAutoDeskList[e]," new_desk_data===",t),void(this.clubAutoDeskList[e]=t)},removeClubAutoDeskByDeskIdx:function(t){for(var e=0;e<this.clubAutoDeskList.length;e++)if(this.clubAutoDeskList[e].desk_idx===t)return this.clubAutoDeskList.splice(e,1),e},addClubAutoDesk:function(t){var e=t;e.desk_detail=JSON.parse(t.desk_detail),e.users=e.users||[],this.clubAutoDeskList.unshift(e)},getClubDataMatchMoney:function(){return this.curClubData=this.curClubData||{},this.curClubData.match_money=this.curClubData.match_money||0,this.curClubData.match_money}}),TimeCtrl=cc.Class.extend({timeInfo:null,offSetTime:0,mstime:0,disMstime:0,startMsTime:0,cmstime:0,ctor:function(t){console.log(t)},initData:function(t){this.timeInfo=t},setServerMsTime:function(t){this.mstime=t,this.startMsTime=(new Date).getTime()},getServerMsTime:function(){return(new Date).getTime()-this.startMsTime+this.mstime},getServerTime:function(){return(new Date).getTime()/1e3+this.offSetTime},setServerTime:function(t){this.offSetTime=t-(new Date).getTime()/1e3},getTodaySec:function(){var t=new Date(1e3*this.getServerTime()),e=t.getHours(),i=t.getMinutes(),a=t.getSeconds();return 60*e*60+60*i+a},calcStepTime:function(t){var e=(this.getServerTime(),Math.floor(Math.max(t-this.getServerTime(),0))),i=Math.floor(e/60),a=e%60;return{min:i,sec:a}},changeTimeIngo:function(t){if(t)for(var e in t)this.timeInfo[e]=t[e]},newData:function(){this.timeInfo.today_share_times=0,this.timeInfo.left_turn_times=1,this.timeInfo.open_room_times=0,this.timeInfo.share_status_list=JSON.stringify([0,0,0])},addTodayShareTime:function(t){this.timeInfo.today_share_times=(this.timeInfo.today_share_times||0)+t},getTodayShareTime:function(){return this.timeInfo.today_share_times||0},getTodayOpenRoomTimes:function(){return this.timeInfo.today_open_room_times||0},getShareStatusList:function(){return this.timeInfo.share_status_list?ConvertToJson(this.timeInfo.share_status_list):[0,0,0]},setShareStatusList:function(t){this.timeInfo.share_status_list=JSON.stringify(t)},getLeftTurnTimes:function(){return this.timeInfo.left_turn_times||0},subLeftTurnTimes:function(t){this.timeInfo.left_turn_times=(this.timeInfo.left_turn_times||0)-t,this.timeInfo.left_turn_times=this.timeInfo.left_turn_times>0?this.timeInfo.left_turn_times:0},getReceiveNativeRewards:function(){return this.timeInfo.receive_native_rewards?ConvertToJson(this.timeInfo.receive_native_rewards):{}},setReceiveNativeRewards:function(t){var e=this.getReceiveNativeRewards();e[t]=1,this.timeInfo.receive_native_rewards=JSON.stringify(e)}}),GameBaseCtrl=cc.Class.extend({deskInfo:{},deskPlayers:[],players:[],online:{},myWheelIdx:0,gameType:"",deskIdx:0,dissovle:[],deskTime:0,deskStatus:"",myWheelInfo:null,wheelInfos:{},recordId:null,myCards:[],curStep:null,replayData:null,deskChat:null,bolLocation:!0,clearData:function(){this.deskChat={},this.deskInfo={},this.deskPlayers=[],this.players=[],this.online={},this.myWheelIdx=0,this.gameType="",this.dissovle=[],this.deskTime=0,this.deskStatus="",this.myWheelInfo=null,this.wheelInfos={},this.recordId=null,this.myCards=[],this.curStep=null,this.replayData=null,this.bolLocation=!0},ctor:function(){this.clearData()},getLocation:function(){var t=function(){0!=DataMgr.gameCtrl.deskIdx&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"user_location",location:JSON.stringify(DataMgr.locationData)})};this.bolLocation&&(this.bolLocation=!1,DataMgr.getLocation(t))},addPlayer:function(t){DataMgr.accountCtrl.setExtraData(t.info);var e=this.players[t.wheel_idx];return this.players[t.wheel_idx]=t,this.wheelInfos[t.wheel_idx]?this.wheelInfos[t.wheel_idx].rid!=t.rid&&(this.wheelInfos[t.wheel_idx]=t):this.wheelInfos[t.wheel_idx]=t,null==e},removePlayer:function(t){var e=this.players[t];if(e){var i=this.getChairIdxByRid(e.rid);this.deskPlayers[i]=null}this.players[t]=null},getPlayerByRid:function(t){for(var e=1;e<=4;e++)if(this.deskPlayers&&this.deskPlayers[e]&&this.deskPlayers[e].rid==t)return this.deskPlayers[e];return null},getChairIdxByRid:function(t){if(null==this.deskPlayers)return-1;for(var e=1;e<=4;e++)if(this.deskPlayers[e]&&this.deskPlayers[e].rid==t)return e;return-1},getChairIdByWheelIdx:function(t){return null==this.players[t]?-1:this.getChairIdxByRid(this.players[t].rid)},isOwer:function(){return this.deskInfo.desk_own_rid==ME_D.get_rid()},sortPlayers:function(){this.deskPlayers=[];for(var t=[],e=null,i=1;i<=this.players.length;i++)this.players[i]&&this.players[i].rid==ME_D.get_rid()?e=this.players[i]:t.push(this.players[i]);this.deskPlayers[4]=e,e&&(this.myWheelIdx=e.wheel_idx);for(var i=1;i<=3;i++)this.deskPlayers[i]=t[i-1]},initMyCards:function(t){t=t||[];for(var e=[],i=0;i<t.length;i++)e.push(t[i]);this.myCards=e},getReplayUsersData:function(){return this.replayData&&this.replayData.users},getReplayStepData:function(){return this.replayData&&this.replayData.steps},getReplayPokerData:function(){return this.replayData&&this.replayData.poker_list}}),AccountCtrl=cc.Class.extend({isGuest:!1,lastAccount:null,lastPass:null,wechatAccount:null,wechatPass:null,lastLoginTime:null,guestAccount:null,guestPsw:null,apiUid:null,apiSign:null,apiServer:null,timestamp:0,enterGameInfo:null,bolLogOut:!1,deskInfo:{},allTeleNum:0,myIpAddr:"",realname:"",userCode:"",isForeceUserCodeOpen:!1,receiveAwardNum:0,openOwnLeave:!1,closeRecord:!1,ctor:function(){this.lastAccount=cc.sys.localStorage.getItem("last_account")||"",this.lastPass=cc.sys.localStorage.getItem("last_pass")||"",this.wechatAccount=cc.sys.localStorage.getItem("wechat_account")||"",this.wechatPass=cc.sys.localStorage.getItem("wechat_pass")||"",this.lastLoginTime=cc.sys.localStorage.getItem("last_login_time")||0,this.guestAccount=cc.sys.localStorage.getItem("guest_account")||"",this.guestPsw=cc.sys.localStorage.getItem("guest_pass")||""},setEnterGameInfo:function(t){this.enterGameInfo=gDeepDup(t)},bolFromHall:function(){return!!this.enterGameInfo},setDeskInfo:function(t){if(t){var e=t.gameType||"",i=t.deskIdx||0;i<=0?this.deskInfo.gameType==e&&(this.deskInfo.deskIdx=i):(this.deskInfo.gameType=e,this.deskInfo.deskIdx=i)}},saveAccount:function(){cc.sys.localStorage.setItem("last_account",this.lastAccount||""),cc.sys.localStorage.setItem("last_pass",this.lastPass||""),cc.sys.localStorage.setItem("wechat_account",this.wechatAccount||""),cc.sys.localStorage.setItem("wechat_pass",this.wechatPass||""),cc.sys.localStorage.setItem("last_login_time",this.lastLoginTime||""),cc.sys.localStorage.setItem("guest_account",this.guestAccount||""),cc.sys.localStorage.setItem("guest_pass",this.guestPsw||"")},clearAccount:function(){this.isGuest?(this.guestAccount="",this.guestPsw=""):(this.wechatAccount="",this.wechatPass=""),this.saveAccount()},getCurServer:function(){return this.apiServer},getMostAppId:function(){var t="GmmZoimZh5";if(designOrientation==SCREEN_ORIENTATION_LANDSCAPE)t="MzOuuINJ53";else if(designOrientation==SCREEN_ORIENTATION_PROTRAIT)if(cc.sys.os==cc.sys.OS_ANDROID){var e=parseFloat(getQueryString("android_version"))||0;e+.001<3.5&&(t="zjilt2OefV")}else if(cc.sys.os==cc.sys.OS_IOS){var e=parseFloat(getQueryString("ios_version"))||0;e+.001<1.4&&(t="zjilt2OefV")}return cc.sys.isNative||"undefined"==typeof MostOneJSApis||"1"==isTestServer&&(t="HY04OrXnTi"),t},apiWechatLogin:function(t,e,i){var a="";"function"==typeof getWechatLoginAppId&&(a=getWechatLoginAppId());var s={channel:"wechat",code:e,id:a,isOpen:t};s.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_WECHAT_LOGIN,s,function(t){cc.log(t),i(t)},"登录验证中")},apiGuestLogin:function(t){var e={channel:"ywt"};e.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_GUEST_LOGIN,e,function(e){t(e)},"登录验证中")},apiMostOneLogin:function(t,e,i){var a=this.getMostAppId(),s={channel:"mw",code:e,id:a,isOpen:t};s.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_MOST_LOGIN,s,function(t){i(t)},"登录验证中")},getTelPassward:function(t){return hex_md5(t+"zhengshifu_gongpa_ywt")},apiTelphoneLogin:function(t,e,i){var a={telephone:t,password:e};a.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_TELEPHONE_LOGIN,a,function(t){0!=t.ret?ModuleMgr.showConfirmTxtMsg(t.error):(DataMgr.accountCtrl.wechatAccount=t.user,DataMgr.accountCtrl.wechatPass=t.password,platform.doWechatLogin(),i&&i(t))},"登录验证中")},apilogin:function(t,e,i){var a={method:"POST",timeout:5e3,url:GAME_WEB_URL+"/apilogin",data:JSON.stringify({channel:"ywt",user:t,password:e})},s=this;HttpNetworkRequest(a,function(a,r){if(ModuleMgr.removeWaitMsg(),a)return void ModuleMgr.showTipMsg(a);var n=ConvertToJson(r);if(0!=n.ret)i(n.error,n),s.clearAccount();else{s.lastAccount=t,s.lastPass=e,s.saveAccount();var o=ConvertToJson(n.baseinfo);s.nickname=o.nickname,s.headimgurl=o.headimgurl,s.sex=o.sex||0,s.allTeleNum=n.allTeleNum,s.wechat=n.wechat,s.telephone=n.telephone,s.bindTeleTime=n.bindTeleTime,s.timestamp=n.timestamp,s.apiUid=n.uid,s.apiSign=n.sign,s.apiServer=n.server,s.realname=n.realname,s.userCode=n.userCode,i(null,n)}})},getVerificationCode:function(t,e){var i={};i.telephone=t,i.ignorePort=!0,request4Http(HTTP_IFACE_TEL_REQUEST_MSG_CODE,i,function(t){t&&0==t.ret&&e&&e(t)})},bindPhoneNumber:function(t,e,i,a){var s={};s.accountId=ME_D.get_user().account_uid,s.userRid=ME_D.get_rid(),s.telephone=t,s.validateCode=e,s.password=i,s.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_TEL_BINDING_TEL,s,function(t){t&&(0!=t.ret?ModuleMgr.showConfirmTxtMsg(retData.error):a&&a(t))},"验证中")},findPhonePW:function(t,e,i,a){var s={};s.accountId=ME_D.get_user().account_uid,s.userRid=ME_D.get_rid(),s.telephone=t,s.validateCode=e,s.password=i,s.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_TEL_LOOK_FOR_PASSWARD,s,function(t){t&&(0!=t.ret?ModuleMgr.showConfirmTxtMsg(retData.error):a&&a(t))},"验证中")},changePhonePW:function(t,e,i){var a={};a.accountId=ME_D.get_user().account_uid,a.oldPassword=t,a.password=e,a.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_TEL_CHANGE_PASSWARD,a,function(t){t&&(0!=t.ret?ModuleMgr.showConfirmTxtMsg(retData.error):i&&i(t))},"验证中")},isBindPhone:function(){var t=ME_D.get_user()||{},e=ConvertToJson(t.comment||"");return!(!e.telephone||!checkPhone(e.telephone))},isBindUserCode:function(){ME_D.get_user()||{};return!!(this.realname&&this.userCode&&this.userCode.length>15)},doForeceUserCodeOpene:function(){var t=this,e={};requestWaiting4Http(HTTP_FORECE_USERCODE_OPEN,e,function(e){e&&(0!=e.ret||(e.foreUserCode&&"false"!=e.foreUserCode&&0!=e.foreUserCode&&0!=e.foreUserCode?t.isForeceUserCodeOpen=!0:t.isForeceUserCodeOpen=!1,e.openOwnLeave&&"false"!=e.openOwnLeave&&0!=e.openOwnLeave&&0!=e.openOwnLeave?t.openOwnLeave=!0:t.openOwnLeave=!1,e.closeRecord&&"false"!=e.closeRecord&&0!=e.closeRecord&&0!=e.closeRecord?t.closeRecord=!0:t.closeRecord=!1))},"验证中")},getIpAddr:function(t){var e=this;if(e.myIpAddr)t&&t(e.myIpAddr);else{var i={method:"GET",timeout:5e3,url:GAME_WEB_URL+"/apiip",data:""};HttpNetworkRequest(i,function(i,a){if(!i){var s=/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)/;if(s.test(a)){var r=s.exec(a);e.myIpAddr=r[0]||""}t&&t(e.myIpAddr)}})}},setExtraData:function(t){if(t.map_list&&0!=t.map_list.length&&DataMgr.propCtrl){var e=t.map_list,i={},a={gun_effect_name:"gun_effect",head:null};if(t.extra_data=a,DataMgr.propCtrl.extendUsedPropObj(e,i),i.head_id){var s=DataMgr.propCtrl.getPropInfoById(i.head_id);s&&(a.head=s.icon)}}},getAppJumpParam:function(t,e){},getExtInfo:function(t){},bindIDCard:function(t,e,i){var a={};a.user=DataMgr.accountCtrl.lastAccount,a.realname=t,a.userCode=e,a.password=DataMgr.accountCtrl.lastPass,a.ignorePort=!0,requestWaiting4Http(HTTP_FULL_NAME,a,function(t){i(t)},"验证中")}}),RecordCtrl=cc.Class.extend({scrollNoticeList:null,noticeList:null,replayData:null,isBanGambling:!1,ctor:function(t){console.log(t)},getRecord:function(t,e){e=e||GAME_TYPE;var i={};return i.rid=ME_D.get_rid(),i.sign=DataMgr.accountCtrl.apiSign,i.timestamp=DataMgr.accountCtrl.timestamp,i.user=DataMgr.accountCtrl.lastAccount,i.uid=DataMgr.accountCtrl.apiUid,i.game_type=e,DataMgr.accountCtrl.closeRecord?ModuleMgr.showTipMsg("请稍后查询战绩"):DataMgr.timeCtrl.getServerTime()-DataMgr.gameCtrl.failTime<180?void ModuleMgr.showTipMsg("服务器网络异常,请等待"+(180-parseInt(DataMgr.timeCtrl.getServerTime()-DataMgr.gameCtrl.failTime))+"秒"):void requestWaiting4Http(HTTP_IFACE_GET_RECORD,i,function(i){t(i,e)},"请求战绩中")},getOneRecord:function(t,e,i,a){i=i||GAME_TYPE;var s={};s.rid=t,s.game_type=i,requestWaiting4Http(HTTP_IFACE_GET_ONE_RECORD,s,function(t){if(a){var s={item_png:"res/plist/item.png",item_plist:"res/plist/item.plist"},r=[];for(var n in s)r.push(GetRealPath(s[n]));cc.loader.load(r,function(t,e,i){},function(){cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/item.plist")),e(t)})}else e(t,i)},"请求战绩中")},getOtherRecord:function(t,e,i){i=i||GAME_TYPE;var a={},s=this,r=HTTP_IFACE_GET_REPLAY_RECORD+"?game_type="+i+"&rid="+t;requestWaiting4Http(r,a,function(t){s.replayData=t,t&&t.lists[0]&&(DataMgr.gameCtrl.replayData=ConvertToJson(t.lists[0].record_detail)),e&&e(t,i)},"请求战绩中","GET")},getOwnerInfo:function(t){var e=t.desk_own_rid,i=ConvertToJson(t.record_detail),a=i.users;if(a)for(var s=0;s<a.length;s++){var r=a[s];if(r.rid==e)return r}return null},showRecordDetail:function(t){if(t){var e={};e.deskId=t.desk_no,null==e.deskId&&(e.deskId=DataMgr.gameCtrl.deskIdx),e.round=t.full_round,e.creatTime=t.create_time;var i=this.getOwnerInfo(t);i&&(e.ownerName=i.name),e.ownerRid=t.desk_own_rid,e.dlgType=t.dlgType||1,e.recordId=t.rid,e.crazyLv=t.crazy_lv,e.players=[];var a=ConvertToJson(t.record_detail);e.recordData=a;for(var s=a.score,r=a.users||[],n=0;n<r.length;n++){var o=n+1,c=r[n];if(c.rid){var l={idx:o,headUrl:c.headimgurl,score:s["idx"+o],name:c.name,rid:c.rid,account_uid:c.account_uid,map_list:c.map_list};l.rid==ME_D.get_rid()&&(l.map_list=DataMgr.propCtrl.usedMapList),DataMgr.accountCtrl.setExtraData(l),e.players.push(l)}}ModuleMgr.runOrientationDlg("RecordDetail",e,null,null)}},getReplayUsers:function(){return this.replayData?this.replayData.users:null},getReplayPokerList:function(){return this.replayData?this.replayData.poker_list:null},getSteps:function(){return this.replayData?this.replayData.steps:null},getGameDetailRecord:function(t,e,i){i=i||GAME_TYPE;var a={},s=this,r=HTTP_IFACE_GET_REPLAY_RECORD+"?game_type="+i+"&rid="+t;requestWaiting4Http(r,a,function(t){s.replayData=t,t&&t.lists[0]&&(DataMgr.gameCtrl.replayData=ConvertToJson(t.lists[0].record_detail),ModuleMgr.enterGameScene(!0)),e&&e(t,i)},"请求录像中","GET")},getNews:function(t){var e=this,i=function(i){var a={};requestWaiting4Http(HTTP_IFACE_GET_NEWS+"&area="+encodeURIComponent(i),a,function(a){t(e.parseDataList(a,i))},"请求新闻中","GET")};DataMgr.getCityCallback(i)},parseDataList:function(t,e){for(var i=[],a=[],s=0;s<t.list.length;s++)"common"==t.list[s].area?i.push(t.list[s]):t.list[s].area==e&&a.push(t.list[s]);return 0==a.length?t.list=i:t.list=a,t},getScrollNotice:function(t){var e={},i=this;if(this.scrollNoticeList&&this.scrollNoticeList.length>0)t(i.scrollNoticeList);else{var a=function(a){request4Http(HTTP_IFACE_GET_SCROLL+"&area="+encodeURIComponent(a),e,function(e){i.scrollNoticeList=i.parseDataList(e,a).list,t(i.scrollNoticeList)},"GET")};DataMgr.getCityCallback(a)}},getOpenNotice:function(t){var e={},i=this;if(this.noticeList&&this.noticeList.length>0)t(i.noticeList);else{var a=function(a){request4Http(HTTP_IFACE_GET_NOTICE_OPEN+"&area="+encodeURIComponent(a),e,function(e){i.noticeList=i.parseDataList(e,a).list,t(i.noticeList)},"GET")};DataMgr.getCityCallback(a)}},getCloseNotice:function(t){var e={},i=this;if(this.noticeList&&this.noticeList.length>0)t(i.noticeList);else{var a=function(a){request4Http(HTTP_IFACE_GET_NOTICE_CLOSE+"&area="+encodeURIComponent(a),e,function(e){i.noticeList=i.parseDataList(e,a).list,t(i.noticeList)},"GET")};DataMgr.getCityCallback(a)}},confirmBanGambling:function(){this.isBanGambling=!0,cc.sys.localStorage.setItem(GAME_TYPE+"_ban_gambling_time",DataMgr.timeCtrl.getServerTime())}}),ActivityCtrl=cc.Class.extend({TYPE_FREE_ROOM:"free_room",activityData:[],ctor:function(t){console.log(t)},getFreeRoomData:function(){for(var t=0;t<this.activityData.length;t++){var e=this.activityData[t];if(e.activity_type==this.TYPE_FREE_ROOM)return e}return null},bolFreeRoom:function(){var t=this.getFreeRoomData();if(!t)return!1;var e=DataMgr.timeCtrl.getServerTime();if(e>=t.start_time&&e<=t.end_time){var i=DataMgr.timeCtrl.getTodaySec();if(t.all_step_list)for(var a=0;a<t.all_step_list.length;a++)if(i>=t.all_step_list[a].start_sec&&i<=t.all_step_list[a].end_sec)return!0}return!1},getBindPhone:function(t,e,i){var a={};a.rid=ME_D.get_rid(),a.sign=DataMgr.accountCtrl.apiSign,a.timestamp=DataMgr.accountCtrl.timestamp,a.user=DataMgr.accountCtrl.lastAccount,a.uid=DataMgr.accountCtrl.apiUid,a.wechat=e,a.telephone=t,a.ignorePort=!0,requestWaiting4Http(HTTP_BIND_PHONE,a,function(t){i(t)},"修改中")},bindCode:function(t,e,i){var a={};a.user=DataMgr.accountCtrl.lastAccount,a.realname=t,a.userCode=e,a.password=DataMgr.accountCtrl.lastPass,a.ignorePort=!0,requestWaiting4Http(HTTP_FULL_NAME,a,function(t){i(t)},"验证中")},getTurnActivity:function(t){if(this.turnData)return void(t&&t(this.turnData));var e=this,i={};requestWaiting4Http(HTTP_TURN_ACTIVITY,i,function(i){e.turnData=i.result,t&&t(e.turnData)},"请求数据中")},doTurn:function(t){var e={};e.rid=ME_D.get_rid(),e.sign=DataMgr.accountCtrl.apiSign,e.timestamp=DataMgr.accountCtrl.timestamp,e.user=DataMgr.accountCtrl.lastAccount,e.uid=DataMgr.accountCtrl.apiUid,requestWaiting4Http(HTTP_TURN_DO,e,function(e){t(e.getItem)},"")},getRankGiftInfo:function(t,e){var i=t||{};requestWaiting4Http(HTTP_GET_DIFT_INFO,i,function(t){e&&e(t.result||{})},"")},doForeceUserCodeOpene:function(){var t={};requestWaiting4Http(HTTP_FORECE_USERCODE_OPEN,t,function(t){t&&(0!=t.ret||(t.foreUserCode&&"false"!=t.foreUserCode&&0!=t.foreUserCode&&0!=t.foreUserCode?DataMgr.accountCtrl.isForeceUserCodeOpen=!0:DataMgr.accountCtrl.isForeceUserCodeOpen=!1,t.openOwnLeave&&"false"!=t.openOwnLeave&&0!=t.openOwnLeave&&0!=t.openOwnLeave?DataMgr.accountCtrl.openOwnLeave=!0:DataMgr.accountCtrl.openOwnLeave=!1,t.closeRecord&&"false"!=t.closeRecord&&0!=t.closeRecord&&0!=t.closeRecord?DataMgr.accountCtrl.closeRecord=!0:DataMgr.accountCtrl.closeRecord=!1,HALL_TWO_URL=t.hallTwoUrl||HALL_TWO_URL))},"验证中")}}),PROP_TYPES={HEAD:1,GUN:2,FACE:3},DEFUALT_USED_ID={HEAD_ID:-2,GUN_ID:-1},PropCtrl=cc.Class.extend({propInfoList:[],soldPropList:[],ownPropList:[],usedPropObj:{head_id:0,gun_id:0},usedMapList:[],ctor:function(){this.clearData(),this.getPropInfoList()},clearData:function(){this.propInfoList=[],this.soldPropList=[],this.ownPropList=[],this.usedPropObj={},this.usedMapList=[]},getPropInfoList:function(){this.propInfoList=CsvMgr.getDataWithFile("NewItemInfo")},getPropInfoById:function(t){return this.propInfoList&&this.propInfoList[t]?this.propInfoList[t]:t==DEFUALT_USED_ID.HEAD_ID?{icon:"touxiang",position:PROP_TYPES.HEAD,name:"默认",quality:0}:null},extendUsedPropObj:function(t,e){if(e=e||this.usedPropObj,t)for(var i=DataMgr.timeCtrl.getServerTime(),a=0;a<t.length;++a){var s=this.getPropInfoById(t[a].class_id);s&&s.position==PROP_TYPES.HEAD&&(!t[a].end_time||t[a].end_time-i<0?e.head_id=0:e.head_id=t[a].class_id)}},updateUsedMapList:function(t){if(this.usedMapList)if(t.class_id!=DEFUALT_USED_ID.HEAD_ID){var e=this.getPropInfoById(t.class_id);if(e)if(0==this.usedMapList.length)this.usedMapList.push(t);else for(var i=0;i<this.usedMapList.length;++i){var a=this.getPropInfoById(this.usedMapList[i].class_id);e.position==a.position&&(this.usedMapList[i]=t)}}else for(var i=0;i<this.usedMapList.length;++i){var a=this.getPropInfoById(this.usedMapList[i].class_id);a.position==PROP_TYPES.HEAD&&this.usedMapList.splice(i,1)}},takeOffUsedProp:function(t){t==PROP_TYPES.HEAD&&(this.usedPropObj.head_id=0,DataMgr.propCtrl.updateUsedMapList({class_id:DEFUALT_USED_ID.HEAD_ID}))},getOwnPropById:function(t){for(var e=0;e<this.ownPropList.length;++e)if(this.ownPropList[e].class_id==t)return this.ownPropList[e]},addOwnProp:function(t){t.is_own_prop=!0,t&&this.ownPropList.push(t)},setPropList:function(t){this.ownPropList=t;for(var e=0;e<this.ownPropList.length;++e)this.ownPropList[e].is_own_prop=!0;this.ownPropList.push({class_id:DEFUALT_USED_ID.HEAD_ID,end_time:-1,is_own_prop:!0})},ownPropListUsed:function(){for(var t=DataMgr.timeCtrl.getServerTime(),e=0;e<this.ownPropList.length;++e)this.ownPropList[e].is_used=!1,this.ownPropList[e].end_time!=-1&&this.ownPropList[e].end_time-t<0&&this.ownPropList.splice(e,1);for(var i=!1,e=0;e<this.ownPropList.length;++e)this.ownPropList[e].class_id==this.usedPropObj.head_id&&(this.ownPropList[e].is_used=!0,i=!0);if(!i)for(var e=0;e<this.ownPropList.length;++e)i||this.ownPropList[e].class_id!=DEFUALT_USED_ID.HEAD_ID||(this.ownPropList[e].is_used=!0)},getHeadPropInfo:function(){var t=this.getPropInfoById(this.usedPropObj.head_id);if(t&&t.position==PROP_TYPES.HEAD)return t},getSoldPropList:function(){if(this.soldPropList.length)return this.soldPropList;for(var t=CsvMgr.getDataWithFile("NewShop"),e=lengthOfObj(t)+1,i=1;i<e;++i)t[i]&&!t[i].is_close&&(t[i].day=t[i].day.split("#"),t[i].money=t[i].money.split("#"),t[i].money_type=t[i].money_type.split("#"),this.soldPropList.push(t[i]));return this.soldPropList}}),Platform=cc.Class.extend({curPlatform:null,weixinTimeOut:172800,ctor:function(){1==cc.sys.isNative?cc.sys.os==cc.sys.OS_ANDROID?this.curPlatform=new AndroidPlatform:cc.sys.os==cc.sys.OS_IOS?this.curPlatform=new IosPlatform:this.curPlatform=new Html5Platform:this.curPlatform=new Html5Platform},login:function(t){return t=t||0,getTimestamp()-DataMgr.accountCtrl.lastLoginTime<platform.weixinTimeOut?void this.doWechatLogin():(ModuleMgr.showWaitMsg("授权中",0),this.curLocate=t,t==LOCATE_PLAFORM.WECHAT?this.curPlatform.login(t):this.curPlatform.loginMost(t))},loginCallback:function(t){return this.curPlatform.loginCallback(t);
},pay:function(t,e,i){return this.curPlatform.pay(t,e,i)},isInstalled:function(){return this.curPlatform.isInstalled()},share:function(t,e,i,a,s,r,n){return n=n||0,n==LOCATE_PLAFORM.WECHAT?this.curPlatform.share(t,e,i,a,s):void(n==LOCATE_PLAFORM.MOSTONE&&this.shareMost(t,e,i,a,s,r))},shareMost:function(t,e,i,a,s,r){return r=r||"",this.curPlatform.shareMost(t,e,i,a,s,r)},shareImage:function(t,e){return this.curPlatform.shareImage(t,e)},shareImageMost:function(t,e){return this.curPlatform.shareImageMost(t,e)},doWechatLogin:function(){return this.curPlatform.doWechatLogin()},init:function(){return this.curPlatform.init()},startRecord:function(){return this.curPlatform.startRecord()},stopRecord:function(){return this.curPlatform.stopRecord()},getLocation:function(t){return this.getLocationCallback=t,this.curPlatform.getLocation(t)},downRecord:function(t){return this.curPlatform.downRecord(t)},enterHall:function(){return this.curPlatform.enterHall()}}),BasePlatform=cc.Class.extend({isInstalled:function(){return!1},login:function(){},loginCallback:function(t){},init:function(){},shareImage:function(t,e){},share:function(t,e,i){},pay:function(t,e){},startRecord:function(){},stopRecord:function(){},downRecord:function(){},getLocation:function(t){},doWechatLogin:function(){DataMgr.accountCtrl.isGuest=!1,DataMgr.accountCtrl.apilogin(DataMgr.accountCtrl.wechatAccount,DataMgr.accountCtrl.wechatPass,function(t,e){t?(ModuleMgr.showTipMsg(t),DataMgr.accountCtrl.lastLoginTime=0,DataMgr.accountCtrl.saveAccount()):(DataMgr.accountCtrl.lastLoginTime=getTimestamp(),DataMgr.accountCtrl.saveAccount(),cc.log(DataMgr.accountCtrl.nickname),cc.log(DataMgr.accountCtrl.headimgurl),cc.log("fuck"),LOGIN_D.login(null,null))})},enterHall:function(){}}),IosPlatform=BasePlatform.extend({mostIosVersion:1.3,downloadUrl:"http://5gcx7ctd.xindelong.com.cn/UJz5H2",isInstalled:function(){return jsb.reflection.callStaticMethod("AppController","isWXInstalled")},login:function(){return jsb.reflection.callStaticMethod("AppController","login")},shareImage:function(t,e){var i=parseFloat(getQueryString("ios_version"))||0;return i+.001<this.mostIosVersion?ModuleMgr.showTipMsg("请下载更高版本！"):jsb.reflection.callStaticMethod("AppController","shareImg:type:",t,e)},shareImageMost:function(t,e){var i=parseFloat(getQueryString("ios_version"))||0;if(i+.001<this.mostIosVersion){var a=this.downloadUrl;return ModuleMgr.showConfirmCancelMsg("请下载更高版本",function(){cc.sys.openURL(decodeURIComponent(a))})}return jsb.reflection.callStaticMethod("AppController","shareImgMost:type:",t,e)},loginCallback:function(t){var e=this,i=function(t){DataMgr.accountCtrl.wechatAccount=t.user,DataMgr.accountCtrl.wechatPass=t.password,e.doWechatLogin()};DataMgr.accountCtrl.apiWechatLogin(1,t,i)},share:function(t,e,i,a){return jsb.reflection.callStaticMethod("AppController","share:andContent:andLink:type:",t,e,i,a)},shareMost:function(t,e,i,a,s,r){r.length>0&&(r="com.gongpa.hall/openwith?"+r);var n=parseFloat(getQueryString("ios_version"))||0;if(n+.001<this.mostIosVersion){var o=this.downloadUrl;return ModuleMgr.showConfirmCancelMsg("请下载更高版本",function(){cc.sys.openURL(decodeURIComponent(o))})}return jsb.reflection.callStaticMethod("AppController","shareMost:andContent:andLink:type:imgUrl:jumpParam:",t,e,i,a,s,r)},startRecord:function(){return jsb.reflection.callStaticMethod("AppController","startRecord:rid:",DOWN_RECORD_SERVER+"/apiupload",ME_D.get_rid())},stopRecord:function(){return jsb.reflection.callStaticMethod("AppController","stopRecord")},downRecord:function(t){return jsb.reflection.callStaticMethod("AppController","downRecord:",t)},getLocation:function(t){return jsb.reflection.callStaticMethod("AppController","getLocation")},pay:function(t,e,i){return jsb.reflection.callStaticMethod("AppController","pay:type:data:",t,e,i)},enterHall:function(){jsb.UpdateZipMgr.Instance().enterHall()}}),AndroidPlatform=BasePlatform.extend({mostAndroidVersion:3.1,downloadUrl:"http://5gcx7ctd.xindelong.com.cn/UJz5H2",isInstalled:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","isWXInstalled","()Z")},login:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","login","()V")},share:function(t,e,i,a,s){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","share","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;I)V",t,e,i,a)},shareMost:function(t,e,i,a,s,r){var n=parseFloat(getQueryString("android_version"))||0;if(n+.001<this.mostAndroidVersion){var o=this.downloadUrl;return ModuleMgr.showConfirmCancelMsg("请下载更高版本",function(){cc.sys.openURL(decodeURIComponent(o))})}return r.length>0&&(r="com.gongpa.hall/openwith?"+r),jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","shareMost","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;)V",t,e,i,a,s,r)},startRecord:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","startRecord","(Ljava/lang/String;Ljava/lang/String;)V",DOWN_RECORD_SERVER+"/apiupload",ME_D.get_rid())},downRecord:function(t){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","downRecord","(Ljava/lang/String;)V",t)},stopRecord:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","stopRecord","()V")},pay:function(t,e,i){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","pay","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",""+t,""+e,""+i)},loginCallback:function(t){var e=this,i=function(t){DataMgr.accountCtrl.wechatAccount=t.user,DataMgr.accountCtrl.wechatPass=t.password,e.doWechatLogin()};DataMgr.accountCtrl.apiWechatLogin(1,t,i)},getLocation:function(t){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getLocation","()V")},shareImage:function(t,e){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","shareImg","(Ljava/lang/String;I)V",t,e)},shareImageMost:function(t,e){var i=parseFloat(getQueryString("android_version"))||0;if(i+.001<this.mostAndroidVersion){var a=this.downloadUrl;return ModuleMgr.showConfirmCancelMsg("请下载更高版本",function(){cc.sys.openURL(decodeURIComponent(a))})}return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","shareImgMost","(Ljava/lang/String;I)V",t,e)},enterHall:function(){jsb.UpdateZipMgr.Instance().enterHall()}}),Html5Platform=BasePlatform.extend({isInstalled:function(){return!0},login:function(){var t=getQueryString("desk")||0,e=getQueryString("guest")||0,i=getQueryString("game_type")||"",a=getQueryString("test")||0,s=WEIXIN_CALLBACK_URL,r=WEIXIN_CALLBACK_URL,n="wx690aed3c77191027",o="ncmj";r="http://gongpa.game842.com",o="fjmj";var c=getQueryString("mj_record_rid")||0,l=getQueryString("union_rid")||0,_=getQueryString("lanscape_dev")||0;cc.sys.openURL("https://open.weixin.qq.com/connect/oauth2/authorize?appid="+n+"&redirect_uri="+encodeURIComponent(r+"/apipubliclogin/dowechat?desk="+t+"&test="+a+"&lanscape_dev="+_+"&union_rid="+l+"&mj_record_rid="+c+"&game_type="+i+"&id="+n+"&guest="+e)+"%26real_redirect%3d"+encodeURIComponent(s+"/doredirect?realRedirect="+o)+"%26real_wechat%3d"+encodeURIComponent(s+"/apipubliclogin")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")},loginMost:function(){if("undefined"!=typeof MostOneJSApis){var t=DataMgr.accountCtrl.getMostAppId(),e=JSON.stringify({appkey:t,state:"1"});MostOneJSApis.getMostOneAuthData(e)}},loginCallback:function(t,e){e=e||platform.curLocate;var i=this,a=function(t){if(t.is_bind_wx)DataMgr.accountCtrl.wechatAccount=t.user,DataMgr.accountCtrl.wechatPass=t.password,i.doWechatLogin();else{if(!cc.sys.isNative&&"undefined"!=typeof MostOneJSApis)return ModuleMgr.showConfirmTxtMsg("需在app版绑定微信");ModuleMgr.showConfirmCancelMsg("绑定微信？",function(){platform.LocateBindWechat=LOCATE_PLAFORM.MOSTONE,DataMgr.accountCtrl.channelUid=t.channelUid,ModuleMgr.showWaitMsg("授权中",0),this.curLocate=LOCATE_PLAFORM.WECHAT,platform.login(LOCATE_PLAFORM.WECHAT)})}};e==LOCATE_PLAFORM.WECHAT||e==LOCATE_PLAFORM.MOSTONE&&DataMgr.accountCtrl.apiMostOneLogin(1,t,a)},init:function(){var t=this;"undefined"!=typeof wx&&wx.onVoiceRecordEnd({complete:function(e){t.uploadVoice(e.localId)}})},getLocation:function(t){function e(e){t({longitude:e.lng,latitude:e.lat})}function i(e){t({longitude:-1})}if("undefined"!=typeof qq)try{var a=new qq.maps.Geolocation("7PHBZ-NWFWG-BBLQ3-IYYJX-N7Z63-O3FO2","myapp");a.getLocation(e,i)}catch(t){}},share:function(t,e,i,a,s){null!=wx&&(null==s&&0==cc.sys.isNative&&(s=getShareIconPath()),wx.ready(function(){wx.onMenuShareAppMessage({title:t,desc:e,link:i,imgUrl:s,success:function(){sdk_share_callback(1),cc.eventManager.dispatchCustomEvent("SuccessShareReturn",0)},cancel:function(){cc.eventManager.dispatchCustomEvent("SuccessShareReturn",-1)}}),wx.onMenuShareTimeline({title:e,link:i,imgUrl:s,success:function(){sdk_share_callback(1),cc.eventManager.dispatchCustomEvent("SuccessShareReturn",0)},cancel:function(){cc.eventManager.dispatchCustomEvent("SuccessShareReturn",-1)}}),3!=a&&ModuleMgr.runDlg("WxShareDlg",{type:a},null,null)}))},shareMost:function(t,e,i,a,s,r){r.length>0&&(r="com.gongpa.hall/openwith?"+r);var n=DataMgr.accountCtrl.getMostAppId(),o=JSON.stringify({title:t,content:e,imagePath:s,webPath:i,shareType:"100",appkey:n});MostOneJSApis.shareWithShareData(o)},startRecord:function(){wx.startRecord({success:function(){},cancel:function(){ModuleMgr.showTipMsg("你取消了录音")}})},stopRecord:function(){var t=this;wx.stopRecord({success:function(e){t.uploadVoice(e.localId)},fail:function(t){ModuleMgr.showTipMsg(JSON.stringify(t))}})},downToMyServer:function(t){var e={method:"POST",timeout:2e4,url:DOWN_RECORD_SERVER+"/apiupload/newWechatMedia",data:JSON.stringify({rid:ME_D.get_rid(),mediaId:t})};HttpNetworkRequest(e,function(t,e){if(t)return void ModuleMgr.showTipMsg(t);var i=ConvertToJson(e);ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",media_id:DOWN_RECORD_SERVER+"/apidown?file="+i.name,platform:"html5_native"})})},uploadVoice:function(t){var e=this;wx.uploadVoice({localId:t,isShowProgressTips:0,success:function(t){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",media_id:t.serverId,platform:"html5"}),e.downToMyServer(t.serverId)}})},downRecord:function(t){wx.onVoicePlayEnd({success:function(e){e.localId;cc.eventManager.dispatchCustomEvent("SuccessEndPlayRecord",t)}}),wx.downloadVoice({serverId:t,isShowProgressTips:0,success:function(e){cc.eventManager.dispatchCustomEvent("SuccessStartPlayRecord",t),wx.playVoice(e)}})}}),login_most_out=function(t){var e=ConvertToJson(t);ModuleMgr.removeWaitMsg(),platform.curLocate=1,platform.loginCallback(e.authCode)};var callBackCode=function(t){setTimeout(function(){login_most_out(t)}.bind(this),0)},callBackError=function(t){setTimeout(function(){var e=ConvertToJson(t);ModuleMgr.showTipMsg(e.message)}.bind(this),0)},callBackShareSuccess=function(t){setTimeout(function(){ModuleMgr.showTipMsg("分享成功")}.bind(this),0)},callBackShareError=function(t){setTimeout(function(){var e=ConvertToJson(t);ModuleMgr.showTipMsg(e.message)}.bind(this),0)};sdk_login_callback=function(t){platform.retCode=t},sdk_record_end_play_callback=function(t){platform.retRecordEndPlay=t},sdk_record_start_play_callback=function(t){platform.retRecordStartPlay=t},sdk_record_uploaded_callback=function(t){platform.retRecordUploaded=t},sdk_record_uploaded_json_callback=function(t){var e=ConvertToJson(t);sdk_record_uploaded_callback(e.name)},sdk_location_callback=function(t,e){var i={};i.longitude=t,i.latitude=e,platform.getLocationCallback(i)},sdk_record_ipa_pay_callback=function(t){var e={method:"POST",timeout:5e3,url:GAME_WEB_URL+PAY_PORT+"/ApiApplyPay",data:JSON.stringify({receipt:t,uid:ME_D.get_user().account_uid})};HttpNetworkRequest(e,function(t,e){})},sdk_share_callback=function(t){ME_D.send_message(CMD_SHARE_GAME,{})},sdk_login_err_callback=function(){ModuleMgr.removeWaitMsg()},sdk_enter_room=function(t){if(!DataMgr.accountCtrl.bolFromHall())if("LoginScene"==g_scene.name)NetMsg.hasQuery=!1;else if("EnterScene"==g_scene.name){var t=parseInt(t);t>0&&ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:t})}},sdk_enter_room_ext=function(t){var e=DataMgr.accountCtrl.getExtInfo(t),i=e.desk,a=e.gameType;DataMgr.accountCtrl.bolFromHall()&&(i>0?a==GAME_TYPE?"EnterScene"==g_scene.name&&ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:i}):DataMgr.gameCtrl.deskIdx>0||(DataMgr.accountCtrl.bolSdkEnterRoom=!0,DataMgr.accountCtrl.sdkEnterRommInfo=DataMgr.accountCtrl.sdkEnterRommInfo||{},DataMgr.accountCtrl.sdkEnterRommInfo.desk=i,DataMgr.accountCtrl.sdkEnterRommInfo.gameType=a,goHome()):(DataMgr.accountCtrl.bolSdkEnterRoom=!1,DataMgr.accountCtrl.sdkEnterRommInfo={}))},platform=new Platform,platform.init(),doMainShare=function(){platform.share(SHARE_GAME_TITLE_DES(),SHARE_MAIN_DES(),getShareUrl(0,0),3)},getPayReturnUrl=function(t,e){var i=getQueryString("guest")||0,a=getQueryString("test")||0,s=SHARE_URL;return s+"?desk="+t+"&game_type="+GAME_TYPE+"&test="+a+"&guest="+i+"&recordId="+e},getShareUrl=function(t,e,i){if(GAME_TYPE_NCMJ==GAME_TYPE&&0==t&&0==e)return"http://ncmj.gongpaa.com/gpncmj/";var a=SHARE_URL,s=getQueryString("guest")||0,r=getQueryString("test")||0;if(i==LOCATE_PLAFORM.MOSTONE){var n="gongpa.5913yx.com/fjmj/";return r&&(n="test.gongpaa.com/fjmj/"),n+"?desk="+t+"&game_type="+GAME_TYPE+"&test="+r+"&guest="+s+"&recordId="+e}return cc.sys.isNative?HALL_TWO_URL+"/hallfafa?desk="+t+"&game_type="+GAME_TYPE+"&test="+r+"&guest="+s+"&recordId="+e:a+"?desk="+t+"&game_type="+GAME_TYPE+"&test="+r+"&guest="+s+"&recordId="+e},getNewShareUrl=function(t,e){getQueryString("guest")||0,getQueryString("test")||0;return GAME_TYPE==GAME_TYPE_NCMJ?WEIXIN_CALLBACK_URL+"/res_ncmj/index.html?desk="+t:WEIXIN_CALLBACK_URL+"/takwx?desk="+t},doGameShare=function(){GAME_TYPE==GAME_TYPE_NCMJ?platform.share(SHARE_INVITE_TITLE(),SHARE_INVITE_DESC(),getNewShareUrl(DataMgr.gameCtrl.deskIdx),3,SHARE_URL+"res/icon/invite3.png"):platform.share(SHARE_INVITE_TITLE(),SHARE_INVITE_DESC(),getShareUrl(DataMgr.gameCtrl.deskIdx),3,SHARE_URL+"res/icon/invite3.png")},getInviteInfo=function(t){var e={title:"",content:""},i=DataMgr.gameCtrl.deskInfo;if(i){var a=DataMgr.gameCtrl.deskPlayers,s="",r=i.game_type;r==GAME_TYPE_FZMJ?s="福州麻将":r==GAME_TYPE_NDMJ&&(s="宁德麻将"),e.title+=s+"，房号 <"+DataMgr.gameCtrl.deskIdx+"> ，";for(var n=i.full_num||4,o=0,c="",l=0;l<a.length;l++)a[l]&&a[l].info&&(c+="，"+a[l].info.name,o++);e.title+=o+"缺"+(n-o),e.title+=c,e.content+="玩法："+s,t&&(i.union_rid?e.content+="，好友圈开房":e.content+="，房主开房"),e.content+="，"+i.full_round+"局",e.content+="，"+i.full_num+"人";var _=i.info;switch(i.game_type){case"fzmj":_&&(1==_.cost?e.content+="，放胡均摊":e.content+="，放胡单赔",1==_.spec1&&(e.content+="，清一色"),1==_.spec3&&(e.content+="，可胡金龙"),1==_.spec2&&(e.content+="，单钓剩金不平胡"),1==_.spec4&&(e.content+="，金雀开口不平胡"));break;case"ndmj":_&&(1==_.cost?e.content+="，放胡均摊":e.content+="，放胡单赔",1==_.spec_type?e.content+="，白板为金":e.content+="，开金")}}return e},shareRoomToLocate=function(t,e){var i=getInviteInfo(!0);cc.log("标题：",i.title),cc.log("内容：",i.content);var a=getShareUrl(DataMgr.gameCtrl.deskIdx,0,e);cc.log("地址：",a),""!=DataMgr.gameCtrl.deskInfo.oncestr&&(a=a+"&oncestr="+DataMgr.gameCtrl.deskInfo.oncestr),DataMgr.gameCtrl.deskInfo.union_rid&&(a=a+"&desk_union_rid="+DataMgr.gameCtrl.deskInfo.union_rid),DataMgr.gameCtrl.deskInfo.match_rid&&(a=a+"&desk_match_rid="+DataMgr.gameCtrl.deskInfo.match_rid);var s=DataMgr.accountCtrl.getAppJumpParam(GAME_TYPE,DataMgr.gameCtrl.deskIdx);platform.share(i.title,i.content,a,t,SHARE_URL+"res/icon/invite3.png",s,e)},SGMsgTip=QPLayer.extend({uiPath:"ui/base/MsgTip.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},setData:function(t){this.lab_txt&&this.lab_txt.setString(t.text)},show:function(){function t(t){e.close()}this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20),this.setCascadeOpacityEnabled(!0);var e=this,i=cc.p(0,40),a=cc.p(0,20);if(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE){var s=ModuleMgr.getScreenRotation();if(s==-90)var i=cc.p(-40,0),a=cc.p(-20,0);else if(90==s)var i=cc.p(40,0),a=cc.p(20,0)}this.runAction(cc.Sequence.create(cc.Spawn.create(cc.MoveBy.create(.4,i),cc.FadeIn.create(.3)),cc.DelayTime.create(1),cc.Spawn.create(cc.MoveBy.create(.2,a),cc.FadeOut.create(.2)),cc.CallFunc.create(t)))}}),SGMsgTip.create=function(t,e,i){return new SGMsgTip(t,e,i)},MsgMgr.registerMsg(MsgMgr.MSG_TYPE.TIP,SGMsgTip),SGMsgWait=QPLayer.extend({waitTime:2,uiPath:"ui/base/MsgWait.ui",_touchListener:null,duration:0,noClose:!1,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i);this.setVisible(!1)},updateTxt:function(t){this.lab_txt&&this.lab_txt.setString(t)},onEnter:function(){QPLayer.prototype.onEnter.call(this)},onExit:function(){this._touchListener&&(cc.eventManager.removeListener(this._touchListener),this._touchListener=null),QPLayer.prototype.onExit.call(this)},showAction:function(){this.setVisible(!0),this.icon_wait&&this.icon_wait.runAction(cc.RepeatForever.create(cc.Sequence.create(cc.RotateBy.create(2,-360))))},setData:function(t){this.lab_txt&&this.lab_txt.setString(t.text),this.waitTime=this.waitTime||0,this.noClose=this.noClose||!1,this.isShowBg=t.black;var e=cc.size(3*cc.winSize.width,3*cc.winSize.height),i=cc.LayerColor.create(cc.color(0,0,0,150));i.setContentSize(e),i.setPositionX(-cc.winSize.width),i.setPositionY(-cc.winSize.height),this.addChild(i,-1),i.setOpacity(150),this.isShowBg&&(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(t,e){return!0}}),cc.eventManager.addListener(this._touchListener,this)),0==this.waitTime&&this.showAction(),this.duration=0,this.scheduleUpdate()},update:function(t){t=t>.3?.3:t,this.duration+=t,this.waitTime>0&&this.duration>=this.waitTime&&!this.isVisible()&&this.showAction()},show:function(){this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20)}}),SGMsgWait.create=function(t,e){return new SGMsgWait(t,e)},SGMsgWait.waitTime=2,MsgMgr.registerMsg(MsgMgr.MSG_TYPE.WAIT,SGMsgWait),SGMsgConfirm=QPDlg.extend({uiPath:"ui/base/MsgConfirm.ui",_touchListener:null,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i);var a=cc.size(3*cc.winSize.width,3*cc.winSize.height),s=cc.LayerColor.create(cc.color(0,0,0,150));s.setContentSize(a),s.setPositionX(-cc.winSize.width),s.setPositionY(-cc.winSize.height),s.setOpacity(150),this.addChild(s,-1),this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(t,e){return!0}}),cc.eventManager.addListener(this._touchListener,this)},setData:function(t){if(this.data=t,null!=this.lab_txt&&null!=t&&(this.cancelFunc=t.cancelFunc,this.okFunc=t.okFunc,this.lab_txt.setString(t.text),t.time)){this.timer.setVisible(!0);var e=this,i=function(){e.okFunc&&e.okFunc.call(),e.close()};this.timer.setData(t.time,i)}},onLoaded:function(){this.ishideCancel&&this.hideCancel(),this.timer.setVisible(!1),this.setData(this.data)},onEnter:function(){QPLayer.prototype.onEnter.call(this)},onExit:function(){this._touchListener&&(cc.eventManager.removeListener(this._touchListener),this._touchListener=null),QPLayer.prototype.onExit.call(this)},DoCancel:function(t){"ended"==t.name&&(this.cancelFunc&&this.cancelFunc.call(),this.close())},hideCancel:function(){this.ishideCancel=!0,this.btn_cancel&&(this.btn_cancel.setVisible(!1),this.btn_ok&&this.btn_ok.setPositionX(this.btn_cancel.getPositionX()/2+this.btn_ok.getPositionX()/2))},DoOk:function(t){"ended"==t.name&&(this.okFunc&&this.okFunc.call(),this.close())},show:function(){this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20)}}),SGMsgConfirm.create=function(t,e,i){return new SGMsgConfirm(t,e,i)},MsgMgr.registerMsg(MsgMgr.MSG_TYPE.CONFIRM,SGMsgConfirm),SGMsgFzConfirm=QPDlg.extend({uiPath:"ui/new/base/NewMsgConfirm.ui",_touchListener:null,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i);var a=cc.size(3*cc.winSize.width,3*cc.winSize.height),s=cc.LayerColor.create(cc.color(0,0,0,150));s.setContentSize(a),s.setPositionX(-cc.winSize.width),s.setPositionY(-cc.winSize.height),s.setOpacity(150),this.addChild(s,-1),this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(t,e){return!0}}),cc.eventManager.addListener(this._touchListener,this)},setData:function(t){if(this.data=t,null!=this.lab_txt&&null!=t&&(this.cancelFunc=t.cancelFunc,this.okFunc=t.okFunc,this.lab_txt.setString(t.text),t.font_size&&this.lab_txt.setFontSize(t.font_size),t.time)){this.item_time&&this.item_time.setVisible(!0);var e=this,i=function(){e.okFunc&&e.okFunc.call(),e.close()};this.item_time&&this.item_time.setData(t.time,i)}},onLoaded:function(){this.ishideCancel&&this.hideCancel(),this.item_time&&this.item_time.setVisible(!1),cc.log("this.data======",this.data),this.setData(this.data)},onEnter:function(){QPLayer.prototype.onEnter.call(this)},onExit:function(){this._touchListener&&(cc.eventManager.removeListener(this._touchListener),this._touchListener=null),QPLayer.prototype.onExit.call(this)},DoCancel:function(t){"ended"==t.name&&(this.cancelFunc&&this.cancelFunc.call(),this.close())},hideCancel:function(){this.ishideCancel=!0,this.btn_cancel&&(this.btn_cancel.setVisible(!1),this.btn_ok&&this.btn_ok.setPositionX(this.btn_cancel.getPositionX()/2+this.btn_ok.getPositionX()/2))},DoOk:function(t){"ended"==t.name&&(this.okFunc&&this.okFunc.call(),this.close())},show:function(){this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20)}}),SGMsgFzConfirm.create=function(t,e,i){return new SGMsgFzConfirm(t,e,i)},MsgMgr.registerMsg(MsgMgr.MSG_TYPE.FZ_CONFIRM,SGMsgFzConfirm),MsgAwardConfirm=QPDlg.extend({uiPath:"ui/new/base/MsgAwardConfirm.ui",_touchListener:null,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i);var a=cc.size(3*cc.winSize.width,3*cc.winSize.height),s=cc.LayerColor.create(cc.color(0,0,0,150));s.setContentSize(a),s.setPositionX(-cc.winSize.width),s.setPositionY(-cc.winSize.height),s.setOpacity(150),this.addChild(s,-1),this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(t,e){return!0}}),cc.eventManager.addListener(this._touchListener,this)},setData:function(t){if(this.data=t,null!=this.lab_txt&&null!=t){this.cancelFunc=t.cancelFunc,this.okFunc=t.okFunc,this.lab_txt.setString(t.text);var e=t.extraData;if(e&&"object"==typeof e){var i=function(t,e){var i=t.parent,a=PropItem,s=t.itemData,r=t.posX,e=t.index;ModuleMgr.createNode(a,s,i,function(t){t.setPositionX(r),i.setContentSize(cc.size(110*(e+1),100))})},a=cc.Node.create();a.setPosition(0,0),a.setAnchorPoint(cc.p(.5,.5)),this.container.addChild(a);for(var s=0;s<e.length;++s){var r={parent:a};r.itemData=e[s],r.posX=110*s,r.index=s,i(r)}}}},onLoaded:function(){},onEnter:function(){UILayer.prototype.onEnter.call(this)},onExit:function(){this._touchListener&&(cc.eventManager.removeListener(this._touchListener),this._touchListener=null),UILayer.prototype.onExit.call(this)},DoOk:function(t){"ended"==t.name&&(this.okFunc&&this.okFunc.call(),this.close())},show:function(){this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20)}}),MsgAwardConfirm.create=function(t,e,i){return new MsgAwardConfirm(t,e,i)},MsgMgr.registerMsg(MsgMgr.MSG_TYPE.AWARD_CONFIRM,MsgAwardConfirm),TAG_NEW_LOGO=1923,LOCAL_Z_ORDER_OF_HEADIMG=1,UrlHead=QPLayer.extend({ctor:function(t,e,i){QPLayer.prototype.ctor.call(this,t,e,i)},setUrl:function(t){var e=this;if(e.head_icon&&e.head_icon.parent&&e.head_icon.parent.removeChildByTag(100),null==t||0==t.length)return void this.head_icon.setVisible(!0);t=toDecodeURIComponent(t);var i=t.split("."),a=i[i.length-1].lastIndexOf("/");if(a>0){var s=t.lastIndexOf("/");s>0&&(t=t.substr(0,s+1)+"96"),cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID}else t+="?x-oss-process=image/resize,m_mfit,h_320,w_320";cc.loader.loadImg(t,{isCrossOrigin:!0},function(i,a){if(cc.log(t),!i){e.head_icon.setVisible(!1);var s=new cc.Sprite(a);s.setTag(100),e.head_icon.parent.removeChildByTag(100),e.head_icon.parent.addChild(s),s.x=e.head_icon.x,s.y=e.head_icon.y;var r=e.head_icon.width/s.width;s.scaleX=e.head_icon.scaleX*r,s.scaleY=e.head_icon.scaleY*r}})}}),UrlHead.create=function(t,e,i){return new UrlHead(t,e,i)},ModuleMgr.registerModule("UrlHead",UrlHead),MsgNotice=QPLayer.extend({uiPath:"ui/base/MsgNotice.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){var t=this;t.setVisible(!1),DataMgr.recordCtrl.getScrollNotice(function(e){if(e&&e.length>0){for(var i="",a=0;a<e.length;a++){var s=e[a];i+=toDecodeURIComponent(s.title)+"  "+toDecodeURIComponent(s.content)+"     "}i&&(t.setVisible(!0),t.show(i))}})},show:function(t){this.lab_txt.setString(t);var e=this.img_bg.getContentSize();this.lab_txt.setPositionX(e.width+5);var i=this.lab_txt.getContentSize(),a=100,s=e.width+i.width+5,r=s/a,n=this;this.lab_txt.runAction(cc.Sequence.create(cc.MoveBy.create(r,cc.p(-s,0)),cc.CallFunc.create(function(){n.show(t)})))}}),MsgNotice.create=function(t,e,i){return new MsgNotice(t,e,i)},UIUtils.RegisterPathTemple("ui/base/MsgNotice.ui",MsgNotice),PropItem=UILayer.extend({isControlNode:!0,uiPath:"ui/base/PropItem.ui",data:null,propInfo:null,ctor:function(t,e,i){this.data=t,UILayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this._super(),this.data&&(this.initUI(),this.setData())},initUI:function(){this.btn_use.setVisible(!1),this.is_used.setVisible(!1),this.lab_name.setVisible(!1),this.img_item.setVisible(!1),this.img_item.x=50,this.img_item.y=50},getLeftTime:function(t){if(t<0)return"永久";var e=t-DataMgr.timeCtrl.getServerTime();if(e<=0)return"剩余 0:0:0";var i=calDate(e),a=i[0],s=i[1],r=i[2],n=i[3];return a>0?"剩余 "+(a+1)+"天":"剩余 "+s+":"+r+":"+n},setData:function(t){this.initUI();var e=function(){i.left_time.setString(i.getLeftTime(t.end_time))};if(this.unscheduleAllCallbacks(),t=t||this.data,t&&"object"==typeof t){this.data=t,this.img_item.setVisible(!0),"diamond"===t.type&&this.img_item.loadTexture("res/uires/new/recharge/zuanshi1.png"),t.class_id&&(this.propInfo=DataMgr.propCtrl.getPropInfoById(t.class_id),this.propInfo&&this.data.day&&this.lab_name.setString(this.propInfo.name+"("+this.data.day[0]+"天)")),this.propInfo&&this.img_item.loadTexture("res/uires/item/"+this.propInfo.icon+".png",ccui.Widget.PLIST_TEXTURE),this.img_item.setTouchEnabled(!1);var i=this;this.left_time.setVisible(!1),this.btn_use.setVisible(!1),this.is_used.setVisible(!1),t.is_own_prop&&(t.is_used?this.is_used.setVisible(!0):this.btn_use.setVisible(!0),this.left_time.setVisible(!0),this.left_time.setString(this.getLeftTime(t.end_time)),t.end_time>0&&this.schedule(e,1,null,1)),t.money_type&&"room_card"==t.money_type[0]&&this.img_currency_type.loadTexture(GetRealPath("res/uires/new/common/chaye.png")),t.money_type&&"stone"==t.money_type[0]&&this.img_currency_type.loadTexture(GetRealPath("res/uires/new/recharge/zuanshi1.png")),this.lab_name.setVisible(t.money_type),this.img_currency_type.setVisible(t.money_type),this.btn_buy.setVisible(t.money_type),this.img_item.setTouchEnabled(t.money_type),t.money?(this.lab_money.setString(t.money[0]),this.lab_money.setVisible(!0)):this.lab_money.setVisible(!1),t.num?(this.lab_num.setString(t.num),this.lab_num.setVisible(!0)):this.lab_num.setVisible(!1),this.setOtherData()}},setOtherData:function(){},onTouched:function(t){return},tap_btn_buy:function(t){var e=this.data;e.money_type&&ModuleMgr.runDlg("MsgBuyPropConfirm",e,null,null)},tap_btn_use:function(){var t=this.data;this.propInfo&&t.is_own_prop&&ModuleMgr.showConfirmCancelMsg("是否使用"+this.propInfo.name+"("+(this.propInfo.position==PROP_TYPES.HEAD?"头像":"枪")+")?",function(){ME_D.send_message(CMD_ITEM_OPER,{oper:"put_on",class_id:t.class_id,game_type:GAME_TYPE})})},onExit:function(){this.unscheduleAllCallbacks(),this._super()}}),PropItem.create=function(t,e,i){return new PropItem(t,e,i)},ModuleMgr.registerModule("PropItem",PropItem),UIUtils.RegisterPathTemple("ui/base/PropItem.ui",PropItem),WxShareDlg=QPDlg.extend({uiPath:"ui/base/WxShareDlg.ui",isTouchClose:!0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e);var a=this;this.addListener("SuccessShareReturn",function(t){a.close()})},onLoaded:function(){var t=this.data.type||0;this.img_0&&this.img_0.setVisible(!1),this.img_1&&this.img_1.setVisible(!1),this.img_90_0&&this.img_90_0.setVisible(!1),this.img_90_1&&this.img_90_1.setVisible(!1),SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&90==ModuleMgr.getScreenRotation()?(this.img_90_0&&this.img_90_0.setVisible(0==t),this.img_90_1&&this.img_90_1.setVisible(1==t)):(this.img_0&&this.img_0.setVisible(0==t),this.img_1&&this.img_1.setVisible(1==t))}}),WxShareDlg.create=function(t,e,i){return new WxShareDlg(t,e,i)},ModuleMgr.registerModule("WxShareDlg",WxShareDlg),LoginScene=cc.Scene.extend({onEnter:function(){this._super(),UIDataUtils.SetUIPrefix("res/"),UIDataUtils.SetLanguagePath("lang/lang.txt");var t=this,e=!1;if(cc.sys.os===cc.sys.OS_IOS&&!cc.sys.isNative){e=!0;var i=new cc.Layer;i.x=0,i.y=0,this.addChild(i);var a=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(e,i){return t.isFirstTouch||(t.isFirstTouch=!0,IsGameTypeFzmjOrNdmj()&&playMuisc("mj_mainBg.mp3")),!0}});cc.eventManager.addListener(a,i),i.onExit=function(){cc.LayerColor.prototype.onExit.call(i),cc.eventManager.removeListener(a)}}IsGameTypeFzmjOrNdmj()?(designOrientation!=SCREEN_ORIENTATION_LANDSCAPE&&DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE),ModuleMgr.runDlg("NewLoginLayer"),e||playMuisc("mj_mainBg.mp3")):(ModuleMgr.runDlg("LoginLayer"),playMuisc("hall_bg1.mp3"))},onExit:function(){this._super()}}),LoginScene.create=function(){return new LoginScene},ModuleMgr.registerModule("LoginScene",LoginScene);var hasQueryParam=!1,hasQueryDeskParam=!1;LoginLayer=QPLayer.extend({uiPath:"ui/Login.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.addListener(EVENT_ENTER_GAME,function(){ModuleMgr.removeWaitMsg(),ModuleMgr.enterEnterScene()}),this.btn_download.setVisible(!1),0==cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID,this.btn_weixin.setVisible(!1),platform.isInstalled()&&this.btn_weixin.setVisible(!0),this.btn_guest.setVisible(!1);var t=parseInt(getQueryString("guest"))||0;(1==t||gInReview)&&this.btn_guest.setVisible(!0),this.scheduleUpdate();var e=getQueryString("recordId")||"0";if(e.length>1){var i=function(t){t&&t.lists&&ModuleMgr.showRecordDetailDlg(t.lists[0])};return void DataMgr.recordCtrl.getOneRecord(e,i)}do if(0==cc.sys.isNative&&0==hasQueryParam){if(hasQueryParam=!0,0==getQueryString("loginsuc")){ModuleMgr.showConfirmTxtMsg("微信授权失败");break}if(""==DataMgr.accountCtrl.wechatAccount||""==DataMgr.accountCtrl.wechatPass)break;return void platform.doWechatLogin()}while(!1);var a=parseInt(getQueryString("desk"))||0;if(a>0&&0==hasQueryDeskParam)hasQueryDeskParam=!0,""!=DataMgr.accountCtrl.wechatAccount&&""!=DataMgr.accountCtrl.wechatPass&&platform.doWechatLogin();else if(""!=DataMgr.accountCtrl.wechatAccount&&""!=DataMgr.accountCtrl.wechatPass&&getTimestamp()-DataMgr.accountCtrl.lastLoginTime<platform.weixinTimeOut)return void platform.login()},update:function(){platform.retCode&&(ModuleMgr.removeWaitMsg(),platform.loginCallback(platform.retCode),platform.retCode=null)},tap_btn_download:function(t){cc.sys.os==cc.sys.OS_ANDROID&&cc.sys.openURL("http://chessres.oss-cn-shanghai.aliyuncs.com/hotfire.apk")},tap_btn_weixin:function(t){
platform.login()},tap_btn_guest:function(t){function e(){DataMgr.accountCtrl.isGuest=!0,DataMgr.accountCtrl.apilogin(DataMgr.accountCtrl.guestAccount,DataMgr.accountCtrl.guestPsw,function(t,e){t?ModuleMgr.showTipMsg(t):LOGIN_D.login(null,null)})}function i(t){0!=t.ret?ModuleMgr.showConfirmTxtMsg(t.error):(DataMgr.accountCtrl.guestAccount=t.user,DataMgr.accountCtrl.guestPsw=t.password),e()}return""!=DataMgr.accountCtrl.guestAccount&&""!=DataMgr.accountCtrl.guestPsw?void e():(DataMgr.accountCtrl.apiGuestLogin(i),void(0==cc.sys.isNative&&doMainShare()))}}),LoginLayer.create=function(t,e,i){return new LoginLayer(t,e,i)},ModuleMgr.registerModule("LoginLayer",LoginLayer),UIDataUtils.SetUIPrefix("res/");var HelloWorldLayer=cc.Layer.extend({sprite:null,ctor:function(){this._super();var t=(cc.winSize,UILayer.create("ui/test.ui"));return t.setPosition(0,0),this.addChild(t,0),!0}}),HelloWorldScene=cc.Scene.extend({onEnter:function(){this._super(),UIDataUtils.SetUIPrefix("res/"),UIDataUtils.SetLanguagePath("lang/lang.txt");var t=LoginLayer.create();this.addChild(t)}});ChatFaceItem=QPListItem.extend({uiPath:"ui/ChatFaceItem.ui",_data:null,_indexArr:[],ctor:function(t,e,i){t=t||this.uiPath,QPListItem.prototype.ctor.call(this,t,e,i)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(t){t||this.setVisible(!1),this._data=t,this._isClubChat=t.isClubChat;var e=t.faceId;this._indexArr=e;for(var i=0;i<4;i++){var a=this["item_face_"+i];a&&(e[i]?(a.setVisible(!0),a.loadTexture("res/uires/face/"+e[i]+".png")):a.setVisible(!1))}},sendFace:function(t){this._indexArr[t]&&(this._isClubChat?(ME_D.send_message(CMD_UNION_MESSAGE,"union_chat",{game_type:GAME_TYPE,send_content:"f"+this._indexArr[t]}),cc.eventManager.dispatchCustomEvent("SetsBoolSendMsg")):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",faceId:this._indexArr[t]}),cc.eventManager.dispatchCustomEvent("HideChatLayer"))},tap_item_face_0:function(){this.sendFace(0)},tap_item_face_1:function(){this.sendFace(1)},tap_item_face_2:function(){this.sendFace(2)},tap_item_face_3:function(){this.sendFace(3)}}),ChatFaceItem.create=function(t,e,i){return new ChatFaceItem(t,e,i)},UIUtils.RegisterPathTemple("ui/ChatFaceItem.ui",ChatFaceItem),ChatLayer=QPLayer.extend({uiPath:"ui/ChatLayer.ui",_curTag:0,list_1_item:null,ctor:function(t,e,i){t=t||this.uiPath,this.list_1_item=ChatTxtItem,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){cc.sys.isNative||this.btn_speak.setVisible(!1);for(var t=!0,e=[],i=0;i<chatCfgList.length;++i)e[i]={chatStr:chatCfgList[i],isClubChat:t};this.refreshList({name:"list_1",list:e,async:!0}),this.list_1.setBounceEnabled(!0);for(var a=[],i=1;i<=20;i++){var s,r=Math.floor((i-1)/4);s=a[r]&&a[r].faceId?a[r].faceId:[],s.push(i),a[r]={faceId:s,isClubChat:t}}this.refreshList({name:"list_2",itemCell:ChatFaceItem,list:a}),this.list_2.setBounceEnabled(!0),this.selectTag(this._curTag)},selectTag:function(t){for(this._curTag=t,i=0;i<2;i++)this["btn_tap_"+i]&&this["btn_tap_"+i].setEnabled(i!=t);0==t?(this.btn_tap_0.setEnabled(!1),this.btn_tap_1.setEnabled(!0),this.list_1.setVisible(!0),this.list_2.setVisible(!1)):1==t&&(this.btn_tap_0.setEnabled(!0),this.btn_tap_1.setEnabled(!1),this.list_1.setVisible(!1),this.list_2.setVisible(!0))},tap_btn_hide:function(){this.setVisible(!1)},tap_btn_tap_0:function(){this.selectTag(0)},tap_btn_tap_1:function(){this.selectTag(1)},DoSpeak:function(t){if(!cc.sys.isNative&&GAME_TYPE!=GAME_TYPE_DD)return void("began"==t.name&&ModuleMgr.showTipMsg("此功能需下载安装原生游戏后方可使用"));var e=ModuleMgr.getDlg("NewGameLayer");e&&e.DoRecord(t)}}),ChatLayer.create=function(t,e,i){return new ChatLayer(t,e,i)},UIUtils.RegisterPathTemple("ui/ChatLayer.ui",ChatLayer),ChatTxtItem=QPListItem.extend({uiPath:"ui/ChatTxtItem.ui",_txt:null,ctor:function(t,e,i){t=t||this.uiPath,QPListItem.prototype.ctor.call(this,t,e,i)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(t){t||this.setVisible(!1),this._txt=t.chatStr,this._isClubChat=t.isClubChat,this.lab_txt.setString(this._txt)},tap_tap_touch:function(){this._isClubChat?(ME_D.send_message(CMD_UNION_MESSAGE,"union_chat",{game_type:GAME_TYPE,send_content:this._txt}),cc.eventManager.dispatchCustomEvent("SetsBoolSendMsg")):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",txt:this._txt}),cc.eventManager.dispatchCustomEvent("HideChatLayer")}}),ChatTxtItem.create=function(t,e,i){return new ChatTxtItem(t,e,i)},UIUtils.RegisterPathTemple("ui/ChatTxtItem.ui",ChatTxtItem),EnterScene=cc.Scene.extend({onEnter:function(){this._super();var t=this,e=!1;if(cc.sys.os===cc.sys.OS_IOS&&!cc.sys.isNative){e=!0;var i=new cc.Layer;i.x=0,i.y=0,this.addChild(i);var a=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(e,i){return t.isFirstTouch||(t.isFirstTouch=!0,IsGameTypeFzmjOrNdmj()&&"mj_mainBg.mp3"!==getLastMusicName()&&playMuisc("mj_mainBg.mp3")),!0}});cc.eventManager.addListener(a,i),i.onExit=function(){cc.LayerColor.prototype.onExit.call(i),cc.eventManager.removeListener(a)}}IsGameTypeFzmjOrNdmj()?(designOrientation!=SCREEN_ORIENTATION_LANDSCAPE&&DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE),ModuleMgr.runDlg("NewMainLayer"),e||"mj_mainBg.mp3"===getLastMusicName()||playMuisc("mj_mainBg.mp3")):(ModuleMgr.runDlg("MainLayer",function(){}),playMuisc("hall_bg1.mp3"))},onExit:function(){this._super(),DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_PROTRAIT)}}),EnterScene.create=function(){return new EnterScene},ModuleMgr.registerModule("EnterScene",EnterScene),EnterLayer=QPLayer.extend({uiPath:"ui/LoginSuccess.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.txt_name.setString(DataMgr.accountCtrl.lastAccount)},DoStartGame:function(t){if(WsNetwork.getInstance().initNetwork(),"ended"==t.name){var e=this;ModuleMgr.runDlg("MainLayer",function(){e.close()})}},DoLogout:function(t){"ended"==t.name&&ModuleMgr.runScene("LoginScene")},tap_btn_weixin:function(t){console.log("tap_btn_weixin 11111111111111111111111")}}),EnterLayer.create=function(t,e,i){return new EnterLayer(t,e,i)},ModuleMgr.registerModule("EnterLayer",EnterLayer);var bol_main_layer_frist_enter=!0;MainLayer=QPLayer.extend({uiPath:"ui/MainLayer.ui",_contentNode:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){0==cc.sys.isNative&&doMainShare(),checkPhone(DataMgr.accountCtrl.telephone)&&this.btn_bind_phone.setVisible(!1);var t=this;if(this.addListener("SuccessBindPhone",function(e){t.btn_bind_phone.setVisible(!1)}),this.addListener("success_receive_native_rewards",function(e){t.refreshDownBtn()}),this.btn_turning_activity&&this.btn_turning_activity.setVisible(!1),this.btn_share&&this.btn_share.setVisible(!0),this.btn_bind_phone&&this.btn_bind_phone.setVisible(!1),cc.sys.isNative?this.btn_down&&this.btn_down.setVisible(!1):this.btn_down&&this.btn_down.setVisible(!0),this.grp_activity&&this.grp_activity.setVisible(!0),GAME_TYPE_NCMJ==GAME_TYPE){this.btn_gift_1&&this.btn_gift_1.setVisible(!1),this.btn_gift_2&&this.btn_gift_2.setVisible(!0);var e=parseInt(getQueryString("desk"));if(e>0);else{var i=cc.sys.localStorage.getItem(GAME_TYPE+"_enter_time"),a=new Date,s=a.format("yyyy-MM-dd");s!=i&&(cc.sys.localStorage.setItem(GAME_TYPE+"_enter_time",s),this.tap_btn_gift_2())}}else this.btn_gift_1&&this.btn_gift_1.setVisible(!1),this.btn_gift_2&&this.btn_gift_2.setVisible(!1);if(GAME_TYPE_NCMJ==GAME_TYPE?this.btn_gift_3&&this.btn_gift_3.setVisible(!0):this.btn_gift_3&&this.btn_gift_3.setVisible(!1),GAME_TYPE==GAME_TYPE_NCMJ){this.btn_turning_activity.setVisible(!1),this.btn_spread&&this.btn_spread.setVisible(!0)}else this.btn_turning_activity.setVisible(!1);this.sortGrp("grp_activity",5,0,1),gInReview&&this.grp_activity&&this.grp_activity.setVisible(!1);var r=getQueryString("mj_record_rid");bol_main_layer_frist_enter&&r&&(DataMgr.gameCtrl.recordRid=r,DataMgr.recordCtrl.getGameDetailRecord(r)),bol_main_layer_frist_enter&&NetMsg.testErrMsg&&ModuleMgr.showConfirmTxtMsg(NetMsg.testErrMsg);var n=getQueryString("union_rid");bol_main_layer_frist_enter&&n&&0!=n&&ME_D.send_message(CMD_UNION_MESSAGE,"apply_union",{union_rid:n,game_type:GAME_TYPE}),bol_main_layer_frist_enter=!1,DataMgr.accountCtrl.bolFromHall()?this.btn_home&&this.btn_home.setVisible(!0):this.btn_home&&this.btn_home.setVisible(!1)},tap_btn_home:function(){goHome()},tap_btn_gift_1:function(){ModuleMgr.runDlg("ActivityImgDlg1")},tap_btn_gift_2:function(){ModuleMgr.runDlg("ActivityImgDlg2")},refreshDownBtn:function(){var t=DataMgr.timeCtrl.getReceiveNativeRewards(),e=t[GAME_TYPE];cc.sys.isNative?null==e||void 0==e||e<=0?this.btn_down.setVisible(!0):this.btn_down.setVisible(!1):e>0?this.btn_down.setVisible(!1):this.btn_down.setVisible(!0)},tap_btn_join:function(){if(0==DataMgr.gameCtrl.deskIdx);else{var t=DataMgr.clubCtrl.getMyClub(),e="",i="";t&&(e=t.match_rid,i=t.rid),ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:DataMgr.gameCtrl.deskIdx,union_rid:i,match_rid:e})}},tap_btn_activity:function(){ModuleMgr.runDlg("ActivityDlg")},tap_btn_create:function(){if(0==DataMgr.gameCtrl.deskIdx)ModuleMgr.runDlg("CreateRoomDlg");else{var t=DataMgr.clubCtrl.getMyClub(),e="",i="";t&&(e=t.match_rid,i=t.rid),ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:DataMgr.gameCtrl.deskIdx,union_rid:i,match_rid:e})}},tap_btn_bind_phone:function(){ModuleMgr.runDlg("ActivityBindPhoneDlg")},tap_btn_gift_3:function(){ModuleMgr.runDlg("ActivityGiftDlg")},tap_btn_turning_activity:function(){var t=function(){ModuleMgr.runDlg("ActivityTurningDlg")};DataMgr.activityCtrl.getTurnActivity(t)},tap_btn_activity:function(){ModuleMgr.runDlg("ActivityDlg")},tap_btn_share:function(){ModuleMgr.runDlg("ActivityShareDlg")},tap_btn_down:function(){var t=getNativeDownUrl();return t?void cc.sys.openURL(t):ModuleMgr.showTipMsg("敬请期待！")},tap_btn_spread:function(){ModuleMgr.runDlg("SpreadDlg")}}),MainLayer.create=function(t,e,i){return new MainLayer(t,e,i)},ModuleMgr.registerModule("MainLayer",MainLayer),RoleInfoBottom=QPLayer.extend({uiPath:"ui/RoleInfoBottom.ui",onLoaded:function(){},tap_btn_help:function(){},tap_btn_news:function(){var t=function(t){ModuleMgr.runDlg("NewsDlg",t,null,null)};DataMgr.recordCtrl.getNews(t)},tap_btn_record:function(){var t=function(t){ModuleMgr.runDlg("RecordDlg",t,null,null)};DataMgr.recordCtrl.getRecord(t)},tap_btn_set:function(){ModuleMgr.runDlg("SetingDlg")},tap_btn_club:function(){},tap_btn_exit:function(){DataMgr.accountCtrl.lastLoginTime=0,WsNetwork.getInstance().close()},tap_btn_rank:function(){return ModuleMgr.showTipMsg("此功能暂未开放")}}),RoleInfoBottom.create=function(t,e,i){return new RoleInfoBottom(t,e,i)},UIUtils.RegisterPathTemple("ui/RoleInfoBottom.ui",RoleInfoBottom),RoleInfoTop=QPLayer.extend({uiPath:"ui/RoleInfoTop.ui",onLoaded:function(){var t=this;t.refreshUi(),t.addListener("SuccessBind",function(e){t.checkBindBtn()}),t.checkBindBtn(),t.addListener("userChange",function(e){t.refreshUi()})},refreshUi:function(){this.lab_name.setString(toDecodeURIComponent(ME_D.get_user().name)),this.lab_stone.setString(ME_D.get_user().room_card),this.lab_id.setString("ID:"+ME_D.get_user().account_uid),this.item_head.setData({url:ME_D.get_user().headimgurl})},checkBindBtn:function(){if(gInReview)return void this.btn_bind.setVisible(!1);var t=ME_D.get_user().extend_uid||"";isAgent()?this.btn_bind.setVisible(0==t.length):this.btn_bind.setVisible(!1)},tap_btn_bind:function(){},tap_btn_buy:function(){return gInReview?void ModuleMgr.runDlg("MallDlg"):GAME_TYPE==GAME_TYPE_NCMJ?void ModuleMgr.runDlg("NcmjMallDlg"):void(isAgent()?(GAME_PAY_TYPE==GAME_PAY_TYPE_JTPAY&&(cc.sys.isNative?ModuleMgr.runDlg("MallDlg"):ModuleMgr.showConfirmCancelMsg("请下载客户端充值",function(){cc.sys.openURL(getNativeDownUrl())})),ModuleMgr.runDlg("MallDlg")):ModuleMgr.runDlg("BuyDlg"))}}),RoleInfoTop.create=function(t,e,i){return new RoleInfoTop(t,e,i)},UIUtils.RegisterPathTemple("ui/RoleInfoTop.ui",RoleInfoTop),NewsDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/NewsDlg.ui",roomName:null,gameState:null,gameType:null,data:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},getStr:function(t){var e="";return e+=toDecodeURIComponent(t.title)+"[br]",e+=toDecodeURIComponent(t.content)},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this);for(var t=this.data.list||[],e=0,i=18,a=0;a<5;a++){var s=this["lab_new_"+a];if(s)if(a<t.length){s.setVisible(!0),s.setString(this.getStr(t[a]));var r=s.getVirtualRendererSize();e+=r.height+i}else s.setVisible(!1)}var n=this.scr_view.getContentSize();n.height<e&&(n.height=e),this.scr_view.setInnerContainerSize(n),e=n.height;for(var a=0;a<5;a++){var s=this["lab_new_"+a];s&&s.isVisible()&&(s.setPositionY(e),e=e-s.getVirtualRendererSize().height-i)}}}),NewsDlg.create=function(t,e,i){return new NewsDlg(t,e,i)},ModuleMgr.registerModule("NewsDlg",NewsDlg),IpDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/IpDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){for(var t=1;t<=4;t++)this["txt_name"+t].setString(""),this["txt_ip"+t].setString(""),this["txt_gps"+t].setString("");this.txt_dis.setString("正常");var e=[],i=[];if(DataMgr.gameCtrl.location)for(var t=0;t<DataMgr.gameCtrl.location.length;t++)if(null!=DataMgr.gameCtrl.players[t+1]&&null!=this["txt_name"+(t+1)]){var a=DataMgr.gameCtrl.players[t+1],s=DataMgr.gameCtrl.location[t];this["txt_name"+(t+1)].setString(a.info.name),this["txt_ip"+(t+1)].setString(s.client_ip),this["txt_gps"+(t+1)].setString(s.location);var s=ConvertToJson(s.location);s.longitude==-1?i.push(a):e.push({player:a,location:s})}for(var r="",t=0;t<e.length;t++)for(var n=t+1;n<e.length;n++){var o=e[t].location,c=e[n].location,l=gGetGreatCircleDistance(o.latitude,o.longitude,c.latitude,c.longitude);r+=e[t].player.info.name+" 与 "+e[n].player.info.name+" 的距离为 "+l+" 米",r+="[br]"}for(var t=0;t<i.length;t++)r+="[br]",r+=i[t].info.name+" 获取定位失败";""==r&&(r="正常"),null==DataMgr.gameCtrl.location&&(r="获取定位中.."),this.txt_dis.setString(r)}}),IpDlg.create=function(t,e,i){return new IpDlg(t,e,i)},ModuleMgr.registerModule("IpDlg",IpDlg),RecordDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/RecordDlg.ui",roomName:null,gameState:null,gameType:null,listView_item:null,ctor:function(t,e,i){this.data=t,this.listView_item=RecordItem,QPDlg.prototype.ctor.call(this,this.uiPath,e)},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this);var t=this.data.lists||[];0==t.length?(this.lab_none.setVisible(!0),this.listView.setVisible(!1)):(this.lab_none.setVisible(!1),this.listView.setVisible(!0),this.refreshList({name:"listView",list:t,async:!0})),this.listView.setClippingType(ccui.Layout.CLIPPING_SCISSOR)}}),RecordDlg.create=function(t,e,i){return new RecordDlg(t,e,i)},ModuleMgr.registerModule("RecordDlg",RecordDlg),RecordItem=QPListItem.extend({isControlNode:!0,uiPath:"ui/RecordItem.ui",selectCallback:null,data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},getMyScore:function(t){if(null==t)return 0;var e=ConvertToJson(t),i=ME_D.get_rid(),a=e.users,s=0;if(e.users)for(var r=0;r<a.length;r++){var n=a[r];if(n.rid==i){s=r;break}}var o=e.score;if(null==o)return 0;var c="idx"+(s+1);return o[c]||0},setData:function(t){if(this.data=t,this.txt_num&&t){this.txt_num.setString(t.desk_no),this.txt_round.setString(t.full_round),this.txt_time.setString(parseTime(t.create_time));var e=this.getMyScore(t.record_detail);e=e>0?"+"+e:e,this.lab_score.setString(e);var i=DataMgr.recordCtrl.getOwnerInfo(t);i&&this.item_head.setData({url:i.headimgurl})}},tap_btn_detail:function(){var t=ConvertToJson(this.data.record_detail).replay_records;ModuleMgr.runDlg("RecordReplayDlg",t,null,null)},tap_btn_view:function(){ModuleMgr.showRecordDetailDlg(this.data)}}),RecordItem.create=function(t,e,i){return new RecordItem(t,e,i)},ModuleMgr.registerModule("RecordItem",RecordItem),SetingDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/SetingDlg.ui",_effectsVolume:1,_musicVolume:1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onEnter:function(){QPDlg.prototype.onEnter.call(this)},tap_btn_bind_phone:function(){ModuleMgr.runDlg("ActivityBindPhoneDlg")},onExit:function(){QPDlg.prototype.onExit.call(this),this.unscheduleAllCallbacks()},setMusic:function(t){this._musicVolume=t;var e=t<=0;this.lab_open_music.setVisible(!e),this.lab_close_music.setVisible(e),gSetMusic(e)},setEffect:function(t){this._effectsVolume=t;var e=t<=0;this.lab_effect_open.setVisible(!e),this.lab_effect_close.setVisible(e),gSetMusicEffect(e)},onLoaded:function(){var t=cc.sys.localStorage.getItem("musicVolume"),e=cc.sys.localStorage.getItem("effectsVolume");null==t&&(t=1),null==e&&(e=1),this.setMusic(t),this.setEffect(e),null==this.txt_phone.oldTxt&&(this.txt_phone.oldTxt=this.txt_phone.getString());var i=this;this.addListener("SuccessBindPhone",function(t){i.txt_phone.setString(i.txt_phone.oldTxt+DataMgr.accountCtrl.telephone)}),DataMgr.accountCtrl.telephone&&""!=DataMgr.accountCtrl.telephone?this.txt_phone.setString(this.txt_phone.oldTxt+DataMgr.accountCtrl.telephone):this.txt_phone.setString(this.txt_phone.oldTxt+"无"),this.txt_bind&&this.txt_bind.setVisible(!1),gInReview&&(this.btn_share_py.setVisible(!1),this.btn_share_wx.setVisible(!1))},tap_btn_switch_music:function(){this._musicVolume<=0?this.setMusic(1):this.setMusic(0)},tap_btn_switch_effect:function(){this._effectsVolume<=0?this.setEffect(1):this.setEffect(0)},tap_btn_logout:function(){DataMgr.accountCtrl.lastLoginTime=0,WsNetwork.getInstance().close()},tap_btn_share_wx:function(){platform.share(SHARE_GAME_TITLE_DES(),SHARE_GAME_WX_DES(),getShareUrl(0,0),0)},tap_btn_share_py:function(){platform.share(SHARE_GAME_TITLE_DES_PY(),SHARE_GAME_PY_DES(),getShareUrl(0,0),1)},tap_btn_close:function(){this.close()}}),SetingDlg.create=function(t,e,i){return new SetingDlg(t,e,i)},ModuleMgr.registerModule("SetingDlg",SetingDlg),SocialInviteDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/SocialInviteDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onEnter:function(){QPDlg.prototype.onEnter.call(this)},onLoaded:function(){this._super(),cc.sys.isNative||(this.btn_copy.setVisible(!1),this.btn_share_most.x=this.btn_share_most.x-80,this.btn_share_wx.x=this.btn_share_wx.x+80)},tap_btn_share_wx:function(){shareRoomToLocate(0,LOCATE_PLAFORM.WECHAT)},tap_btn_copy:function(){copyStrToClipboard(DataMgr.gameCtrl.deskIdx)},tap_btn_share_most:function(){return cc.sys.isNative||"undefined"!=typeof MostOneJSApis?void shareRoomToLocate(3,LOCATE_PLAFORM.MOSTONE):void ModuleMgr.showTipMsg("H5默往分享无效")}}),SocialInviteDlg.create=function(t,e,i){return new SocialInviteDlg(t,e,i)},ModuleMgr.registerModule("SocialInviteDlg",SocialInviteDlg),BuyDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/BuyDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){}}),BuyDlg.create=function(t,e,i){return new BuyDlg(t,e,i)},ModuleMgr.registerModule("BuyDlg",BuyDlg),HeadIcon=UrlHead.extend({uiPath:"ui/HeadIcon.ui",data:null,head_data:null,ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},getHeadData:function(){return this.head_data},setHeadData:function(t){this.head_data=t},setData:function(t){this.setHeadData(t);var e=t.url;this.setUrl(e),this.setFrame(t.frame)},setFrameNoVisible:function(){this.head_frame.setVisible(!1)},setFrame:function(t){t&&""!=t?this.head_frame.loadTexture("item/"+t+".png",ccui.Widget.PLIST_TEXTURE):this.head_frame.loadTexture("item/touxiang.png",ccui.Widget.PLIST_TEXTURE),this.head_frame.setVisible(!0),this.head_frame.setLocalZOrder(LOCAL_Z_ORDER_OF_HEAD_FRAME)}}),HeadIcon.create=function(t,e,i){return new HeadIcon(t,e,i)},UIUtils.RegisterPathTemple("ui/HeadIcon.ui",HeadIcon),BindDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/BindDlg.ui",_inputText:"",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e);var a=this;this.addListener("SuccessBind",function(t){a.close()})},onLoaded:function(){this._inputText=this.lab_input.getString()},tap_btn_send:function(){var t=this.lab_input.getString()||0;return t==this._inputText||0==t.length?ModuleMgr.showTipMsg("代理ID 不能为空！"):void ME_D.send_message_waiting(CMD_BIND_EXTEND,{extend_uid:t})}}),BindDlg.create=function(t,e,i){return new BindDlg(t,e,i)},ModuleMgr.registerModule("BindDlg",BindDlg),ActivityDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/ActivityDlg.ui",ctor:function(t,e,i){this.data=t,this.listView_item=RecordItem,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){}}),ActivityDlg.create=function(t,e,i){return new ActivityDlg(t,e,i)},ModuleMgr.registerModule("ActivityDlg",ActivityDlg),ActivityItem=QPListItem.extend({isControlNode:!0,uiPath:"ui/ActivityItem.ui",selectCallback:null,data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},setData:function(t){if(this.data=t,this.txt_num&&t){this.txt_num.setString(t.desk_no),this.txt_round.setString(t.full_round),this.txt_time.setString(parseTime(t.create_time));var e=this.getMyScore(t.record_detail);e=e>0?"+"+e:e,this.lab_score.setString(e);var i=DataMgr.recordCtrl.getOwnerInfo(t);i&&this.item_head.setData({url:i.headimgurl})}},tap_btn_view:function(){ModuleMgr.showRecordDetailDlg(this.data)}}),ActivityItem.create=function(t,e,i){return new ActivityItem(t,e,i)},ModuleMgr.registerModule("ActivityItem",ActivityItem),ActivityTurningDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/ActivityTurningDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){for(var t=DataMgr.activityCtrl.turnData,e=0;e<t.length&&e<8;e++)this["txt_num"+(e+1)].setString(this.getDesc(t[e].itemId,t[e].itemNum)),this["icon"+(e+1)].id=t[e].id,this["icon"+(e+1)].idx=e+1,this["icon"+(e+1)].data=t[e],this["icon"+(e+1)].loadTexture("res/uires/activity/reward_"+t[e].itemId+".png");for(var e=t.length;e<8;e++)this["icon"+(e+1)].setVisible(!1),this["txt_num"+(e+1)].setString("");this.txt_info.setString("还有"+DataMgr.timeCtrl.getLeftTurnTimes()+"次"),this.lab_open_times&&this.lab_open_times.setString(DataMgr.timeCtrl.getTodayOpenRoomTimes()),this.lab_share_times&&this.lab_share_times.setString(DataMgr.timeCtrl.getTodayShareTime()),this.lab_tel&&this.lab_tel.setString(DataMgr.accountCtrl.allTeleNum||0)},refreshLabTel:function(){},getItemById:function(t){for(var e=0;e<8;e++)if(this["icon"+(e+1)].id==t)return this["icon"+(e+1)];return item},getDesc:function(t,e){return 1==t?e+"个茶叶":2==t?e+"元话费":3==t?"iWatch":4==t?"iPhone 7":void 0},showReward:function(t,e){var i=this.getItemById(t),a=i.idx,s=i.data.itemId,r=i.data.itemNum;this.turn_bg.setRotation(0);var n=25222-45*a,o=this,c=function(){o.isTurning=!1,ModuleMgr.showConfirmTxtMsg("恭喜您获得"+o.getDesc(s,r)),2==s&&(DataMgr.accountCtrl.allTeleNum=(DataMgr.accountCtrl.allTeleNum||0)+r,o.lab_tel&&o.lab_tel.setString(DataMgr.accountCtrl.allTeleNum||0))};DataMgr.timeCtrl.subLeftTurnTimes(1),this.txt_info.setString("还有"+DataMgr.timeCtrl.getLeftTurnTimes()+"次"),this.isTurning=!0,this.turn_bg.runAction(cc.sequence(cc.EaseOut.create(cc.rotateBy(8,n),50),cc.callFunc(c)))},tap_btn_turn:function(){if(1!=this.isTurning){if(0==checkPhone(DataMgr.accountCtrl.telephone)){var t=function(){ModuleMgr.runDlg("ActivityBindPhoneDlg")};return void ModuleMgr.showConfirmCancelMsg("请先绑定合法的手机号",t)}if(DataMgr.timeCtrl.getLeftTurnTimes()<=0)return void ModuleMgr.showTipMsg("您已经没有抽奖次数了");var e=this,i=function(t){e.showReward(t.id,t.itemName)};DataMgr.activityCtrl.doTurn(i)}},tap_btn_help:function(){ModuleMgr.runDlg("ActivityTurningHelpDlg")}}),ActivityTurningDlg.create=function(t,e,i){return new ActivityTurningDlg(t,e,i)},ModuleMgr.registerModule("ActivityTurningDlg",ActivityTurningDlg),ActivityBindPhoneDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/ActivityBindPhoneDlg.ui",_inputText:"",isTime:!0,curDate:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this.lab_phone_input.setString(DataMgr.accountCtrl.telephone),this.lab_input.setString(DataMgr.accountCtrl.wechat)},tap_btn_send:function(){if(1==this.isTime){var t=this.lab_phone_input.getString(),e=this.lab_input.getString();if(""==t&&""==e)return ModuleMgr.showTipMsg("请输入相关信息! ");if(""==e)return ModuleMgr.showTipMsg("微信号不能为空！");if(""!=t)if(t.indexOf(" ")==-1&&e.indexOf("=")==-1){if(0==checkPhone(t))return ModuleMgr.showTipMsg("请填写合法的手机号！");var i=this,a=function(a){return 0!=a.ret?void ModuleMgr.showTipMsg(a.error):(DataMgr.accountCtrl.telephone=t,DataMgr.accountCtrl.wechat=e,ModuleMgr.showTipMsg("绑定成功"),cc.eventManager.dispatchCustomEvent("SuccessBindPhone"),void i.close())};DataMgr.activityCtrl.getBindPhone(t,e,a)}else t.indexOf(" ")!=-1?ModuleMgr.showTipMsg("手机号码存在空格！"):e.indexOf("=")!=-1&&ModuleMgr.showTipMsg("微信号存在非法字符！");else ModuleMgr.showTipMsg("请填写11位手机号！")}else ModuleMgr.showTipMsg("今天已经绑定过了手机与微信号码! ")}}),ActivityBindPhoneDlg.create=function(t,e,i){return new ActivityBindPhoneDlg(t,e,i)},ModuleMgr.registerModule("ActivityBindPhoneDlg",ActivityBindPhoneDlg),ActivityShareDlg=QPDlg.extend({uiPath:"ui/ActivityShareDlg.ui",shareCfgList:[{times:1,cards:1}],idx:0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e);var a=this;this.addListener("SuccessShareGame",function(t){a.refreshUi()}),this.addListener("SuccessShareAward",function(t){a.refreshUi()})},onLoaded:function(){this.refreshUi()},refreshUi:function(){this.idx=0;for(var t=(this.shareCfgList[this.shareCfgList.length-1].times,DataMgr.timeCtrl.getTodayShareTime()),e=DataMgr.timeCtrl.getShareStatusList(),i=0;i<this.shareCfgList.length;i++)if(t>=this.shareCfgList[i].times&&0==e[i]){this.idx=i+1;break}t>=1?(this.grp_get.setVisible(!0),this.grp_share.setVisible(!1),0==this.idx?(this.lab_get_ed.setVisible(!0),this.btn_get.setVisible(!1)):(this.lab_get_ed.setVisible(!1),this.btn_get.setVisible(!0))):(this.grp_share.setVisible(!0),this.grp_get.setVisible(!1))},tap_btn_share:function(){platform.share(SHARE_GAME_TITLE_DES(),SHARE_MAIN_DES(),SHARE_URL,1)},tap_btn_get:function(){ME_D.send_message(CMD_SHARE_AWARD,{idx:this.idx})}}),ActivityShareDlg.create=function(t,e,i){return new ActivityShareDlg(t,e,i)},ModuleMgr.registerModule("ActivityShareDlg",ActivityShareDlg),ActivityShareItem=QPLayer.extend({uiPath:"ui/ActivityShareItem.ui",_txt:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},setData:function(t){t||this.setVisible(!1),this.lab_times.setString(t.times),this.lab_cards.setString(t.cards),this.icon_get.setVisible(1==t.status)}}),ActivityShareItem.create=function(t,e,i){return new ActivityShareItem(t,e,i)},UIUtils.RegisterPathTemple("ui/ActivityShareItem.ui",ActivityShareItem),ActivityDownDlg=QPDlg.extend({uiPath:"ui/ActivityDownDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;this.addListener("success_receive_native_rewards",function(e){t.close()}),this.refreshUi()},refreshUi:function(){var t=DataMgr.timeCtrl.getReceiveNativeRewards(),e=t[GAME_TYPE];cc.sys.isNative?null==e||void 0==e||e<=0?(this.btn_get.setVisible(!0),this.btn_down.setVisible(!1)):(this.btn_get.setVisible(!1),this.btn_down.setVisible(!1)):null==e||void 0==e?(this.btn_get.setVisible(!1),this.btn_down.setVisible(!0)):(this.btn_get.setVisible(!0),this.btn_down.setVisible(!1))},tap_btn_down:function(){cc.sys.openURL("http://www.gongpaa.com")},tap_btn_get:function(){return cc.sys.isNative?void ME_D.send_message(CMD_COMMON_OP,{oper:"receive_native"}):ModuleMgr.showTipMsg("请到原生客户端领取")}}),ActivityDownDlg.create=function(t,e,i){return new ActivityDownDlg(t,e,i)},ModuleMgr.registerModule("ActivityDownDlg",ActivityDownDlg),ActivityImgDlg1=QPDlg.extend({uiPath:"ui/ActivityImgDlg1.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)}}),ActivityImgDlg1.create=function(t,e,i){return new ActivityImgDlg1(t,e,i)},ModuleMgr.registerModule("ActivityImgDlg1",ActivityImgDlg1),ActivityImgDlg2=QPDlg.extend({uiPath:"ui/ActivityImgDlg2.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)}}),ActivityImgDlg2.create=function(t,e,i){return new ActivityImgDlg2(t,e,i)},ModuleMgr.registerModule("ActivityImgDlg2",ActivityImgDlg2),ActivityGiftDlg=QPDlg.extend({uiPath:"ui/ActivityGiftDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},tap_btn_send:function(){var t=this.lab_input.getString(),e={};e.rid=ME_D.get_rid(),e.sign=DataMgr.accountCtrl.apiSign,e.timestamp=DataMgr.accountCtrl.timestamp,e.user=DataMgr.accountCtrl.lastAccount,e.uid=DataMgr.accountCtrl.apiUid,e.game_type=GAME_TYPE,e.code=t;var i=this;requestWaiting4Http(HTTP_IFACE_GET_RECEIVE_GIFT,e,function(t){i.close(),t.giftConfig?ModuleMgr.showConfirmTxtMsg("已领取“"+t.giftConfig.name+"”,"+t.giftConfig.room_card+ROOM_CARD_NAME):ModuleMgr.showConfirmTxtMsg("兑换码领取成功")},"兑换码领取中")}}),ActivityGiftDlg.create=function(t,e,i){return new ActivityGiftDlg(t,e,i)},ModuleMgr.registerModule("ActivityGiftDlg",ActivityGiftDlg),ActivityTurningHelpDlg=QPDlg.extend({uiPath:"ui/ActivityTurningHelpDlg.ui",ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)}}),ActivityTurningHelpDlg.create=function(t,e,i){return new ActivityTurningHelpDlg(t,e,i)},ModuleMgr.registerModule("ActivityTurningHelpDlg",ActivityTurningHelpDlg),PayDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/PayDlg.ui",ctor:function(t,e,i){this.data=t,this.listView_item=RecordItem,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},OnPay:function(t){if("ended"==t.name){var e=t.target.name.substr(7,1);platform.pay(parseInt(e))}}}),PayDlg.create=function(t,e,i){return new PayDlg(t,e,i)},ModuleMgr.registerModule("PayDlg",PayDlg),RankItem=QPLayer.extend({uiPath:"ui/RankItem.ui",data:null,index:0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.rank1.setLocalZOrder(1),this.rank2.setLocalZOrder(1),this.rank3.setLocalZOrder(1)},setData:function(t){this.data=t;var e=t.name||"",i=t.account_uid||"",a=t.score_num,s=t.reward||"";if(this.index=t.idx,this.rank_atlas)this.rank_atlas.setString(t.idx+":");else{var r=GetRealPath("res/uires/main/rankAndSpread/number_paiming.png"),n=[];n.push(r);var o=this;cc.loader.load(n,function(t,e,i){},function(){var e=cc.LabelAtlas.create(t.idx+":",r,17,21,"0");e.setPosition(25,30),o.addChild(e),o.rank_atlas=e})}if(t.idx<4)for(var c=1;c<4;++c)t.idx==c?this["rank"+c].setVisible(!0):this["rank"+c].setVisible(!1);this.item_head.setData({url:t.headimgurl}),this.txt_name.setString(toDecodeURIComponent(e)),this.txt_uid.setString(i),this.txt_counts.setString(a),this.txt_awards.setString(s)}}),RankItem.create=function(t,e,i){return new RankItem(t,e,i)},ModuleMgr.registerModule("RankItem",RankItem),UIUtils.RegisterPathTemple("ui/RankItem.ui",RankItem),RankDlg=QPDlg.extend({uiPath:"ui/RankDlg.ui",curRankIndex:0,rankType:["play_rank","win_rank","fail_rank","recommend_rank"],curRankWeek:0,rankWeeks:["cur","last"],rankData:null,ctor:function(t,e,i){t=t||this.uiPath;var a=this;QPDlg.prototype.ctor.call(this,t,e,i),this.addListener("SuccessGetRankData",function(t){a.SuccessGetRankData(t)})},SuccessGetRankData:function(t){this.rankData=t.getUserData(),this.getRewardData()},rankDataAddRewardDate:function(t){t=t||[];for(var e in t)for(var i=t[e].start_rank-1;i<=t[e].end_rank-1;++i)this.rankData.rank_list[i]&&(this.rankData.rank_list[i].reward=t[e].name)},getRewardData:function(){var t=this,e=t[t.rankData.rank_type+t.rankData.phase_index];if(e)return this.rankDataAddRewardDate(e),void this.refreshRank(this.rankData);var i=function(i){e=t[t.rankData.rank_type+a.phase_index]=i,t.rankDataAddRewardDate(e),t.refreshRank(t.rankData)};if(0==this.rankData.phase_index)return void ModuleMgr.showTipMsg("暂无上周榜单数据！");var a={};a.game_type=this.rankData.game_type,
a.rank_type=this.rankData.rank_type,a.phase_index=this.rankData.phase_index,DataMgr.activityCtrl.getRankGiftInfo(a,i)},onLoaded:function(){ME_D.send_message_waiting(CMD_GET_RANK,{game_type:GAME_TYPE,rank_time_type:this.rankWeeks[this.curRankWeek],rank_type:this.rankType[this.curRankIndex]}),this.listView_item=RankItem,this.btn_this_week.setEnabled(!1),this.btn_model_worker.setEnabled(!1),this.initBtn()},initBtn:function(){this.btn0=this.btn_model_worker,this.btn1=this.btn_master,this.btn2=this.btn_black_cat,this.btn3=this.btn_spread},refreshRank:function(t){var e=t.rank_list||[];this.curRankWeek=this.rankWeeks[0]==t.rank_time_type?0:1;for(var i=0;i<this.rankType.length;++i)if(this.rankType[i]==t.rank_type){this.curRankIndex=i;break}this.btn_this_week.setEnabled(1==this.curRankWeek),this.btn_last_week.setEnabled(0==this.curRankWeek),this.txt_this_week.setVisible(0==this.curRankWeek),this.txt_last_week.setVisible(1==this.curRankWeek),this.refreshRankBtn();var a=t.user_rank;null!=a&&a<499?this.txt_my_rank.setString("我的排名："+(a+1)):this.txt_my_rank.setString("未上榜");for(var i=0;i<e.length;++i)e[i].idx=i+1;this.refreshList({name:"listView",list:e,async:!0})},refreshRankBtn:function(t){this.listView.removeAllChildren(),void 0==t&&(t=this.curRankIndex);for(var e=0;e<this.rankType.length;++e)this["btn"+e]&&this["btn"+e].setEnabled(e!=t)},tap_btn_this_week:function(){ME_D.send_message_waiting(CMD_GET_RANK,{game_type:GAME_TYPE,rank_time_type:this.rankWeeks[0],rank_type:this.rankType[0]}),this.btn_this_week.setEnabled(!1),this.btn_last_week.setEnabled(!0),this.refreshRankBtn(0)},tap_btn_last_week:function(){ME_D.send_message_waiting(CMD_GET_RANK,{game_type:GAME_TYPE,rank_time_type:this.rankWeeks[1],rank_type:this.rankType[0]}),this.btn_this_week.setEnabled(!0),this.btn_last_week.setEnabled(!1),this.refreshRankBtn(0)},tap_btn_model_worker:function(){ME_D.send_message_waiting(CMD_GET_RANK,{game_type:GAME_TYPE,rank_time_type:this.rankWeeks[this.curRankWeek],rank_type:this.rankType[0]}),this.refreshRankBtn(0)},tap_btn_master:function(){ME_D.send_message_waiting(CMD_GET_RANK,{game_type:GAME_TYPE,rank_time_type:this.rankWeeks[this.curRankWeek],rank_type:this.rankType[1]}),this.refreshRankBtn(1)},tap_btn_black_cat:function(){ME_D.send_message_waiting(CMD_GET_RANK,{game_type:GAME_TYPE,rank_time_type:this.rankWeeks[this.curRankWeek],rank_type:this.rankType[2]}),this.refreshRankBtn(2)},tap_btn_spread:function(){ME_D.send_message_waiting(CMD_GET_RANK,{game_type:GAME_TYPE,rank_time_type:this.rankWeeks[this.curRankWeek],rank_type:this.rankType[3]}),this.refreshRankBtn(3)}}),RankDlg.create=function(t,e,i){return new RankDlg(t,e,i)},ModuleMgr.registerModule("RankDlg",RankDlg),MAX_ROUND_OF_RECOMMEND_AWARD=8,SpreadDlg=QPDlg.extend({uiPath:"ui/SpreadDlg.ui",resPath:"res/uires/main/rankAndSpread/",curIndex:0,btnType:["recommend","recommend_give"],btnReceiveStatu:0,recommendUid:"",recordList:[],ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i);var a=this;this.addListener("SuccessGetRecommendInfo",function(t){a.SuccessGetRecommendInfo(t)}),this.addListener("SuccessBindRecommmend",function(t){a.SuccessBindRecommmend(t)}),this.addListener("SuccessGetRcommendAward",function(t){a.SuccessGetRcommendAward(t)})},onLoaded:function(){ME_D.send_message_waiting(CMD_RECOMMEND_INFO,{oper:this.btnType[this.curIndex],game_type:GAME_TYPE}),this.listView_item=SpreadItem,this.btn_invite.setEnabled(!1),this.initBtn()},initBtn:function(){this.btn0=this.btn_invite,this.btn1=this.btn_award},SuccessGetRecommendInfo:function(t){var e=t.getUserData(t);e.oper==this.btnType[0]?(this.curIndex=0,this.showInvitePanel(e)):(this.curIndex=1,this.showAwardPanel(e))},SuccessBindRecommmend:function(t){var e=t.getUserData(t);this.recommendUid==e.recommend_uid&&ME_D.send_message_waiting(CMD_RECOMMEND_INFO,{oper:this.btnType[0],game_type:GAME_TYPE})},showInvitePanel:function(t){var e=void 0!=t.recommend_uid;if(this.panel_input.setVisible(!e),this.panel_award.setVisible(e),this.txt_input.setVisible(!e),this.txt_award_input.setVisible(e),this.btn_apply.setVisible(!e),this.has_done.setVisible(e),e){this.btnReceiveStatu=t.status;var i=t.play_rounds||0;i>MAX_ROUND_OF_RECOMMEND_AWARD&&(i=MAX_ROUND_OF_RECOMMEND_AWARD),this.txt_done_rounds.setString("[/c]已完成[f24][of1][c184:51:14]"+i+"/"+MAX_ROUND_OF_RECOMMEND_AWARD+"[/f][of0][/c]局"),2==this.btnReceiveStatu&&(this.btn_has_receive.setVisible(!0),this.btn_receive.setVisible(!1))}},SuccessGetRcommendAward:function(t){var e=t.getUserData(t);if(ModuleMgr.showTipMsg("已领取"+e.room_card+"个茶叶"),2==e.status)if(void 0==e.rid)this.btnReceiveStatu=2,this.btn_has_receive.setVisible(!0),this.btn_receive.setVisible(!1);else{for(var i=0;i<this.recordList.length;++i)this.recordList[i].rid==e.rid&&(this.recordList[i].recommend_status=2);this.refreshRecordList()}},showAwardPanel:function(t){this.recordList=t.record_list||[];for(var e=0;e<this.recordList.length;++e)this.recordList[e].idx=e+1;this.refreshRecordList()},refreshRecordList:function(){var t=function(t,e){return t.recommend_status==e.recommend_status?0==t.recommend_status?e.play_rounds-t.play_rounds:0:1==t.recommend_status&&1!=e.recommend_status?-1:1==e.recommend_status&&1!=t.recommend_status?1:0==t.recommend_status&&0!=e.recommend_status?-1:0==e.recommend_status&&0!=t.recommend_status?1:0};this.recordList.sort(t),this.refreshList({name:"listView",list:this.recordList,async:!0}),this.refreshTxtAccumalate()},refreshRankBtn:function(t){void 0==t&&(t=this.curIndex);for(var e=0;e<this.btnType.length;++e)this["btn"+e]&&this["btn"+e].setEnabled(e!=t),this["panel"+e].setVisible(e==t)},refreshTxtAccumalate:function(){for(var t=0,e=0;e<this.recordList.length;++e)2==this.recordList[e].recommend_status&&t++;this.txt_accumalate.setString("您累计领取房卡奖励："+t+"张")},tap_btn_invite:function(){ME_D.send_message_waiting(CMD_RECOMMEND_INFO,{oper:this.btnType[0],game_type:GAME_TYPE}),this.refreshRankBtn(0)},tap_btn_award:function(){ME_D.send_message_waiting(CMD_RECOMMEND_INFO,{oper:this.btnType[1],game_type:GAME_TYPE}),this.refreshRankBtn(1)},tap_btn_apply:function(){var t=this.str_input.getString()||0;if(0==t||t==ME_D.get_uid)return void ModuleMgr.showTipMsg("请输入好友ID");var e=Number(t);return isNaN(e)?void ModuleMgr.showTipMsg("格式错误"):(this.recommendUid=t,void ME_D.send_message_waiting(CMD_BIND_RECOMMEND,{recommend_uid:t,game_type:GAME_TYPE}))},tap_btn_receive:function(){return 0==this.btnReceiveStatu?void ModuleMgr.showTipMsg("未完成规定局数"):(2==this.btnReceiveStatu&&ModuleMgr.showTipMsg("您已领取过该奖励"),void(1==this.btnReceiveStatu&&ME_D.send_message_waiting(CMD_RECOMMEND_GET,{oper:this.btnType[0],game_type:GAME_TYPE})))},tap_btn_invite_friend:function(){platform.share(SHARE_GAME_TITLE_DES(),SHARE_GAME_WX_DES(),getShareUrl(0,0),0)}}),SpreadDlg.create=function(t,e,i){return new SpreadDlg(t,e,i)},ModuleMgr.registerModule("SpreadDlg",SpreadDlg),SpreadItem=QPLayer.extend({uiPath:"ui/SpreadItem.ui",data:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.btn_receive.setVisible(!1)},setData:function(t){this.data=t;var e=t.name,i=t.play_rounds||0;i>MAX_ROUND_OF_RECOMMEND_AWARD&&(i=MAX_ROUND_OF_RECOMMEND_AWARD),this.txt_name.setString(e),this.txt_round.setString(i+"/"+MAX_ROUND_OF_RECOMMEND_AWARD),this.btn_receive.setVisible(!1),this.btn_has_receive.setVisible(!1),2==t.recommend_status?(this.txt_status.setString("已领取"),this.btn_has_receive.setVisible(!0)):1==t.recommend_status?this.btn_receive.setVisible(!0):this.txt_status.setString("未完成")},tap_btn_receive:function(){return 0==this.data.recommend_status?void ModuleMgr.showTipMsg("未完成规定局数"):(2==this.data.recommend_status&&ModuleMgr.showTipMsg("您已领取过该奖励"),void(1==this.data.recommend_status&&ME_D.send_message_waiting(CMD_RECOMMEND_GET,{oper:"recommend_give",rid:this.data.rid,game_type:GAME_TYPE})))}}),SpreadItem.create=function(t,e,i){return new SpreadItem(t,e,i)},ModuleMgr.registerModule("SpreadItem",SpreadItem),UIUtils.RegisterPathTemple("ui/SpreadItem.ui",SpreadItem),MallDlg=QPDlg.extend({uiPath:"ui/MallDlg.ui",momeyList:[6,30,68,128,328,648],bolBind:!1,bolAppStore:!1,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){var t=ME_D.get_user().extend_uid||"";this.bolBind=!(0==t.length);var e=10;this.bolBind||(e=5),this.bolAppStore=!1,gInReview&&(this.bolAppStore=!0);for(var i=1;i<=6;i++){var a=this.momeyList[i-1]||0;this["lab_momey_"+i]&&this["lab_momey_"+i].setString(a),this.setText("lab_zhuanshi_"+i,a*e),this["grp_zhengsong"+i]&&this["grp_zhengsong"+i].setVisible(!this.bolAppStore)}if(gInReview?this.lab_bind&&this.lab_bind.setVisible(!1):this.lab_bind&&this.lab_bind.setVisible(!this.bolBind),GAME_TYPE==GAME_TYPE_NCMJ){this.lab_bind&&this.lab_bind.setVisible(!1),e=10;for(var i=1;i<=6;i++){this["icon"+i]&&this["icon"+i].loadTexture(GetRealPath("res/uires/main/mall/cy_lv"+i+".png"));var a=this.momeyList[i-1]||0;this["lab_zhuanshi_"+i].setString(a*e/10+"茶叶"),this["grp_zhengsong"+i]&&this["grp_zhengsong"+i].setVisible(!1)}}},OnPay:function(t){if("ended"==t.name){var e=t.target.name.substr(7,1);if(this.bolAppStore){if(cc.sys.isNative&&cc.sys.os==cc.sys.OS_IOS)return void platform.pay(e,0);var i=this,a=function(){i.close()};ModuleMgr.showConfirmTxtMsg("请先绑定代理号",a)}else if(GAME_PAY_TYPE==GAME_PAY_TYPE_JTPAY)ModuleMgr.runDlg("RechangeDlg",e,null,null);else{var s=[6,30,68,128,328,648];HEEPAY_PAY_WEB(s[e-1])}}}}),MallDlg.create=function(t,e,i){return new MallDlg(t,e,i)},ModuleMgr.registerModule("MallDlg",MallDlg),NcmjMallDlg=QPDlg.extend({uiPath:"ui/NcmjMallDlg.ui",momeyList:[10,50,100],rewardMomeyList:[18,98,218],ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.lab_bind&&this.lab_bind.setVisible(!1);for(var t=1;t<=4;t++){this["icon"+t]&&this["icon"+t].loadTexture(GetRealPath("res/uires/main/mall/cy_lv"+t+".png"));this.momeyList[t-1]||0;this["lab_zhuanshi_"+t]&&this["lab_zhuanshi_"+t].setString(this.rewardMomeyList[t-1]+"茶叶"),this["grp_zhengsong"+t]&&this["grp_zhengsong"+t].setVisible(!1),this["lab_momey_"+t]&&this["lab_momey_"+t].setString(this.momeyList[t-1])}},OnPay:function(t){if("ended"==t.name){var e=t.target.name.substr(7,1);HEEPAY_PAY_WEB(this.momeyList[e-1])}}}),NcmjMallDlg.create=function(t,e,i){return new NcmjMallDlg(t,e,i)},ModuleMgr.registerModule("NcmjMallDlg",NcmjMallDlg),RechangeDlg=QPDlg.extend({uiPath:"ui/RechangeDlg.ui",payType:0,payMoney:[6,30,68,128,328,648],userCode:"10211074",userAppid:"20170413171543226788",keyString:"e96f9950ec449d7f35c9fa5cca8fb157",ivString:"bb024ba8a784c4c9",ctor:function(t,e,i){this.payType=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},get_order:function(t,e){var i={};this.moeny=t,i.p3_money=t,i.p1_usercode=this.userCode,i.p5_notifyurl="unknow",i.p4_returnurl="unknow",i.ownMoney=ME_D.get_user().room_card,0==i.ownMoney&&(i.ownMoney="0.0"),i.extendUid=ME_D.get_user().extend_uid,i.userName=ME_D.get_user().name,i.userRid=ME_D.get_user().rid,i.userUid=ME_D.get_user().account_uid;var a={method:"POST",timeout:5e3,url:GAME_WEB_URL+GAME_WEB_PORT+"/apijftpay/ApiRequestSign",data:JSON.stringify(i)},s=this;ModuleMgr.showWaitMsg("获取订单中",0,null,!0),HttpNetworkRequest(a,function(t,i){ModuleMgr.removeWaitMsg();var a=ConvertToJson(i);a.userCode=s.userCode,a.userAppid=s.userAppid,a.keyString=s.keyString,a.ivString=s.ivString,e(JSON.stringify(a))})},tap_btn_weixin:function(t){var e=this,i=function(t){platform.pay(e.moeny,3,t)};this.get_order(this.payMoney[this.payType-1],i)},tap_btn_zifubao:function(t){var e=this,i=function(t){platform.pay(e.moeny,4,t)};this.get_order(this.payMoney[this.payType-1],i)}}),RechangeDlg.create=function(t,e,i){return new RechangeDlg(t,e,i)},ModuleMgr.registerModule("RechangeDlg",RechangeDlg),GameInterFaceDlg=QPDlg.extend({uiPath:"ui/GameInterFaceDlg.ui",isControlNode:!0,hit:null,hited:null,tapTime:0,isTouchClose:!0,bgLayerOpacity:0,ctor:function(t,e,i){this.data=t,this.hit=t.hit_index,this.hited=t.hited_index,QPDlg.prototype.ctor.call(this,this.uiPath,e),this.self=this,this.faceID={0:1e3,1:1001,2:1002,3:1003,4:1004}},onLoaded:function(){this.setNameAndIpAddress(),this.scheduleUpdate()},update:function(t){this.tapTime-=t},setNameAndIpAddress:function(){var t=(DataMgr.gameCtrl.getChairIdByWheelIdx(this.hit),DataMgr.gameCtrl.getChairIdByWheelIdx(this.hited));if(null!=DataMgr.gameCtrl.deskPlayers[t]&&null!=this.txt_Name){var e=DataMgr.gameCtrl.deskPlayers[t],i=e.info.client_ip;this.txt_Name.setString(toDecodeURIComponent(e.info.name)),this.txt_IpAddress.setString("IP:"+i),this.item_head&&this.item_head.setData({url:e.info.headimgurl})}var a,s,r=[],n=[];if(DataMgr.gameCtrl.location)for(var o=0;o<DataMgr.gameCtrl.location.length;o++)if(null!=DataMgr.gameCtrl.players[o+1]){var e=DataMgr.gameCtrl.players[o+1],i=DataMgr.gameCtrl.location[o],i=ConvertToJson(i.location);o+1==this.hited&&(a=e,s=i),i.longitude==-1?n.push(e):r.push({player:e,location:i})}var c="";if(a&&s&&s.longitude!=-1)for(var l=0;l<r.length;l++){var _=r[l].location;if(a!=r[l].player){var u=gGetGreatCircleDistance(s.latitude,s.longitude,_.latitude,_.longitude);c+=a.info.name+" 与 "+r[l].player.info.name+" 的距离为 "+parseInt(u)+" 米",c+="[br]"}}for(var o=0;o<n.length;o++)c+="[br]",c+=n[o].info.name+" 获取定位失败";null==DataMgr.gameCtrl.location&&(c+="自己获取定位中.."),c=toDecodeURIComponent(c),this.txt_dis&&this.txt_dis.setString(c)},setHitID:function(t,e){this.hit=t,this.hited=e,this.setNameAndIpAddress()},setData:function(t,e){this.faceID[t]=e},tap_btn_Good:function(){this.sendData(4)},tap_btn_Slipper:function(){this.sendData(3)},tap_btn_Boomer:function(){this.sendData(0)},tap_btn_Egg:function(){this.sendData(1)},tap_btn_Flower:function(){this.sendData(2)},tap_btn_Close:function(){this.close()},sendData:function(t){if(!(this.tapTime>0)&&(this.tapTime=.2,this.faceID[t]&&null!=this.hit&&null!=this.hited)){var e={oper:"chat",faceId:this.faceID[t],idx1:this.hit,idx2:this.hited};ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",e)}}}),GameInterFaceDlg.create=function(t,e,i){return new GameInterFaceDlg(t,e,i)},ModuleMgr.registerModule("GameInterFaceDlg",GameInterFaceDlg),ShareDlg=QPDlg.extend({uiPath:"ui/ShareDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},tap_btn_share_wx:function(){platform.share(SHARE_GAME_TITLE_DES(),SHARE_GAME_WX_DES(),getShareUrl(0,0),0)},tap_btn_share_py:function(){platform.share(SHARE_GAME_TITLE_DES_PY(),SHARE_GAME_PY_DES(),getShareUrl(0,0),1)}}),ShareDlg.create=function(t,e,i){return new ShareDlg(t,e,i)},ModuleMgr.registerModule("ShareDlg",ShareDlg),BanGamblingDlg=QPDlg.extend({uiPath:"ui/BanGamblingDlg.ui",ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this._super()},tap_btn_ok:function(){DataMgr.recordCtrl.confirmBanGambling(),this.close()}}),BanGamblingDlg.create=function(t,e,i){return new BanGamblingDlg(t,e,i)},ModuleMgr.registerModule("BanGamblingDlg",BanGamblingDlg),GAME_PAY_TYPE_HEEPAY=0,GAME_PAY_TYPE_JTPAY=1,GAME_PAY_TYPE=GAME_PAY_TYPE_HEEPAY,GAME_PLAY_AUTO=!1;var isAutoPlay=getQueryString("play_auto");1==isAutoPlay&&(GAME_PLAY_AUTO=!0),GAME_TYPE_NCMJ="ncmj",GAME_TYPE_FZMJ="fzmj",GAME_TYPE_NDMJ="ndmj",GAME_TYPE=GAME_TYPE_FZMJ,GAME_TYPE_CFG={},MUSIC_TYPE_CFG=[],OPEN_CARD_CHANGE_MOVE=!1,WEAVE_POKER_SHOW_TYPE=0,WEAVE_POKER_SHOW_ARROW=0,RegisterGameType(GAME_TYPE_NCMJ),RegisterGameType(GAME_TYPE_FZMJ),RegisterGameType(GAME_TYPE_NDMJ),GAME_NAME="[麻将]",ROOM_CARD_NAME="茶叶",BOL_AN_GANG_FANG_PAI=!1,GAME_LAYER_NAME="GameLayer",MY_TOTAL_CARD_NUM=16,MY_TOTAL_CARD_NUM_TT=13,MY_TOTAL_CARD_NUM_ST=16,MUSIC_TYPE=GAME_TYPE_FZMJ,MUSIC_DIFF_SEX=1,MUSIC_CHI_ARR=[],MUSIC_PENG_ARR=[],MUSIC_GANG_ARR=[],MUSIC_HULE_ARR=[],MUSIC_ZIMO_ARR=[],MUSIC_NONE_MAP={},IS_OPEN_MATCH=!1,IS_DISPATCH_POKER_JUMP=!0,ROOM_CARD_COST=[{round:8,cost:1},{round:16,cost:2},{round:32,cost:30},{round:99,cost:1},{round:199,cost:2}];var chatCfgList=["咋弄的呀，你还打不打？","快点啊，我的等的花都谢了","打球个牌，怎么这么慢啊","太爽了，这牌能给你们打满","莫慌这牌胡的宽的很","亮倒！搞满你们","我这牌胡劲大的很","13不靠呀","都懒得的打了","让我闯一下行吗"];IsGameTypeFzmj=function(t){var t=t||GAME_TYPE;return t==GAME_TYPE_FZMJ},IsGameTypeNdmj=function(t){var t=t||GAME_TYPE;return t==GAME_TYPE_NDMJ},IsGameTypeFzmjOrNdmj=function(t){var t=t||GAME_TYPE;return t==GAME_TYPE_FZMJ||t==GAME_TYPE_NDMJ},getWechatLoginAppId=function(){var t="";return GAME_TYPE==GAME_TYPE_NCMJ&&(t="wxe4c6f60ef324b3d8"),t},getNativeDownUrl=function(){var t=new Date;return GAME_TYPE==GAME_TYPE_NCMJ?"http://ncmj.gongpaa.com/gpncmj/?"+t.getTime():""},getShareIconPath=function(){return GAME_TYPE==GAME_TYPE_NCMJ?SHARE_URL+"res/icon/icon4.png":SHARE_URL+"res/icon/icon3.png"},SHARE_MAIN_DES=function(){return GAME_TYPE_NCMJ==GAME_TYPE?"权威官方发布，玩法多样，稳定安全，原汁原味最地道的南昌麻将！":GAME_NAME},SHARE_GAME_TITLE_DES=function(){return GAME_NAME},SHARE_GAME_TITLE_DES_PY=function(){return GAME_TYPE_NCMJ==GAME_TYPE?"权威官方发布，玩法多样，稳定安全，原汁原味最地道的南昌麻将！":GAME_NAME},SHARE_GAME_DESK_TITLE_DES=function(){return GAME_NAME+"房号:"+DataMgr.gameCtrl.deskIdx},SHARE_GAME_CONTENT_DES=function(){return"点击直接进入房间"},SHARE_DETAIL_TITLE_DES=function(t){if(IsGameTypeFzmjOrNdmj(t.gameType)){var e="";return IsGameTypeFzmj(t.gameType)?e="福州麻将":IsGameTypeNdmj(t.gameType)&&(e="宁德麻将"),e+"战绩"}return GAME_NAME+"战绩"},SHARE_DETAIL_DES=function(t){return"房间号:"+t.deskId+"  局数:"+t.round+"  时间:"+parseTime(t.createTime+t.all_cost_time)+"  点击查看详情"},SHARE_GAME_WX_DES=function(){return GAME_TYPE_NCMJ==GAME_TYPE?"权威官方发布，玩法多样，稳定安全，原汁原味最地道的南昌麻将！":"开好房了，就等你们一起来"+GAME_NAME+"啦！晚了位置就没了哟~"},SHARE_GAME_PY_DES=function(){return GAME_TYPE_NCMJ==GAME_TYPE?"权威官方发布，玩法多样，稳定安全，原汁原味最地道的南昌麻将！":"开好房了，就等你们一起来"+GAME_NAME+"啦！晚了位置就没了哟~"},SHARE_INVITE_TITLE=function(){var t=DataMgr.gameCtrl.deskInfo;if(IsGameTypeFzmjOrNdmj()&&t){var e=t.game_type,i="";return IsGameTypeFzmj(e)?i+="[福州麻将]":IsGameTypeNdmj(e)&&(i+="[宁德麻将]"),i+"  房号:"+DataMgr.gameCtrl.deskIdx}return GAME_NAME+"  房号:"+DataMgr.gameCtrl.deskIdx},SHARE_INVITE_DESC=function(){if(GAME_TYPE==GAME_TYPE_NCMJ){var t="局数:";return t+=99==DataMgr.gameCtrl.deskInfo.full_round?"一圈":199==DataMgr.gameCtrl.deskInfo.full_round?"二圈":DataMgr.gameCtrl.deskInfo.full_round,t+="  玩法:",1==DataMgr.gameCtrl.deskInfo.desk_type?t+="上下精":2==DataMgr.gameCtrl.deskInfo.desk_type?t+="埋地雷":3==DataMgr.gameCtrl.deskInfo.desk_type&&(t+="同一首歌"),1==DataMgr.gameCtrl.deskInfo.turn_back&&(t+="(回头一笑)"),t+=1==DataMgr.gameCtrl.deskInfo.chao_master?",抄庄":",不抄庄",t+=1==DataMgr.gameCtrl.deskInfo.discard_poker?",弃牌也算":",弃牌不算 ",t+=" 点击直接进入房间"}if(IsGameTypeFzmjOrNdmj()){var e=DataMgr.gameCtrl.deskInfo,i=e.info;switch(t=e.full_round+"局",t+=","+e.full_num+"人",e.game_type){case GAME_TYPE_FZMJ:if(i){t+=1==i.cost?",放胡均摊":",放胡单赔",1==i.spec1&&(t+=",清一色"),1==i.spec3&&(t+=",可胡金龙"),1==i.spec2&&(t+=",单钓剩金不平胡"),1==i.spec4&&(t+=",金雀开口不平胡")}break;case GAME_TYPE_NDMJ:i&&(t+=1==i.cost?",放胡均摊":",放胡单赔",t+=1==i.spec_type?",白板为金":",开金")}return t+=" 点击直接进入房间"}},isAgent=function(){return!1},GAME_HELP_LIST=[{type:1,txt:"南昌麻将游戏简介"},{type:2,txt:"[c125:57:24]南昌麻将使用无花牌的136张麻将，分别为东、南、西、北，门风东者为庄家，其余均为旁家。 每人手里抓13张牌，通过吃牌、碰牌、杠牌等方式，使手牌按照相关规定的牌型条件和牌。在游戏中对和牌没有要求，和牌者胜，被和牌者负，荒庄时计和局。[/c]"},{type:1,txt:"配牌"},{type:2,txt:"[c125:57:24] 开局前每人按顺时钟顺序分次轮流摸得的13张底牌，每人每次进牌顺序为4+4+4+1。庄家在打出牌前应再摸一张。[/c]"},{type:2,txt:"[c125:57:24] 牌数共计136张数牌（1~9万、1~9筒、1~9条），风牌（东、南、西、北），三元牌（也称箭牌，包括中、发、白）。其中风牌和三元牌统称为字牌。[/c]"},{type:2,txt:"[c125:57:24] 字牌（合计28张）[/c]"},{type:2,txt:"[c125:57:24] ● 风牌：东、南、西、北，各4张，共16张。[/c]"},{type:2,txt:"[c125:57:24] ● 箭牌：中、发、白，各4张，共12张。[/c]"},{type:2,txt:"[c125:57:24]序数牌（合计108张）[/c]"},{type:2,txt:"[c125:57:24] ● 万子牌：从一万至九万，各4张，共36张。[/c]"},{type:2,txt:"[c125:57:24] ● 筒子牌：从一饼至九饼，各4张，共36张。[/c]"},{type:2,txt:"[c125:57:24] ● 索子牌：从一索至九索，各4张，共36张。[/c]"},{type:1,txt:"牌型术语"},{type:2,txt:"[c125:57:24] ● 顺子：南昌麻将的顺子除3张同花色序数相连的牌外，还包括风牌“东南西北”中任意不重复的三个及箭牌“中发白”。例如：789筒。东南北风。[/c]"},{type:2,txt:"[c125:57:24] ● 刻子：三张相同的牌组成一组（被拆分则不算）。例如：三张九条。[/c]"},{type:2,txt:"[c125:57:24] ● 将牌：按基本牌型和牌时必须具备的单独组合的对子。例如：一对八万。[/c]"},{type:2,txt:"[c125:57:24] ● 杠子：四张相同的牌组成的一组（必须通过”杠“的动作亮出，否则不算；不能拆分）。例如：四张白板。[/c]"},{type:2,txt:"[c125:57:24] ● 吃牌：获取上家打出的牌凑顺子（只允许对上家刚打出的牌进行），简称“吃”。吃牌前不能摸牌，吃牌时要将这副顺子亮出，并将获取到的牌放在指定位置。吃牌后要打出一张牌。[/c]"},{type:2,txt:"[c125:57:24] ● 碰牌：获取别人打出的牌凑刻子（只允许对别人刚打出的牌进行），简称“碰”，比吃牌优先。碰牌前不能摸牌，碰牌时要将这副刻子亮出并放在指定位置。碰牌后要打出一张牌。[/c]"},{type:2,txt:"[c125:57:24] ● 杠牌：包括明杠和暗杠，简称“杠”，比吃牌优先。明杠分为两种情况，一是在手上已有三张一样的牌组成刻子时，他家打出第四张相同牌则可以明杠；二是在之前进行过碰牌而亮出得到一副刻子，此时摸牌补进第四张[/c]"},{type:2,txt:"[c125:57:24] ● 相同的牌进行明杠（或称之为补杠、加杠）。暗杠则是自家通过摸牌获得四张相同的牌进行暗杠（即向下扣住，不在牌桌上展示所杠之牌）。杠牌后应立即在牌山的最末尾补进一张牌。[/c]"},{type:2,txt:"[c125:57:24] ● 胡牌：和牌。自己的牌满足“一对头”加“四副牌（刻子/顺子/杠子加起来满四组即可，没有数量或吃碰限定）”，此时称之为平胡。也有些牌型不满足这个条件却仍然能和牌，这些牌型叫做“特殊牌型”。[/c]"},{type:2,txt:"[c125:57:24] ● 截胡：南昌麻将只允许一家胡牌，没有一炮多响。如有一人以上同时表示胡牌时，从打牌者按逆时针方向，顺序在前者被定为“胡牌者”，其他人被截胡。[/c]"},{type:2,txt:"[c125:57:24] ● 自摸：定口后，自己摸到所听之牌，从而使自己和牌。（杠开也算是自摸）[/c]"},{type:2,txt:"[c125:57:24] ● 放炮：自己打出的牌为别人所听之牌，从而使他家推倒和牌。[/c]"},{type:2,txt:"[c125:57:24] ● 弃胡：在同一圈内，第一家点炮自家不胡牌，则下一家接着打出的牌即便可胡也不能进行胡牌动作。此状态直到自身有摸、吃、碰、杠等进牌动作解除，换而言之必须过完这一圈才能再次胡牌，即是不能弃先和后。[/c]"},{type:2,txt:"[c125:57:24] ● 抄庄：在开局第一圈，庄家出的第一张牌，三个闲家在第一圈每人都出一张，则庄家应按规定向其他三家给付分数。抄庄与否不影响牌局进行。比如就是庄家出北风，三个闲家每人都出一张北风。[/c]"},{type:1,txt:"游戏流程"},{type:2,txt:"[c125:57:24] 坐庄： 四人落座后由系统掷骰子决定谁家当庄，按逆时钟顺序计算，点数为5、9则为自身，点数为2、6、10为下家，点数为3、7、11为对家，点数为4、8、12为上家。庄家确定后开始掷骰拿牌翻精。庄家在胡牌分数计算中（无论是胡牌、放炮、被他家自摸），都应在所得分数基础上翻一倍。精牌计算不需要遵守这个规定。[/c]"},{type:2,txt:"[c125:57:24] 出牌：凡是抓进、吃、碰、开杠后，不胡牌便要打出一张牌。[/c]"},{type:2,txt:"[c125:57:24] 吃碰杠牌：打牌过程中，可以吃、碰（杠）牌。开杠后从牌城尾部补牌，允许抓走精牌（抓精和牌时算杠开）。[/c]"},{type:2,txt:"[c125:57:24] 听牌与胡牌：胡牌分为放炮胡和自摸胡，精吊。[/c]"},{type:1,txt:"胡牌类型"},{type:2,txt:"[c125:57:24] 计分分两类一类是奖励分（包括精牌分、杠牌分和其他奖励分），一类是胡牌分。两者得分加减之和则为玩家在这局所得失的分数。[/c]"},{type:1,txt:"胡牌规则"},{type:2,txt:"[c125:57:24] 南昌麻将可胡的牌型有以下三种：基本牌型（四副牌加一对将），对牌型（小七对或大七对） ，十三烂牌型 （手中十四张牌中，序数牌间隔大于等于3，字牌没有重复所组成的牌型）[/c]"},{type:2,txt:"[c125:57:24] 1、拦胡制、没有一炮多响。[/c]"},{type:2,txt:"[c125:57:24] 2、胡先不胡后，同一圈有弃和则不允许再和牌。精吊时需要自摸。[/c]"},{type:2,txt:"[c125:57:24] 3、胡牌分计算按翻倍来，即在原基础之上X2即可。如满足其他条件，则每一项在之前基础上再X2。德国、七星十三烂等特殊牌型另计。[/c]"},{type:2,txt:"[c125:57:24] 4、未胡牌需出子。无论是否放炮都需出子，放炮者付2倍、其他两位玩家付1倍。[/c]"},{type:2,txt:"[c125:57:24] 5、自摸时，每家都需出分，且牌分计算翻倍。[/c]"},{type:2,txt:"[c125:57:24] 5、庄家支付胡牌分数时，无论得失都应翻倍。[/c]"},{type:2,txt:"[c125:57:24] 6、有抢杠，三家支付。[/c]"},{type:2,txt:"[c125:57:24] 7、有杠开，三家支付。（再加自摸的倍数）[/c]"},{type:2,txt:"[c125:57:24] 8、天地胡：三家支付20分。[/c]"},{type:1,txt:"胡牌分"},{type:2,txt:"[c125:57:24] 1.自摸：X2 [/c]"},{type:2,txt:"[c125:57:24] 2.庄家：X2 [/c]"},{type:2,txt:"[c125:57:24] 3.点炮：点炮者X2 [/c]"},{type:2,txt:"[c125:57:24] 4.抢杠：X2。可视作自摸，即他家加杠之牌（手上已碰出一刻子，摸进第四张相同的牌进行加杠）是我方所胡之牌，此时抢杠成立，原有的杠牌动作中止且不算分。抢杠只能发生在加杠动作中，暗杠明杠不算。[/c]"},{type:2,txt:"[c125:57:24] 5.杠开： X2。由于可视作自摸，所以实际上是X4。即开杠后在牌山末尾补进的牌恰好使自己胡牌，可与精钓、德国等重复计算。[/c]"},{type:2,txt:"[c125:57:24] 6.天胡：一家20子，精钓天胡计作40子。[/c]"},{type:2,txt:"[c125:57:24] 7.地胡：一家20子， 起手形成精钓的牌型的地胡为40子。[/c]"},{type:2,txt:"[c125:57:24] 8.精钓X2。自摸翻倍另算，可与其他牌型重复计算。[/c]"},{type:2,txt:"[c125:57:24] 9.大七对：X2。碰碰胡，即胡牌时牌型为4副刻子/杠子+1对头。刻子/杠子没有门清要求，可随意碰、杠。可与其他牌型重复计算。[/c]"},{type:2,txt:"[c125:57:24] 10.小七对：X2。胡牌时手中凑齐7个对子，可以有2对相同的牌（若发生暗杠动作则七对子不成立）。七对子必须门清，不能吃碰杠。可与其他牌型重复计算。[/c]"},{type:2,txt:"[c125:57:24] 11.十三烂：X2[。玩家手中的任意两张“万、筒、条”的序数牌之间都不能靠牌或重复（包括147、148、149、158、159、169、258、259、269、369），风牌、三元牌任意两两间不重复（此时东南西北、中发白不再视作顺子）。满足此要求的牌型成为十三烂。十三烂必须门清，不能有吃碰杠。可与其他牌型重复计算。[/c]"},{type:2,txt:"[c125:57:24] 12.七星十三烂： X4。在十三烂的胡牌时，凑齐东南西北中发白。如有精牌参与则只能做本身含义解释。[/c]"},{type:2,txt:"[c125:57:24] 13.德国：自摸时为每家X2+5；否则点炮者X2+5，非点炮者X2。精还原时算作德国，精牌分数依然计算。可与其他牌型重复计算。[/c]"},{type:2,txt:"[c125:57:24] 14.德中德：自摸时为每家X4+5；否则点炮者X4+5，非点炮者X4。可与其他牌型重复计算。[/c]"},{type:1,txt:"精牌牌型"},{type:2,txt:"[c125:57:24] 1)德国：又称无精。胡牌牌型中没有出现“精”，或有精但并未发挥精的效应。杠精不算精。[/c]"},{type:2,txt:"[c125:57:24] 2)德中德：“德国”胡牌时没有任一玩家手牌中有“精”。[/c]"},{type:2,txt:"[c125:57:24] 3)埋地雷：翻上精的规则不变，（通用功能：下精仅参与精牌分数的结算，没有万用配牌功能）但是下精的指示牌只在牌局终了的时候翻开并结算。此时完结应该把牌局过程中所有手持的、打出的或者“摸吃碰杠”得来的牌进行展示并将其中符合条件的牌亮出来进行计算（加入所打之牌被他家“吃碰杠胡”，则此牌算作他家的）。（通用功能：下精结算也包过冲关和霸王精。）[/c]"},{type:2,txt:"[c125:57:24] 4)回头一笑：和下翻类似，只是游戏抓完牌后，用上盘的上翻精作为本次结算的精。（若为首盘，则首盘没有下翻精。）下精结算也包过冲关和霸王精。[/c]"},{type:2,txt:"[c125:57:24] 5)同一首歌：该玩法是埋地雷的延伸玩法，翻下精的方式同埋地雷一致，牌局终了的时候翻开，翻开后对应的序数相同的序数牌（“万”“筒”“条”）都为精，例：翻下精牌为一万，则本次下翻精正精为一万，副精为二万，对应的一条、二条、一筒、两筒、都为精。若翻下精的牌为字牌（东南西北、中发白），则每个字牌都要显示一次。例如：翻下精牌为东风，下精的正精为东风，副精为南风，则需要显示东南，再南西，再西北，再北东。 翻下精牌为中，下精的正精为中，副精为发，则需要显示中发，再发白，再白中。[/c]"},{type:2,txt:"[c125:57:24] 6)回头上下翻：翻上精的规则不变，翻下精的稍有变动，下精的指示牌开局时就需亮出，下精仅在开局时参与精牌分数的结算，没有万用配牌功能。[/c]"},{type:1,txt:"冲关规则"},{type:2,txt:"[c125:57:24] 手中精的奖励分合计超过5分时称为冲关，冲关时奖励分应再翻番，具体如下：[/c]"},{type:2,txt:"[c125:57:24] 累积[/c] [c194:95:22]5分：5x2=10分[/c]"},{type:2,txt:"[c125:57:24] 累积[/c] [c194:95:22]6分：6x3=18分[/c]"},{type:2,txt:"[c125:57:24] 累积[/c] [c194:95:22]7分：7x4=28分[/c]"},{type:2,txt:"[c125:57:24] 累积[/c] [c194:95:22]8分：8x5=40分[/c]"},{type:2,txt:"[c125:57:24] 累积[/c] [c194:95:22]9分：9x6=54分[/c]"},{type:2,txt:"[c125:57:24] 累积[/c] [c194:95:22]10分：10x7=70分[/c][c125:57:24]??依此类推[/c]"},{type:1,txt:"精分"},{type:2,txt:"[c125:57:24] 1.杠子：暗杠，每家2分；明杠，每家1分。[/c]"},{type:2,txt:"[c125:57:24] 2.精：正精， 2分；副精， 1分。[/c]"},{type:2,txt:"[c125:57:24] 3.抄庄：庄家向其他三家每家支付5分，此处单独计算。 [/c]"},{type:2,txt:"[c125:57:24] 4.霸王精：精分×2 四个玩家中仅有一人有上精称为霸王精，每个精的加成X2 [/c]"}],MJ_STEP_NONE="none",MJ_STEP_OPEN_DOOR="open_door",MJ_STEP_SELECT_RAND_POKER="select_rand_card",MJ_STEP_DEAL_START="deal_start",MJ_STEP_DEAL_END="deal_end",MJ_STEP_INIT_POKER="init_poker",MJ_STEP_PLAY="play",MJ_STEP_GAME_END="game_end",MJ_STEP_SHOW_RESULT="show_result",MJ_STEP_FIX_FLOWER="fix_flower",MJ_STEP_CATCH_KING_HU="catch_king_hu",MJ_STEP_SELECT_PIAO="select_piao",GameCtrl=GameBaseCtrl.extend({isLog:!1,totalCardNum:13,lastWinIdx:-1,randNum1:0,randNum2:0,lastDispatchIdx:0,lastDispatchRid:"",lastDispatchPoker:0,lastOutPokerIdx:0,lastOutPoker:0,randPokerList:null,downRandPokerList:null,wheelDownPokerMap:null,tbDownRandPokerList:null,tbWheelDownPokerMap:null,actionHuTypes:null,actionExtraData:null,curIndex:-1,actionList:null,huTypeList:null,huIdx:0,roleHuTypeList:null,curRoundScore:null,curScore:null,recordDetail:"",resultData:null,deskType:0,myTempCards:null,remainPokerNum:0,allFlowerList:0,recordRid:"",randMineIdx:0,randMineList:[],clearData:function(){GameBaseCtrl.prototype.clearData.call(this),this.totalCardNum=MY_TOTAL_CARD_NUM_TT,this.lastWinIdx=-1,this.randNum1=0,this.randNum2=0,this.lastDispatchIdx=0,this.lastDispatchRid="",this.lastDispatchPoker=0,this.lastOutPokerIdx=0,this.lastOutPoker=0,this.actionList=[],this.randPokerList=[],this.downRandPokerList=[],this.wheelDownPokerMap=[],this.tbDownRandPokerList=[],this.tbWheelDownPokerMap=[],this.huTypeList=[],this.roleHuTypeList=null,this.huIdx=0,this.resultData=null,this.deskType=0,this.actionHuTypes=[],this.actionExtraData=null,this.remainPokerNum=0,this.myTempCards=[],this.isLog=!1,this.recordRid="",this.isGameComplete=!1},getBgId:function(){var t=cc.sys.localStorage.getItem(GAME_TYPE+"_bg");return null!=t&&void 0!=t||(t=GAME_TYPE==GAME_TYPE_NCMJ?2:0),parseInt(t)||0},isBeforeGame:function(){var t=DataMgr.gameCtrl.deskInfo.cur_step;return t==MJ_STEP_NONE||t==MJ_STEP_SELECT_PIAO},saveSceenOrientation:function(t){designOrientation!=SCREEN_ORIENTATION_LANDSCAPE&&(SCREEN_CUR_ORIENTATION=t,cc.sys.localStorage.setItem(GAME_TYPE+"sceen_orientation",t))},getSceenOrientation:function(){return cc.sys.localStorage.getItem(GAME_TYPE+"sceen_orientation")||SCREEN_ORIENTATION_LANDSCAPE},bolKingCard:function(t){for(var e=DataMgr.gameCtrl.randPokerList||[],i=0;i<e.length;i++)if(t==e[i])return!0;return!1},getRoomCardCost:function(t){for(var e=0,i=t.round,a=0;a<ROOM_CARD_COST.length;a++)if(ROOM_CARD_COST[a].round==i){e=ROOM_CARD_COST[a].cost;break}return e},sortPlayers:function(){this.deskPlayers=new Array(4);for(var t=[],e=null,i=1;i<=this.players.length;i++)this.players[i]&&this.players[i].rid==ME_D.get_rid()?e=this.players[i]:t.push(this.players[i]);if(!e){t=[];for(var i=1;i<=this.players.length;i++)1==i?e=this.players[i]:t.push(this.players[i])}if(this.deskPlayers[4]=e,e&&(this.myWheelIdx=e.wheel_idx),this.deskInfo){var a=this.deskInfo.full_num;if(2==a)this.deskPlayers[1]=t[0];else for(var s=this.myWheelIdx,i=0;i<t.length;i++){var r=t[i];r&&((s+1)%a==r.wheel_idx%a?this.deskPlayers[3]=r:(s-1+a)%a==r.wheel_idx%a?this.deskPlayers[2]=r:this.deskPlayers[1]=r)}}},getChiList:function(){var t=DataMgr.gameCtrl.lastOutPoker,e=calc_tip_chi_poker(DataMgr.gameCtrl.myCards,t);return e},canEatList:function(t){var e=[],i=get_card_value(t);return t<49&&i<=7&&e.push([t,t+1,t+2]),e},getRealpokerList:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e},setWheelData:function(t){for(var e=this.deskInfo.full_num,i=1;i<=e;i++){var a=this.wheelInfos[i];if(a&&a.rid==t.rid)for(var s in t)a[s]=t[s]}},getMyCurCards:function(){var t=gDup(this.myCards);return t.length%3==2?t:(this.lastDispatchIdx==this.myWheelIdx&&this.lastDispatchPoker>0&&t.push(this.lastDispatchPoker),t)},cal_desk_info:function(t){this.cal_desk_info_data(t),ModuleMgr.enterGameScene()},cal_desk_info_data:function(t){if(cc.log("cal_desk_info_data------",t),this.curIndex=t.cur_op_idx,this.lastWinIdx=t.last_win_op_idx,this.curRoundScore=t.cur_round_score,this.curScore=t.cur_score,this.lastDispatchIdx=t.last_dispatch_idx||0,this.lastDispatchPoker=t.last_dispatch_poker||0,this.resultData=t.result_data,this.deskType=t.desk_type,this.remainPokerNum=t.remain_poker_num,this.randMineList=t.rand_mine_list||[],this.randMineIdx=t.rand_mine_idx,t.hu_type_str&&("object"==typeof t.hu_type_str?this.roleHuTypeList=t.hu_type_str:this.roleHuTypeList=ConvertToJson(toDecodeURIComponent(t.hu_type_str))),t.last_dispatch_poker)for(var e=0;e<this.myCards.length;e++)if(t.last_dispatch_poker==this.myCards[e]){this.myCards.splice(e,1);break}for(var i=t.rand_pokers,e=0;e<i.length;e++)this.randPokerList[e]=i[e];set_king_map(IsGameTypeNdmj(this.deskInfo.game_type)&&this.deskInfo.info&&0==this.deskInfo.info.spec_type?[67]:this.randPokerList),this.downRandPokerList=t.down_rand_pokers||[],this.actionList=t.select_actions,this.actionHuTypes=t.action_hu_types||[],this.huTypeList=t.cur_hu_types,this.lastOutPoker=t.last_out_poker||0,this.lastOutPokerIdx=t.last_out_poker_idx||0},cal_last_win_op_idx:function(t){this.lastWinIdx=t.last_win_op_idx,cc.eventManager.dispatchCustomEvent("SuccessRandMaster")},cal_open_door:function(t){this.randNum1=t.rand_num1,this.randNum2=t.rand_num2,this.randPokerList=[],this.downRandPokerList=[],this.tbDownRandPokerList=[],set_king_map(IsGameTypeNdmj(this.deskInfo.game_type)&&this.deskInfo.info&&0==this.deskInfo.info.spec_type?[67]:this.randPokerList),cc.eventManager.dispatchCustomEvent("SuccessOpenDoor")},cal_poker_init:function(t){this.initMyCards(t.poker_list),t.rand_pokers&&(this.randPokerList=t.rand_pokers),cc.eventManager.dispatchCustomEvent("SuccessPokerInit",t)},cal_rand_poker:function(t){this.randNum1=t.rand_num1,this.randNum2=t.rand_num2,this.randPokerList=t.rand_pokers,cc.eventManager.dispatchCustomEvent("SuccessRandPoker")},cal_wheel_rand_poker:function(t){for(var e=[],i=t.down_rand_pokers,a=Math.floor(i.length/2),s=this.deskInfo.full_num,r=99,n=1;n<=s;n++)for(var o=t["wheel_rand_idx"+n]||[],c=(t.cur_score["idx"+n]||0,0);c<a;c++){var l={},_=2*c,u=2*c+1,h=o[_]||0,g=o[u]||0;l.downPokerList=[i[_],i[u]],l.nums=[h,g],l.score=2*h+g,l.score>=5&&(l.score=l.score*(l.score-3),l.isChongGuan=!0),e[n]||(e[n]=[]),e[n].push(l)}for(var c=0;c<a;c++){for(var d=0,n=1;n<=s;n++)d+=e[n][c].score;for(var r=s+1,n=1;n<=s;n++){var m=e[n][c].score*(s-1),f=d-e[n][c].score,p=m-f;e[n][c].score=p,m>0&&(r=r>s?n:0)}if(r>=1&&r<=s){e[r][c].isBaWan=!0;for(var n=1;n<=s;n++)e[n][c].score=2*e[n][c].score}}1==t.type?(this.tbWheelDownPokerMap=e,this.tbDownRandPokerList=i):(this.wheelDownPokerMap=e,this.downRandPokerList=i),t.cur_round_score&&(DataMgr.gameCtrl.curRoundScore=t.cur_round_score,cc.eventManager.dispatchCustomEvent("RefreshRoleScore")),t.cur_score&&(DataMgr.gameCtrl.curScore=t.cur_score,cc.eventManager.dispatchCustomEvent("RefreshRoleScore")),cc.eventManager.dispatchCustomEvent("ShowDownKing",t)},cal_op_idx:function(t){this.curIndex=t.cur_op_idx,cc.eventManager.dispatchCustomEvent("TurnIndex")},cal_dispatch_poker:function(t){this.lastDispatchPoker=t.poker_num,this.lastDispatchIdx=t.idx,this.remainPokerNum=t.remain_poker_num,
this.lastDispatchRid=t.rid,cc.eventManager.dispatchCustomEvent("DispatchPoker",t)},cal_poker_list_change:function(t){if(t.idx==this.myWheelIdx)if(this.curStep==MJ_STEP_PLAY)this.initMyCards(t.poker_list),cc.eventManager.dispatchCustomEvent("refreshPoker",t);else if(this.myTempCards=t.poker_list,t.last_dispatch_poker&&t.last_dispatch_poker>0&&this.myTempCards.length>DataMgr.gameCtrl.totalCardNum){for(var e=0;e<this.myTempCards.length;e++)if(t.last_dispatch_poker==this.myTempCards[e]){this.myTempCards.splice(e,1);break}this.lastDispatchIdx==this.myWheelIdx&&(this.lastDispatchPoker=t.last_dispatch_poker)}},cal_deal_poker:function(t){this.lastOutPokerIdx=t.idx,this.lastOutPoker=t.poker_list[0],this.lastDispatchPoker=0,cc.eventManager.dispatchCustomEvent("SuccessDealPoker",t),cc.eventManager.dispatchCustomEvent("HideDispatchPoker",t)},cal_no_action:function(t){var e=this.lastOutPokerIdx,i=this.lastOutPoker;if(this.wheelInfos[e]&&this.lastOutPoker>0){var a=this.wheelInfos[e].out_pokers||[];a.push(i),this.wheelInfos[e].out_pokers=a}this.actionList=[],this.lastOutPoker=0,cc.eventManager.dispatchCustomEvent("SuccessNoAction",t)},cal_select_actions:function(t){this.actionList=t.select_actions,this.actionHuTypes=t.cur_hu_types||[];var e=this.wheelInfos[this.myWheelIdx];if(e){for(var i=DataMgr.gameCtrl.actionHuTypes||[],a=0;a<i.length;a++)if(i[a]==MJ_HU_CAN_DOUBLE_KIND||i[a]==MJ_HU_CAN_THREE_KIND){e&&(e.dui_kind_count=2);break}e.extra_data=t.extra_data||null}cc.eventManager.dispatchCustomEvent("SuccessSelectAction",t)},cal_action_gang:function(t){var e=t.idx;if(this.wheelInfos[e]){var i=this.wheelInfos[e].weave_pokers||[],a=null;if(1==t.poker_list.length){for(var s=0;s<i.length;s++)if(a=i[s],a.mj_action==MJ_PENG&&a.poker_list[0]==t.poker_list[0]){a.mj_action=MJ_BU_GANG,a.poker_list.push(t.poker_list[0]);break}}else a={mj_action:MJ_GANG,poker_list:t.poker_list,last_out_poker_idx:this.lastOutPokerIdx,last_out_poker:this.lastOutPoker},this.lastOutPoker!=t.poker_list[0]&&(a={mj_action:MJ_AN_GANG,poker_list:t.poker_list,last_out_poker_idx:0,last_out_poker:0}),i.push(a);this.wheelInfos[e].weave_pokers=i,cc.eventManager.dispatchCustomEvent("PlayActionEfc",{idx:e,data:a})}this.actionList=[],this.lastOutPoker=0,cc.eventManager.dispatchCustomEvent("HideCurOutCard")},cal_action_peng:function(t){var e=t.idx;if(this.wheelInfos[e]){var i=this.wheelInfos[e].weave_pokers||[],a={mj_action:MJ_PENG,poker_list:t.poker_list,last_out_poker_idx:this.lastOutPokerIdx,last_out_poker:this.lastOutPoker};i.push(a),this.wheelInfos[e].weave_pokers=i,cc.eventManager.dispatchCustomEvent("PlayActionEfc",{idx:e,data:a})}this.actionList=[],this.lastOutPoker=0,cc.eventManager.dispatchCustomEvent("HideCurOutCard")},cal_action_chi:function(t){var e=t.idx;if(this.wheelInfos[e]){var i=this.wheelInfos[e].weave_pokers||[],a={mj_action:MJ_CHI,poker_list:t.poker_list,last_out_poker_idx:this.lastOutPokerIdx,last_out_poker:this.lastOutPoker};i.push(a),this.wheelInfos[e].weave_pokers=i,cc.eventManager.dispatchCustomEvent("PlayActionEfc",{idx:e,data:a})}this.actionList=[],this.lastOutPoker=0,cc.eventManager.dispatchCustomEvent("HideCurOutCard")},cal_action_hu:function(t){this.actionList=[],this.lastOutPoker=0},cal_round_change:function(t){this.deskInfo.cur_round=t.cur_round,this.deskInfo.cur_round>this.deskInfo.full_round&&(this.deskInfo.cur_round=this.deskInfo.full_round),cc.eventManager.dispatchCustomEvent("RefreshRound")},cal_new_ttw_record:function(t){this.recordId=t.rid,this.recordDetail=t.record_detail,4==this.deskType&&cc.eventManager.dispatchCustomEvent("SuccessGameEnd")},cal_rand_mine_idx:function(t){this.randMineIdx=t.rand_mine_idx,cc.eventManager.dispatchCustomEvent("RefreshRandMineLayer")},cal_rand_mine_list:function(t){this.randMineList=t.rand_mine_list||[]},setInitStatus:function(){this.remainPokerNum=0,this.curRoundScore={idx1:0,idx2:0,idx3:0,idx4:0},this.curScore={idx1:0,idx2:0,idx3:0,idx4:0}},initWheelInfo:function(){for(var t=this.deskInfo||{},e=t.full_num||4,i=1;i<=e;i++){var a=this.wheelInfos[i];a&&(a.flower_list=[],a.out_pokers=[],a.weave_pokers=[],a.down_poker_list=[],a.listen_poker_list=[],a.poker_list=[],a.is_show_card=0,a.piao_ratio=-1)}},newGameInit:function(){this.roleHuTypeList=null,this.huTypeList=[],this.randNum1=0,this.randNum2=0,this.lastDispatchIdx=0,this.lastDispatchPoker=0,this.lastOutPokerIdx=0,this.lastOutPoker=0,this.actionList=[],this.initWheelInfo()},stepChageData:function(t){t.cur_step==MJ_STEP_DEAL_START?this.newGameInit():t.cur_step==MJ_STEP_GAME_END||t.cur_step==MJ_STEP_PLAY||t.cur_step==MJ_STEP_SHOW_RESULT||t.cur_step==MJ_STEP_NONE&&this.setInitStatus()},cal_step_change:function(t){this.stepChageData(t),t.cur_step==MJ_STEP_DEAL_START?ModuleMgr.closeOrientationDlg("GameResult"):t.cur_step==MJ_STEP_GAME_END||t.cur_step==MJ_STEP_PLAY&&ModuleMgr.closeOrientationDlg("GameResult"),cc.eventManager.dispatchCustomEvent("SuccessStepChange",t)},checkGameEnd:function(){this.deskInfo&&this.deskInfo.cur_round>=this.deskInfo.full_round&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"score_end"})},cal_show_result:function(t){this.huTypeList=t.cur_hu_types||[],t.hu_type_str&&("object"==typeof t.hu_type_str?this.roleHuTypeList=t.hu_type_str:this.roleHuTypeList=ConvertToJson(toDecodeURIComponent(t.hu_type_str))),this.huIdx=t.win_idx,this.curRoundScore=t.cur_round_score,this.curScore=t.cur_score,this.resultData=t,cc.eventManager.dispatchCustomEvent("SuccessShowResult",t),this.initWheelInfo()},cal_user_poker_fix_flower:function(t){var e=t.idx;if(t.idx==this.myWheelIdx&&this.curStep!=MJ_STEP_PLAY){var i=t.flower_list||[];if(i.length>0){for(var a={},s=0;s<i.length;s++)a[i[s]]=i[s];for(var s=0;s<this.myCards.length;s++)a[this.myCards[s]]&&(a[this.myCards[s]]=null);for(var r in a)if(a[r])for(var s=this.myCards.length-1;s>=0;s--)if(this.myCards[s]<80){this.myCards[s]=a[r];break}}}this.wheelInfos[e]&&(this.wheelInfos[e].flower_list=t.flower_list||[],cc.eventManager.dispatchCustomEvent("SuccessFixFlower",t)),this.setUserFlowerList()},cal_all_poker_fix_flower:function(t){if(this.allFlowerList=t.all_flower_list,this.allFlowerList.length)for(var e=this.allFlowerList.length-1;e>=0;e--){var i=this.allFlowerList[e];if(i){var a=i.idx;0==(this.wheelInfos[a].flower_list||[]).length&&(this.wheelInfos[a].flower_list=i.flower_list||[])}}cc.eventManager.dispatchCustomEvent("SuccesAllPokersFixFlower",t),this.setUserFlowerList()},_userFlowerList:[],setUserFlowerList:function(){if(IsGameTypeFzmj(DataMgr.gameCtrl.deskInfo.game_type)){for(var t=DataMgr.gameCtrl.deskPlayers,e=[],i=[4,3,1,2],a=0;a<i.length;a++){var s=t[i[a]];if(s){var r={};r.name=s.info.name;var n=DataMgr.gameCtrl.wheelInfos[s.wheel_idx],o=n.flower_list;if(!o)return;r.num=o.length,r.wheel_idx=s.wheel_idx;for(var c=[],l=0;l<o.length;l++)c[o[l]]=c[o[l]]||0,c[o[l]]++;r.list=[];for(var l=0;l<c.length;l++)c[l]>0&&r.list.push({card:l,num:c[l]});e.push(r)}}this._userFlowerList=e}},refreshUserFlowerList:function(t,e){for(var i=[4,3,1,2],a=[],s=0;s<i.length;s++)DataMgr.gameCtrl.deskPlayers[i[s]]&&a.push(i[s]);for(var r=-1,s=0;s<a.length;s++)a[s]==t&&(r=s);if(r>=0){var n={},o=DataMgr.gameCtrl.deskPlayers[t];if(o&&o.info){n.name=o.info.name,n.num=e.length,n.wheel_idx=o.wheel_idx;for(var c=[],l=0;l<e.length;l++)c[e[l]]=c[e[l]]||0,c[e[l]]++;n.list=[];for(var l=0;l<c.length;l++)c[l]>0&&n.list.push({card:l,num:c[l]})}this._userFlowerList[r]=n}},setUserLogFlowerList:function(t){this._userFlowerList=t},getUserFlowerList:function(){return this._userFlowerList},cal_tsw_score_end:function(t){var e=t.idx;this.wheelInfos[e]&&(this.wheelInfos[e].is_score_end=1),cc.eventManager.dispatchCustomEvent("SuccessTswScoreEnd",t)},cal_error_op:function(t){ModuleMgr.showTipMsg(t.err_msg),cc.eventManager.dispatchCustomEvent("ErrorOp",t)},cal_show_card:function(t){for(var e=this.deskInfo.full_num,i=1;i<=e;i++){var a=this.wheelInfos[i];a&&a.rid==t.rid&&(a.down_poker_list=t.down_poker_list,a.listen_poker_list=t.listen_poker_list,a.poker_list=t.poker_list,a.is_show_card=1)}this.actionList=[],cc.eventManager.dispatchCustomEvent("SuccesShowCard",t)},cal_select_piao:function(t){var e=t.idx,i=t.piao_ratio,a=this.wheelInfos[e];a&&(a.piao_ratio=i),cc.eventManager.dispatchCustomEvent("SuccesSelectPiao",t)},cal_score_change:function(t){t.cur_round_score&&(this.curRoundScore=t.cur_round_score),t.cur_score&&(this.curScore=t.cur_score),cc.eventManager.dispatchCustomEvent("SuccesScoreChange",t)},cal_chao_master:function(t){cc.eventManager.dispatchCustomEvent("SuccesChaoMaster",t)},cal_change_up_floor:function(t){this.deskInfo.base_ratio=t.base_ratio,cc.eventManager.dispatchCustomEvent("SuccesChangeUpFloor",t)},getIdxByRid:function(t){if(null==this.players)return-1;for(var e=1;e<=4;e++)if(this.players[e]&&this.players[e].rid==t)return e;return-1},analyseReplayPlayer:function(){for(var t=this.replayData.users||[],e=this.replayData.poker_list||[],i=0;i<t.length;i++){var a=t[i],s={};s.info=a,s.wheel_idx=i+1,s.rid=a.rid,s.out_pokers=[],s.weave_pokers=[],s.pokers=e[i],s.down_poker_list=[],s.listen_poker_list=[],s.is_show_card=0,this.addPlayer(s)}this.deskInfo={};var r=this.replayData.desk_info||{};for(var n in r)this.deskInfo[n]=r[n];this.deskInfo.full_num=t.length,this.deskInfo.cur_step=MJ_STEP_PLAY,this.curStep=MJ_STEP_PLAY,this.deskType=this.deskInfo.desk_type},analyseReplayKing:function(){for(var t=this.replayData.steps||[],e=0;e<t.length;e++){var i=t[e],a=i.a,s=i.d;"rand_poker"==a?(this.randPokerList=s.rand_pokers,this.downRandPokerList=s.down_rand_pokers,set_king_map(IsGameTypeNdmj(this.deskInfo.game_type)&&this.deskInfo.info&&0==this.deskInfo.info.spec_type?[67]:this.randPokerList)):"wheel_rand_poker"==a&&(this.downRandPokerList=s.down_rand_pokers)}},analyseReplayData:function(){this.analyseReplayPlayer(),this.analyseReplayKing()},getAppearCountByTile:function(t){var e=0,i=DataMgr.gameCtrl.wheelInfos;for(var a in i){var s=i[a].out_pokers;if(s)for(var r=0;r<s.length;r++)s[r]==t&&e++;var n=i[a].weave_pokers;if(n)for(var r=0;r<n.length;r++){var o=n[r].poker_list;if(o)for(var c=0;c<o.length;c++)o[c]==t&&e++}}var l=DataMgr.gameCtrl.myCards;if(l)for(var r=0;r<l.length;r++)l[r]==t&&e++;if(l&&l.length%3!=2){var _=DataMgr.gameCtrl.lastDispatchIdx,u=DataMgr.gameCtrl.lastDispatchPoker;DataMgr.gameCtrl.myWheelIdx==_&&u>0&&u==t&&e++}var h=DataMgr.gameCtrl.deskInfo,g=h.info,d=DataMgr.gameCtrl.randPokerList||[],m=d[0];if(m){if(IsGameTypeNdmj(h.game_type)&&g){if(0!=g.spec_type)return e;67==t?t=d[0]:t==d[0]&&(t=67)}t==m&&e++}return e}}),NetMsg.msg_room_message_game=function(t,e){cc.log("msg_room_message_game----oper",t),cc.log("info----",e),this.msg_room_message_base(t,e),"desk_info"==t?DataMgr.gameCtrl.cal_desk_info(e):"last_win_op_idx"==t?DataMgr.gameCtrl.cal_last_win_op_idx(e):"open_door"==t?DataMgr.gameCtrl.cal_open_door(e):"poker_init"==t?DataMgr.gameCtrl.cal_poker_init(e):"rand_poker"==t?DataMgr.gameCtrl.cal_rand_poker(e):"wheel_rand_poker"==t?DataMgr.gameCtrl.cal_wheel_rand_poker(e):"op_idx"==t?DataMgr.gameCtrl.cal_op_idx(e):"dispatch_poker"==t?DataMgr.gameCtrl.cal_dispatch_poker(e):"poker_list_change"==t?DataMgr.gameCtrl.cal_poker_list_change(e):"deal_poker"==t?DataMgr.gameCtrl.cal_deal_poker(e):"no_action"==t?DataMgr.gameCtrl.cal_no_action(e):"select_actions"==t?DataMgr.gameCtrl.cal_select_actions(e):"action_gang"==t?DataMgr.gameCtrl.cal_action_gang(e):"action_peng"==t?DataMgr.gameCtrl.cal_action_peng(e):"action_chi"==t?DataMgr.gameCtrl.cal_action_chi(e):"action_hu"==t?DataMgr.gameCtrl.cal_action_hu(e):"round_change"==t?DataMgr.gameCtrl.cal_round_change(e):"new_ttw_record"==t&&DataMgr.gameCtrl.cal_new_ttw_record(e),"step_change"==t?DataMgr.gameCtrl.cal_step_change(e):"show_result"==t?DataMgr.gameCtrl.cal_show_result(e):"user_poker_fix_flower"==t?DataMgr.gameCtrl.cal_user_poker_fix_flower(e):"all_poker_fix_flower"==t?DataMgr.gameCtrl.cal_all_poker_fix_flower(e):"tsw_score_end"==t?DataMgr.gameCtrl.cal_tsw_score_end(e):"error_op"==t?DataMgr.gameCtrl.cal_error_op(e):"show_card"==t?DataMgr.gameCtrl.cal_show_card(e):"select_piao"==t?DataMgr.gameCtrl.cal_select_piao(e):"score_change"==t?DataMgr.gameCtrl.cal_score_change(e):"chao_master"==t?DataMgr.gameCtrl.cal_chao_master(e):"change_up_floor"==t?DataMgr.gameCtrl.cal_change_up_floor(e):"rand_mine_idx"==t?DataMgr.gameCtrl.cal_rand_mine_idx(e):"rand_mine_list"==t?DataMgr.gameCtrl.cal_rand_mine_list(e):"game_over"==t&&(DataMgr.gameCtrl.isGameComplete=!0)},POKER_DATA_TYPE=[1,2,3,4,5,6,7,8,9,17,18,19,20,21,22,23,24,25,33,34,35,36,37,38,39,40,41,49,50,51,52,65,66,67,81,82,83,84,97,98,99,100],POKER_DATA_MAP=arrayToMap(POKER_DATA_TYPE),LOGIC_MASK_COLOR=240,LOGIC_MASK_VALUE=15,LOGIC_COLOR_WAN=0,LOGIC_COLOR_TIAO=16,LOGIC_COLOR_TONG=32,LOGIC_COLOR_FENG=48,LOGIC_COLOR_JIANG=64,BAI_BANG=67,MJ_NULL=0,MJ_CHI=1,MJ_PENG=2,MJ_GANG=3,MJ_HU=4,MJ_BU_GANG=5,MJ_AN_GANG=6,MJ_EXTRA=7,MJ_FLOWER=4097,MJ_FLOWER_GANG=4098,MJ_MING=8193,MJ_DUI=36865,MJ_ZI_MO=1,MJ_QIANG_GANG=2,MJ_GANG_HU=3,MJ_KING_WAIT=4,MJ_GERMAN=5,MJ_GERMAN_GERMAN=6,MJ_TIAN=7,MJ_DI=8,MJ_HU_JI_HU=17,MJ_HU_QI_DUI=18,MJ_HU_THIRTEEN=19,MJ_HU_SERVEN=20,MJ_HU_GERMAN_SERVEN=21,MJ_HU_PENG_PENG=22,MJ_HU_CATCH_KING=257,MJ_HU_SINGLE_KING=258,MJ_HU_DOUBLE_KING=259,MJ_HU_THREE_KING=260,MJ_HU_FIRST_THREE_KING=261,MJ_HU_CAN_SINGLE_KIND=262,MJ_HU_CAN_DOUBLE_KIND=263,MJ_HU_CAN_THREE_KIND=264,MJ_HU_FLOWER_KING=265,MJ_HU_TIAN=289,MJ_HU_DOUBLE_REWARD=290,MJ_HU_ONE_FLOWER=291,MJ_HU_NO_FLOWER=292,MJ_HU_SPARROW_KING=294,MJ_HU_DRAGON_KING=295,MJ_HU_ONE_COLOR=296,MJ_HU_ONE_COLOR_ALL=297,MJ_HU_GANG_KING=298,MJ_HU_FOUR_KING=299,MJ_HU_SINGLE_WAIT=300,MJ_HU_FREE_KING=301,MJ_HU_HB_PI_HU=768,MJ_HU_HB_PENG_PENG=769,MJ_HU_HB_ONE_FLOWER=770,MJ_HU_HB_SEVEN_DUI=771,MJ_HU_HB_SEVEN_DUI_1=772,MJ_HU_HB_SEVEN_DUI_2=773,MJ_HU_HB_SEVEN_DUI_3=774,MJ_HU_HB_KA_5_STAR=775,MJ_HU_HB_XIAO_SAN_YUAN=776,MJ_HU_HB_BIG_SAN_YUAN=777,MJ_HU_HB_MING_SI_GUI_Q=784,MJ_HU_HB_AN_SI_GUI_Q=785,MJ_HU_HB_MING_SI_GUI_B=786,MJ_HU_HB_AN_SI_GUI_B=787,MJ_HU_HB_SHOU_ZHUA_YI=788,MJ_HU_HB_GANG_SHANG_PAO=789,MJ_HU_HB_GANG_KAI=790,MJ_HU_HB_MING_PAI=791,MJ_HU_HB_QIANG_GANG=792,MJ_HU_HB_HAI_DI_PAO=793,MJ_HU_HB_HAI_DI_LAO=800,MJ_HU_HB_ONE_PENGPENG=801,MJ_HU_HB_ONE_SEVEN_DUI=802,MJ_HU_HB_ONE_SEVEN_DUI_1=803,MJ_HU_HB_ONE_SEVEN_DUI_2=804,MJ_HU_HB_ONE_SEVEN_DUI_3=805,MJ_HU_HB_ONE_SHOU_ZHUA_YI=806,MJ_HU_HB_ONE_KA_5_STAR=807,MJ_HU_HB_ONE_MING_SI_GUI=808,MJ_HU_HB_ONE_AN_SI_GUI=809,MJ_HU_NAME_TABLE={},MJ_HU_NAME_TABLE[MJ_ZI_MO]="自摸",MJ_HU_NAME_TABLE[MJ_QIANG_GANG]="抢杠胡",MJ_HU_NAME_TABLE[MJ_GANG_HU]="杠上开花",MJ_HU_NAME_TABLE[MJ_KING_WAIT]="精吊",MJ_HU_NAME_TABLE[MJ_GERMAN]="德国",MJ_HU_NAME_TABLE[MJ_GERMAN_GERMAN]="德中德",MJ_HU_NAME_TABLE[MJ_TIAN]="天胡",MJ_HU_NAME_TABLE[MJ_DI]="地胡",MJ_HU_NAME_TABLE[MJ_HU_QI_DUI]="小七对",MJ_HU_NAME_TABLE[MJ_HU_THIRTEEN]="十三烂",MJ_HU_NAME_TABLE[MJ_HU_SERVEN]="七星十三烂",MJ_HU_NAME_TABLE[MJ_HU_GERMAN_SERVEN]="德国七星",MJ_HU_NAME_TABLE[MJ_HU_PENG_PENG]="大七对",MJ_HU_NAME_TABLE[MJ_HU_CATCH_KING]="抢金胡",MJ_HU_NAME_TABLE[MJ_HU_SINGLE_KING]="单游",MJ_HU_NAME_TABLE[MJ_HU_DOUBLE_KING]="双游",MJ_HU_NAME_TABLE[MJ_HU_THREE_KING]="三游",MJ_HU_NAME_TABLE[MJ_HU_FIRST_THREE_KING]="三金倒",MJ_HU_NAME_TABLE[MJ_HU_TIAN]="天胡",MJ_HU_NAME_TABLE[MJ_HU_DOUBLE_REWARD]="双奖",MJ_HU_NAME_TABLE[MJ_HU_ONE_FLOWER]="一张花",MJ_HU_NAME_TABLE[MJ_HU_NO_FLOWER]="无花无杠",MJ_HU_NAME_TABLE[MJ_HU_SPARROW_KING]="金雀",MJ_HU_NAME_TABLE[MJ_HU_DRAGON_KING]="金龙",MJ_HU_NAME_TABLE[MJ_HU_ONE_COLOR]="混一色",MJ_HU_NAME_TABLE[MJ_HU_ONE_COLOR_ALL]="清一色",MJ_HU_NAME_TABLE[MJ_HU_GANG_KING]="金杠",MJ_HU_NAME_TABLE[MJ_HU_FOUR_KING]="四金倒",MJ_HU_NAME_TABLE[MJ_HU_SINGLE_WAIT]="单钓",MJ_HU_NAME_TABLE[MJ_HU_FREE_KING]="闲金",MJ_HU_NAME_TABLE[MJ_HU_HB_PI_HU]="屁胡",MJ_HU_NAME_TABLE[MJ_HU_HB_PENG_PENG]="碰碰胡",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_FLOWER]="清一色",MJ_HU_NAME_TABLE[MJ_HU_HB_SEVEN_DUI]="7对",MJ_HU_NAME_TABLE[MJ_HU_HB_SEVEN_DUI_1]="豪华7对",MJ_HU_NAME_TABLE[MJ_HU_HB_SEVEN_DUI_2]="超豪华7对",MJ_HU_NAME_TABLE[MJ_HU_HB_SEVEN_DUI_3]="超超豪华7对",MJ_HU_NAME_TABLE[MJ_HU_HB_KA_5_STAR]="卡五星",MJ_HU_NAME_TABLE[MJ_HU_HB_XIAO_SAN_YUAN]="小三元",MJ_HU_NAME_TABLE[MJ_HU_HB_BIG_SAN_YUAN]="大三元",MJ_HU_NAME_TABLE[MJ_HU_HB_MING_SI_GUI_Q]="明四归",MJ_HU_NAME_TABLE[MJ_HU_HB_AN_SI_GUI_Q]="暗四归",MJ_HU_NAME_TABLE[MJ_HU_HB_MING_SI_GUI_B]="明四归",MJ_HU_NAME_TABLE[MJ_HU_HB_AN_SI_GUI_B]="暗四归",MJ_HU_NAME_TABLE[MJ_HU_HB_SHOU_ZHUA_YI]="手抓一",MJ_HU_NAME_TABLE[MJ_HU_HB_GANG_SHANG_PAO]="杠上炮",MJ_HU_NAME_TABLE[MJ_HU_HB_GANG_KAI]="杠开",MJ_HU_NAME_TABLE[MJ_HU_HB_MING_PAI]="明牌",MJ_HU_NAME_TABLE[MJ_HU_HB_QIANG_GANG]="抢杠",MJ_HU_NAME_TABLE[MJ_HU_HB_HAI_DI_PAO]="海底炮",MJ_HU_NAME_TABLE[MJ_HU_HB_HAI_DI_LAO]="海底捞",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_PENGPENG]="清一色碰碰胡",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_SEVEN_DUI]="清一色七对",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_SEVEN_DUI_1]="清一色豪华7对",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_SEVEN_DUI_2]="清一色超豪华7对",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_SEVEN_DUI_3]="清一色超超豪华7对",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_SHOU_ZHUA_YI]="清一色手抓一",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_KA_5_STAR]="清一色卡5星",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_MING_SI_GUI]="清一色明四归",MJ_HU_NAME_TABLE[MJ_HU_HB_ONE_AN_SI_GUI]="清一色暗四归",HB_HU_RATIOS={},HB_HU_RATIOS[MJ_HU_HB_PI_HU]=1,HB_HU_RATIOS[MJ_HU_HB_PENG_PENG]=2,HB_HU_RATIOS[MJ_HU_HB_ONE_FLOWER]=4,HB_HU_RATIOS[MJ_HU_HB_SEVEN_DUI]=4,HB_HU_RATIOS[MJ_HU_HB_SEVEN_DUI_1]=8,HB_HU_RATIOS[MJ_HU_HB_SEVEN_DUI_2]=32,HB_HU_RATIOS[MJ_HU_HB_SEVEN_DUI_3]=128,HB_HU_RATIOS[MJ_HU_HB_KA_5_STAR]=2,HB_HU_RATIOS[MJ_HU_HB_XIAO_SAN_YUAN]=4,HB_HU_RATIOS[MJ_HU_HB_BIG_SAN_YUAN]=8,HB_HU_RATIOS[MJ_HU_HB_MING_SI_GUI_Q]=2,HB_HU_RATIOS[MJ_HU_HB_AN_SI_GUI_Q]=4,HB_HU_RATIOS[MJ_HU_HB_MING_SI_GUI_B]=2,HB_HU_RATIOS[MJ_HU_HB_AN_SI_GUI_B]=4,HB_HU_RATIOS[MJ_HU_HB_SHOU_ZHUA_YI]=4,HB_HU_RATIOS[MJ_HU_HB_GANG_SHANG_PAO]=2,HB_HU_RATIOS[MJ_HU_HB_GANG_KAI]=2,HB_HU_RATIOS[MJ_HU_HB_MING_PAI]=2;HB_HU_RATIOS[MJ_HU_HB_QIANG_GANG]=2;HB_HU_RATIOS[MJ_HU_HB_HAI_DI_PAO]=2,HB_HU_RATIOS[MJ_HU_HB_HAI_DI_LAO]=2,HB_HU_RATIOS[MJ_HU_HB_ONE_PENGPENG]=8,HB_HU_RATIOS[MJ_HU_HB_ONE_SEVEN_DUI]=16,HB_HU_RATIOS[MJ_HU_HB_ONE_SEVEN_DUI_1]=32,HB_HU_RATIOS[MJ_HU_HB_ONE_SEVEN_DUI_2]=128,HB_HU_RATIOS[MJ_HU_HB_ONE_SEVEN_DUI_3]=512,HB_HU_RATIOS[MJ_HU_HB_ONE_SHOU_ZHUA_YI]=16,HB_HU_RATIOS[MJ_HU_HB_ONE_KA_5_STAR]=8,HB_HU_RATIOS[MJ_HU_HB_ONE_MING_SI_GUI]=8,HB_HU_RATIOS[MJ_HU_HB_ONE_AN_SI_GUI]=16,HB_HU_RATIOS[MJ_ZI_MO]=1,DO_BONUS_TYPE_NULL=0,DO_BONUS_TYPE_ZIMO=1,DO_BONUS_TYPE_MING=2,DO_BONUS_TYPE_ALL=2,MJ_KING_MAP={},MJ_KING_ARR=[],sort_card=sort_card_normal;var get_sub_poker_color=function(t,e){for(var i=[],a=0;a<t.length;a++)get_card_color(t[a])==16*e&&i.push(t[a]);return i},check_can_hu_by_map=function(t){var e=[],i=[];for(var a in t)i.push(parseInt(a));i.sort(sort_card);for(var s=0;s<i.length;s++){var a=i[s],r=t[a];if(!(r<=0)){if(4==r&&(t[a]=1,r=1,e.push({mj_action:MJ_PENG,poker_list:[a,a,a]})),3==r)t[a]=0,e.push({mj_action:MJ_PENG,poker_list:[a,a,a]});else{var n=DataMgr.gameCtrl.canEatList(parseInt(a));if(n.length>0)for(var o=0;o<n.length;o++){var c=n[o];if(!t[c[0]]||t[c[0]]<r)break;if(t[c[0]]-=r,!t[c[1]]||t[c[1]]<r){t[c[0]]+=r;break}if(t[c[1]]-=r,!t[c[2]]||t[c[2]]<r){t[c[0]]+=r,t[c[1]]+=r;break}t[c[2]]-=r;for(var l=0;l<r;l++)e.push({mj_action:MJ_CHI,poker_list:[c[0],c[1],c[2]]})}}if(t[a]>0)return null}}return e};TEST_POKER_CHANGE=function(t){t&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"poker_test",type:"poker_list_change",poker_list:t})},TEST_POKER_FRIST_POKER=function(t){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"poker_test",type:"remain_first_poker",poker_list:[t]})},TEST_POKER_LAST_POKER=function(t){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"poker_test",type:"remain_last_poker",poker_list:[t]})};var mjGame=mjGame||{};mjGame.Common={},mjGame.Common.CardType={NO:0,WAN_1:1,WAN_2:2,WAN_3:3,WAN_4:4,WAN_5:5,WAN_6:6,WAN_7:7,WAN_8:8,WAN_9:9,TIAO_1:11,TIAO_2:12,TIAO_3:13,TIAO_4:14,TIAO_5:15,TIAO_6:16,TIAO_7:17,TIAO_8:18,TIAO_9:19,TONG_1:21,TONG_2:22,TONG_3:23,TONG_4:24,TONG_5:25,TONG_6:26,TONG_7:27,TONG_8:28,TONG_9:29,FENG_1:31,FENG_2:32,FENG_3:33,FENG_4:34,JIAN_1:41,JIAN_2:42,JIAN_3:43,HUA_1:51,HUA_2:52,HUA_3:53,HUA_4:54,HUA_5:61,HUA_6:62,HUA_7:63,HUA_8:64,KING:100},mjGame.Common.PaiXing={NO:0,DUI:1,KANG:2,SHUN:3,GANG:4,CHI:5,PENG:6,GANG_MING:7,GANG_DIAN:8,GANG_AN:9},mjGame.Common.TingType={NO:0,SHISAN_YAO:1,ALL:2},mjGame.Common.Func={deepCopy:function(t){var e={};for(var i in t)e[i]="object"==typeof t[i]?this.deepCopy(t[i]):t[i];return e},copyData:function(t){var e={};return e.paixing=t.paixing,e.cardList=this.copyArray(t.cardList),t.kingList&&(e.kingList=this.copyArray(t.kingList)),e.leftKing=t.leftKing,e},copyArray:function(t){for(var e=[],i=0;i<t.length;i++){var a=t[i];"object"==typeof a?e[i]=this.copyArray(a):e[i]=a}return e},isDui:function(t){if(2!=t.length)return!1;var e=t[0],i=t[1];return e==i&&i<=mjGame.Common.CardType.JIAN_3},isShunzi:function(t){if(3!=t.length)return!1;t.sort(function(t,e){return t-e});var e=t[0],i=t[1],a=t[2];return!(e>mjGame.Common.CardType.TIAO_7&&e<=mjGame.Common.CardType.TIAO_9||e>mjGame.Common.CardType.WAN_7&&e<=mjGame.Common.CardType.WAN_9||e>mjGame.Common.CardType.TONG_7)&&(!(a<mjGame.Common.CardType.TIAO_3||a<mjGame.Common.CardType.WAN_3&&a>=mjGame.Common.CardType.WAN_1||a<mjGame.Common.CardType.TONG_3&&a>=mjGame.Common.CardType.TONG_1)&&(i-e==1&&a-i==1))},isSameInList:function(t,e){t.sort(function(t,e){return t-e}),e.sort(function(t,e){return t-e});for(var i=0;i<t.length;i++)if(t[i]!=e[i])return!1;return!0},isPeng:function(t){if(3!=t.length)return!1;for(var e=t[0],i=1;i<t.length;i++)if(t[i]!=e)return!1;return!0},isGang:function(t){if(4!=t.length)return!1;for(var e=t[0],i=1;i<t.length;i++)if(t[i]!=e)return!1;return!0},getPaiXing:function(t){if(!t||t.length<=0)return mjGame.Common.PaiXing.NO;var e=t.length;switch(e){case 2:if(this.isDui(t))return mjGame.Common.PaiXing.DUI;break;case 3:if(this.isPeng(t))return mjGame.Common.PaiXing.KANG;if(this.isShunzi(t))return mjGame.Common.PaiXing.SHUN;break;case 4:if(this.isGang(t))return mjGame.Common.PaiXing.GANG}return mjGame.Common.PaiXing.NO},getNearList:function(t){var e=[];return t==mjGame.Common.CardType.TIAO_1||t==mjGame.Common.CardType.WAN_1||t==mjGame.Common.CardType.TONG_1?e=[[t+1,t+2]]:t==mjGame.Common.CardType.TIAO_9||t==mjGame.Common.CardType.WAN_9||t==mjGame.Common.CardType.TONG_9?e=[[t-1,t-2]]:t==mjGame.Common.CardType.TIAO_2||t==mjGame.Common.CardType.WAN_2||t==mjGame.Common.CardType.TONG_2?e=[[t-1,t+1],[t+1,t+2]]:t==mjGame.Common.CardType.TIAO_8||t==mjGame.Common.CardType.WAN_8||t==mjGame.Common.CardType.TONG_8?e=[[t-2,t-1],[t-1,t+1]]:t>mjGame.Common.CardType.WAN_1&&t<mjGame.Common.CardType.TONG_9&&(e=[[t-2,t-1],[t-1,t+1],[t+1,t+2]]),e},haveHuList:function(t,e,i){var a=this.getNearList(t);a.push([t]),a.push([t,t]);for(var s=this.copyArray(a),r=0;r<e.length;r++){var n=e[r];a.forEach(function(t){t[0]==n&&n!=i?t[0]=-1:t[1]==n&&n!=i&&(t[1]=-1)})}var o=a[a.length-1],c=this.getCardNum(e,t);c>0?(o[0]=-1,o[1]=c>1?-1:t):(o[0]=t,o[1]=t);var l=[],_=this.getKingNum(e,i);if(a.forEach(function(t,e){if(t[0]==-1&&t[1]==-1)l.push(s[e]);else if(t[0]==-1&&void 0==t[1])l.push(s[e]);else if(_>1){if(void 0==t[1]){var i=s[e];i[3]=mjGame.Common.CardType.KING,l.push(s[e])}else if(t[0]!=-1&&t[1]!=-1){var i=s[e];i[3]=mjGame.Common.CardType.KING,i[4]=mjGame.Common.CardType.KING,l.push(i)}else if(t[0]&&t[1]==-1||t[1]&&t[0]==-1){var i=s[e];i[3]=t[0]!=-1?mjGame.Common.CardType.KING:void 0,i[4]=t[1]!=-1?mjGame.Common.CardType.KING:void 0,l.push(i)}}else if(1==_)if(void 0==t[1]){var i=s[e];i[3]=mjGame.Common.CardType.KING,l.push(i)}else if(t[0]&&t[1]==-1||t[1]&&t[0]==-1){var i=s[e];i[3]=t[0]!=-1?mjGame.Common.CardType.KING:void 0,i[4]=t[1]!=-1?mjGame.Common.CardType.KING:void 0,l.push(i)}}),c+_>=3){var n=[t,t,t];n[3]=c<1?mjGame.Common.CardType.KING:void 0,n[4]=c<2?mjGame.Common.CardType.KING:void 0,n[5]=c<3?mjGame.Common.CardType.KING:void 0,l.push(n)}return l.length>0&&l},removeFromList:function(t,e){for(var i=0,a=0;a<e.length;a++)for(var s=0;s<t.length;s++)if(e[a]==t[s]){t.splice(s,1),i++;break}return i==e.length},addList:function(t,e){for(var i=0;i<e.length;i++)t.push(e[i])},getCardNum:function(t,e){for(var i=0,a=0;a<t.length;a++)t[a]==e&&i++;return i},getLenNoKing:function(t,e){for(var i=0,a=0;a<t.length;a++)t[a]!=e&&i++;return i},getKingNum:function(t,e){for(var i=0,a=0;a<t.length;a++)t[a]==e&&i++;return i},getDuiNum:function(t){for(var e=0,i=0;i<t.length;i++){var a=t[i];a.paixing==mjGame.Common.PaiXing.DUI&&e++}return e},getHuList:function(t,e,i){var a=this.getLenNoKing(e,i),s=e.length-a;if(0==a&&s>1){for(var r=[];s>0;)r.push(mjGame.Common.CardType.KING),s--;var n=this.getPaiXing(e),o={paixing:n,cardList:r,kingList:r},c={};return c.data=o,[c]}if(e.length<=1)return!1;var l=e.shift(),_=[],u=this.haveHuList(l,e,i);if(!u)return!1;for(var h=0;h<u.length;h++){var g=u[h],d=this.copyArray(e),m=[g[0]],r=[g[0],l],f=[];void 0!=g[1]&&(m.push(g[1]),r.push(g[1])),void 0!=g[2]&&(m.push(g[2]),r.push(g[2])),g[3]&&(f.push(g[0]),m[0]=i),g[4]&&(f.push(g[1]),m[1]=i),g[5]&&(f.push(g[2]),m[2]=i);var c={};this.removeFromList(d,m);var n=this.getPaiXing(r),o={paixing:n,cardList:r};o.kingList=f.length>0?f:void 0;var a=this.getLenNoKing(d,i);if(a<=0)c.data=o,_.push(c),o.leftKing=d.length-a;else{var p=this.getHuList(t,d,i);p&&(c.data=o,c.nextList=p,_.push(c))}}return _.length>0&&_},getAllHuList:function(t,e,i){if(!t)return!1;for(var a=[],s=0;s<e.length;s++)a.push(e[s]);for(var r=0;r<t.length;r++){var n=t[r];if(0!=r){for(var o=[],s=0;s<a.length;s++)o.push(a[s]);o.push(n.data),this.getAllHuList(n.nextList,o,i),i.push(o)}else e.push(n.data),this.getAllHuList(n.nextList,e,i)}},specialKing:function(t,e,i,a){var s=[mjGame.Common.CardType.TIAO_1,mjGame.Common.CardType.WAN_1,mjGame.Common.CardType.TONG_1];a&&s.push(mjGame.Common.CardType.FENG_1);for(var r=0;r<s.length;r++){for(var n=s[r],o=t.cardList.length,c=[];o>0;)c.push(n),o--;var l=this.getPaiXing(c),_={cardList:c,paixing:l,kingList:t.kingList,tingType:mjGame.Common.TingType.ALL},u=[];this.addList(u,e),u.push(_);var h=this.getDuiNum(u);h==this._maxDui&&i.push(u)}},changeToLockList:function(t,e,i,a,s){for(var r=[],n=0;n<e.length;n++){var o=e[n],c=0,l=[],_=0,u=[];this.addList(u,i);for(var h=null,g=0;g<o.length;g++){var d=o[g];if(u.push(d),d.paixing==mjGame.Common.PaiXing.DUI&&c++,d.kingList){var m=this.copyData(d);m.kingList.sort(function(t,e){return t-e}),l.push(m),d.kingList[0]==mjGame.Common.CardType.KING&&(h=d,u.pop())}d.leftKing&&(_=d.leftKing)}if(_>1&&t.card==a||h){var f={};if(h)f=h;else{for(var p=[];_>0;)p.push(mjGame.Common.CardType.KING),_--;var M=this.getPaiXing(p);f={cardList:p,paixing:M,kingList:p}}this.specialKing(f,u,r,s)}else _>0&&c<=this._maxDui||(c!=this._maxDui?(e.splice(n,1),n--):r.push(u))}return r},_sortCardLast:function(t,e){e.sort(function(e,i){var a=e==t?mjGame.Common.CardType.KING:e,s=i==t?mjGame.Common.CardType.KING:i;return a-s})},_maxDui:1,isCanHu:function(t,e,i,a,s,r,n){var o=this.copyArray(e),c=i;if(this._maxDui=void 0==n?1:n,s||o.push(t.card),this._sortCardLast(a,o),o.length<=1)return!1;var l=this.getHuList(t,o,a);if(!l)return!1;var _=[],u=[];_.push(u),this.getAllHuList(l,u,_);var h=this.changeToLockList(t,_,c,a,r);return h.length>0&&h},is7Dui:function(t,e,i,a){var s=this.copyArray(i);if(e||s.push(t.card),this._sortCardLast(a,s),14!=s.length)return!1;for(var r=[],n=0,o=0;o<s.length;o++){var c=s[o];c!=a&&(r[c]?r[c]=r[c]+1:(n++,r[c]=1))}if(n>7)return!1;for(var l=[],_=[],o=0;o<r.length;o++){var u=r[o];if(u&&u>=2){var h={cardList:[o,o],paixing:mjGame.Common.PaiXing.DUI};if(l.push(h),u-=2,1==u)_.push(o);else if(2==u){var h={cardList:[o,o],paixing:mjGame.Common.PaiXing.DUI};l.push(h)}}else u&&_.push(o)}var g=this.getKingNum(s,a);if(_.length>g)return!1;for(var o=0;o<_.length;o++){var c=_[o],h={cardList:[c,c],paixing:mjGame.Common.PaiXing.DUI,kingList:[c]};l.push(h),g--}return g>0?this.getSpecial7Dui(l,g,r):[l]},getSpecial7Dui:function(t,e,i){for(var a=[],s=[],r=0;r<t.length;r++){var n=t[r],o=n.cardList[0];a.push(o)}if(4==e){var c=a[0],l=a[a.length-1],_={cardList:[c,c],paixing:mjGame.Common.PaiXing.DUI,kingList:[c,c],tingType:mjGame.Common.TingType.ALL},u={cardList:[l,l],paixing:mjGame.Common.PaiXing.DUI,kingList:[l,l],tingType:mjGame.Common.TingType.ALL};return t.push(_),t.push(u),[t]}for(var r=0;r<a.length;r++){var o=a[r];if(4!=i[o]&&i[o]){var h={cardList:[o,o],paixing:mjGame.Common.PaiXing.DUI,kingList:[o,o],tingType:mjGame.Common.TingType.ALL};t.push(h),s.push(t)}}return s},isBig7Dui:function(t,e,i,a){var s=this.copyArray(i);if(e||s.push(t.card),this._sortCardLast(a,s),17!=s.length)return!1;for(var r=[],n=0,o=0;o<s.length;o++){var c=s[o];c!=a&&(r[c]?r[c]=r[c]+1:(n++,r[c]=1))}if(n>8)return!1;for(var l=[],_=[],u=[],o=0;o<r.length;o++){var h=r[o];if(h&&h>=2){var g={cardList:[o,o],paixing:mjGame.Common.PaiXing.DUI};if(l.push(g),h-=2,1==h)_.push(o);else if(2==h){var g={cardList:[o,o],paixing:mjGame.Common.PaiXing.DUI};l.push(g)}}else h&&u.push(o)}var d=this.getKingNum(s,a);if(u.length>d)return!1;if(_.length>d-u.length+1)return!1;for(var o=0;o<u.length;o++){var c=u[o],g={cardList:[c,c],paixing:mjGame.Common.PaiXing.DUI,kingList:[c]};l.push(g),d--}var m=[];if(_.length>0){d-=_.length-1;for(var o=0;o<_.length;o++){for(var f=_[o],p=[],M=0;M<l.length;M++)p.push(l[M]);for(var C=0;C<_.length;C++)if(o!=C){var c=_[C],g={cardList:[c,c],paixing:mjGame.Common.PaiXing.DUI,kingList:[c]};p.push(g)}for(var D=[],b=0;b<p.length;b++)if(p[b].cardList[0]==f){var g={cardList:[f,f,f],paixing:mjGame.Common.PaiXing.KANG};D.unshift(g)}else D.push(p[b]);m.push(D)}}else for(var o=0;o<l.length;o++){for(var y=[],M=0;M<l.length;M++)y.push(l[M]);for(var b=0;b<l.length;b++){if(o==b){var c=l[b].cardList[0],g={cardList:[c,c,c],paixing:mjGame.Common.PaiXing.KANG};y.unshift(g)}else y.push(l[b]);m.push(y)}}return d>0?this.getSpecialBig7Dui(m[0],d,r):m},getSpecialBig7Dui:function(t,e,i){for(var a=[],s=[],r=!1,n=0;n<t.length;n++){var o=t[n],c=o.cardList[0];a.push(c),o.paixing==mjGame.Common.PaiXing.KANG&&(r=!0)}if(4==e){var l=a[1],_=a[a.length-1],u={cardList:[l,l],paixing:mjGame.Common.PaiXing.DUI,kingList:[l,l],tingType:mjGame.Common.TingType.ALL},h={cardList:[_,_],paixing:mjGame.Common.PaiXing.DUI,kingList:[_,_],tingType:mjGame.Common.TingType.ALL};return t.push(u),t.push(h),[t]}for(var n=1;n<a.length;n++){var c=a[n];if(4!=i[c]&&i[c]){var g={cardList:[c,c],paixing:mjGame.Common.PaiXing.DUI,kingList:[c,c],tingType:mjGame.Common.TingType.ALL};t.push(g),s.push(t)}}return s},is13Yao:function(t,e,i,a){var s=this.copyArray(i);if(e||s.push(t.card),this._sortCardLast(a,s),14!=s.length)return!1;for(var r=[mjGame.Common.CardType.TIAO_1,mjGame.Common.CardType.TIAO_9,mjGame.Common.CardType.WAN_1,mjGame.Common.CardType.WAN_9,mjGame.Common.CardType.TONG_1,mjGame.Common.CardType.TONG_9,mjGame.Common.CardType.FENG_1,mjGame.Common.CardType.FENG_2,mjGame.Common.CardType.FENG_3,mjGame.Common.CardType.FENG_4,mjGame.Common.CardType.JIAN_1,mjGame.Common.CardType.JIAN_2,mjGame.Common.CardType.JIAN_3],n=[],o=[],c=0;c<r.length;c++){for(var l=r[c],_=!1,u=0;u<s.length;u++)if(s[u]==l){s.splice(u,1),o.push(l),_=!0;break}_||n.push(l)}var h=this.getCardNum(s,a),g=this.getLenNoKing(s,a);return!(n.length>h)&&(!(0!=g&&!this.allIs13Yao(s,a))&&this.changePaiXingTo13Yao(o,n,s,a))},allIs13Yao:function(t,e){for(var i=[],a=0;a<t.length;a++){var s=t[a];s!=e&&i.push(s)}for(var a=0;a<i.length;a++){var s=i[a];if(s>mjGame.Common.CardType.TIAO_1&&s<mjGame.Common.CardType.TIAO_9||s>mjGame.Common.CardType.WAN_1&&s<mjGame.Common.CardType.WAN_9||s>mjGame.Common.CardType.TONG_1&&s<mjGame.Common.CardType.TONG_9||s>mjGame.Common.CardType.JIAN_3)return!1}return!0},changePaiXingTo13Yao:function(t,e,i,a){for(var s=[],r=0;r<t.length;r++){var n=t[r],o={cardList:[n],paixing:mjGame.Common.PaiXing.NO};s.push(o)}for(var c=this.getKingNum(i,a),r=0;r<e.length;r++){var n=e[r],o={cardList:[n],paixing:mjGame.Common.PaiXing.NO,kingList:[n]};s.push(o),c--}if(0==c){for(var n=mjGame.Common.CardType.WAN_1,r=0;r<i.length&&(n=i[r],n==a);r++);var o={cardList:[n],paixing:mjGame.Common.PaiXing.NO};s.push(o)}else{var n=mjGame.Common.CardType.WAN_1,o={cardList:[n],paixing:mjGame.Common.PaiXing.NO,kingList:[n],tingType:mjGame.Common.TingType.SHISAN_YAO};s.push(o)}return[s]},paixingToWord:function(t){(!t||t.length<1)&&cc.log("没有胡的牌型");for(var e=0;e<t.length;e++){var i=t[e];
cc.log("牌型:"+(e+1));var a="",s=this;i.forEach(function(t){a+=s.paiXingDataToWord(t)}),cc.log(a)}},paiXingDataToWord:function(t){var e="";return e+=_mjPaiXingWord[t.paixing]+this.getCardListName(t.cardList,t.kingList)+"\n"},getCardListName:function(t,e){for(var i=" :",a=0;a<t.length;a++)i+=_mjWord[t[a]]+" ";if(e){i+=", ";for(var a=0;a<e.length;a++)i+="王->"+_mjWord[e[a]]+" "}return i},getPaiTingList:function(t,e){var i=[],a=!1;if(t&&t.length>0)for(var s=0;s<t.length;s++)for(var r=t[s],n=0;n<r.length;n++){var o=r[n].kingList;if(o&&o.length>0)for(var c=0;c<o.length;c++)100==o[c]||o[c]==e?a=!0:i.push(o[c])}return(a||i.length>0)&&e>0&&e<50&&i.push(e),i=unique(i)},removeOneItemList:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(t[a]);for(var a=0;a<i.length;a++)if(e&&i[a]==e){i.splice(a,1);break}return i},existTingListDrop:function(t,e){for(var i=0;i<t.length;i++)if(t[i].dropCard==e)return!0;return!1},getCheckMjList:function(t,e){for(var i=[],a=mjGame.Common.CardType.TIAO_1;a<=mjGame.Common.CardType.TIAO_9;a++)i.push(a);for(var a=mjGame.Common.CardType.WAN_1;a<=mjGame.Common.CardType.WAN_9;a++)i.push(a);for(var a=mjGame.Common.CardType.TONG_1;a<=mjGame.Common.CardType.TONG_9;a++)i.push(a);if(t){for(var a=mjGame.Common.CardType.FENG_1;a<=mjGame.Common.CardType.FENG_4;a++)i.push(a);for(var a=mjGame.Common.CardType.JIAN_1;a<=mjGame.Common.CardType.JIAN_3;a++)i.push(a)}else for(var a=0;a<e.length;a++)i.push(e[a]);return i},isKingJiang:function(t,e,i,a){if(0==i)return!1;for(var s=!1,r=0;r<t.length;r++)t[r]==i&&(s=!0);if(1==t.length&&s)return cc.log("手牌只有一张牌且是赖子"),!0;var n=this.removeOneItemList(this.copyArray(t),i),o=this.isCanHu({card:0},n,e,i,!0,a,0);return!!o},isKingJiangTing:function(t,e,i,a,s){var r=this.isKingJiang(t,e,i,a);return!!r&&this.getCheckMjList(a,s)},isKing7DuiTing:function(t,e,i,a){var s=this.copyArray(t);s.push(99);var r=mjGame.Common.Func.is7Dui({card:0},!0,s,e);return!!r&&this.getCheckMjList(i,a)},isKingBig7DuiTing:function(t,e,i,a){var s=this.copyArray(t);s.push(99);var r=mjGame.Common.Func.isBig7Dui({card:0},!0,s,e);return!!r&&this.getCheckMjList(i,a)},isCanTing:function(t,e,i,a,s,r){var n=[],o=i;if(r){var c={};c.tingCards=[],c.dropCard=0;var l=this.copyArray(t);0==i&&(i=100);var _={card:i},u=this.isCanHu(_,l,e,i,!1,a,1),h=this.getPaiTingList(u,i),g=this.isKingJiangTing(l,e,o,a,s);g&&(h=g),c.tingCards=h,c.tingCards.length>0&&n.push(c)}else for(var d=unique(t),m=0;m<d.length;m++){var f={};f.tingCards=[],f.dropCard=d[m];var p=this.removeOneItemList(this.copyArray(t),f.dropCard);0==i&&(i=100);var M={card:i},C=this.isCanHu(M,p,e,i,!1,a,1),D=this.getPaiTingList(C,i),b=this.isKingJiangTing(p,e,o,a,s);b&&(D=b),f.tingCards=D,f.tingCards.length>0&&n.push(f)}return n.length>0&&n},is7DuiTing:function(t,e,i,a,s,r){var n=[],o=i;if(r){var c={};c.tingCards=[],c.dropCard=0;var l=this.copyArray(t);0==i&&(i=100);var _={card:i},u=this.is7Dui(_,!1,l,i),h=this.getPaiTingList(u,i),g=this.isKing7DuiTing(l,o,a,s);g&&(h=g),c.tingCards=h,c.tingCards.length>0&&n.push(c)}else for(var d=unique(t),m=0;m<d.length;m++){var f={};f.tingCards=[],f.dropCard=d[m];var p=this.removeOneItemList(this.copyArray(t),f.dropCard);0==i&&(i=100);var M={card:i},C=this.is7Dui(M,!1,p,i),D=this.getPaiTingList(C,i),b=this.isKing7DuiTing(p,o,a,s);b&&(D=b),f.tingCards=D,f.tingCards.length>0&&n.push(f)}return n.length>0&&n},isBig7DuiTing:function(t,e,i,a,s,r){var n=[],o=i;if(r){var c={};c.tingCards=[],c.dropCard=0;var l=this.copyArray(t);0==i&&(i=100);var _={card:i},u=this.isBig7Dui(_,!1,l,i),h=this.getPaiTingList(u,i),g=this.isKingBig7DuiTing(l,o,a,s);g&&(h=g),c.tingCards=h,c.tingCards.length>0&&n.push(c)}else for(var d=unique(t),m=0;m<d.length;m++){var f={};f.tingCards=[],f.dropCard=d[m];var p=this.removeOneItemList(this.copyArray(t),f.dropCard);0==i&&(i=100);var M={card:i},C=this.isBig7Dui(M,!1,p,i),D=this.getPaiTingList(C,i);C&&(cc.log("dropCard==========",f.dropCard),cc.log("paiList",C),cc.log("tingCards",D));var b=this.isKingBig7DuiTing(p,o,a,s);b&&(D=b),f.tingCards=D,f.tingCards.length>0&&n.push(f)}return n.length>0&&n},test:function(){var t=([{cardList:[29,29,29],paixing:mjGame.Common.PaiXing.PENG}],28),e=[5,5,5,6,6,8,8,13,13,15,15,19,19,19,23,23,7],i=mjGame.Common.Func.isBig7DuiTing(e,[],t,!1,[],!1);cc.log("=tingList==",i)}},_mjWord=["无","一万","两万","三万","四万","五万","六万","七万","八万","九万","","一条","二条","三条","四条","五条","六条","七条","八条","九条","","一筒","两筒","三筒","四筒","五筒","六筒","七筒","八筒","九筒","","东","南","西","北"],_mjWord[mjGame.Common.CardType.JIAN_1]="中",_mjWord[mjGame.Common.CardType.JIAN_2]="发",_mjWord[mjGame.Common.CardType.JIAN_3]="白",_mjPaiXingWord=["没有牌型","对子","砍","顺子","杠","吃","碰","明杠","点杠","暗杠"],"undefined"==typeof DataMgr&&(DataMgr={}),DataMgr.accountCtrl||(DataMgr.accountCtrl=new AccountCtrl),DataMgr.timeCtrl=new TimeCtrl,DataMgr.recordCtrl=new RecordCtrl,DataMgr.activityCtrl=new ActivityCtrl,DataMgr.clubCtrl=new ClubCtrl,DataMgr.propCtrl=new PropCtrl;var remote_ip_info=remote_ip_info||{city:""};DataMgr.clearData=function(){this.accountCtrl&&this.accountCtrl.clearData(),this.gameCtrl&&this.gameCtrl.clearData()},DataMgr.locationData=null,DataMgr.getLocation=function(t){if(DataMgr.locationData)return void(t&&t());DataMgr.locationData={latitude:-1,longitude:0};var e=function(e){DataMgr.locationData=e,t&&t()};platform.getLocation(e)},DataMgr.setGameType=function(){var t=getQueryString("game_type");console.log("game_type = ",t),GetGameType(t)&&(GAME_TYPE=t),DataMgr.calGameType&&DataMgr.calGameType()},DataMgr.calGameType=function(){},DataMgr.getCityCallback=function(t){return void t(remote_ip_info.city)},ModuleMgr.enterGameScene=function(t){var e={all_effect_xml:"res/fla/all_effect_mj.xml",all_effect_png:"res/fla/all_effect_mj.png",all_effect_plist:"res/fla/all_effect_mj.plist",all_effect_bq_xml:"res/fla/all_effect_bq.xml",all_effect_bq_png:"res/fla/all_effect_bq.png",all_effect_bq_plist:"res/fla/all_effect_bq.plist",all_effect_mjks_xml:"res/fla/all_effect_mjks.xml",all_effect_mjks_png:"res/fla/all_effect_mjks.png",all_effect_mjks_plist:"res/fla/all_effect_mjks.plist",shuzi_jia:"res/uires/game/shuzi_jia.png",shuzi_jian:"res/uires/game/shuzi_jian.png",game_add:"res/uires/game/add.png",game_reduce:"res/uires/game/reduce.png",pocker_png:"res/plist/pocker.png",pocker_plist:"res/plist/pocker.plist",face_png:"res/plist/face.png",face_plist:"res/plist/face.plist",item_png:"res/plist/item.png",item_plist:"res/plist/item.plist",game_bg1:"res/uires/game/desk/icon_bg.png"},i=DataMgr.gameCtrl.getBgId(),a="res/uires/game/desk/bg.png";if(1==i||2==i){var s="res/uires/game/desk/bg_"+i+".png";RegisterReplacePathMap(a,s),a=s}e.game_bg=a;var r=[];for(var n in e)r.push(GetRealPath(e[n]));cc.log("start loading"),NetMsg.isPushStack=!0,cc.loader.load(r,function(t,e,i){ModuleMgr.showWaitMsg("努力加载中"+parseInt(100*i/e)+"%",0,null,!0)},function(){cc.log("end loading"),ModuleMgr.removeWaitMsg(),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/face.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/item.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/pocker.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/game_txt.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("fla/all_effect_mj.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("fla/all_effect_bq.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("fla/all_effect_mjks.plist")),ccs.armatureDataManager.addArmatureFileInfo(UIDataUtils.CalcUIPath("fla/all_effect_mj.xml")),ccs.armatureDataManager.addArmatureFileInfo(UIDataUtils.CalcUIPath("fla/all_effect_bq.xml")),ccs.armatureDataManager.addArmatureFileInfo(UIDataUtils.CalcUIPath("fla/all_effect_mjks.xml")),ModuleMgr.runScene("GameScene",t),NetMsg.dealStackMsg()})},ModuleMgr.enterEnterScene=function(t){var e={all_effect_main_xml:"res/fla/all_effect_main.xml",all_effect_main_png:"res/fla/all_effect_main.png",all_effect_main_plist:"res/fla/all_effect_main.plist",face_png:"res/plist/face.png",face_plist:"res/plist/face.plist",item_png:"res/plist/item.png",item_plist:"res/plist/item.plist"},i=[];for(var a in e)i.push(GetRealPath(e[a]));cc.loader.load(i,function(e,i,a){t||ModuleMgr.showWaitMsg("努力加载中"+parseInt(100*a/i)+"%",0,null,!0)},function(){cc.log("end loading"),ModuleMgr.removeWaitMsg(),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("fla/all_effect_main.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/face.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/item.plist")),ccs.armatureDataManager.addArmatureFileInfo(UIDataUtils.CalcUIPath("fla/all_effect_main.xml")),ModuleMgr.runScene("EnterScene")})},ModuleMgr.showRecordDetailDlg=function(t){if(t){var e={};e.deskId=t.desk_no,e.round=t.full_round,e.createTime=t.create_time,e.all_cost_time=t.all_cost_time||0;var i=DataMgr.recordCtrl.getOwnerInfo(t);i&&(e.ownerName=i.name),e.ownerRid=t.desk_own_rid,e.dlgType=1,e.recordId=t.rid,e.players=[];var a=ConvertToJson(t.record_detail);e.deskScoreType=a.desk_score_type;var s=a.score,r=a.mj_count_list||[],n=(a.cur_base_score,a.users);e.replayRecords=a.replay_records;for(var o=0;o<n.length;o++){var c=o+1,l=n[o];if(l.rid){var _={headUrl:l.headimgurl,baseScore:0,score:s["idx"+c],name:l.name,rid:l.rid,accountUid:l.account_uid,mjCountData:r[o]};e.players.push(_)}}ModuleMgr.runDlg("NewClubRecordDetailDlg",e,null,null)}},ModuleMgr.getDlg=function(t){return"GameLayer"==t&&(t=GAME_LAYER_NAME),g_dlgLayer.getChildByName(t)},ModuleMgr.isLandscape=function(){return SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE||designOrientation==SCREEN_ORIENTATION_LANDSCAPE},ModuleMgr.runOrientationDlg=function(){var t=arguments[0];arguments[0]=t,ModuleMgr.runDlg.apply(this,arguments)},ModuleMgr.closeOrientationDlg=function(t){ModuleMgr.closeDlg(t)},GameKing1=QPLayer.extend({uiPath:"ui/GameKing1.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},initData:function(){this._num=0},onLoaded:function(){},setData:function(t){t=t||[],this.item_card1&&this.item_card1.setData(t[0]),this.item_card2&&this.item_card2.setData(t[1])}}),GameKing1.create=function(t,e,i){return new GameKing1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameKing1.ui",GameKing1),GameKing2=QPLayer.extend({uiPath:"ui/GameKing2.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},initData:function(){this._num=0},onLoaded:function(){},setData:function(t){t=t||[],this.grp_1.setVisible(!1),this.grp_2.setVisible(!1),1==t.length?(this.grp_1.setVisible(!0),this.item_card_1_1.setData(t[0])):2==t.length&&(this.grp_2.setVisible(!0),this.item_card_2_1.setData(t[0]),this.item_card_2_2.setData(t[1]))}}),GameKing2.create=function(t,e,i){return new GameKing2(t,e,i)},UIUtils.RegisterPathTemple("ui/GameKing2.ui",GameKing2),GameClock=QPLayer.extend({uiPath:"ui/GameClock.ui",passTime:0,time:0,callback:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.clear();for(var t=1;t<=4;t++){var e=this["clock_"+t];if(e){var i=ccs.Armature.create("turn_time");i.getAnimation().play("stand",-1,1),i.setAnchorPoint(.5,.5),1==t?(i.setRotation(180),i.setPositionX(55),i.setPositionY(80)):2==t?(i.setRotation(90),i.setPositionX(25),i.setPositionY(55)):3==t?(i.setRotation(-90),i.setPositionX(80),i.setPositionY(55)):4==t&&(i.setPositionX(55),i.setPositionY(25)),e.addChild(i)}}},stop:function(){this.unscheduleUpdate(),this.passTime=0},clear:function(){for(var t=1;t<=4;t++)this["clock_"+t]&&this["clock_"+t].setVisible(!1);this.callback=null,this.unscheduleUpdate()},turn:function(t,e){this.clear(),this["clock_"+t]&&this["clock_"+t].setVisible(!0)}}),GameClock.create=function(t,e,i){return new GameClock(t,e,i)},UIUtils.RegisterPathTemple("ui/GameClock.ui",GameClock),GameShaizi=QPLayer.extend({uiPath:"ui/GameShaizi.ui",calBack:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},show:function(t,e,i){t&&e&&(this.calBack=i,this.shaizi_1.loadTexture("res/uires/game/shaizi/shaizi_"+t+".png"),this.shaizi_2.loadTexture("res/uires/game/shaizi/shaizi_"+e+".png"),this.shaizi_1.setVisible(!1),this.shaizi_2.setVisible(!1),this.ani_efc.setVisible(!0),this.ani_efc.getAnimation().play("stand",-1,-1),this.ani_efc.getAnimation().setMovementEventCallFunc(this.animationEvent,this),playEffect("shaizi.mp3"))},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete&&(this.ani_efc.setVisible(!1),this.shaizi_1.setVisible(!0),this.shaizi_2.setVisible(!0),this.calBack&&this.calBack())}}),GameShaizi.create=function(t,e,i){return new GameShaizi(t,e,i)},UIUtils.RegisterPathTemple("ui/GameShaizi.ui",GameShaizi),GameLieCardBase=QPLayer.extend({uiPath:"ui/GameLieCardBase.ui",_num:0,data:null,_ckeckKingEnable:!0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.img_king&&this.img_king.setVisible(!1),this.img_select&&this.img_select.setVisible(!1),this.img_kou&&this.img_kou.setVisible(!1);var t=cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0;this.setCardBg(t)},setCardBg:function(t){var e=GetRealPath("res/uires/game/maj/down_s/disablelying.png"),i=GetRealPath("res/uires/game/maj/down_s/lying.png"),a=GetRealPath("res/uires/game/maj/down_s/lyingjing.png"),s=GetRealPath("res/uires/game/maj/down_s/back.png"),r=GetRealPath("res/uires/game/maj/down_s/lyingjing1.png");1!=t&&2!=t||(e=GetRealPath("res/uires/game/maj/down_s_"+t+"/disablelying.png"),i=GetRealPath("res/uires/game/maj/down_s_"+t+"/lying.png"),a=GetRealPath("res/uires/game/maj/down_s_"+t+"/lyingjing.png"),s=GetRealPath("res/uires/game/maj/down_s_"+t+"/back.png"),r=GetRealPath("res/uires/game/maj/down_s_"+t+"/lyingjing1.png")),this.img_disable&&this.img_disable.loadTexture(e),this.img_normal&&this.img_normal.loadTexture(i),this.img_select&&this.img_select.loadTexture(a),this.img_bg&&this.img_bg.loadTexture(s),this.img_normal_king&&this.img_normal_king.loadTexture(r)},getNum:function(){return this._num},setCkeckKingEnable:function(t){this._ckeckKingEnable=t},checkBack:function(t){t=!!t,this.grp_front.setVisible(!t),this.grp_back.setVisible(t)},checkSelect:function(t){var e=t==this._num;this.img_select&&this.img_select.setVisible(e),e?(this.img_normal&&this.img_normal.setVisible(!e),this.img_normal_king&&this.img_normal_king.setVisible(e)):this.checkKing(MJ_KING_ARR)},checkKing:function(t){var e=!1;if(this._ckeckKingEnable)for(var i=0;i<t.length;i++)if(this._num==t[i]){e=!0;break}this.img_normal_king&&this.img_normal_king.setVisible(e),this.img_normal&&this.img_normal.setVisible(!e)},setCard:function(t){var e=cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0;this.setCardBg(e),t=parseInt(t),this._num=t,!t||t<=0||!POKER_DATA_MAP[t]||POKER_DATA_MAP[t]<=0?this.setVisible(!1):(this.setVisible(!0),t>80&&t<96||t>96&&t<112||this.img_card.loadTexture("pokers/down/"+(t+16)+".png",ccui.Widget.PLIST_TEXTURE)),this.img_select&&this.img_select.setVisible(!1),this.img_normal&&this.img_normal.setVisible(!0),this.img_disable&&this.img_disable.setVisible(!1),this.checkKing(MJ_KING_ARR)},setDisable:function(){this.img_normal&&this.img_normal.setVisible(!1),this.img_normal_king&&this.img_normal_king.setVisible(!1),this.img_disable&&this.img_disable.setVisible(!0)},showKou:function(){this.img_kou&&this.img_kou.setVisible(!0)},hideKou:function(){this.img_kou&&this.img_kou.setVisible(!1)},getData:function(){return this.data},setData:function(t,e){var i=0;this.data=null,"object"==typeof t?(this.data=t,i=t.num||0):i=t,this.setCard(i),this.checkBack(e),this.checkKing(DataMgr.gameCtrl.randPokerList),this.hideKou()},putAction:function(){for(var t=["img_disable","img_normal_king","img_normal","img_select","img_card","img_king","img_kou","img_bg"],e=0;e<t.length;e++){var i=t[e],a=this[i];a&&(a.setOpacity(100),a.runAction(cc.FadeIn.create(.3)))}}}),GameLieCardBase.create=function(t,e,i){return new GameLieCardBase(t,e,i)},UIUtils.RegisterPathTemple("ui/GameLieCardBase.ui",GameLieCardBase),GameLieCardBase1=GameLieCardBase.extend({uiPath:"ui/GameLieCardBase1.ui",ctor:function(t,e,i){t=t||this.uiPath,GameLieCardBase.prototype.ctor.call(this,this.uiPath,e,i)},setCardBg:function(t){var e=GetRealPath("res/uires/game/maj/left_s/disablelying.png"),i=GetRealPath("res/uires/game/maj/left_s/lying.png"),a=GetRealPath("res/uires/game/maj/left_s/lyingjing.png"),s=GetRealPath("res/uires/game/maj/left_s/back.png"),r=GetRealPath("res/uires/game/maj/left_s/lyingjing1.png");1!=t&&2!=t||(e=GetRealPath("res/uires/game/maj/left_s_"+t+"/disablelying.png"),i=GetRealPath("res/uires/game/maj/left_s_"+t+"/lying.png"),a=GetRealPath("res/uires/game/maj/left_s_"+t+"/lyingjing.png"),s=GetRealPath("res/uires/game/maj/left_s_"+t+"/back.png"),r=GetRealPath("res/uires/game/maj/left_s_"+t+"/lyingjing1.png")),this.img_disable&&this.img_disable.loadTexture(e),this.img_normal&&this.img_normal.loadTexture(i),this.img_select&&this.img_select.loadTexture(a),this.img_bg&&this.img_bg.loadTexture(s),this.img_normal_king&&this.img_normal_king.loadTexture(r)},setCard:function(t){var e=cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0;this.setCardBg(e),this._num=t,!t||t<=0||!POKER_DATA_MAP[t]||POKER_DATA_MAP[t]<=0?this.setVisible(!1):(this.setVisible(!0),this.img_card.loadTexture("pokers/left/"+(t+16)+".png",ccui.Widget.PLIST_TEXTURE)),this.img_select.setVisible(!1),this.img_normal.setVisible(!0),this.checkKing(MJ_KING_ARR)},setRotation:function(t){180==t&&this.img_card&&this.img_card.setRotation(180)}}),GameLieCardBase1.create=function(t,e,i){return new GameLieCardBase1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameLieCardBase1.ui",GameLieCardBase1),GameLieCardBase2=GameLieCardBase.extend({uiPath:"ui/GameLieCardBase2.ui",ctor:function(t,e,i){t=t||this.uiPath,GameLieCardBase.prototype.ctor.call(this,this.uiPath,e,i)},setCardBg:function(t){var e=GetRealPath("res/uires/game/maj/down/disablelying.png"),i=GetRealPath("res/uires/game/maj/down/lying.png"),a=GetRealPath("res/uires/game/maj/down/lyingjing.png"),s=GetRealPath("res/uires/game/maj/down/back.png"),r=GetRealPath("res/uires/game/maj/down/lyingjing1.png");1!=t&&2!=t||(e=GetRealPath("res/uires/game/maj/down_"+t+"/disablelying.png"),i=GetRealPath("res/uires/game/maj/down_"+t+"/lying.png"),a=GetRealPath("res/uires/game/maj/down_"+t+"/lyingjing.png"),s=GetRealPath("res/uires/game/maj/down_"+t+"/back.png"),r=GetRealPath("res/uires/game/maj/down_"+t+"/lyingjing1.png")),this.img_disable&&this.img_disable.loadTexture(e),this.img_normal&&this.img_normal.loadTexture(i),this.img_select&&this.img_select.loadTexture(a),this.img_bg&&this.img_bg.loadTexture(s),this.img_normal_king&&this.img_normal_king.loadTexture(r)},setCard:function(t){var e=cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0;this.setCardBg(e),t=parseInt(t),this._num=t,!t||t<=0||!POKER_DATA_MAP[t]||POKER_DATA_MAP[t]<=0?this.setVisible(!1):(this.setVisible(!0),t>80&&t<96?this.img_card.loadTexture("res/uires/game/maj/down/hua_1.png"):t>96&&t<112?this.img_card.loadTexture("res/uires/game/maj/down/hua_2.png"):this.img_card.loadTexture("pokers/down_b/"+(t+16)+".png",ccui.Widget.PLIST_TEXTURE)),this.img_select&&this.img_select.setVisible(!1),this.img_normal&&this.img_normal.setVisible(!0),this.img_disable&&this.img_disable.setVisible(!1),this.checkKing(MJ_KING_ARR)}}),GameLieCardBase2.create=function(t,e,i){return new GameLieCardBase2(t,e,i)},UIUtils.RegisterPathTemple("ui/GameLieCardBase2.ui",GameLieCardBase2),GamePutOutCard=QPLayer.extend({uiPath:"ui/GamePutOutCard.ui",sex:0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.ani_efc&&this.ani_efc.setVisible(!1)},playDiaoPao:function(){this.ani_efc.setVisible(!0),this.ani_efc.getAnimation().play("stand",-1,-1),this.ani_efc.getAnimation().setMovementEventCallFunc(this.animationEvent,this),this.isVisible()&&playEffect("shandian.mp3")},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete&&this.ani_efc.setVisible(!1)},setSex:function(t){this.sex=t},setCardBg:function(t){this.item_card&&this.item_card.setCardBg(t)},setData:function(t,e){if(t<=0)return void this.setVisible(!1);if(this.setVisible(!0),this.item_card.setData(t),!e){var i=get_card_color(t),a=get_card_value(t),s="",r="%s/%s.mp3";MUSIC_DIFF_SEX&&(r=2==this.sex?"%s/woman/%s.mp3":"%s/man/%s.mp3"),i==LOGIC_COLOR_WAN?s=r.format(MUSIC_TYPE,"wan_"+a):i==LOGIC_COLOR_TIAO?s=r.format(MUSIC_TYPE,"tiao_"+a):i==LOGIC_COLOR_TONG?s=r.format(MUSIC_TYPE,"tong_"+a):i==LOGIC_COLOR_FENG?s=r.format(MUSIC_TYPE,"feng_"+a):i==LOGIC_COLOR_JIANG&&(s=r.format(MUSIC_TYPE,"jiang_"+a)),s&&playEffect(s)}}}),GamePutOutCard.create=function(t,e,i){return new GamePutOutCard(t,e,i)},UIUtils.RegisterPathTemple("ui/GamePutOutCard.ui",GamePutOutCard),GameFlowerCard=QPLayer.extend({uiPath:"ui/GameFlowerCard.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.txt_count&&this.txt_count.setString(0)},setData:function(t){if(t){var e=t.count||0,i=t.poker||0;this.item_card.setData(i),this.txt_count.setString(e)}}}),GameFlowerCard.create=function(t,e,i){return new GameFlowerCard(t,e,i)},UIUtils.RegisterPathTemple("ui/GameFlowerCard.ui",GameFlowerCard),ResultKingItem=QPLayer.extend({uiPath:"ui/ResultKingItem.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},setData:function(t){if(!t)return void this.setVisible(!1);this.setVisible(!0);var e=t.num1||0,i=t.num2||0;this.item_card_1.setData(e),this.item_card_2.setData(i)}}),ResultKingItem.create=function(t,e,i){return new ResultKingItem(t,e,i)},UIUtils.RegisterPathTemple("ui/ResultKingItem.ui",ResultKingItem),ResultSubKingItem=QPLayer.extend({uiPath:"ui/ResultSubKingItem.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},setData:function(t){if(!t)return void this.setVisible(!1);this.setVisible(!0);var e=t.num1||0,i=t.num2||0;this.item_card_1.setData(e),this.item_card_2.setData(i)}}),ResultSubKingItem.create=function(t,e,i){return new ResultSubKingItem(t,e,i)},UIUtils.RegisterPathTemple("ui/ResultSubKingItem.ui",ResultSubKingItem),GameStandCardBase=QPLayer.extend({uiPath:"ui/GameStandCardBase.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0;this.setCardBg(t)},setCardBg:function(t){var e=GetRealPath("res/uires/game/maj/down/backstand.png");1!=t&&2!=t||(e=GetRealPath("res/uires/game/maj/down_"+t+"/backstand.png")),this.img_bg&&this.img_bg.loadTexture(e)},setData:function(){}}),GameStandCardBase.create=function(t,e,i){return new GameStandCardBase(t,e,i)},UIUtils.RegisterPathTemple("ui/GameStandCardBase.ui",GameStandCardBase),GameStandCardBase1=GameStandCardBase.extend({uiPath:"ui/GameStandCardBase1.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},setCardBg:function(t){var e=GetRealPath("res/uires/game/maj/left/backstand.png");1!=t&&2!=t||(e=GetRealPath("res/uires/game/maj/left_"+t+"/backstand.png")),this.img_bg&&this.img_bg.loadTexture(e)}}),GameStandCardBase1.create=function(t,e,i){return new GameStandCardBase1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameStandCardBase1.ui",GameStandCardBase1),GameFlowerItem=GameStandCardBase.extend({uiPath:"ui/GameFlowerItem.ui",num:0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},setData:function(t){t=parseInt(t),t<81||t>100||(this.num=t,t+=16,this.img_card.loadTexture("res/uires/game/maj/flower/"+t+".png"))}}),GameFlowerItem.create=function(t,e,i){return new GameFlowerItem(t,e,i)},UIUtils.RegisterPathTemple("ui/GameFlowerItem.ui",GameFlowerItem),GameActionItem=QPLayer.extend({uiPath:"ui/GameActionItem.ui",cardList:[],myWidth:0,myHeight:0,data:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.setData(this.data)},setCardBg:function(t){for(var e=1;e<=4;e++){var i=this["item_card_"+e];i&&i.setCardBg(t)}},setData:function(t){if(!t)return void this.setVisible(!1);this.data=t,this.setVisible(!0);var e=t.poker_list||t,i=t.mj_action,a=t.light||!1,s=t.fang_pai||!1,r=t.last_out_poker_idx||0,n=t.last_out_poker||0;e.sort(sort_card),this.icon_light&&this.icon_light.setVisible(a);for(var o=0;o<4;o++){var c=this["item_card_"+(o+1)];c&&(e[o]?(c.setVisible(!0),(BOL_AN_GANG_FANG_PAI||s||DataMgr.gameCtrl.isLog)&&i==MJ_AN_GANG&&3==o?c.setData(e[o],!1):c.setData(e[o],i==MJ_AN_GANG)):c.setVisible(!1))}for(var o=0;o<4;o++){var l=this["arrow_"+(o+1)];l&&l.setVisible(!1)}if(1==WEAVE_POKER_SHOW_ARROW)if(i==MJ_CHI)for(var o=0;o<4;o++){var l=this["arrow_"+(o+1)];if(l&&e[o]==n){l.setVisible(!0);var _=this.getArrowRotation(r);l.setRotation(_)}}else if(i==MJ_PENG){if(e[0]==n){var l=this.arrow_2;if(l){l.setVisible(!0);var _=this.getArrowRotation(r);l.setRotation(_)}}}else if(e[0]==n){var l=this.arrow_4;if(l){l.setVisible(!0);var _=this.getArrowRotation(r);l.setRotation(_)}}},getArrowRotation:function(t){var e=DataMgr.gameCtrl.getChairIdByWheelIdx(t);return 1==e?0:2==e?-90:3==e?90:4==e?180:void 0},checkSelect:function(t){for(var e=1;e<=4;e++){var i=this["item_card_"+e];i&&i.checkSelect(t)}},getMyWidth:function(){return this.getContentSize().width},getMyHeight:function(){return this.getContentSize().height}}),GameActionItem.create=function(t,e,i){return new GameActionItem(t,e,i)},UIUtils.RegisterPathTemple("ui/GameActionItem.ui",GameActionItem),GameActionItem1=GameActionItem.extend({uiPath:"ui/GameActionItem1.ui",ctor:function(t,e,i){t=t||this.uiPath,GameActionItem.prototype.ctor.call(this,t,e,i)}}),GameActionItem1.create=function(t,e,i){return new GameActionItem1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameActionItem1.ui",GameActionItem1),GameActionItem2=GameActionItem.extend({uiPath:"ui/GameActionItem2.ui",ctor:function(t,e,i){t=t||this.uiPath,GameActionItem.prototype.ctor.call(this,t,e,i)}}),GameActionItem2.create=function(t,e,i){return new GameActionItem2(t,e,i)},UIUtils.RegisterPathTemple("ui/GameActionItem2.ui",GameActionItem2),GameMultAction=QPLayer.extend({uiPath:"ui/GameMultAction.ui",pokerList:[],callBack:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},setData:function(t,e){this.pokerList=t,this.callBack=e;var i=!1;t[0]!=t[1]&&(i=!0);for(var a=1;a<=4;a++){var s=t[a-1];if(s){var r={};r.poker_list=s,r.light=!0,this["item_action_"+a].setVisible(!0),this["item_action_"+a].setData(r),this["item_action_"+a].checkSelect(DataMgr.gameCtrl.lastOutPoker)}else this["item_action_"+a].setVisible(!1)}},tapCallBack:function(t){this.callBack&&this.callBack(t)},tap_item_action_1:function(){this.tapCallBack(0)},tap_item_action_2:function(){this.tapCallBack(1)},tap_item_action_3:function(){this.tapCallBack(2)},tap_item_action_4:function(){this.tapCallBack(3)}}),GameMultAction.create=function(t,e,i){return new GameMultAction(t,e,i)},UIUtils.RegisterPathTemple("ui/GameMultAction.ui",GameMultAction),GameResultHead=UrlHead.extend({isControlNode:!0,uiPath:"ui/GameResultHead.ui",ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},setData:function(t){var e=toDecodeURIComponent(t.name);this.txt_name.setString(e),this.setUrl(t.headimgurl),this.icon_ower.setVisible(t.isOwn),this.img_master.setVisible(t.isMaster),this.icon_chao.setVisible(t.isMaster&&t.isChao)}}),GameResultHead.create=function(t,e,i){return new GameResultHead(t,e,i)},UIUtils.RegisterPathTemple("ui/GameResultHead.ui",GameResultHead),GameDownKingItem=QPLayer.extend({uiPath:"ui/GameDownKingItem.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setData:function(t){if(!t)return void this.setVisible(!1);this.setVisible(!0),this.lab_score.setScore(t.score),this.ani_efc_1&&this.ani_efc_1.setVisible(!1),this.ani_efc_2&&this.ani_efc_2.setVisible(!1),this.ani_efc_3&&this.ani_efc_3.setVisible(!1);var e=t.isBaWan||!1,i=t.isChongGuan||!1;e&&i&&this.ani_efc_3?(this.ani_efc_3.setVisible(!0),this.ani_efc_3.getAnimation().play("stand",-1,-1)):i&&this.ani_efc_2?(this.ani_efc_2.setVisible(!0),this.ani_efc_2.getAnimation().play("stand",-1,-1)):e&&this.ani_efc_1&&(this.ani_efc_1.setVisible(!0),this.ani_efc_1.getAnimation().play("stand",-1,-1));for(var a=[],s=0;s<t.nums[0];s++)a.push(t.downPokerList[0]);for(var s=0;s<t.nums[1];s++)a.push(t.downPokerList[1]);for(var s=1;s<=8;s++){var r=a[s-1],n=this["item_card_"+s];n&&(r?(n.setCkeckKingEnable(!1),n.setData(r)):n.setVisible(!1))}this.grp_card&&this.grp_card.setVisible(!0),this.sortCardGrp(a)},sortCardBgSize:function(t,e){if(this.bg_card.setVisible(!1),this.bg_card&&this.grp_card)if(0==t.length);else{var i=ccui.Scale9Sprite.create(GetRealPath("res/uires/game/img_jingpai.png"));i.insetLeft=20,i.insetTop=20,i.insetRight=20,i.insetBottom=20,i.x=this.bg_card.x,i.y=this.bg_card.y,i.anchorX=this.bg_card.anchorX,i.anchorY=this.bg_card.anchorY;this.bg_card.getContentSize();i.setContentSize(e),this.addChild(i),i.setLocalZOrder(-999),this.bg_card.removeFromParent(),this.bg_card=i}},sortCardGrp:function(t){if(this.sortGrp("grp_card"),this.bg_card.setVisible(!1),this.bg_card&&this.grp_card)if(0==t.length);else{var e=this.bg_card.getContentSize();this.sortCardBgSize(t,cc.size(44*t.length+20,e.height))}}}),GameDownKingItem.create=function(t,e,i){return new GameDownKingItem(t,e,i)},UIUtils.RegisterPathTemple("ui/GameDownKingItem.ui",GameDownKingItem),GameDownKingItem1=GameDownKingItem.extend({uiPath:"ui/GameDownKingItem1.ui"}),GameDownKingItem1.create=function(t,e,i){return new GameDownKingItem1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameDownKingItem1.ui",GameDownKingItem1),GameDownKingItem2=GameDownKingItem.extend({uiPath:"ui/GameDownKingItem2.ui",sortCardGrp:function(t){this.sortGrp("grp_card",-13,1);var e=this.bg_card.getContentSize();this.sortCardBgSize(t,cc.size(e.width,44*t.length+15))}}),GameDownKingItem2.create=function(t,e,i){return new GameDownKingItem2(t,e,i)},UIUtils.RegisterPathTemple("ui/GameDownKingItem2.ui",GameDownKingItem2),GameDownKingItem3=GameDownKingItem.extend({uiPath:"ui/GameDownKingItem3.ui",sortCardGrp:function(t){for(var e=1;e<=8;e++){var i=this["item_card_"+e];i&&i.setRotation(180)}this.sortGrp("grp_card",-13,1);var a=this.bg_card.getContentSize();this.sortCardBgSize(t,cc.size(a.width,44*t.length+15))}}),GameDownKingItem3.create=function(t,e,i){return new GameDownKingItem3(t,e,i)},UIUtils.RegisterPathTemple("ui/GameDownKingItem3.ui",GameDownKingItem3),GameDownKingItem4=GameDownKingItem.extend({uiPath:"ui/GameDownKingItem4.ui"}),GameDownKingItem4.create=function(t,e,i){return new GameDownKingItem4(t,e,i)},UIUtils.RegisterPathTemple("ui/GameDownKingItem4.ui",GameDownKingItem4),GameActionEffect=QPLayer.extend({uiPath:"ui/GameActionEffect.ui",sex:0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=ccs.Armature.create("chi");this.grp_ani&&this.grp_ani.addChild(t),this.ani_efc=t,this.ani_efc.setVisible(!1);var e=cc.Sprite.create();this.grp_ani&&this.grp_ani.addChild(e),this.sprite_efc=e},setSex:function(t){this.sex=t},setData:function(t){if(!t)return void this.setVisible(!1);this.sprite_efc.setVisible(!1),this.setVisible(!0);var e=(t.poker_list||[],t.mj_action),i="",a="",s="%s/%s.mp3";if(MUSIC_DIFF_SEX&&(s=2==this.sex?"%s/woman/%s.mp3":"%s/man/%s.mp3"),e==MJ_CHI){i="chi";var r="chi",n=MUSIC_CHI_ARR[parseInt(Math.random()*MUSIC_CHI_ARR.length)];n&&(r+=n),a=s.format(MUSIC_TYPE,r)}else if(e==MJ_PENG){i="peng";var r="peng",n=MUSIC_PENG_ARR[parseInt(Math.random()*MUSIC_PENG_ARR.length)];n&&(r+=n),a=s.format(MUSIC_TYPE,r)}else if(e==MJ_GANG){i="gang";var r="gang",n=MUSIC_GANG_ARR[parseInt(Math.random()*MUSIC_GANG_ARR.length)];n&&(r+=n),a=s.format(MUSIC_TYPE,r)}else if(e==MJ_AN_GANG){i="an_gang";var r="gang",n=MUSIC_GANG_ARR[parseInt(Math.random()*MUSIC_GANG_ARR.length)];
n&&(r+=n),a=s.format(MUSIC_TYPE,r)}else if(e==MJ_BU_GANG){i="bu_gang";var r="gang",n=MUSIC_GANG_ARR[parseInt(Math.random()*MUSIC_GANG_ARR.length)];n&&(r+=n),a=s.format(MUSIC_TYPE,r)}else if(e==MJ_HU){var o=DataMgr.gameCtrl.huTypeList||[],c=arrayToMap(o);if(c[MJ_HU_CATCH_KING]?(i="qiang_jing",a=s.format(MUSIC_TYPE,"hule")):c[MJ_HU_FIRST_THREE_KING]?(i="sang_jing_dao",a=s.format(MUSIC_TYPE,"hule")):c[MJ_HU_SINGLE_KING]?(i="you_jing",a=s.format(MUSIC_TYPE,"hule")):c[MJ_HU_DOUBLE_KING]?(i="shuang_you",a=s.format(MUSIC_TYPE,"hule")):c[MJ_HU_THREE_KING]?(i="sang_you",a=s.format(MUSIC_TYPE,"hule")):c[MJ_HU_HB_KA_5_STAR]&&(i="action_ka5xing",a=s.format(MUSIC_TYPE,"hule")),c[MJ_HU_HB_ONE_SEVEN_DUI_3]?(i="qingchaochaohuaqidui",a=s.format(MUSIC_TYPE,"qingchaochaohuaqidui")):c[MJ_HU_HB_ONE_SEVEN_DUI_2]?(i="qingchaohuaohuaqidui",a=s.format(MUSIC_TYPE,"qingchaohuaohuaqidui")):c[MJ_HU_HB_SEVEN_DUI_3]?(i="chaochaohaohua",a=s.format(MUSIC_TYPE,"chaochaohaohua")):c[MJ_HU_HB_ONE_SEVEN_DUI_1]?(i="qinghaohuaqidui",a=s.format(MUSIC_TYPE,"qinghaohuaqidui")):c[MJ_HU_HB_SEVEN_DUI_2]?(i="chaohaohua",a=s.format(MUSIC_TYPE,"chaohaohua")):c[MJ_HU_HB_SEVEN_DUI_1]?(i="haohuaqidui",a=s.format(MUSIC_TYPE,"haohuaqidui")):c[MJ_HU_HB_SEVEN_DUI]?(i="qiduihuapai",a=s.format(MUSIC_TYPE,"qiduihuapai")):c[MJ_HU_HB_ONE_SHOU_ZHUA_YI]?(i="qingshouzhuayi",a=s.format(MUSIC_TYPE,"qingshouzhuayi")):c[MJ_HU_HB_ONE_SEVEN_DUI]?(i="qingqidui",a=s.format(MUSIC_TYPE,"qingqidui")):c[MJ_HU_HB_ONE_AN_SI_GUI]?(i="qingangui",a=s.format(MUSIC_TYPE,"qingangui")):c[MJ_HU_HB_ONE_PENGPENG]?(i="qingpeng",a=s.format(MUSIC_TYPE,"qingpeng")):c[MJ_HU_HB_ONE_KA_5_STAR]?(i="qingkawuxing",a=s.format(MUSIC_TYPE,"qingkawuxing")):c[MJ_HU_HB_ONE_MING_SI_GUI]?(i="qingminggui",a=s.format(MUSIC_TYPE,"qingminggui")):c[MJ_HU_HB_BIG_SAN_YUAN]?(i="dasanyuan",a=s.format(MUSIC_TYPE,"dasanyuan")):c[MJ_HU_HB_ONE_FLOWER]?(i="bingyise",a=s.format(MUSIC_TYPE,"qingyise")):c[MJ_HU_HB_XIAO_SAN_YUAN]?(i="xiaosanyuan",a=s.format(MUSIC_TYPE,"xiaosanyuan")):c[MJ_HU_HB_AN_SI_GUI_Q]?(i="ansigui",a=s.format(MUSIC_TYPE,"ansigui")):c[MJ_HU_HB_AN_SI_GUI_B]?(i="ansigui",a=s.format(MUSIC_TYPE,"ansigui")):c[MJ_HU_HB_SHOU_ZHUA_YI]?(i="shouzhuayi",a=s.format(MUSIC_TYPE,"shouzhuayi")):c[MJ_HU_HB_PENG_PENG]?(i="pengpeng",a=s.format(MUSIC_TYPE,"pengpeng")):c[MJ_HU_HB_KA_5_STAR]?(i="kawuxing",a=s.format(MUSIC_TYPE,"kawuxing")):c[MJ_HU_HB_MING_SI_GUI_Q]?(i="mingsigui",a=s.format(MUSIC_TYPE,"mingsigui")):c[MJ_HU_HB_MING_SI_GUI_B]?(i="mingsigui",a=s.format(MUSIC_TYPE,"mingsigui")):c[MJ_HU_HB_GANG_SHANG_PAO]?(i="gangshangpao",a=s.format(MUSIC_TYPE,"gangshangpao")):c[MJ_HU_HB_GANG_KAI]?(i="gangkaihua",a=s.format(MUSIC_TYPE,"gangkaihua")):c[MJ_HU_HB_QIANG_GANG]?(i="qianggang",a=s.format(MUSIC_TYPE,"qianggang")):c[MJ_HU_HB_HAI_DI_PAO]?(i="haidipao",a=s.format(MUSIC_TYPE,"haidipao")):c[MJ_HU_HB_HAI_DI_LAO]&&(i="haidelao",a=s.format(MUSIC_TYPE,"haidelao")),c[MJ_ZI_MO]&&(i||(i="zi_mo_hu"),!a)){var r="zimo",n=MUSIC_ZIMO_ARR[parseInt(Math.random()*MUSIC_ZIMO_ARR.length)];n&&(r+=n),a=s.format(MUSIC_TYPE,r)}if(GAME_TYPE==GAME_TYPE_NCMJ){var l=this.showLabel(c,i);l&&(i="hu_effect_bg",a=s.format(MUSIC_TYPE,l))}if(a||(a=s.format(MUSIC_TYPE,"hule")),!i){i="hu";var r="hule"}}else e==MJ_FLOWER?i="bu_hua":e==MJ_FLOWER_GANG?(i="bu_hua_gang",a=s.format(MUSIC_TYPE,"buhua")):e==MJ_MING&&(i="action_ming",a=s.format(MUSIC_TYPE,"liangdao"));return a&&playEffect(a),i?(this.ani_efc.setVisible(!0),this.ani_efc.init(i),this.ani_efc.getAnimation().play("stand",-1,-1),void this.ani_efc.getAnimation().setMovementEventCallFunc(this.animationEvent,this)):void this.setVisible(!1)},getShowLabel:function(t){var e=function(t){return!(t[MJ_HU_QI_DUI]||t[MJ_HU_THIRTEEN]||t[MJ_HU_SERVEN]||t[MJ_HU_GERMAN_SERVEN]||t[MJ_HU_PENG_PENG])};if(t[MJ_DI])return MJ_DI;if(t[MJ_TIAN])return MJ_TIAN;if(e(t)){if(t[MJ_QIANG_GANG])return MJ_QIANG_GANG;if(t[MJ_GANG_HU])return MJ_GANG_HU;if(t[MJ_KING_WAIT])return MJ_KING_WAIT;if(t[MJ_GERMAN])return MJ_GERMAN;if(t[MJ_GERMAN_GERMAN])return MJ_GERMAN_GERMAN}else{var i=t[MJ_GERMAN]||t[MJ_GERMAN_GERMAN];if(t[MJ_KING_WAIT]){if(t[MJ_HU_QI_DUI])return MJ_HU_QI_DUI+"_"+MJ_KING_WAIT;if(t[MJ_HU_PENG_PENG])return i?MJ_HU_PENG_PENG+"_"+MJ_KING_WAIT+"_"+MJ_GERMAN:MJ_HU_PENG_PENG+"_"+MJ_KING_WAIT}else if(i){if(t[MJ_HU_QI_DUI])return MJ_HU_QI_DUI+"_"+MJ_GERMAN;if(t[MJ_HU_THIRTEEN])return MJ_HU_THIRTEEN+"_"+MJ_GERMAN;if(t[MJ_HU_SERVEN])return MJ_HU_SERVEN+"_"+MJ_GERMAN;if(t[MJ_HU_GERMAN_SERVEN])return MJ_HU_GERMAN_SERVEN+"_"+MJ_GERMAN;if(t[MJ_HU_PENG_PENG])return MJ_HU_PENG_PENG+"_"+MJ_GERMAN}else{if(t[MJ_HU_QI_DUI])return MJ_HU_QI_DUI;if(t[MJ_HU_THIRTEEN])return MJ_HU_THIRTEEN;if(t[MJ_HU_SERVEN])return MJ_HU_SERVEN;if(t[MJ_HU_GERMAN_SERVEN])return MJ_HU_GERMAN_SERVEN;if(t[MJ_HU_PENG_PENG])return MJ_HU_PENG_PENG}}},showLabel:function(t,e){var i=this.getShowLabel(t),a={2:1,3:1,4:1,5:1,6:1,7:1,8:1,"18_4":1,"18_5":1,"18_6":1,18:1,"19_5":1,"19_6":1,19:1,"20_5":1,"20_6":1,20:1,"22_4_5":1,"22_4":1,"22_5":1,"22_6":1,22:1};return a[i]?(e="hu_effect_bg",this.sprite_efc.setVisible(!0),this.sprite_efc.initWithFile(GetRealPath("res/uires/ncmj/hu_"+i+".png")),this.sprite_efc.scale=1,this.sprite_efc.runAction(cc.sequence(cc.scaleTo(.2,2),cc.scaleTo(.2,.8),cc.scaleTo(.1,1))),"hu_"+i):""},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete&&this.setVisible(!1)}}),GameActionEffect.create=function(t,e,i){return new GameActionEffect(t,e,i)},UIUtils.RegisterPathTemple("ui/GameActionEffect.ui",GameActionEffect),GameHu=QPDlg.extend({uiPath:"ui/GameHu.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete&&(this.data&&this.data.callback&&this.data.callback.call(),this.close())},onLoaded:function(){if(!this.data)return void this.close();this.ani_hu&&this.ani_hu.setVisible(!1),this.ani_zi_mo_hu&&this.ani_zi_mo_hu.setVisible(!1);var t=this.data.huList;t[0]&&t[0]==MJ_ZI_MO?this.ani_zi_mo_hu&&(this.ani_zi_mo_hu.setVisible(!0),this.ani_zi_mo_hu.getAnimation().play("stand",-1,-1),this.ani_zi_mo_hu.getAnimation().setMovementEventCallFunc(this.animationEvent,this)):this.ani_hu&&(this.ani_hu.setVisible(!0),this.ani_hu.getAnimation().play("stand",-1,-1),this.ani_hu.getAnimation().setMovementEventCallFunc(this.animationEvent,this))}}),GameHu.create=function(t,e,i){return new GameHu(t,e,i)},ModuleMgr.registerModule("GameHu",GameHu),CreateRoomBaseDlg=QPDlg.extend({uiPath:"",bolClub:!1,clubTag:0,clubData:null,costRatio:0,matchRid:"",unionRid:"",matchMoney:0,bolMatch:!1,ctor:function(t,e,i){this.data=t,t?(this.bolClub=t.bolClub||!1,this.clubData=t.clubData||null,this.bolMatch=t.bolMatch||!1):(this.bolClub=!1,this.bolMatch=!1),QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.checkClub(),this.bolClub&&this.setClubTag()},setClubTag:function(){this.clubData&&(this.bolMatch?(this.matchRid=this.clubData.match_rid,this.unionRid=this.clubData.rid,this.matchMoney=this.clubData.match_money,this.costRatio=this.clubData.cost_match_ratio,this.lab_club_cost&&this.lab_club_cost.setVisible(!0)):(this.costRatio=this.clubData.cost_ratio,this.matchRid="",this.unionRid=this.clubData.rid,this.matchMoney=this.clubData.match_money,this.lab_club_cost&&this.lab_club_cost.setVisible(!0)),this.refreshCost())},tap_btn_club_tab_1:function(){this.setClubTag(1)},tap_btn_club_tab_2:function(){return DataMgr.clubCtrl.bolMatchExist()?void this.setClubTag(2):ModuleMgr.showTipMsg("赛制尚未开启！")},checkClub:function(){this.lab_club_cost&&this.lab_club_cost.setVisible(this.bolClub)},tap_btn_close:function(){QPDlg.prototype.tap_btn_close.call(this),cc.eventManager.dispatchCustomEvent("showChatInput")}}),CreateRoomNcmjDlg=CreateRoomBaseDlg.extend({uiPath:"ui/CreateRoomNcmjDlg.ui",curRound:0,curRoleNum:0,curType:0,curCost:0,gang:0,discard:0,chao:0,turnBack:0,ctor:function(t,e,i){CreateRoomBaseDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){for(var t=0;t<3;t++)this.setText("lab_round_"+t,ROOM_CARD_COST[t].round);var e=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_round")||0),i=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_type_num")||0),a=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_gang")||1),s=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_discard_num")||1),r=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_chao")||1),n=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_turn_back")||0);this.setRound(e),this.setTypeNum(i),this.setGangNum(a),this.setDiscardNum(s),this.setChaoNum(r),this.setTurnBackNum(n),this.refreshFreeLab(),CreateRoomBaseDlg.prototype.onLoaded.call(this)},refreshFreeLab:function(){if(this.lab_free){var t=DataMgr.activityCtrl.getFreeRoomData();if(!t)return void this.lab_free.setString("");var e=DataMgr.timeCtrl.getServerTime();if(!(e>=t.start_time&&e<=t.end_time))return void this.lab_free.setString("");var i=(t.start_time,t.end_time,"限时免费：");if(t.all_step_list)for(var a=0;a<t.all_step_list.length;a++){var s=t.all_step_list[a],r=calDate(s.start_sec);i+=(r[1]<10?"0"+r[1]:r[1])+":"+(r[2]<10?"0"+r[2]:r[2]),i+="-";var r=calDate(s.end_sec);i+=(r[1]<10?"0"+r[1]:r[1])+":"+(r[2]<10?"0"+r[2]:r[2]),i+="  "}this.lab_free.setString(i)}},refreshCkRound:function(){for(var t=0;t<6;t++)this["ck_round"+t]&&this["ck_round"+t].setSelected(this.curRound==ROOM_CARD_COST[t].round),this["ck_type"+t]&&this["ck_type"+t].setSelected(this.curType==t),this["ck_discard"+t]&&this["ck_discard"+t].setSelected(this.discard==t),this["ck_chao"+t]&&this["ck_chao"+t].setSelected(this.chao==t),this["ck_turnBack"+t]&&this["ck_turnBack"+t].setSelected(this.turnBack==t);this.refreshCost()},refreshCost:function(){var t={full_round:this.curRound,desk_type:this.curType+1};if(this.curCost=DataMgr.gameCtrl.getRoomCardCost(t),this.bolClub&&this.costRatio>=0){var e=Math.ceil(this.curCost*(this.costRatio/100));this.curCost=this.curCost-e,this.setText("lab_club_cost",e)}this.lab_cost.setString(this.curCost)},setRound:function(t){this.curRound=ROOM_CARD_COST[t].round,this.refreshCkRound(),cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_round",t)},OnSelectRound:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(8,1));this.setRound(e)}else"unselected"==t.name&&t.target.setSelected(!0)},setRoleNum:function(t){this.refreshCkRound()},setTypeNum:function(t){this.curType=t,this.refreshCkRound(),cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_type_num",t)},OnSelecType:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(7,1));this.setTypeNum(e)}else"unselected"==t.name&&t.target.setSelected(!0)},setGangNum:function(t){this.gang=t,this.refreshCkRound(),cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_gang",t)},OnSelecGang:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(7,1));this.setGangNum(e)}else"unselected"==t.name&&t.target.setSelected(!0)},setDiscardNum:function(t){this.discard=t,this.refreshCkRound(),cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_discard_num",t)},OnSelecDiscard:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(10,1));this.setDiscardNum(e)}else"unselected"==t.name&&t.target.setSelected(!0)},setChaoNum:function(t){this.chao=t,this.refreshCkRound(),cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_chao",t)},OnSelecChao:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(7,1));this.setChaoNum(e)}else"unselected"==t.name&&t.target.setSelected(!0)},setTurnBackNum:function(t){this.turnBack=t,this.refreshCkRound(),cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_turn_back",t)},OnSelecTurnBack:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(11,1));this.setTurnBackNum(e)}else"unselected"==t.name&&t.target.setSelected(!0)},tap_btn_create:function(){return this.curCost>ME_D.get_user().room_card?ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！"):(this.curRoleNum=4,getQueryString("full_num")&&(this.curRoleNum=getQueryString("full_num")),void ME_D.send_message(CMD_CREATE_DESK,{game_type:GAME_TYPE,full_num:this.curRoleNum,full_round:this.curRound,desk_type:this.curType+1,discard_poker:this.discard,chao_master:this.chao,gang_jing:this.gang,turn_back:this.turnBack,union_rid:this.unionRid,match_rid:this.matchRid,is_check_allready:1,test_pokers:TEST_POKERS}))}}),CreateRoomNcmjDlg.create=function(t,e,i){return new CreateRoomNcmjDlg(t,e,i)},ModuleMgr.registerModule("CreateRoomDlg",CreateRoomNcmjDlg),GameScene=cc.Scene.extend({isLog:!1,ctor:function(t){cc.Scene.prototype.ctor.call(this),this.isLog=t||!1,DataMgr.gameCtrl.isLog=this.isLog},createGameLayer:function(){this.isLog?IsGameTypeFzmjOrNdmj()?ModuleMgr.runDlg("NewGameLogLayer"):ModuleMgr.runOrientationDlg("GameLogLayer"):IsGameTypeFzmjOrNdmj()?ModuleMgr.runDlg("NewGameLayer",{dlgZorder:98},null,null):ModuleMgr.runOrientationDlg(GAME_LAYER_NAME)},onExit:function(){this._super(),DataMgr.gameCtrl.clearData(),DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_PROTRAIT)},onEnter:function(){this._super();var t=this,e=!1;if(cc.sys.os===cc.sys.OS_IOS&&!cc.sys.isNative){e=!0;var i=new cc.Layer;i.x=0,i.y=0,this.addChild(i);var a=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(e,i){return t.isFirstTouch||(t.isFirstTouch=!0,IsGameTypeFzmjOrNdmj()&&playMuisc("mj_gameBg.mp3")),!0}});cc.eventManager.addListener(a,i),i.onExit=function(){cc.LayerColor.prototype.onExit.call(i),cc.eventManager.removeListener(a)}}IsGameTypeFzmjOrNdmj()?(designOrientation!=SCREEN_ORIENTATION_LANDSCAPE&&DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE),e||playMuisc("mj_gameBg.mp3")):(SCREEN_CUR_ORIENTATION=DataMgr.gameCtrl.getSceenOrientation(),playMuisc("hall_bg1.mp3")),this.createGameLayer()}}),GameScene.create=function(t){return new GameScene(t)},ModuleMgr.registerModule("GameScene",GameScene),GameLayer=QPLayer.extend({uiPath:"ui/Game.ui",musicDt:0,isPlaying:!1,isTurning:!1,isAction:!1,isDispatchPoker:!1,touchCardIndex:-1,touchMoveCardIndex:-1,bolCardMove:!1,updateDt:0,cardOrgX:0,isScreenRotationDirty:!1,showKingType:1,touchInterval:0,downCardTime:.4,stepRandMasterTime:4.5,stepOpenDoorTime:2,stepRandKingTime:2.5,startType:0,deskTypeKeyArr:[],isDissolve:!1,heartDt:0,sendHeadTime:0,faceInfo:null,initTime:function(){},ctor:function(t,e,i){t=t||this.uiPath,this.events=["SuccessStartGame","SuccessStartPlayRecord","SuccessEndPlayRecord","refreshPoker","SuccessEnterDesk","SuccessLeaveDesk","SuccessOwnLeaveDesk","SuccessDissolve","SUCCECES_ROOM_CREATE","SuccessGameEnd","SuccessUserReady","SuccessStepChange","TurnIndex","SuccessPlayChatTxt","SuccessPlayChatFace","HideChatLayer","ErrorOp","SuccessRandMaster","SuccessOpenDoor","SuccessPokerInit","SuccessRandPoker","SuccessFixFlower","SuccesAllPokersFixFlower","DispatchPoker","HideDispatchPoker","SuccessDealPoker","SuccessNoAction","SuccessSelectAction","RefreshWeakPoker","HideCurOutCard","ShowDownKing","SuccessShowResult","PlayActionEfc","RefreshRound","SuccessTswScoreEnd","RefreshRoleScore","ClearResuleCard","CheckCardSelectMove","FaceInter","SuccesShowCard","SuccesSelectPiao","SuccesScoreChange","SuccesChaoMaster","SuccesSetDeskBg","SuccesSetCardBg","SuccesRefreshPlayers","RefreshRandMineLayer"],QPLayer.prototype.ctor.call(this,t,e,i),this.faceInfo=CsvMgr.getDataWithFile("face");var a=this;a.touchCardIndex=-1,this.initTime(),this.scheduleUpdate(),this.sendHeadTime=parseInt((new Date).getTime()%1e7)},deal_SuccesSetDeskBg:function(t){cc.log("deal_SuccesSetDeskBg"),this.setDeskBg()},deal_SuccesSetCardBg:function(t){cc.log("deal_SuccesSetCardBg"),this.setDeskCardBg()},deal_SuccessStartGame:function(t){cc.log("deal_SuccessStartGame"),this.SuccessStartGame(),this.refreshRoomState()},deal_SuccessStartPlayRecord:function(t){cc.log("deal_SuccessStartPlayRecord");var e=this,i=t.getUserData(),a=DataMgr.gameCtrl.deskChat[i];e["role_card"+a]&&e["role_card"+a].showTalk()},deal_SuccessEndPlayRecord:function(t){cc.log("deal_SuccessEndPlayRecord");var e=this,i=t.getUserData(),a=DataMgr.gameCtrl.deskChat[i];e["role_card"+a]&&e["role_card"+a].stopTalk()},deal_refreshPoker:function(t){cc.log("deal_refreshPoker");var e=this;e.refreshPoker()},deal_SuccesRefreshPlayers:function(t){cc.log("deal_SuccesRefreshPlayers");var e=this;e.refreshPlayers()},deal_SuccessEnterDesk:function(t){cc.log("deal_SuccessEnterDesk");var e=this,i=t.getUserData();i?e.refreshPlayers():e.refreshPlayersOnline(),e.checkShowStart()},deal_SuccessLeaveDesk:function(t){cc.log("deal_SuccessLeaveDesk");var e=this,i=t.getUserData();i?e.refreshPlayers():e.refreshPlayersOnline(),e.checkShowStart()},deal_SuccessOwnLeaveDesk:function(t){cc.log("deal_SuccessOwnLeaveDesk"),this.isDissolve||ModuleMgr.enterEnterScene()},deal_SuccessDissolve:function(t){cc.log("deal_SuccessDissolve"),DataMgr.gameCtrl.deskInfo&&DataMgr.gameCtrl.deskInfo.cur_round>1&&(this.isDissolve=!0,ModuleMgr.closeDlg("GameDissolve"),4!=DataMgr.gameCtrl.deskType&&this.gameOver())},deal_SUCCECES_ROOM_CREATE:function(t){cc.log("deal_SUCCECES_ROOM_CREATE");this.reBuyCardStart(),this.checkShowStart()},deal_SuccessGameEnd:function(t){cc.log("deal_SuccessGameEnd");this.checkContinueBuy(),this.isPlaying=!1,this.refreshRoomState()},deal_SuccessUserReady:function(t){cc.log("deal_SuccessUserReady");var e=this,i=t.getUserData();cc.log("info",i);var a=i.idx;a==DataMgr.gameCtrl.myWheelIdx&&e.btn_ready.setVisible(!1);var s=DataMgr.gameCtrl.getChairIdByWheelIdx(a);e["role_card"+s]&&e["role_card"+s].setReady(1);for(var r=DataMgr.gameCtrl.deskInfo,n=0,o=r.full_num,c=1;c<=o;c++){var l=DataMgr.gameCtrl.wheelInfos[c];l&&1==l.is_ready&&(n+=1)}n>=o&&r&&1!=r.is_check_allready&&r.desk_own_rid==ME_D.get_rid()&&0==this.startType&&this.tap_do_start_game()},deal_SuccessStepChange:function(t){cc.log("deal_SuccessStepChange");this.stepChange(),this.checkShowStart()},deal_TurnIndex:function(t){cc.log("deal_TurnIndex");this.turnIndex()},deal_SuccessPlayChatTxt:function(t){cc.log("deal_SuccessPlayChatTxt");var e=t.getUserData(),i=e.chair;this["role_card"+i]&&this["role_card"+i].showChatLab(e.txt)},deal_SuccessPlayChatFace:function(t){cc.log("deal_SuccessPlayChatFace");var e=t.getUserData(),i=e.chair;this["role_card"+i]&&this["role_card"+i].showChatFace(e.faceId)},deal_HideChatLayer:function(t){cc.log("deal_HideChatLayer");this.hideChatLayer()},deal_DispatchPoker:function(t){cc.log("deal_DispatchPoker");var e=t.getUserData(),i=e.idx,a=e.poker_num;this.dispatchPoker(i,a),this.refreshLastPokerNum()},deal_HideDispatchPoker:function(){cc.log("deal_HideDispatchPoker"),this.hideDispatchPoker()},deal_SuccessDealPoker:function(t){cc.log("deal_SuccessDealPoker");t.getUserData();this.dealPoker()},deal_SuccessNoAction:function(t){cc.log("deal_SuccessNoAction");t.getUserData();this.noAction()},deal_SuccessSelectAction:function(t){cc.log("deal_SuccessSelectAction"),this.selectAction()},deal_RefreshWeakPoker:function(t){cc.log("deal_RefreshWeakPoker"),this.refreshWeakPoker()},deal_HideCurOutCard:function(t){cc.log("deal_HideCurOutCard"),this.hideCurOutCard()},deal_SuccessRandMaster:function(t){cc.log("deal_SuccessRandMaster"),this.stepRandMaster()},deal_SuccessOpenDoor:function(t){cc.log("deal_SuccessOpenDoor");this.stepOpenDoor()},deal_SuccessPokerInit:function(t){cc.log("deal_SuccessPokerInit")},deal_SuccessRandPoker:function(t){cc.log("deal_SuccessRandPoker");this.stepRandKing()},deal_ShowDownKing:function(t){cc.log("deal_ShowDownKing");var e=t.getUserData(),i=e.type;this.showDownKing(i)},deal_SuccessShowResult:function(t){cc.log("deal_SuccessShowResult");this.showResult()},deal_PlayActionEfc:function(t){cc.log("deal_PlayActionEfc");var e=t.getUserData(),i=e.idx,a=e.data;this.playActionEfc(i,a)},deal_RefreshRound:function(t){cc.log("deal_RefreshRound"),this.refreshRound()},deal_SuccessTswScoreEnd:function(t){cc.log("deal_SuccessTswScoreEnd");var e=this,i=t.getUserData(),a=i.idx,s=DataMgr.gameCtrl.getChairIdByWheelIdx(a);e["role_card"+s]&&e["role_card"+s].setReady(1)},deal_RefreshRoleScore:function(t){cc.log("deal_RefreshRoleScore"),this.refreshRoleScore()},deal_SuccessFixFlower:function(t){cc.log("deal_SuccessFixFlower");var e=t.getUserData();if(DataMgr.gameCtrl.curStep==MJ_STEP_PLAY){var i=e.idx;this.addFixFlower(i)}else this.stepFixFlower()},deal_SuccesAllPokersFixFlower:function(t){cc.log("deal_SuccesAllPokersFixFlower");t.getUserData();this.stepFixFlower()},deal_ErrorOp:function(t){cc.log("deal_ErrorOp");var e=t.getUserData(),i=e.oper;"deal_poker"==i&&this.dealPokerError()},deal_ClearResuleCard:function(t){cc.log("deal_ClearResuleCard"),this.clearResuleCard()},deal_CheckCardSelectMove:function(t){cc.log("deal_CheckCardSelectMove");var e=t.getUserData();this.checkCardSelectMove(e)},deal_SuccesShowCard:function(t){cc.log("deal_SuccesShowCard");var e=t.getUserData();this.showCard(e)},deal_SuccesSelectPiao:function(t){cc.log("deal_SuccesSelectPiao");var e=t.getUserData();this.refreshPiao(e)},deal_SuccesScoreChange:function(t){cc.log("deal_SuccesScoreChange");var e=t.getUserData();this.scoreChange(e)},deal_FaceInter:function(t){if(cc.log("deal_FaceInter"),0==this.isAllUILoaded)return void(this.eventStack.SuccessFaceInter=t.getUserData());var e=t.getUserData();this.faceInter(e)},deal_SuccesChaoMaster:function(t){cc.log("deal_SuccesChaoMaster"),this.chaoMaster()},deal_RefreshRandMineLayer:function(t){cc.log("deal_RefreshRandMineLayer"),this.refreshMineDlg()},refreshMineDlg:function(t){if(4==DataMgr.gameCtrl.deskType){var e=this,i=function(t){var i=ModuleMgr.getDlg("GameNcmjMineDlg");i&&i.refreshUi();var a=function(t){var i=DataMgr.gameCtrl.downRandPokerList,a=DataMgr.gameCtrl.wheelDownPokerMap,s=i[2*t],r={};r.num=s,r.deskType=4,r.index=t+1,r.func1=function(){for(var i=1;i<=4;i++){var s=a[i];if(s){var r=s[t];if(r){var n=DataMgr.gameCtrl.getChairIdByWheelIdx(i);e["role_card"+n]&&e["role_card"+n].showDownKing(r)}}}},r.func2=function(){for(var t=1;t<=4;t++)e["role_card"+t]&&e["role_card"+t].hideDownKing();e.item_down_king.setVisible(!1),e.hideDiLeiAni(),e.showDiLeiAni(DataMgr.gameCtrl.randMineIdx)},e.item_down_king.setVisible(!0),e.item_down_king.setData(r)};a(t)};t&&ModuleMgr.runDlg("GameNcmjMineDlg");for(var a=!0,s=!0,r=DataMgr.gameCtrl.randMineList,n=r.length,o=n-1;o>=0;o--){var c=r[o];if(1==c.is_pass){this.item_shaizi.setVisible(!0),this.item_shaizi.show(c.rand_num1,c.rand_num2,function(){i(o)}),s=!1;break}a=!1}e.grp_desk_info&&e.grp_desk_info.setVisible(!1),e.grp_last_num&&e.grp_last_num.setVisible(!1),s&&(e.hideDiLeiAni(),e.showDiLeiAni(DataMgr.gameCtrl.randMineIdx)),a&&e.scheduleOnce(function(){e.hideDiLeiAni(),e.item_shaizi.setVisible(!1),e.grp_desk_info&&e.grp_desk_info.setVisible(!0),e.grp_last_num&&e.grp_last_num.setVisible(!0),ModuleMgr.closeDlg("GameNcmjMineDlg"),e.showSubResult()},4)}},testOutCard:function(){if(GAME_PLAY_AUTO){var t=this,e=function(){for(var i=[],a=1;a<=MY_TOTAL_CARD_NUM;a++){var s=t["item_card_"+a];s&&s.isVisible()&&i.push(s)}var s=t.item_card_dispatch;s&&s.isVisible()&&i.push(s);var r=Math.floor(Math.random()*i.length),s=i[r];s&&t.tap_btn_out(s),t.scheduleOnce(function(){e()},1)};e()}},testSelectAction:function(){if(GAME_PLAY_AUTO){var t=arrayToMap(DataMgr.gameCtrl.actionList||[]);t[MJ_HU]?this.grp_myBtn&&this.grp_myBtn.tap_btn_hu():t[MJ_MING]?this.grp_myBtn&&this.grp_myBtn.tap_btn_ming():t[MJ_GANG]?this.grp_myBtn&&this.grp_myBtn.tap_btn_gang():t[MJ_PENG]?this.grp_myBtn&&this.grp_myBtn.tap_btn_peng():t[MJ_CHI]&&this.grp_myBtn&&this.grp_myBtn.tap_btn_chi()}},chaoMaster:function(){},faceInter:function(t){var e=this,i=this.faceInfo[t.faceId];if(1==i.type){if(t.idx1!=DataMgr.gameCtrl.myWheelIdx)return;var a=ccs.Armature.create(i.effect_name);return void(a&&(playEffect("face/face_qifu.mp3"),a.getAnimation().play("stand",-1,-1),a.setPosition(winSizeWidthBigger.height/2,winSizeWidthBigger.width/2),"effect_guanyu"==i.effect_name&&(a.x=a.x+40),"effect_money_man"==i.effect_name&&(a.x=a.x+40,a.y=a.y+40),a.setPosition(winSizeWidthBigger.width/2,winSizeWidthBigger.height/2),a.setZOrder(9999),a.setScale(2),a.getAnimation().setMovementEventCallFunc(function(t,e,i){e==ccs.MovementEventType.complete&&t.removeFromParent()},this),e.addChild(a)))}var s=t.idx1,r=t.idx2,n=i.effect_name,o=DataMgr.gameCtrl.getChairIdByWheelIdx(s),c=DataMgr.gameCtrl.getChairIdByWheelIdx(r),l=e["role_card"+o]&&e["role_card"+o].getChildByName("head"),_=e["role_card"+c]&&e["role_card"+c].getChildByName("head");if(l&&_){var u=l.head_icon.getParent().convertToWorldSpace(l.head_icon.getPosition()),h=cc.p(e.convertToNodeSpace(u).x,e.convertToNodeSpace(u).y);u=_.head_icon.getParent().convertToWorldSpace(_.head_icon.getPosition());var g=cc.p(e.convertToNodeSpace(u).x,e.convertToNodeSpace(u).y),a=ccs.Armature.create(n);a&&(a.targetpos2=g,a.targetpos1=h,a.chairId1=o,a.chairId2=c,a.getAnimation().play("stand",-1,-1),a.setVisible(!0),a.setPosition(h),a.setZOrder(9999),e.addChild(a),a.getAnimation().setMovementEventCallFunc(function(t,i,a){if(i==ccs.MovementEventType.complete){var s=ModuleMgr.getDlg("GameLayer").getBezierControlPoint(t.targetpos1,t.targetpos2,t.chairId1,t.chairId2),r=[s,s,t.targetpos2],o=cc.BezierTo.create(.6,r),c=cc.RotateTo.create(.6,720),l=cc.RotateTo.create(.6,720),_=cc.Sequence.create(c,l),u=cc.CallFunc.create(function(){var i=ccs.Armature.create(n+"_hit");playEffect("face/"+n+".mp3"),i&&(i.getAnimation().play("stand",-1,-1),i.setPosition(t.targetpos2),e.addChild(i),i.getAnimation().setMovementEventCallFunc(function(t,e,i){e==ccs.MovementEventType.complete&&t.removeFromParent()},this))}),h=cc.Sequence.create(o,cc.CallFunc.create(function(t){t.removeFromParent()},t),u);t.runAction(cc.Spawn.create(_,h))}},this))}},getBezierControlPoint:function(t,e,i,a){var s=cc.p(0,0);return 1==i&&2==a||2==i&&1==a?t.x>e.x?(s.x=e.x+(t.x-e.x)/2+200,s.y=e.y+(t.y-e.y)/2-200):(s.x=t.x+(e.x-t.x)/2+200,s.y=t.y+(e.y-t.y)/2-200):2==i&&3==a||3==i&&2==a?t.x>e.x?SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=t.x-(t.x-e.x)/2-200,s.y=t.y+(e.y-t.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=t.x-(t.x-e.x)/2+200,s.y=t.y+(e.y-t.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=e.x-(e.x-t.x)/2+200,s.y=e.y+(t.y-e.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=t.x+(e.x-t.x)/2+200,s.y=e.y+(t.y-e.y)/2+200):3==i&&4==a||4==i&&3==a?t.x>e.x?SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=e.x+(t.x-e.x)/2+200,s.y=e.y+(t.y-e.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=e.x+(t.x-e.x)/2-200,s.y=e.y+(t.y-e.y)/2+200):(s.x=t.x+(e.x-t.x)/2-200,s.y=t.y+(e.y-t.y)/2+200):1==i&&4==a||4==i&&1==a?t.x>e.x?SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=e.x+(t.x-e.x)/2-200,s.y=e.y+(t.y-e.y)/2-200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=e.x+(t.x-e.x)/2-200,s.y=e.y+(t.y-e.y)/2+200):(s.x=t.x+(e.x-t.x)/2-200,s.y=t.y+(e.y-t.y)/2+200):2==i&&4==a||4==i&&2==a?t.y>e.y?(s.x=e.x+200,s.y=e.y+cc.pDistance(t,e)/2):(s.x=t.x+200,s.y=t.y+cc.pDistance(t,e)/2):(1==i&&3==a||3==i&&1==a)&&(t.y>e.y?(s.x=e.x-200,s.y=e.y+cc.pDistance(t,e)/2):(s.x=t.x-200,s.y=t.y+cc.pDistance(t,e)/2)),s},scoreChangeAction:function(t){t=t||DataMgr.gameCtrl.curRoundScore;for(var e=1;e<=4;e++){var i=t["idx"+e],a=DataMgr.gameCtrl.getChairIdByWheelIdx(e),s=this["role_card"+a];if(s){var r=s.getScore(),n=i-r;0!=n&&s.setAddScore(n,!0)}}},scoreChange:function(t){this.scoreChangeAction()},stepRandMaster:function(){for(var t=this,e=1;e<=4;e++)this["role_card"+e]&&this["role_card"+e].hideMaster();DataMgr.gameCtrl.myWheelIdx==DataMgr.gameCtrl.lastWinIdx,this.scheduleOnce(function(){t.tap_btn_open_door()},this.stepRandMasterTime);var i=function(){var e=DataMgr.gameCtrl.lastWinIdx,i=DataMgr.gameCtrl.getChairIdByWheelIdx(e),a=t["role_card"+i];if(a){t.grp_zhuang.setVisible(!0),t.grp_zhuang.setScale(1),t.grp_zhuang.setPositionX(t.grp_zhuang.oldX),t.grp_zhuang.setPositionY(t.grp_zhuang.oldY);var s=a.getMasterWorldpos(),r=t.grp_zhuang.getParent(),n=r.convertToNodeSpace(s);t.ani_zhuang.getAnimation().play("stand",-1,-1),t.ani_zhuang.getAnimation().setMovementEventCallFunc(function(e,i,a){i==ccs.MovementEventType.complete&&(console.log("==========="+i),t.grp_zhuang.runAction(cc.Sequence.create(cc.Spawn.create(cc.MoveTo.create(.3,n),cc.ScaleTo.create(.3,.7,.7)),cc.CallFunc.create(function(){t.grp_zhuang.setVisible(!1),t.refreshMaster()}))))},t)}};ModuleMgr.runDlg("GameStart",{callback:i},null,null)},refreshMaster:function(){for(var t=1;t<=4;t++)this["role_card"+t]&&this["role_card"+t].hideMaster();var e=DataMgr.gameCtrl.lastWinIdx;if(!(e<0)){var i=DataMgr.gameCtrl.getChairIdByWheelIdx(e);this["role_card"+i]&&this["role_card"+i].showMaster()}},stepOpenDoor:function(){var t=this,e=function(){};this.showShaizi(e);var t=this;this.scheduleOnce(function(){t.onPokerInited(),t.tap_btn_select_rand_poker()},this.stepOpenDoorTime)},onPokerInitedEnd:function(){this.refreshPoker(!0)},onPokerInited:function(){function t(t){t.setVisible(!0),t.idx==s&&e.onPokerInitedEnd()}var e=this;e.grp_my_card.setVisible(!0);var i=DataMgr.gameCtrl.getChairIdxByRid(DataMgr.gameCtrl.myWheelInfo.rid);this["role_card"+i].startGame(),this.refreshPoker(!0,!0);for(var e=this,a=0,s=0,r=1;r<=MY_TOTAL_CARD_NUM;r++){var n=this["item_card_"+r];n.isVisible()&&(n.idx=r,n.setVisible(!1),s=r,a+=.053,n.runAction(cc.Sequence.create(cc.DelayTime.create(.053*r),cc.CallFunc.create(t))))}a+=.053,this.scheduleOnce(function(){e.setDispatchPokerEnable()},a),this.refreshWeakPoker()},getPokerList:function(t){var e=DataMgr.gameCtrl.myCards||[];return e=gDup(e),t||e.sort(sort_card),e},refreshPoker:function(t,e){for(var i=[],a=1;a<=MY_TOTAL_CARD_NUM;a++){var s=this["item_card_"+a];s&&(s.newData=0,s.isOut=!1,s.targetIdx=0,0!=s.getNum()&&i.push(s.getNum()))}var r=function(t,e){t.newData=e},n=this.getPokerList(e),o=n.length;o%3==2&&(this.dispatchPoker(DataMgr.gameCtrl.myWheelIdx,n[o-1]),n.splice(o-1,1));var c=DataMgr.gameCtrl.totalCardNum;if(c==MY_TOTAL_CARD_NUM_TT)if(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT){var l=n.length-1;if(n.length<=8)for(var a=MY_TOTAL_CARD_NUM;a>=1&&!(l<0);a--){var s=this["item_card_"+a];r(s,n[l]),l--}else for(var a=15;a>=1;a--)if(9!=a){if(l<0)break;var s=this["item_card_"+a];r(s,n[l]),l--}}else for(var l=n.length-1,_=0,a=MY_TOTAL_CARD_NUM;a>=1&&!(l<0)&&(_++,!(_>c));a--){var s=this["item_card_"+a];r(s,n[l]),l--}else for(var l=n.length-1,_=0,a=MY_TOTAL_CARD_NUM;a>=1&&!(l<0)&&(_++,!(_>c));a--){var s=this["item_card_"+a];r(s,n[l]),l--}if(!OPEN_CARD_CHANGE_MOVE||t)return void this.doRefreshPoker();var u=this,h=this.getNewPoker(i,n),g=h.newPoker,d=h.outCards;if(0==i.length)return void this.doRefreshPoker();for(var m=[],f=(i.length-1,n.length-1),p=[],a=MY_TOTAL_CARD_NUM;a>=1;a--){var s=this["item_card_"+a];d[s._num]&&d[s._num]>=1&&(d[s._num]--,p.push(s))}if(this.outCard&&1==p.length&&this.outCard.getNum()==p[0].getNum())this.outCard.isOut=!0,m.push(this.outCard);else for(var a=0;a<p.length;a++)p[a].isOut=!0,m.push(p[a]);for(var a=0;a<m.length;a++)cc.log("out idx "+m[a].displayIdx),m[a].setVisible(!1);for(var f=-1,a=MY_TOTAL_CARD_NUM;a>=1;a--){var s=this["item_card_"+a];if(s.newData==g){var M=s.orgPos;f=a,this.item_card_0.setLocalZOrder(1e3),this.item_card_0.setData(g),this.item_card_0.setVisible(!0);var C=this.item_card_dispatch.getPosition();this.item_card_0.setPosition(C),this.item_card_0.stopAllActions(),this.item_card_0.runAction(cc.sequence(cc.delayTime(.3),cc.moveTo(.1,{x:C.x,y:C.y+100}),cc.moveTo(.2,{x:M.x,y:M.y+100}),cc.moveTo(.1,M)))}}cc.log("newIdx "+f);var D=MY_TOTAL_CARD_NUM;DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(D=MY_TOTAL_CARD_NUM-1);for(var b=D,a=D;a>=1;a--){var s=u["item_card_"+a];DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&9==a||0!=s.getNum()&&(s.isOut||(b==f&&b--,DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&9==b&&b--,s.targetIdx=b,b--))}for(var a=D;a>=1;a--){var s=u["item_card_"+a];if(0!=s.targetIdx){s.stopAllActions();var y=u["item_card_"+s.targetIdx];
s.runAction(cc.moveTo(.2,y.orgPos)),cc.log(a+" move to"+s.targetIdx)}}var v=function(){u.doRefreshPoker()},E=cc.sequence(cc.delayTime(.8),cc.callFunc(v));E.setTag(99),this.stopActionByTag(99),this.runAction(E)},getNewPoker:function(t,e){var i=this.getPokerDetail(t),a=this.getPokerDetail(e),s=-1,r=[];for(var n in a)0!=parseInt(n)&&(null==i[n]?s=parseInt(n):a[n]>i[n]&&(s=parseInt(n)));for(var n in i)if(0!=parseInt(n)){var o=0;null==a[n]?o=i[n]:i[n]>a[n]&&(o=i[n]-a[n]);for(var c=0;c<o;c++)r.push(parseInt(n))}return{newPoker:s,outCards:this.getPokerDetail(r)}},getPokerDetail:function(t){for(var e={},i=0;i<t.length;i++)null==e[t[i]]&&(e[t[i]]=0),e[t[i]]++;return e},doRefreshPoker:function(){this.stopActionByTag(99),this.item_card_0.setVisible(!1);for(var t=(DataMgr.gameCtrl.totalCardNum,1);t<=MY_TOTAL_CARD_NUM;t++){var e=this["item_card_"+t];e.setPosition(e.orgPos),e.stopAllActions(),0!=e.newData?(e.setVisible(!0),e.setData(e.newData),e.unSelect()):(e.setData(0),e.setVisible(!1))}this.outCard=null,this.setCardNormal(),this.checkCardCanTouch()},showKing:function(){var t=this,e=1.5;DataMgr.gameCtrl.downRandPokerList.length>0&&(e=DataMgr.gameCtrl.curStep==MJ_STEP_GAME_END||DataMgr.gameCtrl.curStep==MJ_STEP_SHOW_RESULT?2.5:4),t.scheduleOnce(function(){t.setTurnIndexEnable(),t.setSelectActionEnable(),t.grp_last_num&&t.grp_last_num.setVisible(!0)},e+DataMgr.gameCtrl.downRandPokerList.length/2*2);var i={};i.pokerList=DataMgr.gameCtrl.randPokerList,i.showKingType=this.showKingType,i.func=function(){set_king_map(DataMgr.gameCtrl.randPokerList),t.checkKingGrp(),t.refreshPoker(!0),t.dispatchPoker()},ModuleMgr.runDlg("GameShowKing",i,null,null)},stepRandKing:function(){var t=this;t.btn_select_rand_poker.setVisible(!1);var e=DataMgr.gameCtrl.tbDownRandPokerList.length/2*3;t.scheduleOnce(function(){t.showKing()},e+2.5),this.scheduleOnce(function(){t.showShaizi()},e+.5),this.scheduleOnce(function(){t.item_shaizi.setVisible(!1)},e+2.5)},getStepRandKingTime:function(){return this.stepRandKingTime},refreshPiao:function(t){},showDiLeiAni:function(t){for(var e=(DataMgr.gameCtrl.deskInfo.full_num,DataMgr.gameCtrl.lastWinIdx,t),i=DataMgr.gameCtrl.getChairIdByWheelIdx(e),a=1;a<=4;a++){var s=this["role_card"+a];s&&a==i&&s.showDiLeiAni()}},hideDiLeiAni:function(){for(var t=1;t<=4;t++){var e=this["role_card"+t];e&&e.hideDiLeiAni()}},showDownKing:function(t){var e=this,i=[],a=[],s=0,r=0;if(1==t?(i=DataMgr.gameCtrl.tbDownRandPokerList,a=DataMgr.gameCtrl.tbWheelDownPokerMap,s=.5,r=0):(i=DataMgr.gameCtrl.downRandPokerList,a=DataMgr.gameCtrl.wheelDownPokerMap,s=s+2+DataMgr.gameCtrl.tbDownRandPokerList.length/2*3,r=DataMgr.gameCtrl.deskType),4!=r){DataMgr.gameCtrl.curStep==MJ_STEP_SELECT_RAND_POKER&&(s+=2.5),DataMgr.gameCtrl.curStep==MJ_STEP_PLAY&&(s-=2);var n=Math.floor(i.length/2),o=function(t){if(e.hideDiLeiAni(),t>=n)return void e.item_down_king.setVisible(!1);4==r&&e.showDiLeiAni(t);var s=i[2*t],c={};c.num=s,c.deskType=r,c.index=t+1,c.func1=function(){for(var i=1;i<=4;i++){var s=a[i];if(s){var r=s[t];if(r){var n=DataMgr.gameCtrl.getChairIdByWheelIdx(i);e["role_card"+n]&&e["role_card"+n].showDownKing(r)}}}},c.func2=function(){for(var t=1;t<=4;t++)e["role_card"+t]&&e["role_card"+t].hideDownKing()},c.func3=function(){o(t+1),0==r&&DataMgr.gameCtrl.isLog&&(e.item_back_card&&e.item_back_card.setVisible(!0),e.item_back_card&&e.item_back_card.setData(i[0]),e.lab_back_card&&e.lab_back_card.setVisible(!0))},e.item_down_king.setVisible(!0),e.item_down_king.setData(c)};this.scheduleOnce(function(){o(0)},s)}},stepFixFlower:function(){},addFlowerAction:function(t){if(t){var e=DataMgr.gameCtrl.myWheelIdx,i=t.getContentSize(),a=t.getScale(),s=t.getPositionX()+i.width*a*.5,r=t.getPositionY()+i.height*a*.5-10*a,n=ccs.Armature.create("hua_pai");n.getAnimation().play("stand",-1,-1),n.getAnimation().setMovementEventCallFunc(this.flowerAnimationEvent,this),n.setAnchorPoint(.5,.5),n.setPositionX(s),n.setPositionY(r),this.grp_my_card.addChild(n);var o=this.item_sub_card_4.getFlowerPokerCfg(0),c=o.pos,l=this.item_sub_card_4.convertToWorldSpace(c),_=this.grp_my_card.convertToNodeSpace(l);n.targetPos=_,n.idx=e,n.poker=t.getNum()}},flowerAnimationEvent:function(t,e,i){if(e==ccs.MovementEventType.complete){var a=this,s=t.targetPos,r=t.idx,n=t.poker;t.runAction(cc.Sequence.create(cc.Spawn.create(cc.MoveTo.create(.3,s),cc.ScaleTo.create(.3,.3)),cc.CallFunc.create(function(){var e=DataMgr.gameCtrl.getChairIdByWheelIdx(r),i=a["role_card"+e];i&&i.addFlowerPokers(n),t.removeFromParent()})))}},refreshFixFlower:function(){for(var t=DataMgr.gameCtrl.deskInfo.full_num,e=1;e<=t;e++){var i=DataMgr.gameCtrl.wheelInfos[e];if(i){var a=DataMgr.gameCtrl.getChairIdByWheelIdx(e),s=i.flower_list||[];this["role_card"+a]&&this["role_card"+a].refreshFlowerPokers(s)}}},addFixFlower:function(t){var e=this;if(DataMgr.gameCtrl.curStep==MJ_STEP_PLAY){var i=DataMgr.gameCtrl.wheelInfos[t];if(i){var a=DataMgr.gameCtrl.getChairIdByWheelIdx(t),s=this["role_card"+a];if(s&&!e.isAddFixFlower){e.isAddFixFlower=!0;var r=s.flowerList.length,n=function(a){var o=i.flower_list||[],c=o[a+r];return c?(t==DataMgr.gameCtrl.myWheelIdx?(e.item_card_dispatch.setData(c),e.item_card_dispatch.unSelect(),e.addFlowerAction(e.item_card_dispatch)):s.addFlowerPokers(c),void e.scheduleOnce(function(){n(a+1),e.playActionEfc(t,{mj_action:MJ_FLOWER})},1)):(e.isAddFixFlower=!1,t==DataMgr.gameCtrl.myWheelIdx&&e.dispatchPoker(),void e.selectAction())};n(0)}}}},showCard:function(t){},refreshResultPokers:function(){for(var t=DataMgr.gameCtrl.resultData,e=t.details,i=0;i<e.length;i++){var a=e[i],s=a.idx||i+1;if(s!=DataMgr.gameCtrl.myWheelIdx){var r=DataMgr.gameCtrl.getChairIdByWheelIdx(s),n=this["role_card"+r];n&&n.refreshResultPokers(a.poker_list,t.last_dispatch_poker)}}playEffect("tanpai.mp3")},showSubResult:function(){for(var t={},e=1;e<=4;e++){var i=DataMgr.gameCtrl.curRoundScore["idx"+e],a=DataMgr.gameCtrl.getChairIdByWheelIdx(e),s=this["role_card"+a];if(s&&!DataMgr.gameCtrl.isLog){var r=s.getScore(),n=i-r;e==DataMgr.gameCtrl.myWheelIdx?t.addScore=n:s.setAddScore(n)}}var o=this;t.callBack=function(){o.clearResuleCard()},ModuleMgr.runDlg("GameResultSub",t,null,null),ModuleMgr.runOrientationDlg("GameResult"),this.refreshRoleScore()},clearResuleCard:function(){var t=this;t.hideDispatchPoker();for(var e=1;e<=4;e++)t["role_card"+e]&&(t["role_card"+e].setResultStatus(),t["role_card"+e].hideAddScore());t.grp_my_card&&t.grp_my_card.setVisible(!1),t.item_king_1&&t.item_king_1.setVisible(!1),t.item_king_2&&t.item_king_2.setVisible(!1),t.grp_last_num&&t.grp_last_num.setVisible(!1)},showResult:function(){var t=this;t.item_turn.setVisible(!1),t.grp_myBtn.setVisible(!1),t.item_shaizi.setVisible(!1),t.isTurning=!1,t.isAction=!1,t.isDispatchPoker=!1,this.refreshResultPokers();var e=0;DataMgr.gameCtrl.huIdx>0?(this.playActionEfc(DataMgr.gameCtrl.huIdx,{mj_action:MJ_HU}),e=2):(t.grp_liuju&&t.grp_liuju.setVisible(!0),t.ani_liuju&&t.ani_liuju.getAnimation().play("stand",-1,-1),t.ani_liuju&&t.ani_liuju.getAnimation().setMovementEventCallFunc(function(e,i,a){i==ccs.MovementEventType.complete&&t.grp_liuju.setVisible(!1)},t),e=3);for(var i=!1,a=DataMgr.gameCtrl.huTypeList||[],s=0;s<a.length;s++)if(a[s]==MJ_ZI_MO){i=!0;break}if(!i&&DataMgr.gameCtrl.huIdx!=-1)for(var s=1;s<=4;s++)t["role_card"+s]&&t["role_card"+s].playDiaoPao();this.showResultDlg(e)},showResultDlg:function(t){if(4==DataMgr.gameCtrl.deskType)this.scheduleOnce(function(){ModuleMgr.runDlg("GameNcmjMineDlg")},t);else{var e=this,i=DataMgr.gameCtrl.downRandPokerList,a=Math.floor((i.length||0)/2);1==DataMgr.gameCtrl.deskType&&(a=0),this.scheduleOnce(function(){e.showSubResult()},t+3.5*a)}},playActionEfc:function(t,e){if(e){var i=DataMgr.gameCtrl.getChairIdByWheelIdx(t),a=this["role_card"+i];if(a){var s=0;if(e.mj_action==MJ_CHI||e.mj_action==MJ_PENG||e.mj_action==MJ_GANG||e.mj_action==MJ_AN_GANG||e.mj_action==MJ_BU_GANG){var r=DataMgr.gameCtrl.wheelInfos[t];if(r){var n=DataMgr.gameCtrl.wheelInfos[t].weave_pokers||[];if(s=n.length,e.mj_action==MJ_BU_GANG)for(var o=0;o<n.length;o++)if(e.poker_list[0]==n[o].poker_list[0]){s=o+1;break}}}a.playActionEfc(s,e,n)}this.clearMyBtn(e)}},clearMyBtn:function(t){t&&(t.mj_action!=MJ_PENG&&t.mj_action!=MJ_GANG&&t.mj_action!=MJ_AN_GANG&&t.mj_action!=MJ_BU_GANG&&t.mj_action!=MJ_HU||this.grp_myBtn&&this.grp_myBtn.clear())},refreshRoleScore:function(){if(DataMgr.gameCtrl.curRoundScore)for(var t=1;t<=4;t++){var e=DataMgr.gameCtrl.curRoundScore["idx"+t],i=DataMgr.gameCtrl.getChairIdByWheelIdx(t);this["role_card"+i]&&this["role_card"+i].setScore(e)}},checkKingGrp:function(){},selectAction:function(){this.isAction&&this.grp_myBtn.setAction()},setSelectActionEnable:function(){var t=this;t.isAction=!0,t.selectAction()},hideCurOutCard:function(){for(var t=1;t<=4;t++){var e=this["role_card"+t];e&&e.isVisible()&&this["role_card"+t].hideCurOutCard()}},initRoleCard4:function(){this.role_card4&&(this.grp_sub_out_card_4&&this.role_card4.setOutCardGrp(this.grp_sub_out_card_4),this.item_sub_cur_out_card_4&&this.role_card4.setCurOutCard(this.item_sub_cur_out_card_4),this.item_sub_card_4&&this.role_card4.setCardLayer(this.item_sub_card_4),this.item_sub_down_king_4&&this.role_card4.setDownKingItem(this.item_sub_down_king_4),this.item_sub_action_efc_4&&this.role_card4.setCardActionEfc(this.item_sub_action_efc_4),this.item_sub_ting_4&&this.role_card4.setTingLayer(this.item_sub_ting_4))},initUi:function(){this.btn_ready.setVisible(!1),this.item_turn.setVisible(!1),this.item_shaizi.setVisible(!1),this.item_card_dispatch.setVisible(!1),this.item_king_1.setVisible(!1),this.item_king_2.setVisible(!1),this.btn_invite.setVisible(!1),this.grp_my_card.setVisible(!1),this.btn_start_game.setVisible(!1),this.item_down_king.setVisible(!1),this.grp_log.setVisible(!1),this.item_back_card&&this.item_back_card.setVisible(!1),this.lab_back_card&&this.lab_back_card.setVisible(!1),this.grp_zhuang.setVisible(!1),this.grp_zhuang.oldX=this.grp_zhuang.getPositionX(),this.grp_zhuang.oldY=this.grp_zhuang.getPositionY(),this.grp_action_mb.oldX=this.grp_action_mb.getPositionX(),this.grp_action_mb.oldY=this.grp_action_mb.getPositionY(),this.grp_myBtn.setVisible(!1),this.grp_myBtn.setData({delegate:this}),this.item_card_out&&this.item_card_out.setVisible(!1),this.grp_btn_ting&&this.grp_btn_ting.setVisible(!1),this.grp_select_piao&&this.grp_select_piao.setVisible(!1),this.grp_liuju&&this.grp_liuju.setVisible(!1),this.grp_log_btn&&this.grp_log_btn.setVisible(!1),this.grp_p_btn&&this.grp_p_btn.setVisible(!0),cc.sys.isNative?this.img_down_app&&this.img_down_app.setVisible(!1):this.img_down_app&&this.img_down_app.setVisible(!0)},initMyCardGrp:function(){if(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE){var t=winSizeWidthBigger.width/960;t=t>=1?t:1;var e=1.1*t,i=0;DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&(e=1.3*t,i=48.96*e*3/2),this.grp_my_card&&(this.grp_my_card.setScale(e),this.grp_my_card.setPositionX(this.grp_my_card.getPositionX()-i)),this.item_sub_card_4&&this.item_sub_card_4.setScale(t)}},onLoaded:function(){this.setDeskBg(),this.initUi();for(var t=1;t<=MY_TOTAL_CARD_NUM;t++){var e=this["item_card_"+t];e&&(e.orgPos=e.getPosition(),e.displayIdx=t)}this.initRoleCard4(),this.initMyCardGrp(),this.refreshRound(),this.onAllUiLoaded(),this.checkShowStart(),this.hideChatLayer(),this.refreshDesk(),this.checkKingGrp(),this.selectAction(),this.playOutCard(),this.refreshRoleScore(),this.stepChange();var i=this,a=function(t){i.isScreenRotationDirty=!0};this.addListener("screen_change",a),this.dealEventStack(),0==cc.sys.isNative&&doGameShare()},setDeskBg:function(){var t=DataMgr.gameCtrl.getBgId(),e="res/uires/game/desk/bg.png";1==t||2==t?(e="res/uires/game/desk/bg_"+t+".png",RegisterReplacePathMap("res/uires/game/desk/bg.png",e)):RegisterReplacePathMap("res/uires/game/desk/bg.png","res/uires/game/desk/bg.png"),e=GetRealPath(e),this.img_bg&&this.img_bg.loadTexture(e)},setDeskCardBg:function(){for(var t=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0),e=1;e<=MY_TOTAL_CARD_NUM;e++){var i=this["item_card_"+e];i&&i.setCardBg(t)}var i=this.item_card_dispatch;i&&i.setCardBg(t);for(var e=1;e<=4;e++)this["role_card"+e]&&this["role_card"+e].setCardBg(t)},onAllUiLoaded:function(){for(var t=1;t<=4;t++)if(null==this["role_card"+t])return void console.log("card "+t+" empty");if(this.refreshPlayers(),"dissolve"==DataMgr.gameCtrl.deskStatus&&this.scheduleOnce(function(){ModuleMgr.runDlg("GameDissolve")},1),this.btn_invite.setVisible(!1),this.btn_select_rand_poker.setVisible(!1),this.btn_open_door.setVisible(!1),this.btn_ready.setVisible(!1),1==DataMgr.gameCtrl.deskInfo.is_need_room_card&&this.checkContinueBuy(),this.isPlaying=!0,this.isTurning=!1,this.isAction=!1,this.grp_last_num&&this.grp_last_num.setVisible(!0),DataMgr.gameCtrl.deskInfo){var e=DataMgr.gameCtrl.deskInfo.cur_step;e==MJ_STEP_DEAL_END?this.onPokerInited():e==MJ_STEP_SHOW_RESULT?(this.onPokerInited(),this.refreshResultPokers(),1!=DataMgr.gameCtrl.myWheelInfo.is_score_end&&(4==DataMgr.gameCtrl.deskType?this.refreshMineDlg(!0):this.scheduleOnce(function(){ModuleMgr.runOrientationDlg("GameResult")},1))):DataMgr.gameCtrl.isBeforeGame()?(this.grp_last_num&&this.grp_last_num.setVisible(!1),this.btn_invite.setVisible(!0),0==this.role_card4.isReady&&this.btn_ready.setVisible(!0),DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()&&1==this.startType&&(this.tap_do_btn_ready(),this.btn_ready.setVisible(!1)),this.isPlaying=!1):e==MJ_STEP_GAME_END?this.isPlaying=!1:e==MJ_STEP_OPEN_DOOR?this.tap_btn_open_door():e==MJ_STEP_PLAY?(this.onPokerInited(),this.setTurnIndexEnable(),this.setSelectActionEnable()):e==MJ_STEP_INIT_POKER?this.onPokerInited():e==MJ_STEP_SELECT_RAND_POKER&&(this.tap_btn_select_rand_poker(),this.onPokerInited())}this.refreshRoomState()},stepChange:function(){var t=DataMgr.gameCtrl.curStep;DataMgr.gameCtrl.isBeforeGame()?(this.grp_l_btn.setVisible(!0),DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()?this.btn_l_dissolve.setVisible(!0):this.btn_l_dissolve.setVisible(!1),this.grp_last_num&&this.grp_last_num.setVisible(!1)):this.grp_l_btn.setVisible(!1),t==MJ_STEP_DEAL_START&&this.refreshDesk()},checkShowStart:function(){DataMgr.gameCtrl.curStep;this.btn_start_game.setVisible(!1),DataMgr.gameCtrl.isBeforeGame()&&1==this.startType&&DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()&&this.btn_start_game.setVisible(!0)},onSuccessInit:function(){QPLayer.prototype.onSuccessInit.call(this);var t=this,e=cc.LayerColor.create(cc.color(0,0,0,0));e.setContentSize(cc.size(3*winSizeWidthBigger.height,3*winSizeWidthBigger.width)),e.setPosition(cc.p(-winSizeWidthBigger.height,-winSizeWidthBigger.width));var i=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e,i){return t.onTouchBegan(e,i)},onTouchMoved:function(e,i){t.onTouchMoved(e,i)},onTouchEnded:function(e,i){t.onTouchEnded(e,i)},onTouchCancelled:function(e,i){t.onTouchCancelled(e,i)}});e.onExit=function(){cc.LayerColor.prototype.onExit.call(e),cc.eventManager.removeListener(i)},cc.eventManager.addListener(i,e),t.addChild(e)},checkSelect:function(t){for(var e=1;e<=4;e++){var i=this["role_card"+e];i.checkSelect(t)}},getTouchCardIndex:function(t,e){for(var i=this.grp_my_card.getScaleX(),a=this.grp_my_card.getScaleY(),s=MY_TOTAL_CARD_NUM;s>=1;s--)if(s!=e){var r=this["item_card_"+s],n=getNodeWorldRect(r);if(n.width=n.width*i,n.height=n.height*a,SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE){var o=ModuleMgr.getScreenRotation();o==-90?(n.x=n.x+10*i,n.height=n.height+20*a,r.bolSelect()&&(n.x=n.x+20*i,n.height=n.height+20*a)):90==o&&(n.x=n.x-10*i,n.height=n.height+20*a,r.bolSelect()&&(n.x=n.x-20*i,n.height=n.height+20*a)),n=ModuleMgr.switchNodeRect(n)}else r.bolSelect()&&(n.y=n.y-20*a,n.height=n.height+20*a);if(r&&r.isCanTouch()&&cc.rectContainsPoint(n,t))return s}if(0!=e){var c=this.item_card_dispatch,n=getNodeWorldRect(c);if(n.width=n.width*i,n.height=n.height*a,SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE){var o=ModuleMgr.getScreenRotation();o==-90?(n.x=n.x+10*i,n.height=n.height+20*a,c.bolSelect()&&(n.x=n.x+20*i,n.height=n.height+20*a)):90==o&&(n.x=n.x-10*i,n.height=n.height+20*a,c.bolSelect()&&(n.x=n.x-20*i,n.height=n.height+20*a)),n=ModuleMgr.switchNodeRect(n)}else c.bolSelect()&&(n.y=n.y-20*a,n.height=n.height+20*a);if(c&&c.isCanTouch()&&cc.rectContainsPoint(n,t))return 0}return-1},getTouchCard:function(t){var e=null;return e=0==t?this.item_card_dispatch:this["item_card_"+t]},onTouchBegan:function(t,e){if(this.layer_chat&&this.layer_chat.isVisible())return this.layer_chat.setVisible(!1),!1;if(!this.isTurning)return!1;var i=this.getMyBtnVisible();return!i},tapCardIndex:-1,onTouchMoved:function(t,e){if(this.grp_my_card&&this.grp_my_card.isVisible()){var i=t.getLocation(),a=this.getTouchCardIndex(i,this.touchMoveCardIndex);if(a>=0&&!this.bolCardMove){this.touchMoveCardIndex=a,this.unselectAllPoker();var s=this.getTouchCard(a);s&&(playEffect("xuanpai.mp3"),s.setSelect(),this.checkSelect(s.getNum()))}else{var s=this.getTouchCard(this.touchMoveCardIndex);if(!s)return;var r=this.grp_my_card.convertToNodeSpace(i),n=s.getContentSize(),o=s.getScale(),c=s.getOldX(),l=s.getOldY();r.x>=c&&r.x<=c+n.width*o&&r.y>=l&&r.y<=l+n.height*o?(this.bolCardMove&&(this.unselectAllPoker(),s.setSelect()),this.bolCardMove=!1):DataMgr.gameCtrl.curIndex==DataMgr.gameCtrl.myWheelIdx&&this.item_card_dispatch.isVisible()&&r.y>=l+n.height*o?this.bolCardMove=!0:this.bolCardMove=!1,this.bolCardMove&&(this.tapCardIndex=-1,s.setPositionX(r.x-n.width*o*.5),s.setPositionY(r.y-n.height*o*.5))}}},getMyBtnVisible:function(){return!!this.grp_myBtn&&this.grp_myBtn.isVisible()},onTouchEnded:function(t,e){if(this.grp_my_card){var i=t.getLocation();if(this.bolCardMove&&this.touchMoveCardIndex>=0){var a=this.getTouchCard(this.touchMoveCardIndex);if(a){var s=a.getContentSize(),r=a.getScale(),n=a.getOldX(),o=a.getOldY(),c=this.grp_my_card.convertToNodeSpace(i);c.x>=n&&c.x<=n+s.width*r&&c.y>=o&&c.y<=o+s.height*r||this.tap_btn_out(a)||this.unselectAllPoker()}return this.bolCardMove=!1,this.touchMoveCardIndex=-1,void(this.touchCardIndex=-1)}if(this.bolCardMove=!1,this.touchMoveCardIndex=-1,this.grp_my_card.isVisible()&&!this.getMyBtnVisible()){var i=t.getLocation(),l=this.getTouchCardIndex(i);if(l==-1)return void(this.touchInterval<=0?this.touchInterval=(new Date).getTime():(new Date).getTime()-this.touchInterval<500?(this.touchInterval=0,this.touchCardIndex=-1,this.tapCardIndex=-1,this.unselectAllPoker()):this.touchInterval=(new Date).getTime());var a=this.getTouchCard(l);if(a)return l==this.tapCardIndex?(this.tap_btn_out(a)||this.unselectAllPoker(),void(this.tapCardIndex=-1)):(this.unselectAllPoker(),this.tapCardIndex=l,a&&(a.bolSelect()||(playEffect("xuanpai.mp3"),a.setSelect()),this.checkSelect(a.getNum())),void 0)}}},onTouchCancelled:function(t,e){this.onTouchEnded(t,e)},dispatchPoker:function(t,e){if(!this.isDispatchPoker)return!1;if(e=e||DataMgr.gameCtrl.lastDispatchPoker,t=t||DataMgr.gameCtrl.lastDispatchIdx,e>0&&t==DataMgr.gameCtrl.myWheelIdx)this.item_card_dispatch.setData(e),this.item_card_dispatch.unSelect(),this.setCardNormal();else{var i=DataMgr.gameCtrl.getChairIdByWheelIdx(t);this["role_card"+i]&&this["role_card"+i].dispatchPoker(0)}return!0},setDispatchPokerEnable:function(){var t=this;t.isDispatchPoker=!0,t.dispatchPoker()},hideDispatchPoker:function(){for(var t=1;t<=4;t++)this["role_card"+t]&&this["role_card"+t].hideDispatchPoker();this.item_card_dispatch.setVisible(!1)},turnIndex:function(t){if(this.isTurning){this.item_shaizi.setVisible(!1),this.item_turn.setVisible(!0);var e=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.curIndex);this.item_turn.turn(e),this.checkCardCanTouch()}},setTurnIndexEnable:function(){var t=this;t.isTurning=!0,t.turnIndex()},checkCardCanTouch:function(){},checkCardSelectMove:function(t){for(var e=!1,i=0,a=1;a<=MY_TOTAL_CARD_NUM;a++){var s=this["item_card_"+a];s&&s.isVisible()&&(e&&(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&i<=8?a<=8&&s.setSelectMove():s.setSelectMove()),s.bolSelect()&&(e=!0,i=a))}e&&this.item_card_dispatch&&this.item_card_dispatch.isVisible()&&(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT?i>8&&this.item_card_dispatch.setSelectMove():this.item_card_dispatch.setSelectMove())},setCardTouch:function(t){t=!!t;for(var e=1;e<=MY_TOTAL_CARD_NUM;e++){var i=this["item_card_"+e];i&&i.setTouchEnable(t)}var i=this.item_card_dispatch;i&&i.setTouchEnable(t)},setCardVisible:function(t){t=!!t;for(var e=1;e<=MY_TOTAL_CARD_NUM;e++){var i=this["item_card_"+e];i&&i.setVisible(t)}var i=this.item_card_dispatch;i&&i.setVisible(t)},setCardDisable:function(){for(var t=1;t<=MY_TOTAL_CARD_NUM;t++){var e=this["item_card_"+t];e&&e.setDisable(!0)}var e=this.item_card_dispatch;e&&e.setDisable(!0)},setCardNormal:function(){for(var t=1;t<=MY_TOTAL_CARD_NUM;t++){var e=this["item_card_"+t];e&&e.setNormal(!0)}var e=this.item_card_dispatch;e&&e.setNormal(!0)},setCardSelect:function(){},hidePutOutArrowAni:function(){for(var t=1;t<=4;t++)this["role_card"+t].hidePutOutArrowAni()},playOutCard:function(t){if(DataMgr.gameCtrl.deskInfo.cur_step==MJ_STEP_PLAY){this.hidePutOutArrowAni();var e=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.lastOutPokerIdx),i=this["role_card"+e];i&&i.playOutCard(DataMgr.gameCtrl.lastOutPoker,t)}},noAction:function(){var t=DataMgr.gameCtrl.lastOutPokerIdx,e=DataMgr.gameCtrl.getChairIdByWheelIdx(t);this["role_card"+e]},downOutCard:function(){},dealPoker:function(){var t=this;DataMgr.gameCtrl.lastOutPokerIdx==DataMgr.gameCtrl.myWheelIdx||(playEffect("chupai.mp3"),t.playOutCard()),t.checkSelect(0)},dealPokerError:function(){var t=this;t.unselectAllPoker(),t.item_sub_cur_out_card_4&&t.item_sub_cur_out_card_4.setVisible(!1),t.item_card_out&&t.item_card_out.stopActionByTag(999),t.item_card_out&&t.item_card_out.setVisible(!1),this.refreshPoker()},bolTurnSelf:function(){return DataMgr.gameCtrl.curIndex==DataMgr.gameCtrl.myWheelIdx&&(DataMgr.gameCtrl.curStep==MJ_STEP_PLAY&&!(this.item_card_dispatch&&!this.item_card_dispatch.isVisible()))},bolCardCanOut:function(t){return DataMgr.gameCtrl.curIndex!=DataMgr.gameCtrl.myWheelIdx?(ModuleMgr.showTipMsg("还未轮到您出牌"),!1):DataMgr.gameCtrl.curStep!=MJ_STEP_PLAY?(ModuleMgr.showTipMsg("游戏不在进行中！"),!1):!(this.item_card_dispatch&&!this.item_card_dispatch.isVisible())},outAction:function(t){if(t){var e=t.getNum();DataMgr.gameCtrl.myWheelInfo&&(this.hidePutOutArrowAni(),this.role_card4&&this.role_card4.playOutCard(e))}},calDealPoker:function(t){ME_D.send_message_waiting(CMD_ROOM_MESSAGE,"desk_op",{oper:"deal_poker",poker_list:[t]})},tap_btn_out:function(t){var e=t.getNum();return this.outCard=t,this.checkSelect(0),!!this.bolCardCanOut(t)&&(DataMgr.gameCtrl.actionList.length>0&&(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_cancel"}),DataMgr.gameCtrl.actionList=[]),this.calDealPoker(e),t.setVisible(!1),this.outAction(t),this.setCardNormal(),!0)},unselectAllPoker:function(){for(var t=1;t<=MY_TOTAL_CARD_NUM;t++){var e=this["item_card_"+t];e.unSelect()}this.item_card_dispatch.unSelect()},getCardItemList:function(t){for(var e=[],i=1;i<=MY_TOTAL_CARD_NUM;i++){var a=this["item_card_"+i];a&&a.isVisible()&&a.getNum()==t&&e.push(a)}return this.item_card_dispatch&&this.item_card_dispatch.isVisible()&&this.item_card_dispatch.getNum()==t&&e.push(this.item_card_dispatch),e},hidePlayPoker:function(t){this["role_card"+t]&&this["role_card"+t].hideCards()},clearPlayPoker:function(){for(var t=1;t<=4;t++)this.hidePlayPoker(t)},onExit:function(){QPLayer.prototype.onExit.call(this)},sortMoreBtnGrp:function(){},refreshRoomState:function(){this.btn_close.setVisible(!1),this.isPlaying?this.btn_close.setVisible(!0):DataMgr.gameCtrl.isOwer()&&this.btn_close.setVisible(!0),this.btn_invite_club.setVisible(!1),this.isPlaying||DataMgr.gameCtrl.deskInfo.union_rid&&this.btn_invite_club.setVisible(!0)},showShaizi:function(t){var e=(DataMgr.gameCtrl.curStep,DataMgr.gameCtrl.randNum1),i=DataMgr.gameCtrl.randNum2;this.item_shaizi.setVisible(!0),this.item_shaizi.show(e,i,t)},refreshWeakPoker:function(){for(var t=DataMgr.gameCtrl.deskInfo.full_num,e=1;e<=t;e++){var i=DataMgr.gameCtrl.wheelInfos[e];if(i){var a=DataMgr.gameCtrl.getChairIdByWheelIdx(e),s=this["role_card"+a];s&&s.isVisible()&&s.refreshPokers(i.weave_pokers)}}},refreshRound:function(){if(DataMgr.gameCtrl.deskInfo){var t=DataMgr.gameCtrl.deskInfo.cur_round+"/"+DataMgr.gameCtrl.deskInfo.full_round;this.txt_round.setString(t)}},reBuyCardStart:function(){this.refreshRound(),this.refreshDesk();for(var t=1;t<=4;t++)this["role_card"+t].setInitStatus(),this["role_card"+t].setWait();this.btn_ready.setVisible(!0),DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()&&1==this.startType&&(this.tap_do_btn_ready(),this.btn_ready.setVisible(!1)),this.refreshRoleScore(),this.refreshRoomState(),this.refreshPoker()},checkContinueBuy:function(){this.gameOver()},gameOver:function(){var t={},e=DataMgr.gameCtrl.getPlayerByRid(DataMgr.gameCtrl.deskInfo.desk_own_rid);e&&(t.ownerName=e.info.name,t.ownerRid=DataMgr.gameCtrl.deskInfo.desk_own_rid),t.deskId=DataMgr.gameCtrl.deskInfo.desk_idx,t.round=DataMgr.gameCtrl.deskInfo.full_round,t.creatTime=DataMgr.gameCtrl.deskInfo.desk_create_time,t.crazyLv=DataMgr.gameCtrl.deskInfo.crazy_lv,t.deskScoreType=DataMgr.gameCtrl.deskInfo.desk_score_type,t.players=[],t.recordId=DataMgr.gameCtrl.recordId,t.hasBigPoker=DataMgr.gameCtrl.hasBigPoker;var i=ConvertToJson(DataMgr.gameCtrl.recordDetail);t.deskScoreType=i.desk_score_type;var a=i.score,s=i.users,r=i.mj_count_list||[];t.replayRecords=i.replay_records;for(var n=0;n<s.length;n++){var o=n+1,c=s[n];if(c.rid){var l={headUrl:c.headimgurl,baseScore:0,score:a["idx"+o],name:c.name,rid:c.rid,accountUid:c.account_uid,mjCountData:r[n]};t.players.push(l)}}this.openRecordDetail(t)},openRecordDetail:function(t){},SuccessStartGame:function(){var t=this;if(DataMgr.gameCtrl.deskInfo.cur_round>DataMgr.gameCtrl.deskInfo.full_round)return void t.refreshRound();t.isPlaying=!0,DataMgr.gameCtrl.myWheelInfo.is_show_card=0,t.btn_ready.setVisible(!1),this.btn_invite.setVisible(!1),this.refreshRound();for(var t=this,e=1;e<=4;e++)DataMgr.gameCtrl.deskPlayers[e]&&(t["role_card"+e].startGame(),t["role_card"+e].setReady(0));t.item_back_card&&t.item_back_card.setVisible(!1),t.lab_back_card&&t.lab_back_card.setVisible(!1)},onStartGame:function(){self.btn_ready.setVisible(!1),self.btn_invite.setVisible(!1),this.btn_invite_club.setVisible(!1)},tap_do_invite_club:function(){if(DataMgr.gameCtrl.deskInfo.union_rid){var t=" (普通房)";DataMgr.gameCtrl.deskInfo.match_rid&&(t=" (赛制房)");var t=GAME_NAME+"房号:"+DataMgr.gameCtrl.deskIdx+t,e=SHARE_INVITE_DESC();ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"share_to_match",title:t,content:e})}},refreshDeskOwn:function(){for(var t=1;t<=4;t++)this["role_card"+t].setOwner(DataMgr.gameCtrl.deskInfo.desk_own_rid)},refreshGameTypeTxt:function(){var t=DataMgr.gameCtrl.deskInfo,e="";if(t)for(var i=0;i<this.deskTypeKeyArr.length;i++){var a=this.deskTypeKeyArr[i],s=GAME_TYPE_CFG[a][t[a]||0];s&&(e+=s+"  ")}if(this.txt_desk_type&&this.bg_desk_type){this.txt_desk_type.setString(e);var r=this.bg_desk_type.getContentSize(),n=this.txt_desk_type.getContentSize();this.bg_desk_type.setVisible(!0),this.bg_desk_type.setContentSize(cc.size(n.width+20,r.height))}},refreshDesk:function(){DataMgr.gameCtrl.sortPlayers(),this.txt_desk_idx.setString(DataMgr.gameCtrl.deskIdx),this.refreshLastPokerNum(),this.lab_game_type_1&&this.lab_game_type_1.setVisible(!1),this.grp_game_type_2&&this.grp_game_type_2.setVisible(!1),this.refreshDeskOwn(),this.refreshGameTypeTxt()},refreshLastPokerNum:function(){this.txt_last_num&&this.txt_last_num.setString(DataMgr.gameCtrl.remainPokerNum)},refreshPlayersOnline:function(){if(DataMgr.gameCtrl.deskPlayers)for(var t=1;t<=4;t++)if(DataMgr.gameCtrl.deskPlayers[t]){var e=DataMgr.gameCtrl.deskPlayers[t].wheel_idx,i=DataMgr.gameCtrl.online[e];DataMgr.gameCtrl.deskPlayers[t].rid==ME_D.get_rid()&&(i=!0),this["role_card"+t]&&this["role_card"+t].setOnline(i)}},update:function(t){if(this.musicDt+=t,this.musicDt>=.2&&(this.musicDt=0),this.heartDt+=t,this.heartDt>=3){this.heartDt-=3,this.sendHeadTime=parseInt((new Date).getTime()%1e7);var e=this.sendHeadTime;WsNetwork.getInstance().sendMessage(CMD_CHECK_HEART,{cmstime:e})}if(0!=DataMgr.timeCtrl.disMstime){var i=DataMgr.timeCtrl.disMstime,a=(this.sendHeadTime-3e3-DataMgr.timeCtrl.cmstime)/2;if(a>i&&(i=a),i<=0&&(i=0),this.lab_network_time&&this.icon_network_time){this.lab_network_time.setString(Math.floor(i)+"ms");var s=GetRealPath("res/uires/game/signal1_3.png");i<=100?(s=GetRealPath("res/uires/game/signal1_3.png"),this.lab_network_time.setColor(cc.color(0,255,0))):i<=200?(s=GetRealPath("res/uires/game/signal1_2.png"),this.lab_network_time.setColor(cc.color(255,255,0))):(s=GetRealPath("res/uires/game/signal1_1.png"),this.lab_network_time.setColor(cc.color(255,0,0))),this.icon_network_time.loadTexture(s)}}if(this.updateDt+=t,!(this.updateDt<.2)){if(this.updateDt-=.2,this.isScreenRotationDirty&&(this.isScreenRotationDirty=!1,0==cc.sys.isNative&&__BrowserGetter)){var r=__BrowserGetter.availWidth(cc.EGLView._getInstance()._frame),n=__BrowserGetter.availHeight(cc.EGLView._getInstance()._frame);return r>n?DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE):DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_PROTRAIT),this.close(),ModuleMgr.runOrientationDlg(GAME_LAYER_NAME),void(r>n&&ModuleMgr.showConfirmTxtMsg("手机锁定屏幕,体验更佳 "))}if(1==this.endRecord&&Date.parse(new Date)-this.recordTime>800&&(this.txt_record.setVisible(!1),this.endRecord=!1,platform.stopRecord()),1==this.startRecord){if(this.startRecord=!1,this.endRecord)return;platform.startRecord()}platform.retRecordStartPlay&&(cc.eventManager.dispatchCustomEvent("SuccessStartPlayRecord",platform.retRecordStartPlay),platform.retRecordStartPlay=null),platform.retRecordEndPlay&&(cc.eventManager.dispatchCustomEvent("SuccessEndPlayRecord",platform.retRecordEndPlay),platform.retRecordEndPlay=null),platform.retRecordUploaded&&(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",media_id:DOWN_RECORD_SERVER+"/apidown?file="+platform.retRecordUploaded,platform:"native"}),platform.retRecordUploaded=null)}},DoRecord:function(t){if("began"==t.name){if(!cc.sys.isNative)return void ModuleMgr.showTipMsg("下载APP才可使用该功能！");this.startRecord=!0,this.endRecord=!1,this.recordTime=Date.parse(new Date),this.txt_record.setVisible(!0)}else"ended"!=t.name&&"canceled"!=t.name||(this.endRecord=!0)},refreshPlayers:function(){console.log("refreshPlayers"),DataMgr.gameCtrl.sortPlayers();for(var t=1;t<=4;t++)if(this["role_card"+t].card_tag=t,DataMgr.gameCtrl.deskPlayers[t]){this["role_card"+t].setVisible(!0);var e=DataMgr.gameCtrl.deskPlayers[t].wheel_idx;this["role_card"+t].wheelIdx=e;var i=DataMgr.gameCtrl.wheelInfos[e];this["role_card"+t].setData(DataMgr.gameCtrl.deskPlayers[t]),this["role_card"+t].setWheelInfo(i),DataMgr.gameCtrl.isBeforeGame()?this["role_card"+t].setReady(i.is_ready):DataMgr.gameCtrl.deskInfo.cur_step==MJ_STEP_SHOW_RESULT?this["role_card"+t].setReady(i.is_score_end):this["role_card"+t].setReady(0)}else this["role_card"+t].setEmpty(),this["role_card"+t].setVisible(!1);this.refreshPlayersOnline(),this.refreshDeskOwn(),this.refreshMaster()},tap_btn_open_door:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"open_door"})},tap_btn_select_rand_poker:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"select_rand_poker"})},tap_btn_formation:function(){ModuleMgr.runDlg("GameCardFormation")},tap_do_btn_ready:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"ready"})},tap_btn_set:function(){ModuleMgr.runDlg("SetingDlg")},hideChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!1)},showChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!0)},tap_bg:function(){this.hideChatLayer()},tap_btn_chat:function(){this.showChatLayer()},tap_btn_back:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{
oper:"leave_desk"})},tap_btn_ip:function(){ModuleMgr.runDlg("IpDlg")},tap_do_invite:function(){GAME_TYPE==GAME_TYPE_NCMJ?platform.share(SHARE_INVITE_TITLE(),SHARE_INVITE_DESC(),getNewShareUrl(DataMgr.gameCtrl.deskIdx,0),0,SHARE_URL+"res/icon/invite2.png"):platform.share(SHARE_INVITE_TITLE(),SHARE_INVITE_DESC(),getShareUrl(DataMgr.gameCtrl.deskIdx,0),0,SHARE_URL+"res/icon/invite2.png")},tap_do_start_game:function(){DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"start_game"})},tap_btn_close:function(){var t=function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"apply_dissolve"})},e=function(){};ModuleMgr.showConfirmCancelMsg("是否要解散房间?",t,e)},tap_btn_l_dissolve:function(){this.tap_btn_close()},tap_btn_l_back:function(){this.tap_btn_back()},tap_btn_huanfu:function(){ModuleMgr.runDlg("GameChangeDeskDlg")},tap_btn_switch:function(){this.close(),SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT?DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE):DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_PROTRAIT),ModuleMgr.runOrientationDlg(GAME_LAYER_NAME)},mbGrpStatus:0,bolMbGrpActoion:!1,tap_btn_more:function(){var t=this;if(!t.bolMbGrpActoion){var e=.3;t.grp_action_mb.stopAllActions();var i;if(0==t.mbGrpStatus){t.mbGrpStatus=1;var a=cc.p(-380,0);SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&(a=cc.p(0,-400)),i=cc.Sequence.create(cc.EaseOut.create(cc.MoveBy.create(e,a),e),cc.CallFunc.create(function(){t.bolMbGrpActoion=!1,t.btn_chat.setVisible(!1),t.btn_record.setVisible(!1),t.grp_l_btn.setVisible(!1)}))}else t.mbGrpStatus=0,i=cc.Sequence.create(cc.EaseOut.create(cc.MoveTo.create(e,cc.p(t.grp_action_mb.oldX,t.grp_action_mb.oldY)),e),cc.CallFunc.create(function(){t.bolMbGrpActoion=!1,t.btn_chat.setVisible(!0),t.btn_record.setVisible(!0),DataMgr.gameCtrl.isBeforeGame()&&t.grp_l_btn.setVisible(!0)}));t.bolMbGrpActoion=!0,this.grp_action_mb.runAction(i),this.icon_more.runAction(cc.Sequence.create(cc.RotateBy.create(e,180)))}}}),GameLayer.create=function(t,e,i){return new GameLayer(t,e,i)},ModuleMgr.registerModule("GameLayer",GameLayer),GameCard=QPLayer.extend({uiPath:"ui/GameCard1.ui",liePokerList:[],standPokerList:[],weavePokerList:[],flowerPokerList:[],liePokerCLazz:null,standPokerCLazz:null,weavePokerCLazz:null,flowerPokerClazz:null,liePokerSize:null,standPokerSize:null,weavePokerSize:null,flowerPokerSize:null,liePokerScale:.6,standPokerScale:.6,weavePokerScale:.6,flowerPokerScale:.6,roleCard:null,status:0,weavePokerType:0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onExit:function(){this.clear(),QPLayer.prototype.onExit.call(this)},setStatus:function(t){this.status=t},setRoleCard:function(t){this.roleCard=t},clear:function(){this.roleCard=null;for(var t=0;t<this.liePokerList.length;t++)this.liePokerList[t]&&this.liePokerList[t].removeFromParent(!0);this.liePokerList=[];for(var t=0;t<this.standPokerList.length;t++)this.standPokerList[t]&&this.standPokerList[t].removeFromParent(!0);this.standPokerList=[];for(var t=0;t<this.weavePokerList.length;t++)this.weavePokerList[t]&&this.weavePokerList[t].removeFromParent(!0);this.weavePokerList=[];for(var t=0;t<this.flowerPokerList.length;t++)this.flowerPokerList[t]&&this.flowerPokerList[t].removeFromParent(!0);this.flowerPokerList=[]},onLoaded:function(){this.weavePokerType=1,this.clear(),this.initPokerItem(),this.initFlowerItem()},setCardBg:function(t){for(var e=0;e<this.liePokerList.length;e++)this.liePokerList[e]&&this.liePokerList[e].setCardBg(t);for(var e=0;e<this.standPokerList.length;e++)this.standPokerList[e]&&this.standPokerList[e].setCardBg(t);for(var e=0;e<this.weavePokerList.length;e++)this.weavePokerList[e]&&this.weavePokerList[e].setCardBg(t)},setData:function(t){},clearWeavePoker:function(){for(var t=0;t<this.weavePokerList.length;t++){var e=this.weavePokerList[t];e&&e.setVisible(!1)}},clearLiePoker:function(){for(var t=0;t<this.liePokerList.length;t++){var e=this.liePokerList[t];e&&e.setVisible(!1)}},clearFlowerPoker:function(){for(var t=0;t<this.flowerPokerList.length;t++){var e=this.flowerPokerList[t];e&&e.setVisible(!1)}},checkSelect:function(t){for(var e=0;e<this.weavePokerList.length;e++){var i=this.weavePokerList[e];i&&i.checkSelect(t)}},clearStandPoker:function(){for(var t=0;t<this.standPokerList.length;t++){var e=this.standPokerList[t];e&&e.setVisible(!1)}},refreshWeavePoker:function(t){t=t||[],this.clearWeavePoker();for(var e=0;e<t.length;e++)this.addWeavePoker(e+1,t[e],!0)},refreshStandPoker:function(t){t=t||[];var e=t.length;e=3*e,this.clearStandPoker();for(var i=1;i<=DataMgr.gameCtrl.totalCardNum-e;i++)this.addStandPoker(i,0,!0)},refreshLiePoker:function(t,e,i){t=t||[],this.clearLiePoker(),i||t.sort(sort_card);for(var a=t.length,s=0;s<a;s++)this.addLiePoker(a-s,t[s],!0,e)},refreshFlowerPoker:function(t){t=t||[],this.clearFlowerPoker();for(var e=0;e<t.length;e++)this.addFlowerPoker(e,t[e],!0)},refreshPokers:function(t){t=t||[],0==this.status?(this.refreshWeavePoker(t),this.refreshStandPoker(t)):this.refreshWeavePoker(t)},dispatchPoker:function(t){var e=this;if(0==t){var i=function(){var t=e.standPokerList[0];if(t){t.stopAllActions();var i=cc.jumpBy(.8,cc.p(0,0),10,2),a=i.reverse(),s=cc.sequence(i,a).repeatForever();t.runAction(s)}};IS_DISPATCH_POKER_JUMP?this.addStandPoker(0,0,!1,i):this.addStandPoker(0,0,!1)}else e.addLiePoker(0,t)},hideDispatchPoker:function(){var t=this.liePokerList[0];t&&t.setVisible(!1);var e=this.standPokerList[0];e&&(e.setVisible(!1),e.stopAllActions())},calRefreshLiePoker:function(t,e,i){t=t||[];var a=gDup(t),s=a.length;return s%3==1?void this.refreshLiePoker(a,e,i):(this.addLiePoker(0,a[s-1],!0,e),a.splice(s-1,1),void this.refreshLiePoker(a,e,i))},refreshLogPokers:function(t,e,i){t=t||[],e=e||[],i=i||[];var a=arrayToMap(i),s=gDup(e);s.sort(function(t,e){var i=t,s=e;return a[i]&&(i-=1e3),a[s]&&(s-=1e3),i-s});var r=function(t){if(t){var e=t.getNum();a[e]&&t.showKou()}},n=!1;this.calRefreshLiePoker(s,r,n)},showTingPokers:function(t,e,i){t=t||[],e=e||[],i=i||{},t.length>0&&this.setStatus(1),this.clearStandPoker();var a=arrayToMap(e);for(var s in a)a[s]=3;for(var r=[],n=0;n<t.length;n++){var o={},c=t[n];o.num=c,o.sortNum=c,a[c]&&a[c]>0&&(a[c]--,o.sortNum-=1e4),i[c]&&i[c]>0&&(i[c]--,o.sortNum-=1e3),r.push(o)}r.sort(function(t,e){return t.sortNum-e.sortNum});var l=function(t){if(t&&t.getData()){t.setVisible(!0);var e=t.getData().sortNum;e<0&&t.checkBack(!0)}};this.calRefreshLiePoker(r,l,!0)},hideTingPokers:function(){this.setStatus(0),this.clearLiePoker()},refreshResultPokers:function(t,e){this.clearStandPoker();var i=t.length;if(i%3==1)this.calRefreshLiePoker(t);else{for(var a=gDup(t),s=0;s<a.length;s++)if(a[s]==e){a.splice(s,1);break}this.calRefreshLiePoker(a),this.addLiePoker(0,e,!0)}},playActionEfc:function(t,e,i){var a=this,s=function(){var e=a.weavePokerList[t];if(e){e.stopAllActions();var i=e.getPosition(),s=e.getScale(),r=i,n=a.roleCard,o=n.getActionEfcWorldPos();n&&o&&(r=a.convertToNodeSpace(o)),e.setPositionX(r.x),e.setPositionY(r.y),e.setScale(1.4);var c=cc.Sequence.create(cc.Spawn.create(cc.MoveTo.create(.3,i),cc.ScaleTo.create(.3,s,s)),cc.CallFunc.create(function(){playEffect("peng.mp3")}));e.runAction(c)}};a.addWeavePoker(t,e,!1,s),DataMgr.gameCtrl.isLog||this.refreshStandPoker(i)},refreshTest:function(){},initFlowerItem:function(){this.flowerPokerClazz=GameFlowerItem,this.flowerPokerSize=cc.size(30,30),this.flowerPokerScale=1},initPokerItem:function(){this.liePokerCLazz=GameLieCardBase,this.standPokerCLazz=GameStandCardBase,this.weavePokerCLazz=GameActionItem,this.liePokerSize=cc.size(70,107),this.standPokerSize=cc.size(70,107),this.weavePokerSize=cc.size(214,130),this.liePokerScale=.6,this.standPokerScale=.6,this.weavePokerScale=.55},createItem:function(t){var e=this,i=t.clazz,a=t.scale||1,s=t.pos||cc.p(0,0),r=t.poker,n=t.index,o=t.async||!1,c=t.pokerList,l=t.zOrder||0,_=t.callBack||null,u=t.scaleX||1,h=t.rotation||0,g=c[n];if(g)g.setData(r),g.setVisible(!0),g.setPositionX(s.x),g.setPositionY(s.y),_&&_(g);else{var d=function(){ModuleMgr.createNode(i,function(t){g=i.create(),g.setAnchorPoint(.5,.5),g.setScaleX(a*u),g.setScaleY(a),cc.log("========rotation================="+h),g.setRotation(h),g.setData(r),g.setPositionX(s.x),g.setPositionY(s.y),g.setZOrder(l),e.addChild(g),c[n]?(c[n].removeFromParent&&c[n].removeFromParent(!0),c[n]=g):c[n]=g,_&&_(g)})};o?e.scheduleOnce(function(){d()},.01*n):d()}},addLiePoker:function(t,e,i,a){var s=this,r=s.getLiePokerCfg(t);if(r){var n={};n.clazz=s.liePokerCLazz,n.scale=s.liePokerScale,n.pokerList=s.liePokerList,n.index=t,n.poker=e,n.async=i||!1,n.callBack=a||null,n.pos=r.pos,n.zOrder=r.zOrder,n.scaleX=r.scaleX||1,n.rotation=r.rotation||0,s.createItem(n)}},getLiePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(108,50),s=e.liePokerScale,r=e.liePokerSize,n=0,o=0;0==t?(n=a.x-50,o=a.y):(n=a.x+s*r.width*((t-1)%8),o=a.y-80*Math.floor((t-1)/8)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=1e3-t,c},addStandPoker:function(t,e,i,a){var s=this,r=s.getStandPokerCfg(t);if(r){var n={};n.clazz=s.standPokerCLazz,n.scale=s.standPokerScale,n.pokerList=s.standPokerList,n.index=t,n.poker=e,n.async=i||!1,n.callBack=a||null,n.pos=r.pos,n.zOrder=r.zOrder,n.scaleX=r.scaleX||1,n.rotation=r.rotation||0,s.createItem(n)}},getStandPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(108,93),s=e.standPokerScale,r=e.standPokerSize,n=0,o=0;0==t?(n=a.x-50,o=a.y):(n=a.x+s*r.width*((t-1)%8),o=a.y-50*Math.floor((t-1)/8)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=2e3-t,c},addWeavePoker:function(t,e,i,a){var s=this,r=s.getWeavePokerCfg(t);if(r){var n={};n.clazz=s.weavePokerCLazz,n.scale=s.weavePokerScale,n.pokerList=s.weavePokerList,n.index=t,n.poker=e,n.async=i||!1,n.pos=r.pos,n.zOrder=r.zOrder,n.scaleX=r.scaleX||1,n.callBack=a||null,n.rotation=r.rotation||0,s.createItem(n)}},getWeavePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(400,50),s=e.weavePokerScale,r=e.weavePokerSize,n=a.x-s*r.width*((t-1)%3),o=a.y-80*Math.floor((t-1)/3);i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=3e3-t,c},addFlowerPoker:function(t,e,i,a){var s=this,r=s.getFlowerPokerCfg(t);if(r){var n={};n.clazz=s.flowerPokerClazz,n.scale=s.flowerPokerScale,n.pokerList=s.flowerPokerList,n.index=t,n.poker=e,n.async=i||!1,n.pos=r.pos,n.zOrder=r.zOrder,n.scaleX=r.scaleX||1,n.callBack=a||null,n.rotation=r.rotation||0,s.createItem(n)}},getFlowerPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(400,50),s=e.flowerPokerScale,r=e.flowerPokerSize,n=a.x-s*r.width*((t-1)%3),o=a.y-80*Math.floor((t-1)/3);i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=4e3-t,c}}),GameCard.create=function(t,e,i){return new GameCard(t,e,i)},UIUtils.RegisterPathTemple("ui/GameCard1.ui",GameCard),GameCard1=GameCard.extend({uiPath:"ui/GameCard1.ui",initPokerItem:function(){this.liePokerCLazz=GameLieCardBase,this.standPokerCLazz=GameStandCardBase,this.weavePokerCLazz=GameActionItem,this.liePokerSize=cc.size(70,107),this.standPokerSize=cc.size(70,107),this.weavePokerSize=cc.size(214,130),this.liePokerScale=.6,this.standPokerScale=.6,this.weavePokerScale=.55},getLiePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(68,93),s=e.liePokerScale,r=e.liePokerSize,n=0,o=0;0==t?(n=a.x-50,o=a.y):(n=a.x+s*r.width*((t-1)%8),o=a.y-65*Math.floor((t-1)/8)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=1e3+t,c},getStandPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(68,93),s=e.standPokerScale,r=e.standPokerSize,n=0,o=0;0==t?(n=a.x-50,o=a.y):(n=a.x+s*r.width*((t-1)%8),o=a.y-50*Math.floor((t-1)/8)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=2e3+t,c},getWeavePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(330,38),s=e.weavePokerScale,r=e.weavePokerSize,n=a.x-s*r.width*((t-1)%3)-5,o=a.y+65*Math.floor((t-1)/3);i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=3e3+t,c},getFlowerPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(350,-15),s=e.flowerPokerScale,r=e.flowerPokerSize,n=a.x-s*r.width*t,o=a.y;i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=4e3+t,c}}),GameCard1.create=function(t,e,i){return new GameCard1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameCard1.ui",GameCard1),GameCard2=GameCard.extend({uiPath:"ui/GameCard2.ui",refreshTest:function(){},initPokerItem:function(){this.liePokerCLazz=GameLieCardBase1,this.standPokerCLazz=GameStandCardBase1,this.liePokerSize=cc.size(63,37),this.standPokerSize=cc.size(32,34);var t=1;DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&(t=1.2),1==this.weavePokerType?(this.weavePokerCLazz=GameActionItem1,this.weavePokerSize=cc.size(66,130),this.weavePokerScale=.6*t):(this.weavePokerCLazz=GameActionItem,this.weavePokerSize=cc.size(80,142),this.weavePokerScale=.45*t),this.liePokerScale=.6*t,this.standPokerScale=.7*t},getLiePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(35,15),s=e.liePokerScale,r=e.liePokerSize,n=0,o=0;0==t?(n=a.x,o=a.y-40):(n=a.x,o=a.y+s*r.height*(t-1)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=1e3-t,c},getStandPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(35,35),s=e.standPokerScale,r=e.standPokerSize,n=0,o=0;0==t?(n=a.x,o=a.y-40):(n=a.x,o=a.y+s*r.height*(t-1)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=2e3-t,c},getWeavePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(35,400);1==this.weavePokerType&&(a=cc.p(45,375));var s=e.weavePokerScale,r=e.weavePokerSize,n=0,o=0;n=a.x,o=a.y-r.height*s*(t-1),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=3e3-t,c},getFlowerPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(100,320),s=e.flowerPokerScale,r=e.flowerPokerSize,n=a.x,o=a.y-s*r.height*t;i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=4e3+t,c}}),GameCard2.create=function(t,e,i){return new GameCard2(t,e,i)},UIUtils.RegisterPathTemple("ui/GameCard2.ui",GameCard2),GameCard3=GameCard.extend({uiPath:"ui/GameCard3.ui",initPokerItem:function(){this.liePokerCLazz=GameLieCardBase1,this.standPokerCLazz=GameStandCardBase1,this.weavePokerCLazz=GameActionItem,this.liePokerSize=cc.size(63,37),this.standPokerSize=cc.size(32,34),this.weavePokerSize=cc.size(80,142);var t=1;DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&(t=1.2),1==this.weavePokerType?(this.weavePokerCLazz=GameActionItem1,this.weavePokerSize=cc.size(66,130),this.weavePokerScale=.6*t):(this.weavePokerCLazz=GameActionItem,this.weavePokerSize=cc.size(80,142),this.weavePokerScale=.45*t),this.liePokerScale=.6*t,this.standPokerScale=.7*t},getLiePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(-20,425),s=e.liePokerScale,r=e.liePokerSize,n=0,o=0;0==t?(n=a.x,o=a.y+40):(n=a.x,o=a.y-s*r.height*(t-1)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=1e3+t,c.rotation=180,c},getStandPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(-20,420),s=e.standPokerScale,r=e.standPokerSize,n=0,o=0;0==t?(n=a.x,o=a.y+40):(n=a.x,o=a.y-s*r.height*(t-1)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=2e3+t,c.scaleX=-1,c},getWeavePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(-25,50);1==this.weavePokerType&&(a=cc.p(-30,60));var s=e.weavePokerScale,r=e.weavePokerSize,n=a.x,o=a.y+r.height*s*(t-1)+5;i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=3e3+t,c},getFlowerPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(-90,80),s=e.flowerPokerScale,r=e.flowerPokerSize,n=a.x,o=a.y+s*r.height*t;i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=4e3+t,c}}),GameCard3.create=function(t,e,i){return new GameCard3(t,e,i)},UIUtils.RegisterPathTemple("ui/GameCard3.ui",GameCard3),GameCard4=GameCard.extend({uiPath:"ui/GameCard4.ui",initPokerItem:function(){this.liePokerCLazz=GameLieCardBase2,this.standPokerCLazz=GameStandCardBase,this.weavePokerCLazz=GameActionItem2,this.liePokerSize=cc.size(70,107),this.standPokerSize=cc.size(70,107),this.weavePokerSize=cc.size(222,130);var t=1;this.liePokerScale=.85*t,this.standPokerScale=.85*t,this.weavePokerScale=.7*t},getLiePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(448,115),s=e.liePokerScale,r=e.liePokerSize,n=0,o=0;0==t?(n=a.x+75,o=a.y):(n=a.x-s*r.width*((t-1)%8),o=a.y+124*Math.floor((t-1)/8)),i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=2e3-t,c},getStandPokerCfg:function(t){return null},getWeavePokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(80,250),s=e.weavePokerScale,r=e.weavePokerSize,n=a.x+s*r.width*((t-1)%3),o=a.y-120*Math.floor((t-1)/3);i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=1e3-t,c},getFlowerPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(95,300),s=e.flowerPokerScale,r=e.flowerPokerSize,n=a.x+s*r.width*t,o=a.y;i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=4e3+t,c},addWeavePoker:function(t,e,i,a){e&&(e.fang_pai=!0),GameCard.prototype.addWeavePoker.call(this,t,e,i,a)},refreshLiePoker:function(t,e,i){t=t||[],this.clearLiePoker(),i||t.sort(sort_card);var a=t.length,s=DataMgr.gameCtrl.totalCardNum;if(s==MY_TOTAL_CARD_NUM_TT)if(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT){for(var r=0,n=1;n<=15;n++)if(8!=n){if(r>=a)break;r++,this.addLiePoker(n,t[a-r],!0,e)}}else for(var r=0,n=0;n<a;n++)this.addLiePoker(a-n,t[n],!0,e);else for(var n=0;n<a;n++)this.addLiePoker(a-n,t[n],!0,e)},showTingPokers:function(t,e,i){t=t||[],e=e||[],i=i||{},t.length>0&&this.setStatus(1),this.clearStandPoker();var a=arrayToMap(e);for(var s in a)a[s]=3;for(var r=[],n=0;n<t.length;n++){var o={},c=t[n];o.num=c,o.sortNum=c,a[c]&&a[c]>0?(a[c]--,o.sortNum-=1e4):i[c]&&i[c]>0&&(i[c]--,o.sortNum-=1e3),r.push({num:t[n]})}r.sort(function(t,e){return t.sortNum-e.sortNum});var l=function(t){if(t&&t.getData()){t.setVisible(!0);var e=t.getData().sortNum;e<0&&t.checkBack(!0)}};this.calRefreshLiePoker(r,l,!0)},showTingPokers:function(t,e,i){t=t||[],e=e||[],i=i||{},t.length>0&&this.setStatus(1),this.clearStandPoker();var a=arrayToMap(e);for(var s in a)a[s]=3;for(var r=[],n=0;n<t.length;n++){var o={},c=t[n];o.num=c,o.sortNum=c,a[c]&&a[c]>0?(a[c]--,o.sortNum-=1e4):i[c]&&i[c]>0&&(i[c]--,o.sortNum-=1e3),r.push(o)}r.sort(function(t,e){return t.sortNum-e.sortNum});var l=function(t){if(t){var e=t.getData();e&&(e.sortNum<-5e3&&t.showKou(),e.sortNum<0&&t.setDisable())}};this.refreshLiePoker(r,l,!0)}}),GameCard4.create=function(t,e,i){return new GameCard4(t,e,i)},UIUtils.RegisterPathTemple("ui/GameCard4.ui",GameCard4),GameHead=UrlHead.extend({isControlNode:!0,uiPath:"ui/GameHead.ui",ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.icon_ower&&this.icon_ower.setVisible(!1),cc.log("loader head url "+this.uiPath)},setData:function(t,e){var i=toDecodeURIComponent(t.name);i=i.substring(0,5),this.txt_name.setString(i),this.head_frame.setScale(1),t.extra_data&&t.extra_data.head&&""!=t.extra_data.head?this.setFrame(t.extra_data.head):this.setFrame(),this.setUrl(t.headimgurl),e||this.txt_score.setVisible(!1)},setOnline:function(t){t?this.online_icon.setVisible(!1):this.online_icon.setVisible(!0)},setScore:function(t){this.txt_score&&this.txt_score.setString(t)},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete&&t.removeFromParent()},showCoinEffect:function(){var t=ccs.Armature.create("coin_effect");t.getAnimation().play("stand",-1,-1),t.getAnimation().setMovementEventCallFunc(this.animationEvent,this),this.coin.addChild(t)}}),GameHead.create=function(t,e,i){return new GameHead(t,e,i)},ModuleMgr.registerModule("GameHead",GameHead),UIUtils.RegisterPathTemple("ui/GameHead.ui",GameHead),GameHead1=GameHead.extend({uiPath:"ui/GameHead1.ui"}),GameHead1.create=function(t,e,i){return new GameHead1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameHead1.ui",GameHead1),GameHead2=GameHead.extend({uiPath:"ui/GameHead2.ui"}),GameHead2.create=function(t,e,i){return new GameHead2(t,e,i)},UIUtils.RegisterPathTemple("ui/GameHead2.ui",GameHead2),GameTimer=QPLayer.extend({time:0,passTime:0,callback:null,uiPath:"ui/GameTimer.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},update:function(t){if(this.passTime+=t,this.time<=this.passTime)return this.txt_time.setString("0"),this.callback&&this.callback(),this.callback=null,this.unscheduleUpdate(),void this.setVisible(!1);var e=this.time-this.passTime;e<.1?this.txt_time.setString(0):this.txt_time.setString(parseInt(this.time-this.passTime))},stop:function(){this.unscheduleUpdate(),this.passTime=0},setData:function(t,e){this.passTime=0,this.time=t,this.callback=e,this.txt_time.setString(t),this.scheduleUpdate()},onLoaded:function(){}}),GameTimer.create=function(t,e,i){return new GameTimer(t,e,i)},ModuleMgr.registerModule("GameTimer",GameTimer),UIUtils.RegisterPathTemple("ui/GameTimer.ui",GameTimer),GameCardBase=QPLayer.extend({uiPath:"ui/GameCardBase.ui",_num:0,_isSelect:!1,_oldY:null,_oldX:null,_scale:null,_touchEnable:!0,_ckeckKingEnable:!0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},initData:function(){this._num=0,this._isSelect=!1,this._touchEnable=!0,this._ckeckKingEnable=!0},onLoaded:function(){var t=cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0;this.setCardBg(t),this.hideKing(),this.hideKou(),this.hideTing(),this.setNormal()},setCardBg:function(t){var e=GetRealPath("res/uires/game/maj/down/disable.png"),i=GetRealPath("res/uires/game/maj/down/stand.png"),a=GetRealPath("res/uires/game/maj/down/standjing1.png");1!=t&&2!=t||(e=GetRealPath("res/uires/game/maj/down_"+t+"/disable.png"),i=GetRealPath("res/uires/game/maj/down_"+t+"/stand.png"),a=GetRealPath("res/uires/game/maj/down_"+t+"/standjing1.png")),this.img_disable&&this.img_disable.loadTexture(e),this.img_normal&&this.img_normal.loadTexture(i),this.img_normal_king&&this.img_normal_king.loadTexture(a)},getOldX:function(){return this._oldX},getOldY:function(){return this._oldY},rest:function(){this.unSelect(),this.initData()},hideKing:function(){this.img_king.setVisible(!1)},showKing:function(){this.img_king.setVisible(!0)},hideTing:function(){this.img_ting&&this.img_ting.setVisible(!1)},showTing:function(){this.img_ting&&this.img_ting.setVisible(!0)},hideKou:function(){this.img_kou&&this.img_kou.setVisible(!1)},showKou:function(){this.img_kou&&this.img_kou.setVisible(!0)},getNum:function(){return this._num},bolSelect:function(){return this._isSelect},setSelect:function(){this._isSelect||this._scale||(this._scale=this.getScale()),this._isSelect=!0,this.setPositionY(this._oldY+20),this.setScale(1.2*this._scale);var t={};t.num=this.getNum(),cc.eventManager.dispatchCustomEvent("CheckCardSelectMove",t)},setSelectMove:function(){null==this._oldY&&(this._oldY=this.getPositionY()),null==this._oldX&&(this._oldX=this.getPositionX());var t=this.getContentSize(),e=t.width*this._scale*.2;this.setPositionX(this._oldX+e)},unSelect:function(){null==this._oldY&&(this._oldY=this.getPositionY()),null==this._oldX&&(this._oldX=this.getPositionX()),null==this._scale&&(this._scale=this.getScale()),this._isSelect=!1,this.setScale(this._scale),this.setPositionY(this._oldY),this.setPositionX(this._oldX)},setCkeckKingEnable:function(t){this._ckeckKingEnable=t},checkKing:function(t){var e=!1;if(this._ckeckKingEnable)for(var i=0;i<t.length;i++)if(this._num==t[i]){e=!0;break}this.img_king&&this.img_king.setVisible(e),this.img_normal_king&&this.img_normal_king.setVisible(e),this.img_normal&&this.img_normal.setVisible(!e)},setData:function(t){var e=cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0;this.setCardBg(e),t=parseInt(t),this._num=t,!t||t<=0||!POKER_DATA_MAP[t]||POKER_DATA_MAP[t]<=0?this.setVisible(!1):(this.setVisible(!0),this.img_card.loadTexture("pokers/down_b/"+(t+16)+".png",ccui.Widget.PLIST_TEXTURE)),this.checkKing(MJ_KING_ARR),null==this._oldY&&(this._oldY=this.getPositionY()),null==this._oldX&&(this._oldX=this.getPositionX())},isCanTouch:function(){return this.isVisible()&&this._touchEnable},setNormal:function(){this.img_normal&&this.img_normal.setVisible(!0),this.img_normal_king&&this.img_normal_king.setVisible(!1),this.img_disable&&this.img_disable.setVisible(!1),this._touchEnable=!0,this.hideKou(),this.hideTing(),this.checkKing(MJ_KING_ARR)},setDisable:function(){this.img_normal&&this.img_normal.setVisible(!1),this.img_normal_king&&this.img_normal_king.setVisible(!1),this.img_normal&&this.img_disable.setVisible(!0)},setTouchEnable:function(t){this._touchEnable=t},setTing:function(){}}),GameCardBase.create=function(t,e,i){return new GameCardBase(t,e,i)},ModuleMgr.registerModule("GameCardBase",GameCardBase),UIUtils.RegisterPathTemple("ui/GameCardBase.ui",GameCardBase),GameResultItem=QPListItem.extend({uiPath:"ui/GameResultItem.ui",actionItemWidth:130,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},setData:function(t){this.refreshOtherUi(t),this.refreshCommonUi(t)},refreshOtherUi:function(t){var e=t.huScore||0,i=t.upSocre||0,a=t.downScore||0,s=t.gangScore||0,r=t.totalScore||0,n=t.returnDownScore||0;if(this.lab_hu_socre.setString(e),this.lab_up_socre.setString(i),this.lab_down_socre.setString(a),this.lab_gang_socre.setString(s),this.lab_total_socre.setScore(r),this.lab_return_down_socre.setString(n),t.deskData){var o=t.deskData.desk_type||1,c={1:GetRealPath("res/uires/game/xiajing.png"),2:GetRealPath("res/uires/game/maidilei.png"),3:GetRealPath("res/uires/game/tongyishouge.png"),4:GetRealPath("res/uires/game/txt_dileizhan.png")},l=c[o];l&&this.lab_down_king&&this.lab_down_king.loadTexture(l)}var _=[],u=t.curHuTypes;if(u)for(var h=0;h<u.length;h++){var g=u[h];_.push(GetRealPath("res/uires/game/hu_txt/txt_"+g+".png"))}var d=this;cc.loader.load(_,function(t,e,i){},function(){d.refreshHuLab(t)})},refreshHuLab:function(t){var e=t.curHuTypes;if(this.grp_hu&&e)for(var i=0,a=0;a<e.length;a++){var s=e[a];if(s&&!(s<MJ_ZI_MO||s>MJ_HU_PENG_PENG)&&s!=MJ_HU_JI_HU){var r=ccui.ImageView.create();r.loadTexture(GetRealPath("res/uires/game/hu_txt/txt_"+s+".png")),r.setAnchorPoint(0,0),this.grp_hu.addChild(r),r.setPositionY(0),r.setPositionX(i),i+=r.getContentSize().width+5}}},refreshCommonUi:function(t){var e=t.headData||{},i=(t.weavePokerList||[],t.pokerList||[]);i.sort(sort_card),this.item_head.setData(e);var a=t.curHuTypes;a&&t.winIdx>0?this.ico_hu&&this.ico_hu.setVisible(!0):this.ico_hu&&this.ico_hu.setVisible(!1);var s=t.bolFanP||!1;this.ico_fp&&this.ico_fp.setVisible(s)},actionItemWidth:214,refreshCard:function(t,e){var i=t.weavePokerList||[],a=t.pokerList||[],s=gDup(a),r=0;t.curHuTypes&&t.winIdx>0&&(s.length%3==2?(s=sub_poker(s,[t.lastDispatchPoker]),r=t.lastDispatchPoker):r=t.lastOutPoker),this.createWeavePoker(i,e),this.createLeftPoker(s,i,r,e)},createWeavePoker:function(t,e){var i=this;e=e||.45;var a=i.grp_card;width=this.actionItemWidth*e+5;for(var s=function(t,i){ModuleMgr.createNode(GameActionItem,function(s){var r=GameActionItem.create();t.fang_pai=!0,t.last_out_poker=-1,r.setData(t),a.addChild(r),r.setScale(e,e),r.setAnchorPoint(0,0),r.setPositionX(width*i),r.setPositionY(0)})},r=0;r<t.length;r++)s(t[r],r)},createLeftPoker:function(t,e,i,a){var s=this;a=a||.45;for(var r=s.grp_card,n=(this.actionItemWidth*a+5)*e.length||0,o=function(t,e){ModuleMgr.createNode(GameLieCardBase,function(i){var s=GameLieCardBase.create();s.setData(t),r.addChild(s),s.setScale(a,a),s.setAnchorPoint(0,0),s.setPositionX(n+s.getContentSize().width*e*a),s.setPositionY(0)})},c=0;c<t.length;c++)o(t[c],c);i>0&&o(i,t.length+.3)}}),GameResultItem.create=function(t,e,i){return new GameResultItem(t,e,i)},UIUtils.RegisterPathTemple("ui/GameResultItem.ui",GameResultItem),GameResult=QPDlg.extend({uiPath:"ui/GameResult.ui",ctor:function(t,e,i){QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){ModuleMgr.getDlg("GameResultSub")?this.btn_close.setVisible(!0):this.btn_close.setVisible(!1);var t=DataMgr.gameCtrl.resultData,e=t.details||[],i=[],a=!1,s=t.win_idx,r=t.last_out_poker_idx,n=t.last_dispatch_idx,o=t.cur_hu_types||[],c=t.cur_round_score,l=t.cur_score,_=t.other_score||[],u=t.last_out_poker||0,h=t.last_dispatch_poker||0,g=t.sub_game_type||"",d=t.bonus_score||0,m=null;t.hu_type_str&&(m=ConvertToJson(toDecodeURIComponent(t.hu_type_str)));for(var f=0;f<e.length;f++){var p=e[f],M={},C=p.idx||f+1;M.idx=C,M.winIdx=s,M.upSocre=p.king_score||0,M.downScore=p.down_king_score||0,M.returnDownScore=p.return_down_king_score||0,M.gangScore=p.gang_score||0,M.otherData=p,M.deskData=t,M.subGameType=g,M.lastDispatchPoker=h,M.lastOutPoker=u,M.bonusScore=d,M.mjHuExtStr=toDecodeURIComponent(p.mj_hu_ext_str),M.userNum=e.length;for(var D=0;D<_.length;D++)C==_[D].idx&&(M.otherScore=_[D]);M.flowerList=p.flower_list,M.huScore=p.hu_score||0,M.piaoScore=p.piao_score||0,M.totalScore=l["idx"+C]||0,M.curRoundScore=c["idx"+C]||0,M.weavePokerList=p.weave_pokers,M.pokerList=p.poker_list;var b=DataMgr.gameCtrl.players[C];if(b&&(M.headData={},M.headData.name=b.info.name,M.headData.headimgurl=b.info.headimgurl,M.headData.isOwn=b.rid==DataMgr.gameCtrl.deskInfo.desk_own_rid,M.headData.isMaster=t.last_win_op_idx==C,M.headData.isChao=1==(t.chao_master||0)),C==s&&(M.curHuTypes=o),m&&(M.curHuTypes=m[C]),C==r){for(var y=!1,v=0;v<o.length;v++)if(o[v]==MJ_ZI_MO){y=!0;break}n==s&&(y=!0),!y&&s>0&&(M.bolFanP=!0)}C==DataMgr.gameCtrl.myWheelIdx&&M.totalScore>0&&(a=!0),i.push(M)}this.refreshTitle(s,o),this.refreshKingGrp(t),this.refreshRole(i),this.refreshCard(i,s,u,h),this.refreshOtherUi(),GAME_PLAY_AUTO&&this.tap_btn_continue(),DataMgr.gameCtrl.isLog&&this.btn_continue&&this.btn_continue.setVisible(!1)},tap_btn_continue:function(){DataMgr.gameCtrl.isLog||(DataMgr.gameCtrl.curStep==MJ_STEP_GAME_END?cc.eventManager.dispatchCustomEvent("SuccessGameEnd"):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"score_end"})),ModuleMgr.closeDlg("GameResultSub"),cc.eventManager.dispatchCustomEvent("ClearResuleCard"),this.close()},refreshOtherUi:function(){},refreshTitle:function(t,e){if(t<0)this.grp_title&&this.grp_title.setVisible(!1),this.title_liuju&&this.title_liuju.setVisible(!0);else{this.grp_title&&this.grp_title.setVisible(!0),this.title_liuju&&this.title_liuju.setVisible(!1);var i=GetRealPath("res/uires/game/txt_ph.png"),a=arrayToMap(e);a[MJ_KING_WAIT]?i=GetRealPath("res/uires/game/txt_jd.png"):a[MJ_ZI_MO]&&(i=GetRealPath("res/uires/game/txt_zm.png")),this.lab_title&&this.lab_title.loadTexture(i)}},refreshKingGrp:function(t){this.item_up_king.setData({num1:DataMgr.gameCtrl.randPokerList[0],num2:DataMgr.gameCtrl.randPokerList[1]});for(var e=DataMgr.gameCtrl.downRandPokerList||[],i=1;i<=4;i++){var a=this["item_down_king_"+i],t={};t.num1=e[2*i-2],t.num2=e[2*i-1],t.num1&&t.num2?(a.setVisible(!0),a.setData(t)):a.setVisible(!1)}},refreshRole:function(t){for(var e=0;e<4;e++){var i=this["item_result_"+(e+1)];i&&(t[e]?(i.setVisible(!0),i.setData(t[e])):i.setVisible(!1))}},actionItemWidth:214,refreshCard:function(t,e,i,a){for(var s=null,r=0;r<t.length;r++)if(t[r].idx==e){s=t[r];break}if(s){var n=s.weavePokerList||[],o=s.pokerList||[],c=gDup(o),l=0;c.length%3==2?(c=sub_poker(c,[a]),l=a):l=i,this.createWeavePoker(n),this.createLeftPoker(c,n,l)}},createWeavePoker:function(t){var e=this,i=.45,a=e.grp_card;DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&(i=1.2*i),width=this.actionItemWidth*i+5;for(var s=function(t,e){ModuleMgr.createNode(GameActionItem,function(s){var r=GameActionItem.create();t.fang_pai=!0,t.last_out_poker=-1,r.setData(t),a.addChild(r),r.setScale(i,i),r.setAnchorPoint(0,0),r.setPositionX(width*e),r.setPositionY(0)})},r=0;r<t.length;r++)s(t[r],r)},createLeftPoker:function(t,e,i){var a=this,s=.45,r=a.grp_card;if(r){DataMgr.gameCtrl.totalCardNum==MY_TOTAL_CARD_NUM_TT&&(s=1.2*s);for(var n=(this.actionItemWidth*s+5)*(e.length||0),o=function(t,e){ModuleMgr.createNode(GameLieCardBase,function(i){var a=GameLieCardBase.create();a.setData(t),r.addChild(a),a.setScale(s,s),a.setAnchorPoint(0,0),a.setPositionX(n+a.getContentSize().width*e*s),a.setPositionY(0)})},c=0;c<t.length;c++)o(t[c],c);i>0&&o(i,t.length+.3)}}}),GameResult.create=function(t,e,i){return new GameResult(t,e,i)},GameResultNcmj=GameResult.extend({uiPath:"ui/GameResult.ui",ctor:function(t,e,i){GameResult.prototype.ctor.call(this,this.uiPath,e)},getShowLabel:function(t){var e=function(t){return!(t[MJ_HU_QI_DUI]||t[MJ_HU_THIRTEEN]||t[MJ_HU_SERVEN]||t[MJ_HU_GERMAN_SERVEN]||t[MJ_HU_PENG_PENG])};if(t[MJ_DI])return MJ_DI;if(t[MJ_TIAN])return MJ_TIAN;if(e(t)){if(t[MJ_QIANG_GANG])return MJ_QIANG_GANG;
if(t[MJ_GANG_HU])return MJ_GANG_HU;if(t[MJ_KING_WAIT])return MJ_KING_WAIT;if(t[MJ_GERMAN])return MJ_GERMAN;if(t[MJ_GERMAN_GERMAN])return MJ_GERMAN_GERMAN}else{var i=t[MJ_GERMAN]||t[MJ_GERMAN_GERMAN];if(t[MJ_KING_WAIT]){if(t[MJ_HU_QI_DUI])return MJ_HU_QI_DUI+"_"+MJ_KING_WAIT;if(t[MJ_HU_PENG_PENG])return i?MJ_HU_PENG_PENG+"_"+MJ_KING_WAIT+"_"+MJ_GERMAN:MJ_HU_PENG_PENG+"_"+MJ_KING_WAIT}else if(i){if(t[MJ_HU_QI_DUI])return MJ_HU_QI_DUI+"_"+MJ_GERMAN;if(t[MJ_HU_THIRTEEN])return MJ_HU_THIRTEEN+"_"+MJ_GERMAN;if(t[MJ_HU_SERVEN])return MJ_HU_SERVEN+"_"+MJ_GERMAN;if(t[MJ_HU_GERMAN_SERVEN])return MJ_HU_GERMAN_SERVEN+"_"+MJ_GERMAN;if(t[MJ_HU_PENG_PENG])return MJ_HU_PENG_PENG+"_"+MJ_GERMAN}else{if(t[MJ_HU_QI_DUI])return MJ_HU_QI_DUI;if(t[MJ_HU_THIRTEEN])return MJ_HU_THIRTEEN;if(t[MJ_HU_SERVEN])return MJ_HU_SERVEN;if(t[MJ_HU_GERMAN_SERVEN])return MJ_HU_GERMAN_SERVEN;if(t[MJ_HU_PENG_PENG])return MJ_HU_PENG_PENG}}},refreshTitle:function(t,e){var i=this;if(t<0)this.grp_title&&this.grp_title.setVisible(!1),this.title_liuju&&this.title_liuju.setVisible(!0);else{this.grp_title&&this.grp_title.setVisible(!0),this.title_liuju&&this.title_liuju.setVisible(!1),i.lab_title&&i.lab_title.setVisible(!1);var a=arrayToMap(e),s=this.getShowLabel(a),r={2:1,3:1,4:1,5:1,6:1,7:1,8:1,"18_4":1,"18_5":1,"18_6":1,18:1,"19_5":1,"19_6":1,19:1,"20_5":1,"20_6":1,20:1,"22_4_5":1,"22_4":1,"22_5":1,"22_6":1,22:1},n=GetRealPath("res/uires/game/txt_ph.png");a[MJ_ZI_MO]&&(n=GetRealPath("res/uires/game/txt_zm.png")),r[s]&&(n=GetRealPath("res/uires/ncmj/hu_"+s+".png"));var o=[];o.push(n),cc.loader.load(o,function(t,e,i){},function(){i.lab_title&&(i.lab_title.loadTexture(n),i.lab_title.setVisible(!0))})}},refreshKingGrp:function(t){this.item_up_king.setData({num1:DataMgr.gameCtrl.randPokerList[0],num2:DataMgr.gameCtrl.randPokerList[1]});var e=t.down_rand_pokers||[],i=t.return_down_rand_pokers||[];t.desk_type||0;if(i.length){this.grp_return_king&&this.grp_return_king.setVisible(!0);for(var a=1;a<=2;a++){var s=this["item_return_king_"+a];s&&(s.setCkeckKingEnable(!1),s.setData(i[a-1]))}}else this.grp_return_king&&this.grp_return_king.setVisible(!1);if(e.length){var r="res/uires/game/txt_xj_"+(t.desk_type||0)+".png";this.img_type&&this.img_type.loadTexture(GetRealPath(r)),this.grp_normal_king&&this.grp_normal_king.setVisible(!0);for(var a=1;a<=8;a++){var s=this["item_king_"+a];s&&(s.setCkeckKingEnable(!1),s.setData(e[a-1]))}var n=this.bg_king.getContentSize(),o=e.length,s=this["item_king_"+o];if(s){var c=s.getPositionX()+50;this.bg_king&&this.bg_king.setContentSize(cc.size(c,n.height)),this.grp_return_king&&this.grp_return_king.setPositionX(this.grp_normal_king.getPositionX()+c-45)}}else this.grp_normal_king&&this.grp_normal_king.setVisible(!1)}}),GameResultNcmj.create=function(t,e,i){return new GameResultNcmj(t,e,i)},ModuleMgr.registerModule("GameResult",GameResult),GameStart=QPDlg.extend({isControlNode:!0,uiPath:"ui/GameStart.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete&&(this.data&&this.data.callback&&this.data.callback.call(),this.close())},onLoaded:function(){this.ani&&(this.ani.getAnimation().play("stand",-1,-1),this.ani.getAnimation().setMovementEventCallFunc(this.animationEvent,this)),this.scheduleOnce(function(){playEffect("kaishi.mp3")},.3)}}),GameStart.create=function(t,e,i){return new GameStart(t,e,i)},ModuleMgr.registerModule("GameStart",GameStart),GameScore=QPLayer.extend({uiPath:"ui/ScoreItem.ui",isControlNode:!0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setScore:function(t){var e=this,i=[];i.push(GetRealPath("res/uires/game/shuzi_jia.png")),i.push(GetRealPath("res/uires/game/shuzi_jian.png")),cc.loader.load(i,function(t,e,i){},function(){e.setNum(t)})},setNum:function(t){var e=this.txt_num,i=GetRealPath("res/uires/game/shuzi_jia.png");t<0?(i=GetRealPath("res/uires/game/shuzi_jian.png"),this.txt_flag.loadTexture(GetRealPath("res/uires/game/reduce.png"))):this.txt_flag.loadTexture(GetRealPath("res/uires/game/add.png")),e.setProperty(Math.abs(t),i,e.uiData.itemWidth,e.uiData.itemHeight,e.uiData.mapStartChar),e.setAnchorPoint(0,.5)}}),GameScore.create=function(t,e,i){return new GameScore(t,e,i)},ModuleMgr.registerModule("GameScore",GameScore),UIUtils.RegisterPathTemple("ui/ScoreItem.ui",GameScore),GameDissolve=QPDlg.extend({uiPath:"ui/GameDissolve.ui",ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i);var a=this;this.addListener("AGREE_DISSOLVE",function(t){a.onRefresh()}),this.addListener("REFUSE_DISSOLVE",function(t){a.onRefresh(),a.close()})},onRefresh:function(){for(var t=!1,e=1;e<=4;e++)0==DataMgr.gameCtrl.dissovle[e]?this["txt_info"+e]&&this["txt_info"+e].setVisible(!1):1==DataMgr.gameCtrl.dissovle[e]?(this["txt_info"+e]&&this["txt_info"+e].setVisible(!0),this["txt_info"+e]&&this["txt_info"+e].loadTexture("res/uires/game/txt_tongyi.png"),e==DataMgr.gameCtrl.myWheelIdx&&(t=!0)):(this["txt_info"+e]&&this["txt_info"+e].setVisible(!0),this["txt_info"+e]&&this["txt_info"+e].loadTexture("res/uires/game/tx_jujue.png"),e==DataMgr.gameCtrl.myWheelIdx&&(t=!0));t?(this.btn_ok&&this.btn_ok.setVisible(!1),this.btn_cancel&&this.btn_cancel.setVisible(!1)):(this.btn_ok&&this.btn_ok.setVisible(!0),this.btn_cancel&&this.btn_cancel.setVisible(!0))},DoCancel:function(t){"ended"==t.name&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"refuse_dissolve"})},DoOk:function(t){"ended"==t.name&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"agree_dissolve"})},onLoaded:function(){this.onRefresh(),this.onAllUiLoaded();var t=this,e=function(){t.close()},i=DISSOLVE_TIME;this.timer&&this.timer.setData(i-(DataMgr.timeCtrl.getServerTime()-DataMgr.gameCtrl.deskTime),e)},onEnter:function(){QPLayer.prototype.onEnter.call(this),this.setLocalZOrder(1e4)},onAllUiLoaded:function(){for(var t=1;t<=4;t++){var e=DataMgr.gameCtrl.players[t];this["head"+t]&&(this["head"+t].setVisible(!1),e&&(this["head"+t].setVisible(!0),this["head"+t].setData(e.info),this["head"+t].setOnline(DataMgr.gameCtrl.online[t]),e.rid==DataMgr.gameCtrl.deskInfo.desk_own_rid&&this["head"+t].icon_ower.setVisible(!0)))}}}),GameDissolve.create=function(t,e,i){return new GameDissolve(t,e,i)},ModuleMgr.registerModule("GameDissolve",GameDissolve),GameRoleCard=QPLayer.extend({uiPath:"ui/GameRoleCard1.ui",score:0,isReady:!1,rid:null,wheelIdx:0,wheelInfo:null,lieCardBaseClass:null,actionItemClass:null,outCardLineNum:8,outCardScale:0,flowerList:[],sex:0,putOutArrowAni:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){if(this.item_cur_out_card&&(this.item_cur_out_card.oldX=this.item_cur_out_card.getPositionX(),this.item_cur_out_card.oldY=this.item_cur_out_card.getPositionY(),this.item_cur_out_card.setVisible(!1)),!this.putOutArrowAni){var t=ccs.Armature.create("arrow");t.getAnimation().play("stand",-1,1),t.setVisible(!1),this.addChild(t),this.putOutArrowAni=t}this.setLieCardBaseClass(),this.icon_laba.setVisible(!1),this.hideChatLab(),this.hideChatFace(),this.setEmpty(),this.hideCards(),this.hideMaster(),this.hideDownKing(),this.setScore(0),this.hideFlowerPokers(),this.hideAddScore(),this.setVisible(!1),this.setCardRole(),this.hideTing(),this.hidePiao(),this.lab_add_score&&(this.lab_add_score.oldX=this.lab_add_score.getPositionX()),this.lab_add_score&&(this.lab_add_score.oldY=this.lab_add_score.getPositionY())},setResultStatus:function(){this.clearCard(),this.clearOutCards(),this.hideCurOutCard(),this.hideFlowerPokers(),this.hideTing()},setEmpty:function(){this.head&&this.head.setVisible(!1),this.icon_ready&&this.icon_ready.setVisible(!1)},setInitStatus:function(){this.icon_ready&&this.icon_ready.setVisible(!1),this.hideMaster(),this.setScore(0),this.hidePiao()},startGame:function(){this.head&&this.head.setVisible(!0),this.icon_ready&&this.icon_ready.setVisible(!1)},setData:function(t){null!=t&&(this.rid=t.rid,this.wheelIdx=t.wheel_idx,this.setVisible(!0),this._data=t.info,this.head.setVisible(!0),this.head.setData(t.info),this.sex=t.info&&t.info.sex)},setCardBg:function(t){if(this.item_card&&this.item_card.setCardBg(t),this.item_ting&&this.item_ting.setCardBg(t),this.item_cur_out_card&&this.item_cur_out_card.setCardBg(t),this.grp_out_cards)for(var e=this.grp_out_cards.getChildren(),i=0;i<e.length;i++){var a=e[i];a&&"function"==typeof a.setCardBg&&a.setCardBg(t)}},setWheelInfo:function(t){var e=t.out_pokers;t.flower_list;this.wheelInfo=t,this.showOutCards(e)},getMasterWorldpos:function(){if(this.img_master){var t=this.img_master.getPosition();return this.convertToWorldSpace(cc.p(t.x,t.y))}return cc.p(0,0)},showMaster:function(){this.img_master.setVisible(!0)},hideMaster:function(){this.img_master.setVisible(!1)},setCardActionEfc:function(t){this.item_action_efc=t},getActionEfcWorldPos:function(){return this.item_action_efc?void this.item_action_efc.convertToWorldSpace(cc.p(120,120)):null},setCardRole:function(){this.item_card&&this.item_card.setRoleCard(this)},setCardLayer:function(t){this.item_card=t,t.setVisible(!1),this.setCardRole()},clearCard:function(){this.item_card&&(this.item_card.clearLiePoker(),this.item_card.clearStandPoker(),this.item_card.clearWeavePoker(),this.item_card.clearFlowerPoker())},hideCards:function(){this.clearCard()},refreshPokers:function(t){this.item_card&&(this.item_card.setVisible(!0),this.item_card.refreshPokers(t))},dispatchPoker:function(t){this.item_card&&this.item_card.dispatchPoker(t)},hideDispatchPoker:function(){this.item_card&&this.item_card.hideDispatchPoker()},refreshLogPokers:function(){this.item_card.setVisible(!0),this.item_card.refreshLogPokers(this.wheelInfo.weave_pokers,this.wheelInfo.pokers,this.wheelInfo.down_poker_list)},playActionEfc:function(t,e,i){this.item_action_efc&&this.item_action_efc.setSex(this.sex),this.item_action_efc&&this.item_action_efc.setData(e),t>0&&this.item_card&&this.item_card.playActionEfc(t,e,i)},refreshResultPokers:function(t,e){this.item_card&&this.item_card.refreshResultPokers(t,e)},hideFlowerPokers:function(){this.flowerList=[],this.item_card&&this.item_card.clearFlowerPoker()},addFlowerPokers:function(t){this.flowerList.push(t);var e=this.flowerList.length-1;this.item_card&&this.item_card.addFlowerPoker(e,t)},refreshFlowerPokers:function(t){this.flowerList=t,this.item_card&&this.item_card.refreshFlowerPoker(t)},setOutCardGrp:function(t){this.grp_out_cards=t,t.setVisible(!0)},checkSelect:function(t){if(this.item_card&&this.item_card.checkSelect(t),this.grp_out_cards)for(var e=this.grp_out_cards.getChildren(),i=0;i<e.length;i++){var a=e[i];a&&"function"==typeof a.checkSelect&&a.checkSelect(t)}},hideOutCard:function(){this.item_cur_out_card.setVisible(!1)},showOutCards:function(t){if(t){var e=this;if(e.grp_out_cards)for(var i=e.grp_out_cards,a=0;a<t.length;a++){var s=i.getChildByName("out_card_"+a);s?s.setData(t[a]):e.addOutCard(a,t[a])}}},addOutCard:function(t,e,i){var a=this;if(a.grp_out_cards){var s=a.lieCardBaseClass,r=a.grp_out_cards,n=r.getContentSize().width,o=r.getContentSize().height,c=a.outCardScale||.45;ModuleMgr.createNode(s,function(l){var _=s.create();_.setName("out_card_"+t),_.setData(e),r.addChild(_),_.setScale(c,c),_.setAnchorPoint(1,1);var u=_.getContentSize(),h=n-t%a.outCardLineNum*u.width*c,g=o-Math.floor(t/a.outCardLineNum)*(u.height*c+5);_.setPositionX(h),_.setPositionY(g),i&&(_.putAction(),a.showPutOutArrow(h,g))})}},showPutOutArrow:function(t,e,i){if(this.putOutArrowAni&&this.grp_out_cards){this.putOutArrowAni.setVisible(!0);var a=this.grp_out_cards.convertToWorldSpace(cc.p(t,e)),a=this.convertToNodeSpace(a);this.putOutArrowAni.setPositionX(a.x),this.putOutArrowAni.setPositionY(a.y)}},clearOutCards:function(){this.grp_out_cards&&this.grp_out_cards.removeAllChildren()},setCurOutCard:function(t){this.item_cur_out_card=t,t.setVisible(!1)},playOutCard:function(t,e){if(this.item_cur_out_card&&(this.item_cur_out_card.setVisible(!0),this.item_cur_out_card.setVisible(!1),this.item_cur_out_card.setSex(this.sex),this.item_cur_out_card.setData(t,e),this.item_cur_out_card.setScale(1,1)),this.wheelInfo&&t>0){var i=(this.wheelInfo.out_pokers||[]).length;this.downOutCard(i,t)}},playDiaoPao:function(){var t=this;t.item_cur_out_card&&t.item_cur_out_card.isVisible()&&(t.item_cur_out_card.playDiaoPao(),t.scheduleOnce(function(){t.hideCurOutCard()},1.5))},hidePutOutArrowAni:function(){this.putOutArrowAni&&this.putOutArrowAni.setVisible(!1)},showPutOutArrowAni:function(){this.putOutArrowAni&&this.putOutArrowAni.setVisible(!0)},hideCurOutCard:function(){this.item_cur_out_card&&this.item_cur_out_card.setVisible(!1),this.hidePutOutArrowAni();var t=this.grp_out_cards;if(t&&this.wheelInfo)for(var e=(this.wheelInfo.out_pokers||[]).length,i=t.getChildren(),a=0;a<i.length;a++){var s=i[a],r=s.getName(),n=parseInt(r.substr(9-r.length));n>=e&&s.removeFromParent()}},downOutCard:function(t,e){this.item_cur_out_card&&(this.item_cur_out_card.setVisible(!1),this.addOutCard(t,e,!0))},setDownKingItem:function(t){this.item_down_king=t,t.setVisible(!1)},showDownKing:function(t){this.item_down_king&&(this.item_down_king.setVisible(!0),this.item_down_king.setData(t))},hideDownKing:function(){this.item_down_king&&this.item_down_king.setVisible(!1)},setLieCardBaseClass:function(){this.lieCardBaseClass=GameLieCardBase,this.actionItemClass=GameActionItem},setScore:function(t){this.score=t,this.head&&this.head.setScore(t)},getScore:function(){return this.score},setAddScore:function(t,e){if(this.lab_add_score){var i=this;i.lab_add_score.stopAllActions(),i.lab_add_score.setVisible(!0),i.lab_add_score.setScore(t),i.lab_add_score.setPositionX(this.lab_add_score.oldX),i.lab_add_score.setPositionY(this.lab_add_score.oldY),this.setScore(this.score+t),e=!!e,this.lab_add_score.runAction(cc.Sequence.create(cc.MoveBy.create(.4,cc.p(0,25)),cc.DelayTime.create(1.2),cc.CallFunc.create(function(){e&&i.lab_add_score.setVisible(!1)})))}},hideAddScore:function(){this.lab_add_score&&(this.lab_add_score.setVisible(!1),this.lab_add_score.setScore(0))},diLeiAni:null,showDiLeiAni:function(){if(!this.diLeiAni&&this.head){var t=ccs.Armature.create("dilei");t.x=this.head.x+45,t.y=this.head.y+65,t.setScale(.9),t.getAnimation().play("stand",-1,1),this.addChild(t),this.diLeiAni=t}},hideDiLeiAni:function(){this.diLeiAni&&(this.diLeiAni.removeFromParent(),this.diLeiAni=null)},setTingLayer:function(t){this.item_ting=t,this.item_ting.setVisible(!1)},hideTing:function(){this.item_ting&&this.item_ting.setVisible(!1)},showTing:function(t,e){this.item_ting&&this.item_ting.setData(t,e)},showTingPokers:function(t,e,i){this.item_card.setVisible(!0),this.item_card&&this.item_card.showTingPokers(t,e,i)},hideTingPokers:function(){this.item_card.setVisible(!0),this.item_card&&this.item_card.hideTingPokers()},hidePiao:function(){this.lab_piao&&this.lab_piao.setVisible(!1)},showPiao:function(t){if(this.lab_piao)if(this.lab_piao.setVisible(!0),t<0)this.lab_piao.setVisible(!1);else{this.lab_piao.setVisible(!0);var e=GetRealPath("res/uires/game/txt_bupiao.png");1==t?e=GetRealPath("res/uires/game/txt_piaoyibei.png"):2==t&&(e=GetRealPath("res/uires/game/txt_piao2bei.png")),this.lab_piao.loadTexture(e)}},setReady:function(t){t=t?t:0,this.isReady=1==t,this.icon_ready&&this.icon_ready.setVisible(this.isReady)},setOnline:function(t){this.head.setOnline(t),this.online=t,0==t&&this.setReady(0)},showTalk:function(){this.icon_laba.setVisible(!0)},stopTalk:function(){this.icon_laba.setVisible(!1)},showChatLab:function(t){function e(t){i.hideChatLab()}for(var i=this,a=0;a<chatCfgList.length;a++)if(chatCfgList[a]==t){var s=a+1;playEffect(MUSIC_TYPE+"/talk/CHAT"+s+".mp3")}i.lab_chat.setString("[c255:255:255]"+t+"[/c]"),i.grp_chat_txt.stopAllActions(),i.grp_chat_txt.setVisible(!0),i.grp_chat_txt.runAction(cc.Sequence.create(cc.DelayTime.create(2),cc.CallFunc.create(e)))},hideChatLab:function(){this.grp_chat_txt.setVisible(!1)},showChatFace:function(t){function e(t){i.hideChatFace()}var i=this;i.img_chat_face.stopAllActions(),i.img_chat_face.loadTexture("res/uires/face/"+t+".png"),i.img_chat_face.setVisible(!0),i.img_chat_face.setOpacity(0),i.img_chat_face.runAction(cc.Sequence.create(cc.FadeIn.create(.4),cc.DelayTime.create(1),cc.CallFunc.create(e)))},hideChatFace:function(){this.img_chat_face.setVisible(!1)},setOwner:function(t){this.head&&this.head.icon_ower.setVisible(t==this.rid)},setWait:function(){this.head.setVisible(!0)},tap_head:function(){var t=this.wheelIdx,e=DataMgr.gameCtrl.myWheelIdx;t!=e&&ModuleMgr.runNode("GameInterFaceDlg",{hit_index:e,hited_index:t},ModuleMgr.getDlg("GameLayer"),function(t){var e=ModuleMgr.getDlg("GameLayer"),i=e.getContentSize();t.anchorX=.5,t.anchorY=.5,t.x=i.width/2,t.y=i.height/2})}}),GameRoleCard.create=function(t,e,i){return new GameRoleCard(t,e,i)},ModuleMgr.registerModule("GameRoleCard",GameRoleCard),UIUtils.RegisterPathTemple("ui/GameRoleCard.ui",GameRoleCard),GameRoleCard1=GameRoleCard.extend({uiPath:"ui/GameRoleCard1.ui",outCardLineNum:10,outCardScale:.55,onLoaded:function(){GameRoleCard.prototype.onLoaded.call(this)},setLieCardBaseClass:function(){this.lieCardBaseClass=GameLieCardBase},addOutCard:function(t,e,i){var a=this;if(a.grp_out_cards){var s=a.lieCardBaseClass,r=a.grp_out_cards,n=r.getContentSize().width,o=r.getContentSize().height,c=a.outCardScale;ModuleMgr.createNode(s,function(l){var _=s.create();_.setName("out_card_"+t),_.setData(e),r.addChild(_),_.setScale(c,c),_.setAnchorPoint(1,1);var u=_.getContentSize(),h=n-t%a.outCardLineNum*(u.width-1)*c,g=o-Math.floor(t/a.outCardLineNum)*(u.height*c-11);_.setZOrder(-100+t),_.setPositionX(h),_.setPositionY(g),i&&(_.putAction(),a.showPutOutArrow(h-u.width*c/2,g-40*c,180))})}}}),GameRoleCard1.create=function(t,e,i){return new GameRoleCard1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameRoleCard1.ui",GameRoleCard1),GameRoleCard2=GameRoleCard.extend({uiPath:"ui/GameRoleCard2.ui",outCardLineNum:7,outCardScale:.85,setLieCardBaseClass:function(){this.lieCardBaseClass=GameLieCardBase1},addOutCard:function(t,e,i){var a=this;if(a.grp_out_cards){var s=a.lieCardBaseClass,r=a.grp_out_cards,n=(r.getContentSize().width,r.getContentSize().height),o=a.outCardScale;ModuleMgr.createNode(s,function(c){var l=s.create();l.setName("out_card_"+t),l.setData(e),r.addChild(l),l.setScale(o,o),l.setAnchorPoint(0,1);var _=l.getContentSize(),u=Math.floor(t/a.outCardLineNum)*(_.width*o-1),h=n-t%a.outCardLineNum*(_.height-16)*o;l.setZOrder(-100+t),l.setPositionX(u),l.setPositionY(h),i&&(l.putAction(),a.showPutOutArrow(u+_.width*o/2,h-15*o))})}}}),GameRoleCard2.create=function(t,e,i){return new GameRoleCard2(t,e,i)},UIUtils.RegisterPathTemple("ui/GameRoleCard2.ui",GameRoleCard2),GameRoleCard3=GameRoleCard.extend({uiPath:"ui/GameRoleCard3.ui",outCardLineNum:7,outCardScale:.85,setLieCardBaseClass:function(){this.lieCardBaseClass=GameLieCardBase1},addOutCard:function(t,e,i){var a=this;if(a.grp_out_cards){var s=a.lieCardBaseClass,r=a.grp_out_cards,n=r.getContentSize().width,o=(r.getContentSize().height,a.outCardScale);ModuleMgr.createNode(s,function(c){var l=s.create();l.setName("out_card_"+t),l.setData(e),r.addChild(l),l.setScale(o,o),l.setRotation(180),l.setAnchorPoint(1,0);var _=l.getContentSize(),u=n-Math.floor(t/a.outCardLineNum)*(_.width*o-1),h=t%a.outCardLineNum*(_.height-16)*o;l.setZOrder(-100-t),l.setPositionX(u),l.setPositionY(h),i&&(l.putAction(),a.showPutOutArrow(u-_.width*o/2,h+_.height*o-15*o))})}}}),GameRoleCard3.create=function(t,e,i){return new GameRoleCard3(t,e,i)},UIUtils.RegisterPathTemple("ui/GameRoleCard3.ui",GameRoleCard3),GameRoleCard4=GameRoleCard.extend({uiPath:"ui/GameRoleCard4.ui",outCardLineNum:10,outCardScale:.55,setLieCardBaseClass:function(){this.lieCardBaseClass=GameLieCardBase},addOutCard:function(t,e,i){var a=this;if(a.grp_out_cards){var s=a.lieCardBaseClass,r=a.grp_out_cards,n=a.outCardScale;ModuleMgr.createNode(s,function(o){var c=s.create();c.setName("out_card_"+t),c.setData(e),r.addChild(c),c.setScale(n,n),c.setAnchorPoint(0,0);var l=c.getContentSize(),_=t%a.outCardLineNum*(l.width-1)*n,u=Math.floor(t/a.outCardLineNum)*(l.height*n-11);c.setZOrder(-100-t),c.setPositionX(_),c.setPositionY(u),i&&(c.putAction(),a.showPutOutArrow(_+l.width*n/2,u+l.height*n-40*n,0))})}}}),GameRoleCard4.create=function(t,e,i){return new GameRoleCard4(t,e,i)},UIUtils.RegisterPathTemple("ui/GameRoleCard4.ui",GameRoleCard4),InviteFriendDlg=QPDlg.extend({uiPath:"ui/InviteFriendDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){function t(){e.timer_down.setVisible(!1),e.timer_down.stop(),e.tap_btn_cancel()}var e=this,i=DataMgr.gameCtrl.getPlayerByRid(DataMgr.gameCtrl.deskInfo.desk_own_rid);e.setText("lab_invite",i.info.name),e.timer_down.setVisible(!0),e.timer_down.setData(10,t)},tap_btn_agree:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"reply_invite_friend",type:"agree"}),this.close()},tap_btn_cancel:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"reply_invite_friend",type:"reject"}),this.close()}}),InviteFriendDlg.create=function(t,e,i){return new InviteFriendDlg(t,e,i)},ModuleMgr.registerModule("InviteFriendDlg",InviteFriendDlg),RecordDetail=QPDlg.extend({isControlNode:!0,uiPath:"ui/RecordDetailDlg.ui",curLoadSubUiIdx:0,curCost:0,bolDlgAction:!1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e);var a=this;this.addListener("SUCCECES_ROOM_CREATE",function(t){a.close()})},onEnter:function(){QPDlg.prototype.onEnter.call(this)},getOwnerInfo:function(t){for(var e=t.desk_own_rid,i=ConvertToJson(t.record_detail),a=i.users,s=0;s<a.length;s++){var r=a[s];if(r.rid==e)return r}return null},onLoaded:function(){this.listView_item=RecordDetailItem;var t=this.data;this.txt_num.setString(t.deskId),this.txt_round.setString(99==t.round?"一圈":t.round),this.txt_time.setString(parseTime(t.createTime+t.all_cost_time)),this.txt_name.setString(toDecodeURIComponent(t.ownerName)),this.txt_score_type.setString(t.deskScoreType+"分场");cc.sys.isNative;if(this.refreshRank(this.data),this.data.needShare){var e=this,i=function(){e.doShareImg()};this.runAction(cc.sequence(cc.delayTime(.6),cc.callFunc(i))),this.rotation=this.rotation-90}},tap_btn_view:function(){var t=this.data.replayRecords;ModuleMgr.runDlg("RecordReplayDlg",t,null,null)},refreshRank:function(t){for(var e=[],i=0;i<t.players.length;i++){var a=t.players[i];a&&(a.round=t.round,a.sortNum=a.score,e.push(a))}for(var i=0;i<4;i++){var s=this["txt_name"+(i+1)],r=this["txt_score"+(i+1)],n=e[i];null!=n?(s.setString((n.name||"").substring(0,5)),r.setString(n.score)):(s.setString(""),r.setString(""))}3==e.length?(this.txt_name2&&this.txt_name2.setPositionX(this.txt_name2.getPositionX()+20),this.txt_name3&&this.txt_name3.setPositionX(this.txt_name3.getPositionX()+40),this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+20),this.txt_score3&&this.txt_score3.setPositionX(this.txt_score3.getPositionX()+40)):2==e.length&&(this.txt_name1&&this.txt_name1.setPositionX(this.txt_name1.getPositionX()+40),this.txt_name2&&this.txt_name2.setPositionX(this.txt_name2.getPositionX()+80),this.txt_score1&&this.txt_score1.setPositionX(this.txt_score1.getPositionX()+40),this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+80));var o=this.data.replayRecords;this.refreshList({name:"listView",list:o,async:!0})},doShareImg:function(){var t="",e=this,i=function(){platform.shareImage(t,0),e.listView.setClippingType(ccui.Layout.CLIPPING_STENCIL)};this.listView.setClippingType(ccui.Layout.CLIPPING_SCISSOR),t=saveScreenShot(i)},tap_btn_share:function(){var t=this.data,e="";t.crazyLv&&t.crazyLv>1&&(e="（疯狂场）");if(cc.sys.isNative)if(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&null==this.data.needShare){var t=this.data;this.close(),t.needShare=!0,ModuleMgr.runDlg("RecordDetail",t,null,null)}else this.doShareImg();else platform.share(SHARE_DETAIL_TITLE_DES(t),SHARE_DETAIL_DES(t),getShareUrl(0,t.recordId),0,SHARE_URL+"res/icon/record3.png")},tap_btn_close:function(){this.close(),this.data.dlgType&&1==this.data.dlgType||(0==DataMgr.gameCtrl.deskIdx?ModuleMgr.enterEnterScene():(DataMgr.gameCtrl.deskIdx=0,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"leave_desk"})))},again:function(){return this.curCost>ME_D.get_user().room_card?ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！"):void ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"room_buy_by_card"})},tap_btn_h5_again:function(){this.again()},tap_btn_native_again:function(){this.again()},tap_btn_official:function(){cc.sys.openURL(H5_FOCUS_PUBLIC_URL)}}),RecordDetail.create=function(t,e,i){return new RecordDetail(t,e,i)},ModuleMgr.registerModule("RecordDetail",RecordDetail),RecordDetailItem=QPLayer.extend({isControlNode:!0,uiPath:"ui/RecordDetailItem.ui",data:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},tap_btn_view:function(){DataMgr.gameCtrl.recordRid=this.data.rid,DataMgr.recordCtrl.getGameDetailRecord(this.data.rid)},setData:function(t){this.txt_rank.setString(t.idx),this.btn_view.setVisible("GameScene"!=g_scene.name),this.data=t;for(var e=t.cur_hu_types||[],i=(arrayToMap(e),0),a=0,s=0;s<4;s++){var r=t.users[s];r?(this["txt_score"+(s+1)].setString(r.score),i<r.score&&(i=r.score,a=s)):this["txt_score"+(s+1)].setString("")}3==t.users.length?(this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+20),this.txt_score3&&this.txt_score3.setPositionX(this.txt_score3.getPositionX()+40)):2==t.users.length&&(this.txt_score1&&this.txt_score1.setPositionX(this.txt_score1.getPositionX()+40),this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+80));for(var s=1;s<=4;s++)this["icon_you_"+s]&&this["icon_you_"+s].setVisible(!1)}}),RecordDetailItem.create=function(t,e,i){return new RecordDetailItem(t,e,i)},ModuleMgr.registerModule("RecordDetailItem",RecordDetailItem),UIUtils.RegisterPathTemple("ui/RecordDetailItem.ui",RecordDetailItem),GameLogLayerCreate=function(t){GameLogLayer=t.extend({uiPath:"ui/Game.ui",STATU_TYPE:{NONE:0,PAUSE:1,PLAY:2,OVER:3},status:0,steps:null,curStep:0,perStepData:null,curStepData:null,curStepTime:0,speedMult:1,downCardTime:.01,stepTimeCfg:null,speedMultCfg:[1,1.5,2,3],ctor:function(e,i,a){t.prototype.ctor.call(this,e,i,a)},onLoaded:function(){var t=this;t.initData(),t.initUi(),t.initRoleCard4(),t.dealEventStack(),t.scheduleOnce(function(){t.startPlay()},.5)},initData:function(){this.isTurning=!0,this.status=this.STATU_TYPE.NONE,this.curStep=0,this.stepTimeCfg={open_door:{time:3},last_win_op_idx:{time:0},rand_poker:{time:6},wheel_rand_poker:{time:.1},op_idx:{time:0},dispatch_poker:{time:1},deal_poker:{time:1},action_chi:{time:1},action_gang:{time:1},action_peng:{time:1},action_hu:{time:1},no_action:{time:0},user_poker_fix_flower:{time:.8},show_card:{time:0},show_result:{time:2},rand_mine_idx:{time:12},rand_mine_list:{time:.1}},DataMgr.gameCtrl.analyseReplayData()},initUi:function(){t.prototype.initUi.call(this),this.grp_log&&this.grp_log.setVisible(!0),GAME_TYPE==GAME_TYPE_NCMJ&&this.grp_log&&this.grp_log.setVisible(!1),this.grp_desk_info&&this.grp_desk_info.setVisible(!1),this.grp_last_num&&this.grp_last_num.setVisible(!0),this.btn_close&&this.btn_close.setVisible(!1),this.btn_chat&&this.btn_chat.setVisible(!1),this.btn_ip&&this.btn_ip.setVisible(!1),this.btn_huanfu&&this.btn_huanfu.setVisible(!1),this.grp_p_btn&&this.grp_p_btn.setVisible(!1),this.grp_l_btn&&this.grp_l_btn.setVisible(!1),this.grp_log_btn&&this.grp_log_btn.setVisible(!0)},initPoker:function(){for(var t=1;t<=4;t++){var e=DataMgr.gameCtrl.wheelInfos[t],i=DataMgr.gameCtrl.getChairIdByWheelIdx(t);e&&(this["role_card"+i]&&this["role_card"+i].refreshLogPokers(),this["role_card"+i]&&this["role_card"+i].setOnline(1))}},startPlay:function(){this.refreshPlayers(),this.checkKingGrp(),this.initPoker(),this.refreshDesk(),this.steps=DataMgr.gameCtrl.replayData.steps||[],this.status=this.STATU_TYPE.PLAY,this.refreshLogSpeed(),this.refreshPlayBtn(),this.scheduleUpdate()},getNextStepData:function(){for(var t=this.curStep;t<this.steps.length;t++){var e=this.steps[t],i=e.a;if(this.stepTimeCfg[i])return this.curStep=t+1,e}return this.curStep=0,null},update:function(t){if(this.status==this.STATU_TYPE.PLAY){if(this.curStepTime>0)return void(this.curStepTime-=t);var e=this.getNextStepData();if(!e)return GAME_TYPE==GAME_TYPE_NCMJ||ModuleMgr.showTipMsg("播放结束！"),void(this.status=this.STATU_TYPE.OVER);var i=e.a,a=e.d;this.curStepTime=this.stepTimeCfg[i].time/this.speedMult/.6,this.calMsg(i,a),this.perStepData=e}},deal_SuccessFixFlower:function(t){var e=t.getUserData(),i=e.idx;if(DataMgr.gameCtrl.wheelInfos[i]){var a=DataMgr.gameCtrl.wheelInfos[i].flower_list,s=DataMgr.gameCtrl.getChairIdByWheelIdx(i);this["role_card"+s]&&this["role_card"+s].refreshFlowerPokers(a),this.playActionEfc(i,{mj_action:MJ_FLOWER})}},hideOutCard:function(){for(var t=1;t<=4;t++)this["role_card"+t].hideOutCard()},dispatchPoker:function(){var t=DataMgr.gameCtrl.lastDispatchRid,e=DataMgr.gameCtrl.lastDispatchPoker,i=DataMgr.gameCtrl.getIdxByRid(t),a=DataMgr.gameCtrl.wheelInfos[i];a&&a.pokers.push(e);var s=DataMgr.gameCtrl.getChairIdxByRid(t);this["role_card"+s]&&this["role_card"+s].dispatchPoker(e)},dealPoker:function(){this.playOutCard()},showCard:function(t){for(var e=DataMgr.gameCtrl.deskInfo.full_num,i=1;i<=e;i++){var a=DataMgr.gameCtrl.wheelInfos[i];if(a&&1==a.is_show_card){var s=DataMgr.gameCtrl.getChairIdxByRid(a.rid),r=this["role_card"+s];r&&r.showTing(a.listen_poker_list)}}if(t){var s=DataMgr.gameCtrl.getChairIdxByRid(t.rid),r=this["role_card"+s];r&&r.playActionEfc(0,{mj_action:MJ_MING})}},refreshLogPokers:function(t){var e=DataMgr.gameCtrl.getChairIdByWheelIdx(t);this["role_card"+e]&&this["role_card"+e].refreshLogPokers()},showResultDlg:function(t){var e=this;GAME_TYPE==GAME_TYPE_NCMJ&&this.scheduleOnce(function(){e.showSubResult()},t)},stepOpenDoor:function(){var t=function(){};this.showShaizi(t)},showKing:function(){var t=this,e=1.5;DataMgr.gameCtrl.downRandPokerList.length>0&&(e=DataMgr.gameCtrl.curStep==MJ_STEP_GAME_END||DataMgr.gameCtrl.curStep==MJ_STEP_SHOW_RESULT?2.5:4),t.scheduleOnce(function(){t.setTurnIndexEnable(),t.setSelectActionEnable(),t.grp_last_num&&t.grp_last_num.setVisible(!0)},e+DataMgr.gameCtrl.downRandPokerList.length/2*2);var i={};i.pokerList=DataMgr.gameCtrl.randPokerList,i.showKingType=this.showKingType,i.func=function(){set_king_map(DataMgr.gameCtrl.randPokerList),t.checkKingGrp()},ModuleMgr.runDlg("GameShowKing",i,null,null)},calMsg:function(t,e){if("op_idx"==t)DataMgr.gameCtrl.cal_op_idx(e);else if("last_win_op_idx"==t)DataMgr.gameCtrl.cal_last_win_op_idx(e);else if("dispatch_poker"==t)DataMgr.gameCtrl.cal_dispatch_poker(e);else if("deal_poker"==t){var i=e.idx,a=DataMgr.gameCtrl.wheelInfos[i];if(a){var s=sub_poker(a.pokers,e.poker_list);s&&(a.pokers=s)}DataMgr.gameCtrl.cal_deal_poker(e),this.refreshLogPokers(i)}else if("no_action"==t)DataMgr.gameCtrl.cal_no_action(e);else if("action_chi"==t){var i=e.idx,r=e.poker_list,n=sub_poker(r,[DataMgr.gameCtrl.lastOutPoker]),a=DataMgr.gameCtrl.wheelInfos[i];if(a){var s=sub_poker(a.pokers,n);s&&(a.pokers=s)}DataMgr.gameCtrl.cal_action_chi(e),this.refreshLogPokers(i)}else if("action_peng"==t){var i=e.idx,o=e.poker_list,a=DataMgr.gameCtrl.wheelInfos[i];if(a){var s=sub_poker(a.pokers,[o[0],o[1]]);s&&(a.pokers=s)}DataMgr.gameCtrl.cal_action_peng(e),this.refreshLogPokers(i)}else if("action_gang"==t){var i=e.idx,c=e.poker_list,a=DataMgr.gameCtrl.wheelInfos[i];if(a){var s=null;1==c.length?(s=sub_poker(a.pokers,c),s&&(a.pokers=s)):s=DataMgr.gameCtrl.lastOutPoker!=c[0]?sub_poker(a.pokers,c):sub_poker(a.pokers,[c[0],c[0],c[0]]),s&&(a.pokers=s)}DataMgr.gameCtrl.cal_action_gang(e),this.refreshLogPokers(i)}else if("show_card"==t){DataMgr.gameCtrl.cal_show_card(e);var l=DataMgr.gameCtrl.getPlayerByRid(e.rid);l&&this.refreshLogPokers(l.wheel_idx)}else if("action_hu"==t)DataMgr.gameCtrl.cal_action_hu(e);else if("user_poker_fix_flower"==t)DataMgr.gameCtrl.cal_user_poker_fix_flower(e);else if("show_result"==t)DataMgr.gameCtrl.cal_show_result(e);else if("open_door"==t)DataMgr.gameCtrl.cal_open_door(e),
DataMgr.gameCtrl.curStep=MJ_STEP_SELECT_RAND_POKER,DataMgr.gameCtrl.deskInfo.cur_step=MJ_STEP_SELECT_RAND_POKER;else if("rand_poker"==t)DataMgr.gameCtrl.cal_rand_poker(e),DataMgr.gameCtrl.curStep=MJ_STEP_PLAY,DataMgr.gameCtrl.deskInfo.cur_step=MJ_STEP_PLAY;else if("wheel_rand_poker"==t){if("action_hu"==this.perStepData.a){var _=3;3==DataMgr.gameCtrl.deskType&&(_=9),this.curStepTime=_/this.speedMult}DataMgr.gameCtrl.cal_wheel_rand_poker(e)}else if("rand_mine_idx"==t){var u=this;u.refreshMineDlg(!0),DataMgr.gameCtrl.randMineIdx=e.rand_mine_idx;var h=DataMgr.gameCtrl.randMineIdx,g=function(){for(var t=0;t<DataMgr.gameCtrl.randMineList.length;t++)if(!DataMgr.gameCtrl.randMineList[t].is_pass){DataMgr.gameCtrl.randMineList[t].is_pass=1;break}u.refreshMineDlg(),u.scheduleOnce(function(){DataMgr.gameCtrl.randMineIdx=(DataMgr.gameCtrl.randMineIdx+1)%DataMgr.gameCtrl.deskInfo.full_num,h==DataMgr.gameCtrl.randMineIdx||g()},2.9)};g()}else"rand_mine_list"==t&&DataMgr.gameCtrl.cal_rand_mine_list(e)},refreshPlayersOnline:function(){},refreshDeskOwn:function(){},refreshLogSpeed:function(){var t={1:GetRealPath("res/uires/game/log/num_1.png"),1.5:GetRealPath("res/uires/game/log/num_1_5.png"),2:GetRealPath("res/uires/game/log/num_2.png"),3:GetRealPath("res/uires/game/log/num_3.png")},e=t[this.speedMult];this.lab_log_speed_num&&this.lab_log_speed_num.loadTexture(e),this.lab_log_speed_num&&this.lab_log_speed_num.setVisible(!0)},refreshPlayBtn:function(){this.status!=this.STATU_TYPE.PLAY?(this.btn_log_play&&this.btn_log_play.setVisible(!0),this.btn_log_stop&&this.btn_log_stop.setVisible(!1)):(this.btn_log_play&&this.btn_log_play.setVisible(!1),this.btn_log_stop&&this.btn_log_stop.setVisible(!0))},tap_btn_log_back:function(){ModuleMgr.enterEnterScene()},tap_btn_log_share:function(){for(var t="",e=1;e<=4;e++){var i=DataMgr.gameCtrl.wheelInfos[e];if(i){var a=i.info&&i.info.name||"";t+=toDecodeURIComponent(a)+"    "}}t+="点击观看";var s=getQueryString("guest")||0,r=getQueryString("test")||0;platform.share("[录像分享]",t,SHARE_URL+"?game_type="+GAME_TYPE+"&test="+r+"&guest="+s+"&mj_record_rid="+DataMgr.gameCtrl.recordRid+"&lanscape_dev=1",0)},tap_btn_log_play:function(){this.status!=this.STATU_TYPE.NONE&&this.status!=this.STATU_TYPE.OVER&&(this.status==this.STATU_TYPE.PLAY?this.status=this.STATU_TYPE.PAUSE:this.status=this.STATU_TYPE.PLAY,this.refreshPlayBtn())},tap_btn_log_stop:function(){this.tap_btn_log_play()},tap_btn_log_quick:function(){for(var t=0;t<this.speedMultCfg.length;t++)if(this.speedMultCfg[t]==this.speedMult){var e=t+1;e>=this.speedMultCfg.length&&(e=0),this.speedMult=this.speedMultCfg[e];break}this.refreshLogSpeed()},tap_btn_slow:function(){this.speedMult=this.speedMult/2,this.speedMult=this.speedMult>=1/8?1/8:this.speedMult,this.curStepTime=this.curStepTime/this.speedMult}}),GameLogLayer.create=function(t,e,i){return new GameLogLayer(t,e,i)},ModuleMgr.registerModule("GameLogLayer",GameLogLayer)},GameDownKingShow=QPLayer.extend({uiPath:"ui/GameDownKingShow.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.scrol.setClippingType(ccui.Layout.CLIPPING_STENCIL)},setData:function(t){if(!t)return void this.setVisible(!1);this.setVisible(!0);var e=t.num,i=t.deskType,a=t.index,s=t.func1,r=t.func2,n=t.func3;this.item_card.setCkeckKingEnable(!1),this.item_card.setData(e);var o=this.getContentSize().width;this.item_card.setPositionX(-o/2);var c="res/uires/game/img_xiajing_"+i+".png";4==i&&(c="res/uires/game/img_xiajing_"+i+"_"+a+".png"),this.img_type.loadTexture(GetRealPath(c));var l=cc.Sequence.create(cc.MoveBy.create(.3,cc.p(o,0)),cc.CallFunc.create(function(){s&&s()}),cc.DelayTime.create(2.5),cc.CallFunc.create(function(){r&&r()}),cc.MoveBy.create(.3,cc.p(o,0)),cc.CallFunc.create(function(){n&&n()}));this.item_card.stopAllActions(),this.item_card.runAction(l)}}),GameDownKingShow.create=function(t,e,i){return new GameDownKingShow(t,e,i)},UIUtils.RegisterPathTemple("ui/GameDownKingShow.ui",GameDownKingShow),GameResultSub=QPDlg.extend({uiPath:"ui/GameResultSub.ui",data:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){if(this.data){var t=this.data.addScore||0;this.lab_score&&this.lab_score.setScore(t),DataMgr.gameCtrl.isLog?this.lab_score&&this.lab_score.setVisible(!1):this.lab_score&&this.lab_score.setVisible(!0);var e=DataMgr.gameCtrl.resultData,i=e.down_rand_pokers||[],a=e.return_down_rand_pokers||[];e.desk_type||0;if(a.length){this.grp_return_king.setVisible(!0);for(var s=1;s<=2;s++){var r=this["item_return_king_"+s];r&&(r.setCkeckKingEnable(!1),r.setData(a[s-1]))}}else this.grp_return_king.setVisible(!1);if(i.length){var n="res/uires/game/txt_xj_"+(e.desk_type||0)+".png";this.img_type.loadTexture(GetRealPath(n)),this.grp_normal_king.setVisible(!0);for(var s=1;s<=8;s++){var r=this["item_king_"+s];r&&(r.setCkeckKingEnable(!1),r.setData(i[s-1]))}var o=this.bg_king.getContentSize(),c=i.length,r=this["item_king_"+c];if(r&&this.bg_king.setContentSize(cc.size(r.getPositionX()+50,o.height)),c>2){var l=Math.floor(c/2),r=this["item_king_"+l];if(r){var _=0;a.length>0&&(_=50),this.grp_king.setPositionX(this.grp_king.getPositionX()-r.getPositionX()+_)}}else this.grp_king.setPositionX(this.grp_king.getPositionX()+50)}else this.grp_normal_king.setVisible(!1);this.lab_score&&this.lab_score.runAction(cc.Sequence.create(cc.MoveBy.create(.4,cc.p(0,40))))}},tap_btn_result:function(){ModuleMgr.runOrientationDlg("GameResult")},tap_btn_continue:function(){if(this.close(),!DataMgr.gameCtrl.isLog){if(DataMgr.gameCtrl.curStep==MJ_STEP_GAME_END)return void cc.eventManager.dispatchCustomEvent("SuccessGameEnd");ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"score_end"})}cc.eventManager.dispatchCustomEvent("ClearResuleCard")}}),GameResultSub.create=function(t,e,i){return new GameResultSub(t,e,i)},ModuleMgr.registerModule("GameResultSub",GameResultSub),GameMyBtn=QPLayer.extend({uiPath:"ui/GameMyBtn.ui",delegate:null,isCanGuo:!0,actionList:[],gangModle:1,noGangPokerMap:{},ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},initData:function(){this._num=0},onLoaded:function(){for(var t=[{grp:"btn_peng",ani:"btn_peng"},{grp:"btn_gang",ani:"btn_gang"},{grp:"btn_chi",ani:"btn_chi"},{grp:"btn_ming",ani:"btn_mimg"},{grp:"btn_hu",ani:"btn_hu"},{grp:"btn_you",ani:"btn_youjin"},{grp:"btn_you_1",ani:"btn_danyou"},{grp:"btn_you_2",ani:"btn_shuangyou"},{grp:"btn_you_3",ani:"btn_sanyou"}],e=0;e<t.length;e++){var i=t[e],a=this[i.grp];if(a){var s=ccs.Armature.create(i.ani);s.x=63,s.y=63,s.getAnimation().play("stand",-1,1),a.addChild(s)}}this.gangModle=1,this.noGangPokerMap={}},setData:function(t){this.setVisible(!1),t&&(this.delegate=t.delegate)},getActionList:function(){return this.actionList},setAction:function(){var t=DataMgr.gameCtrl.actionList||[];if(this.actionList=t,!t||t.length<=0)return void this.setVisible(!1);this.setVisible(!0),this.layer_mult_action&&this.layer_mult_action.setVisible(!1),this.btn_peng&&this.btn_peng.setVisible(!1),this.btn_gang&&this.btn_gang.setVisible(!1),this.btn_chi&&this.btn_chi.setVisible(!1),this.btn_hu&&this.btn_hu.setVisible(!1),this.btn_guo&&this.btn_guo.setVisible(!0),this.btn_ming&&this.btn_ming.setVisible(!1),this.btn_you&&this.btn_you.setVisible(!1),this.btn_you_1&&this.btn_you_1.setVisible(!1),this.btn_you_2&&this.btn_you_2.setVisible(!1),this.btn_you_3&&this.btn_you_3.setVisible(!1),this.isCanGuo=!0;for(var e=0;e<t.length;e++)if(t[e]==MJ_CHI)this.btn_chi&&this.btn_chi.setVisible(!0);else if(t[e]==MJ_PENG)this.btn_peng&&this.btn_peng.setVisible(!0);else if(t[e]==MJ_GANG)this.btn_gang&&this.btn_gang.setVisible(!0);else if(t[e]==MJ_HU){this.btn_hu&&this.btn_hu.setVisible(!0);for(var i=DataMgr.gameCtrl.actionHuTypes||[],a=0;a<i.length;a++){var s=i[a];if(s==MJ_HU_SINGLE_KING||s==MJ_HU_DOUBLE_KING||s==MJ_HU_THREE_KING){var r=this["btn_you_"+(s-MJ_HU_SINGLE_KING+1)];r&&(this.btn_hu.setVisible(!1),r.setVisible(!0)),s>=MJ_HU_DOUBLE_KING&&this.btn_guo&&this.btn_guo.setVisible(!1)}s==MJ_HU_FLOWER_KING&&this.btn_guo&&this.btn_guo.setVisible(!1)}}else if(t[e]==MJ_EXTRA)for(var i=DataMgr.gameCtrl.actionHuTypes||[],a=0;a<i.length;a++){if(i[a]==MJ_HU_CAN_SINGLE_KIND){this.btn_you&&this.btn_you.setVisible(!0),this.txt_you&&this.txt_you.setString("可单游");break}if(i[a]==MJ_HU_CAN_DOUBLE_KIND){this.btn_you&&this.btn_you.setVisible(!0),this.txt_you&&this.txt_you.setString("可双游");break}if(i[a]==MJ_HU_CAN_THREE_KIND){this.btn_you&&this.btn_you.setVisible(!0),this.txt_you&&this.txt_you.setString("可三游");break}}else t[e]==MJ_MING&&this.btn_ming&&this.btn_ming.setVisible(!0);this.sortGrp("grp_action",40,0,1)},clear:function(){var t=this;t.setVisible(!1),DataMgr.gameCtrl.actionList=[]},tap_btn_ming:function(){var t=this;this.delegate&&"function"==typeof this.delegate.checkCardTing&&this.delegate.checkCardTing();var t=this;t.setVisible(!1)},tap_btn_chi:function(){var t=this,e=DataMgr.gameCtrl.getChiList();if(e.length<=0)return void ModuleMgr.showTipMsg("没办法吃！");var i=function(i){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_chi",poker_list:e[i]}),t.clear()};1==e.length?i(0):(t.layer_mult_action.setVisible(!0),t.layer_mult_action.setData(e,function(t){i(t)}))},setGangModle:function(t){this.gangModle=t},setNoGangPokerMap:function(t){t=t||{},this.noGangPokerMap=t},tap_btn_gang:function(t){for(var e=this,i=[],a=0;a<DataMgr.gameCtrl.myCards.length;a++)i.push(DataMgr.gameCtrl.myCards[a]);i.sort(sort_card);for(var s=analyse_card_data(i),r=DataMgr.gameCtrl.myWheelInfo.weave_pokers||[],n=[],a=0;a<r.length;a++){var o=r[a];o.mj_action==MJ_PENG&&n.push(o.poker_list[0])}var c=DataMgr.gameCtrl.lastOutPoker;if(c>0){for(var a=0;a<n.length;a++)if(n[a]==c)return ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:[c]}),void e.clear();for(var a=0;a<s.three_list.length;a++)if(s.three_list[a]==c)return ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:[c,c,c,c]}),void e.clear()}if(DataMgr.gameCtrl.lastDispatchPoker>0&&(i.push(DataMgr.gameCtrl.lastDispatchPoker),i.sort(sort_card),s=analyse_card_data(i)),s){var l=this.noGangPokerMap||{},_=[];if(2==this.gangModle){for(var a=0;a<n.length;a++)if(n[a]==DataMgr.gameCtrl.lastDispatchPoker&&!l[n[a]]){for(var u=[],h=0;h<4;h++)u.push(n[a]);_.push(u);break}}else for(var a=0;a<n.length;a++)for(var g=0;g<s.single_list.length;g++)if(n[a]==s.single_list[g]&&!l[n[a]]){for(var u=[],h=0;h<4;h++)u.push(n[a]);_.push(u)}for(var d=[],m=[],a=0;a<s.four_list.length;a++)a%4==0&&(m=[],d.push(m)),m.push(s.four_list[a]);var f=_.concat(d);if(f.length<0)return void ModuleMgr.showTipMsg("没办法杠！");var p=function(t){t<_.length?ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:[f[t][0]]}):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:f[t]}),e.clear()};if(1!=t)1==f.length?p(0):(e.layer_mult_action.setVisible(!0),e.layer_mult_action.setData(f,function(t){p(t)}));else for(var a=0;a<f.length;a++)if(f[a][0]==DataMgr.gameCtrl.lastDispatchPoker)return void p(a)}},tap_btn_you:function(){var t=this.delegate;if(t){t.unselectAllPoker();var e=null,i=DataMgr.gameCtrl.wheelInfos[DataMgr.gameCtrl.myWheelIdx];if(i){var a=i.extra_data||{};e=a.extra_poker}var s=arrayToMap(DataMgr.gameCtrl.actionHuTypes||[]),r=null;if(s[MJ_HU_CAN_DOUBLE_KIND]||s[MJ_HU_CAN_THREE_KIND]){var n=t.getCardItemList[DataMgr.gameCtrl.randPokerList[0]];if(r=n[n.length-1],!r){var n=t.getCardItemList[DataMgr.gameCtrl.randPokerList[1]];r=n[n.length-1]}}else if(s[MJ_HU_CAN_SINGLE_KIND]){e==DataMgr.gameCtrl.randPokerList[0]&&(e=67);var n=t.getCardItemList(e);r=n[n.length-1]}if(!r)return void this.tap_btn_guo();this.tap_btn_guo(),s[MJ_HU_CAN_DOUBLE_KIND]||s[MJ_HU_CAN_THREE_KIND]?t.tap_btn_out(r):s[MJ_HU_CAN_SINGLE_KIND]&&r.setSelect()}},tap_btn_you_1:function(){this.tap_btn_hu()},tap_btn_you_2:function(){this.tap_btn_hu()},tap_btn_you_3:function(){this.tap_btn_hu()},tap_btn_hu:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_hu"}),this.setVisible(!1)},tap_btn_guo:function(){if(this.isCanGuo){this.delegate&&this.delegate.bolTurnSelf()||(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_cancel"}),DataMgr.gameCtrl.actionList=[]),this.delegate&&"function"==typeof this.delegate.calGuo&&this.delegate.calGuo();var t=this;t.setVisible(!1)}},tap_btn_peng:function(){var t=DataMgr.gameCtrl.lastOutPoker;ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_peng",poker_list:[t,t,t]}),this.clear()}}),GameMyBtn.create=function(t,e,i){return new GameMyBtn(t,e,i)},UIUtils.RegisterPathTemple("ui/GameMyBtn.ui",GameMyBtn),GameShowKing=QPDlg.extend({uiPath:"ui/GameShowKing.ui",bolDlgAction:!1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){if(this.data){for(var t=this.data,e=t.pokerList||[],i=t.showKingType||1,a=t.func,s=1;s<=2;s++){var r=e[s-1];r?(this["item_king_"+s]&&this["item_king_"+s].setVisible(!0),this["item_king_"+s]&&this["item_king_"+s].setData(r)):this["item_king_"+s]&&this["item_king_"+s].setVisible(!1)}this.sortGrp("grp_king",15),this.ani_efc_1&&this.ani_efc_1.setVisible(!1),this.ani_efc_2&&this.ani_efc_2.setVisible(!1);var n=this["ani_efc_"+i];n&&(n.setVisible(!0),n.getAnimation().play("stand",-1,-1),n.getAnimation().setMovementEventCallFunc(this.animationEvent,this)),playEffect("kaijin.mp3");var o=this;o.scheduleOnce(function(){o.close(),a&&a()},2)}},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete}}),GameShowKing.create=function(t,e,i){return new GameShowKing(t,e,i)},ModuleMgr.registerModule("GameShowKing",GameShowKing),GameChangeDeskDlg=QPDlg.extend({uiPath:"ui/GameChangeDeskDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this.checkGou()},checkGou:function(){for(var t=DataMgr.gameCtrl.getBgId(),e=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_card_bg")||0),i=0;i<3;i++)this["card_gou_"+i]&&this["card_gou_"+i].setVisible(e==i),this["desk_gou_"+i]&&this["desk_gou_"+i].setVisible(t==i)},setCardBg:function(t){cc.sys.localStorage.setItem(GAME_TYPE+"_card_bg",t),cc.eventManager.dispatchCustomEvent("SuccesSetCardBg",{}),this.checkGou()},setDeskBg:function(t){cc.sys.localStorage.setItem(GAME_TYPE+"_bg",t),cc.eventManager.dispatchCustomEvent("SuccesSetDeskBg",{}),this.checkGou()},tap_card_bg_0:function(){this.setCardBg(0)},tap_card_bg_1:function(){this.setCardBg(1)},tap_card_bg_2:function(){this.setCardBg(2)},tap_desk_bg_0:function(){this.setDeskBg(0)},tap_desk_bg_1:function(){this.setDeskBg(1)},tap_desk_bg_2:function(){this.setDeskBg(2)}}),GameChangeDeskDlg.create=function(t,e,i){return new GameChangeDeskDlg(t,e,i)},ModuleMgr.registerModule("GameChangeDeskDlg",GameChangeDeskDlg),GameCtrlNcmj=GameCtrl.extend({clearData:function(){GameCtrl.prototype.clearData.call(this),this.totalCardNum=MY_TOTAL_CARD_NUM_TT},getRoomCardCost:function(t){if(DataMgr.activityCtrl.bolFreeRoom())return 0;for(var e=t.full_round,i=(t.desk_type,0),a=0;a<ROOM_CARD_COST.length;a++)if(ROOM_CARD_COST[a].round==e){i=ROOM_CARD_COST[a].cost;break}return i},checkGameEnd:function(){if(this.deskInfo){if(99==this.deskInfo.full_round)return void(this.deskInfo.cur_round>=this.deskInfo.full_num&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"score_end"}));this.deskInfo.cur_round>=this.deskInfo.full_round&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"score_end"})}},canEatList:function(t){var e=[],i=get_card_value(t);return t<49?i<=7&&e.push([t,t+1,t+2]):t<53?1!=i&&2!=i||(e.push([t,t+1,t+2]),2==i&&(e.push([t,t+1,t+3]),e.push([t,t+2,t+3]))):65==t&&e.push([t,t+1,t+2]),e}}),GameCtrlFzmj=GameCtrl.extend({clearData:function(){GameCtrl.prototype.clearData.call(this),this.totalCardNum=MY_TOTAL_CARD_NUM_ST},stepFixFlower:function(){},getChiList:function(){var t=DataMgr.gameCtrl.lastOutPoker,e=calc_tip_chi_poker(DataMgr.gameCtrl.myCards,t);return e},getRoomCardCost:function(t){var e=0,i=t.full_round,a=t.has_big_poker||0;if(a)e=60;else{var s={1:1,4:30,8:60};e=s[i]||0}return e},cal_desk_info_data:function(t){GameCtrl.prototype.cal_desk_info_data.call(this,t)}}),GameLayerNcmj=GameLayer.extend({startType:0,showKingType:2,deskTypeKeyArr:["desk_type","turn_back","chao_master","discard_poker"],stepRandMasterTime:3,stepRandMaster:function(){for(var t=this,e=1;e<=4;e++)this["role_card"+e]&&this["role_card"+e].hideMaster();this.scheduleOnce(function(){t.tap_btn_open_door()},this.stepRandMasterTime);var i=function(){t.refreshMaster()};ModuleMgr.runDlg("GameStart",{callback:i},null,null)},refreshDesk:function(){GameLayer.prototype.refreshDesk.call(this),this.txt_game_name&&this.txt_game_name.setString("南昌麻将")},refreshGameTypeTxt:function(){var t=DataMgr.gameCtrl.deskInfo,e="";if(t)for(var i=0;i<this.deskTypeKeyArr.length;i++){var a=this.deskTypeKeyArr[i],s=GAME_TYPE_CFG[a][t[a]||0];s&&(e+=s+"  ")}if(99==DataMgr.gameCtrl.deskInfo.full_round?e+="一圈":199==DataMgr.gameCtrl.deskInfo.full_round&&(e+="二圈"),this.txt_desk_type&&this.bg_desk_type){this.txt_desk_type.setString(e);var r=this.bg_desk_type.getContentSize(),n=this.txt_desk_type.getContentSize();this.bg_desk_type.setVisible(!0),this.bg_desk_type.setContentSize(cc.size(n.width+20,r.height))}},refreshRound:function(){if(DataMgr.gameCtrl.deskInfo){var t=DataMgr.gameCtrl.deskInfo.cur_round+"/"+DataMgr.gameCtrl.deskInfo.full_round;99==DataMgr.gameCtrl.deskInfo.full_round&&(t=DataMgr.gameCtrl.deskInfo.cur_round+"/4"),199==DataMgr.gameCtrl.deskInfo.full_round&&(t=DataMgr.gameCtrl.deskInfo.cur_round+"/8"),this.txt_round.setString(t)}},chaoMaster:function(){ModuleMgr.runDlg("GameChaoMaster")},getStepRandKingTime:function(){return 1==DataMgr.gameCtrl.deskType?this.stepRandKingTime+3:4==DataMgr.gameCtrl.deskType?DataMgr.gameCtrl.deskInfo.cur_round<=1?this.stepRandKingTime:this.stepRandKingTime+3:void 0},checkKingGrp:function(){return GameLayer.prototype.checkKingGrp.call(this),!DataMgr.gameCtrl.randPokerList||DataMgr.gameCtrl.randPokerList.length<=0?void(this.item_king_1&&this.item_king_1.setVisible(!1)):(this.item_king_1&&this.item_king_1.setVisible(!0),void(this.item_king_1&&this.item_king_1.setData(DataMgr.gameCtrl.randPokerList)))}}),GameLayerNcmj.create=function(t,e,i){return new GameLayerNcmj(t,e,i)},ModuleMgr.registerModule("GameLayerNcmj",GameLayerNcmj),GameLayerFzmj=GameLayer.extend({isAddFixFlower:!1,addFlowerMap:{},startType:1,showKingType:1,stepOpenDoorTime:3,refreshDesk:function(){GameLayer.prototype.refreshDesk.call(this);var t="";t=1==DataMgr.gameCtrl.hasBigPoker?"有大字":"无大字",this.txt_desk_type.setString(t)},onPokerInitedEnd:function(){DataMgr.gameCtrl.curStep==MJ_STEP_PLAY&&this.refreshPoker(!0)},stepOpenDoor:function(){var t=this,e=function(){};this.showShaizi(e);var t=this;this.scheduleOnce(function(){t.onPokerInited()},this.stepOpenDoorTime)},checkFlower:function(t){for(var e=this,i=1;i<=MY_TOTAL_CARD_NUM;i++){var a=this["item_card_"+i];a&&a.isVisible()&&a.getNum()>=49&&this.addFlowerAction(a)}this.item_card_dispatch&&this.item_card_dispatch.isVisible()&&this.item_card_dispatch.getNum()>=49&&this.addFlowerAction(this.item_card_dispatch),DataMgr.gameCtrl.initMyCards(t),e.refreshPoker(!0,!0)},playFixFlowerAction:function(t){for(var e=this,i=[],a=DataMgr.gameCtrl.deskInfo.full_num,s=1;s<=a;s++)i[s]=[];for(var s=0;s<DataMgr.gameCtrl.allFlowerList.length;s++){var r=DataMgr.gameCtrl.allFlowerList[s];r&&(i[r.idx]||(i[r.idx]=[]),i[r.idx].push(r))}var n=function(s){for(var r=null,o=0;;){if(r=i[s],r&&r.length>0)break;if(o>=a)return void(t&&t());s=(s+1)%a,s=0==s?a:s,o++}var c=r[0],l=c.idx;r.splice(0,1);var r=c.flower_list||[];if(r.length>0){var _=DataMgr.gameCtrl.getChairIdByWheelIdx(l);e.playActionEfc(l,{mj_action:MJ_FLOWER}),l==DataMgr.gameCtrl.myWheelIdx?e.checkFlower(c.poker_list):e["role_card"+_]&&e["role_card"+_].refreshFlowerPokers(r)}e.scheduleOnce(function(){var t=(s+1)%a;t=0==t?a:t,n(t)},2)};n(DataMgr.gameCtrl.lastWinIdx)},stepFixFlower:function(){var t=this,t=this,e=function(){t.refreshPoker(!0),t.scheduleOnce(function(){t.showKing()},1)};this.scheduleOnce(function(){t.playFixFlowerAction(function(){e()})},4)},stepRandKing:function(){var t=this;t.btn_select_rand_poker.setVisible(!1)},refreshPlayers:function(){GameLayer.prototype.refreshPlayers.call(this),DataMgr.gameCtrl.curStep==MJ_STEP_PLAY&&this.refreshFixFlower(!1),this.refreshRoleScore()},tap_btn_out:function(t){return!this.isAddFixFlower&&GameLayer.prototype.tap_btn_out.call(this,t)},selectAction:function(){this.isAddFixFlower||GameLayer.prototype.selectAction.call(this)},bolCardCanOut:function(t){var e=t.getNum();if(DataMgr.gameCtrl.bolKingCard(e)){var i=DataMgr.gameCtrl.wheelInfos[DataMgr.gameCtrl.myWheelIdx];if(i&&(i.dui_kind_count||0)<2)return ModuleMgr.showTipMsg("当前牌型不能出金牌！"),!1}return GameLayer.prototype.bolCardCanOut.call(this,t)},dispatchPoker:function(t,e){this.isAddFixFlower||(GameLayer.prototype.dispatchPoker.call(this,t,e),this.checkCardCanTouch())},checkKingGrp:function(){return GameLayer.prototype.checkKingGrp.call(this),!DataMgr.gameCtrl.randPokerList||DataMgr.gameCtrl.randPokerList.length<=0?void this.item_king_2.setVisible(!1):(this.item_king_2.setVisible(!0),void this.item_king_2.setData(DataMgr.gameCtrl.randPokerList))},checkCardCanTouch:function(){}});GameLayerFzmj.create=function(t,e,i){return new GameLayerFzmj(t,e,i)};ModuleMgr.registerModule("GameLayerFzmj",GameLayerFzmj),GameTingCard=QPLayer.extend({uiPath:"ui/GameTingCard.ui",ctor:function(t,e,i){this.data=t,QPLayer.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this.setVisible(!1)},setCardBg:function(t){if(this.grp_card)for(var e=this.grp_card.getChildren(),i=0;i<e.length;i++){var a=e[i];a&&"function"==typeof a.setCardBg&&a.setCardBg(t)}},setData:function(t,e){t=t||[],e=e||!1;var i=this,a=t.length;a<=0&&i.setVisible(!1);var s=.45;i.setVisible(!0);var r=32.4*a+60,n=this.img_bg.getContentSize();i.img_bg.setContentSize(cc.size(r,n.height)),i.lab_ming.setPositionX(r),e?i.lab_ming.setVisible(!1):i.lab_ming.setVisible(!0);var o=this.grp_card;o.removeAllChildren(!0);for(var c=function(t,e){ModuleMgr.createNode(GameLieCardBase,function(i){var a=GameLieCardBase.create();a.setData(t),o.addChild(a),a.setScale(s,s),a.setAnchorPoint(0,0);var r=a.getContentSize().width*e*s;a.setPositionX(r),a.setPositionY(0)})},l=0;l<a;l++)c(t[l],l)}}),GameTingCard.create=function(t,e,i){return new GameTingCard(t,e,i)},UIUtils.RegisterPathTemple("ui/GameTingCard.ui",GameTingCard),GameTingCard1=GameTingCard.extend({uiPath:"ui/GameTingCard1.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},setData:function(t){t=t||[];var e=this,i=t.length;i<=0&&e.setVisible(!1);var a=.45;e.setVisible(!0);var s=32.4*i+60,r=this.img_bg.getContentSize();e.img_bg.setContentSize(cc.size(s,r.height)),e.lab_ming.setPositionX(this.getContentSize().width-s);var n=this.grp_card;n.removeAllChildren(!0);for(var o=function(t,e){ModuleMgr.createNode(GameLieCardBase,function(i){var s=GameLieCardBase.create();s.setData(t),n.addChild(s),s.setScale(a,a),s.setAnchorPoint(1,0);var r=40-s.getContentSize().width*e*a;s.setPositionX(r),s.setPositionY(0)})},c=0;c<i;c++)o(t[c],c)}}),GameTingCard1.create=function(t,e,i){return new GameTingCard1(t,e,i)},UIUtils.RegisterPathTemple("ui/GameTingCard1.ui",GameTingCard1),SetingNcmjDlg=SetingDlg.extend({uiPath:"ui/SetingNcmjDlg.ui",musicType:0,curTag:-1,ctor:function(t,e,i){this.data=t,SetingDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){SetingDlg.prototype.onLoaded.call(this);var t=cc.sys.localStorage.getItem(GAME_TYPE+"musicType")||0;this.setYy(t)},refreshCk:function(t){var e=this;if(e.curTag!=t){for(var i=0;i<=5;i++)e["btn_tab_"+i]&&e["btn_tab_"+i].setEnabled(i!=t);this.curTag=t}},setYy:function(t){this.musicType=t,this.refreshCk(t),cc.sys.localStorage.setItem(GAME_TYPE+"musicType",t),DataMgr.setMusicType()},tap_btn_tab_0:function(){this.setYy(0)},tap_btn_tab_1:function(){this.setYy(1)},tap_btn_tab_2:function(){this.setYy(2)}}),SetingNcmjDlg.create=function(t,e,i){return new SetingNcmjDlg(t,e,i)},GameAniCenter=QPLayer.extend({uiPath:"ui/GameActionEffect.ui",data:null,ctor:function(t,e,i){this.data=t,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){if(this.data){var t=this.data.aniName,e=ccs.Armature.create(t);this.grp_ani&&this.grp_ani.addChild(e),e.setVisible(!0),e.getAnimation().play("stand",-1,-1),e.getAnimation().setMovementEventCallFunc(this.animationEvent,this)}},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete&&(this.data&&this.data.callBack&&this.data.callBack(),this.close())}}),GameAniCenter.create=function(t,e,i){return new GameAniCenter(t,e,i)},ModuleMgr.registerModule("GameAniCenter",GameAniCenter),GameNcmjMineDlg=QPLayer.extend({uiPath:"ui/GameNcmjMineDlg.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},initData:function(){},onLoaded:function(){this.refreshUi()},refreshUi:function(){for(var t=!0,e=DataMgr.gameCtrl.randMineList,i=0;i<4;i++){var a=i+1,s=this["grp_"+a];if(s){var r=e[i];r?(s.setVisible(!0),1==r.is_pass?(this["item_card_"+a]&&this["item_card_"+a].setCkeckKingEnable(!1),this["item_card_"+a]&&this["item_card_"+a].setCard(r.extra_poker),this["item_card_"+a]&&this["item_card_"+a].checkBack(!1),this["lab_num_"+a]&&this["lab_num_"+a].setString(r.rand_num1+r.rand_num2)):(t=!1,this["item_card_"+a]&&this["item_card_"+a].checkBack(!0),this["lab_num_"+a]&&this["lab_num_"+a].setString(""))):s.setVisible(!1)}}DataMgr.gameCtrl.randMineIdx!=DataMgr.gameCtrl.myWheelIdx||t?this.btn_throw&&this.btn_throw.setVisible(!1):this.btn_throw&&this.btn_throw.setVisible(!0)},tap_btn_throw:function(){this.btn_throw.setVisible(!1),ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"select_rand_mine"})}}),GameNcmjMineDlg.create=function(t,e,i){return new GameNcmjMineDlg(t,e,i)},UIUtils.RegisterPathTemple("ui/GameNcmjMineDlg.ui",GameNcmjMineDlg),ModuleMgr.registerModule("GameNcmjMineDlg",GameNcmjMineDlg),ClubCreateDlg=QPDlg.extend({uiPath:"ui/Club/ClubCreateDlg.ui",listView_item:null,curTag:0,costNum:0,searchList:[],ctor:function(t,e,i){this.data=t,this.listView_item=ClubItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.input_name.setFontSize(31),this.input_weixin.setFontSize(31),this.input_search.setFontSize(31);var t=this;t.addListener("CreateUnionSucces",function(e){t.close()}),t.addListener("RecommendUnionSucces",function(e){var i=e.getUserData();t.searchList=i.union_list||[],t.refreshSeachList()}),t.addListener("SearchUnionSucces",function(e){var i=e.getUserData();t.searchList=i.union_list||[],t.refreshSeachList(),0==t.searchList.length&&ModuleMgr.showTipMsg("找不到该好友圈！")});var e=CsvMgr.getDataWithFile("union");e&&(this.costNum=(e[GAME_TYPE+":create"]||{}).cost||0),t.setText("lab_cost",this.costNum),t.grp_create.setVisible(!1),t.grp_search.setVisible(!1),t.selectTag(1)},selectTag:function(t){if(this.curTag!=t){for(var e=1;e<=2;e++)this["btn_tab_"+e]&&(e!=t?this["btn_tab_"+e].setOpacity(0):this["btn_tab_"+e].setOpacity(255));this.curTag=t,1==t?(this.grp_create.setVisible(!0),this.grp_search.setVisible(!1)):2==t&&(this.grp_create.setVisible(!1),this.grp_search.setVisible(!0),0==DataMgr.clubCtrl.applyList.length&&ME_D.send_message(CMD_UNION_MESSAGE,"get_apply_list",{game_type:GAME_TYPE}),ME_D.send_message(CMD_UNION_OPER,"recommend_union",{game_type:GAME_TYPE}))}},refreshSeachList:function(){this.refreshList({name:"listView",list:this.searchList,async:!0})},tap_btn_tab_1:function(){this.selectTag(1)},tap_btn_tab_2:function(){this.selectTag(2)},tap_btn_create_club:function(){var t=this.input_name.getString(),e=this.input_weixin.getString();if(!t)return ModuleMgr.showTipMsg("好友圈名字不能是空！");if(this.costNum>ME_D.get_user().room_card)return ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！");var i=function(i){var a=!1;for(var s in i){var r=s,n=t.indexOf(r);if(n>-1){a=!0;break}}return a?ModuleMgr.showTipMsg("好友圈名字非法！"):void ME_D.send_message_waiting(CMD_UNION_OPER,"create_union",{name:t,wechat:e,game_type:GAME_TYPE})};CsvMgr.getBannedWordMap(i)},tap_btn_search:function(t){var e=this.input_search.getString();return e?void ME_D.send_message(CMD_UNION_OPER,"search_union",{name:e,game_type:GAME_TYPE}):ModuleMgr.showTipMsg("名字不能是空！")}}),ClubCreateDlg.create=function(t,e,i){return new ClubCreateDlg(t,e,i)},ModuleMgr.registerModule("ClubCreateDlg",ClubCreateDlg),ClubItem=QPListItem.extend({uiPath:"ui/Club/ClubItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("ApplyUnionSucces",function(e){t.refreshStatus()})},setData:function(t){if(!t)return void this.setVisible(!1);this.setVisible(!0),this.data=t;this.item_head.setData({url:t.head_icon}),this.lab_club_name.setString(toDecodeURIComponent(t.name)),this.lab_notice.setString(t.apply_notice||"无"),this.lab_notice.setVisible(!1),this.lab_people.setString(t.union_mem_num+"/"+DataMgr.clubCtrl.getMaxClubPeople(t.lv)),this.refreshStatus()},refreshStatus:function(){if(this.data){this.lab_apply.setVisible(!1),this.lab_applyed.setVisible(!1),this.btn_apply.setVisible(!0);for(var t=!1,e=DataMgr.clubCtrl.applyList,i=0;i<e.length;i++)if(e[i]==this.data.rid){t=!0;break}t?(this.btn_apply.setVisible(!1),this.lab_applyed.setVisible(!0)):this.lab_apply.setVisible(!0)}},getData:function(){return this.data},tap_item_head:function(){ModuleMgr.runDlg("ClubDetailsDlg",this.data,null,null)},tap_btn_apply:function(){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"apply_union",{union_rid:this.data.rid,game_type:GAME_TYPE})}}),ClubItem.create=function(t,e,i){return new ClubItem(t,e,i)},ModuleMgr.registerModule("ClubItem",ClubItem);var ClubRoomDlg_send_time=0;ClubRoomDlg=QPDlg.extend({uiPath:"ui/Club/ClubRoomDlg.ui",todoChatList:[],newChatList:[],data:null,zhankai:!1,bolSendMsg:!1,lastChatRid:"",bolCanChatList:!1,noticeChatData:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){DataMgr.clubCtrl.clubClearData(),ME_D.send_message(CMD_UNION_OPER,"enter_union",{game_type:GAME_TYPE}),ME_D.send_message(CMD_UNION_MESSAGE,"get_union_chat_list",{game_type:GAME_TYPE}),this.clearUi();var t=this;t.addListener("EnterUnionSucces",function(e){t.refreshUi();var i=DataMgr.clubCtrl.curClubData;i.match_rid&&ME_D.send_message(CMD_UNION_MESSAGE,"get_match_info",{game_type:GAME_TYPE})}),t.addListener("GetMatchInfoSucces",function(e){t.refreshUi()}),t.addListener("LevelUpUnionSucces",function(e){t.refreshUi()}),t.addListener("MemberListSucces",function(e){e.getUserData();t.refreshUi();var i=DataMgr.clubCtrl.getSelfInfo();i&&(i.position!=UNION_POSITION_MASTER&&i.position!=UNION_POSITION_ASSISTANT||ME_D.send_message(CMD_UNION_MESSAGE,"get_union_applyed_list",{game_type:GAME_TYPE,offset:0,limit_num:1}))}),t.addListener("GetUnionApplyedListSucces",function(e){t.checkRedPoint()}),t.addListener("AgreeApplySucces",function(e){t.checkRedPoint()}),t.addListener("RefuseApplySucces",function(e){t.checkRedPoint()}),t.addListener("UnionChatSucces",function(e){var i=e.getUserData();t.newChatList.push(i)}),t.addListener("showChatInput",function(t){t.getUserData()}),t.addListener("CreateMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("StopMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("CloseMatchSucces",function(e){e.getUserData();t.refreshUi()}),this.addListener("HideChatLayer",function(e){e.getUserData();t.hideChatLayer()}),this.addListener("SetsBoolSendMsg",function(e){e.getUserData();t.bolSendMsg=!0});var e=DataMgr.clubCtrl.getMyClub();e&&(t.noticeChatData={send_name:"公告",chat_info:{send_content:""}}),t.addListener("GetUnionChatListSucces",function(e){var i=e.getUserData(),a=i.map_list||[];if(0!=a.length){t.lastChatRid=a[a.length-1].rid,t.bolCanChatList=!1,t.noticeChatData&&t.noticeChatData.chat_info&&t.noticeChatData.chat_info.send_content&&(t.todoChatList.push(t.noticeChatData),t.noticeChatData=null);for(var s=0;s<a.length;s++)t.todoChatList.push(a[s]);
}}),0==DataMgr.clubCtrl.clubMemberList.length||this.refreshUi(),this.showList.setBounceEnabled(!0),this.btn_chat&&this.btn_chat.setVisible(!0),this.input_chat&&this.input_chat.setVisible(!1),this.btn_send&&this.btn_send.setVisible(!1),this.scheduleUpdate()},onExit:function(){DataMgr.clubCtrl.clubClearData(),ME_D.send_message(CMD_UNION_OPER,"close_union",{game_type:GAME_TYPE}),QPDlg.prototype.onExit.call(this)},clearUi:function(){this.lab_clubname.setVisible(!1),this.lab_people.setVisible(!1)},hideInput:function(){this.input_chat.setVisible(!1)},showInput:function(){this.input_chat.setVisible(!0)},refreshUi:function(){var t=DataMgr.clubCtrl.curClubData;t&&(this.lab_clubname.setVisible(!0),this.lab_people.setVisible(!0),this.item_head.setData({url:t.head_icon}),this.lab_clubname.setString(toDecodeURIComponent(t.name)),this.setText("lab_people",DataMgr.clubCtrl.getClubOnlineNum()+"/"+DataMgr.clubCtrl.getClubMemNum()),DataMgr.clubCtrl.bolMatchOver()?this.btn_match_create_game&&this.btn_match_create_game.setVisible(!1):this.btn_match_create_game&&this.btn_match_create_game.setVisible(!0))},checkRedPoint:function(){DataMgr.clubCtrl.clubApplyList||[];0==DataMgr.clubCtrl.clubApplyCount?this.img_msg_red&&this.img_msg_red.setVisible(!1):this.img_msg_red&&this.img_msg_red.setVisible(!0)},_onAddChat:function(){var t=this,e=null,i=!1;if(this.todoChatList.length>0&&(e=this.todoChatList[0],this.todoChatList.splice(0,1),i=!1),this.newChatList.length>0&&(e=this.newChatList[0],this.newChatList.splice(0,1),i=!0),e){var a=t.showList,s=ClubChatLeft;e.send_rid==ME_D.get_rid()&&(s=ClubChatRight),ModuleMgr.createNode(s,function(r){var n=s.create();n.setTouchEnabled(!0),n.anchorY=1,n.setData(e),n.setTouchEnabled(!0),i?a.pushBackCustomItem(n):a.insertCustomItem(n,0),t.lastChatRid==e.rid&&(t.bolCanChatList=!0);var o=a.getInnerContainerPosition();0==o.y||t.bolSendMsg?(t.bolSendMsg=!1,a.forceDoLayout(),a.jumpToBottom()):(a.forceDoLayout(),o.y=o.y-r.getContentSize().height-a.getItemsMargin(),a.setInnerContainerPosition(o))})}},update:function(t){QPDlg.prototype.update.call(this,t),this._onAddChat();var e=this.showList;if(e){var i=e.getInnerContainerPosition().y,a=e.getInnerContainerSize(),s=e.getContentSize();this.lastChatRid&&this.bolCanChatList&&a.height>s.height&&s.height-a.height-10>i&&(ME_D.send_message(CMD_UNION_MESSAGE,"get_union_chat_list",{game_type:GAME_TYPE,rid:this.lastChatRid}),this.lastChatRid="",this.bolCanChatList=!1)}},tap_btn_massage:function(t){this.hideInput(),ModuleMgr.runDlg("ClubDlg")},tap_btn_send:function(t){var e=new Date;if(e.getTime()-ClubRoomDlg_send_time<4e3)return ModuleMgr.showTipMsg("发送太频繁，请稍后发送！");ClubRoomDlg_send_time=e.getTime();var i=this.input_chat.getString();if(!i)return void ModuleMgr.showTipMsg("发送消息不能为空！");var a=this,s=function(t){var e=!1;for(var s in t){var r=s,n=i.indexOf(r);if(n>-1){e=!0;break}}return e?ModuleMgr.showTipMsg("存在非法字符！"):(a.bolSendMsg=!0,ME_D.send_message(CMD_UNION_MESSAGE,"union_chat",{game_type:GAME_TYPE,send_content:i}),void a.input_chat.setString(""))};CsvMgr.getBannedWordMap(s)},tap_btn_result:function(){this.hideInput(),ModuleMgr.runDlg("ClubResultDlg")},createGame:function(t){if(0==DataMgr.gameCtrl.deskIdx){var e=DataMgr.clubCtrl.curClubData;if(!e)return;this.hideInput(),ModuleMgr.runDlg("CreateRoomDlg",{bolClub:!0,clubData:e,bolMatch:t},null,null)}else{var i=DataMgr.clubCtrl.getMyClub(),a="",s="";i&&(a=i.match_rid,s=i.rid),ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:DataMgr.gameCtrl.deskIdx,union_rid:s,match_rid:a})}},tap_btn_club_create_game:function(){this.createGame(!1)},tap_btn_match_create_game:function(){this.createGame(!0)},showChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!0)},hideChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!1)},tap_btn_chat:function(){this.showChatLayer()},tap_bg:function(){this.hideChatLayer()}}),ClubRoomDlg.create=function(t,e,i){return new ClubRoomDlg(t,e,i)},ModuleMgr.registerModule("ClubRoomDlg",ClubRoomDlg),ClubApplyList=QPDlg.extend({uiPath:"ui/Club/ClubApplyList.ui",listView_item:null,applyList:[],limitNum:5,maxCount:0,curPageIndex:0,ctor:function(t,e,i){this.data=t,this.listView_item=ClubApplyListItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.getApplyList(this.curPageIndex);var t=this;t.addListener("GetUnionApplyedListSucces",function(e){var i=e.getUserData();t.applyList=i.map_list||[],t.refreshApplyList()})},getApplyList:function(t){var e=this;t=t||e.curPageIndex;var i=t*e.limitNum;this.maxCount=DataMgr.clubCtrl.clubApplyCount||0,ME_D.send_message(CMD_UNION_MESSAGE,"get_union_applyed_list",{game_type:GAME_TYPE,offset:i,limit_num:e.limitNum})},refreshApplyList:function(){if(0==this.applyList.length)this.lab_null.setVisible(!0),this.listView.setVisible(!1);else{this.lab_null.setVisible(!1),this.listView.setVisible(!0),this.maxCount=DataMgr.clubCtrl.clubApplyCount||0,this.refreshList({name:"listView",list:this.applyList,async:!0});var t=Math.ceil(this.maxCount/this.limitNum);t=0==t?1:t,this.lab_page.setString(this.curPageIndex+1+"/"+t)}},tap_btn_close:function(){QPDlg.prototype.tap_btn_close.call(this),cc.eventManager.dispatchCustomEvent("ShowNoticeInput")},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getApplyList(this.curPageIndex))},tap_btn_next_page:function(){var t=!1;if(this.maxCount!=DataMgr.clubCtrl.clubApplyCount?(this.curPageIndex+1)*this.limitNum<DataMgr.clubCtrl.clubApplyCount?t=!0:DataMgr.clubCtrl.clubApplyCount%this.limitNum==0&&this.curPageIndex>0&&this.curPageIndex--:t=!0,t){if(this.curPageIndex>=Math.floor((this.maxCount-1)/this.limitNum))return;this.curPageIndex++}this.getApplyList(this.curPageIndex)}}),ClubApplyList.create=function(t,e,i){return new ClubApplyList(t,e,i)},ModuleMgr.registerModule("ClubApplyList",ClubApplyList),ClubApplyListItem=QPListItem.extend({uiPath:"ui/Club/ClubApplyListItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("AgreeApplySucces",function(e){var i=e.getUserData();t.calAgree(i.rid)}),t.addListener("RefuseApplySucces",function(e){var i=e.getUserData();t.calRefuse(i.rid)})},setData:function(t){t&&(this.data=t,this.lab_agreeed.setVisible(!1),this.lab_refuseed.setVisible(!1),this.grp_agree.setVisible(!0),this.grp_refuse.setVisible(!0),this.item_head.setData({url:t.headimgurl||t.head_icon}),this.lab_name.setString(toDecodeURIComponent(t.name)))},tap_btn_agree:function(t){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"agree_apply",{game_type:GAME_TYPE,rid:this.data.rid})},calAgree:function(t){this.data&&this.data.rid==t&&(this.lab_agreeed.setVisible(!0),this.grp_agree.setVisible(!1),this.grp_refuse.setVisible(!1))},tap_btn_refuse:function(){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"refuse_apply",{game_type:GAME_TYPE,rid:this.data.rid})},calRefuse:function(t){this.data&&this.data.rid==t&&(this.lab_refuseed.setVisible(!0),this.grp_agree.setVisible(!1),this.grp_refuse.setVisible(!1))}}),ClubApplyListItem.create=function(t,e,i){return new ClubApplyListItem(t,e,i)},ModuleMgr.registerModule("ClubApplyListItem",ClubApplyListItem),ClubDetailsDlg=QPDlg.extend({uiPath:"ui/Club/ClubDetailsDlg.ui",isTouchClose:!0,data:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){if(this.data){var t=this.data;this.item_head.setData({url:t.head_icon}),this.lab_club_name.setString(toDecodeURIComponent(t.name)),this.setText("lab_lv",t.lv),this.setText("lab_active",t.all_join),this.setText("lab_people",t.union_mem_num+"/"+DataMgr.clubCtrl.getMaxClubPeople(t.lv)),this.lab_notice.setString(t.apply_notice||"无")}}}),ClubDetailsDlg.create=function(t,e,i){return new ClubDetailsDlg(t,e,i)},ModuleMgr.registerModule("ClubDetailsDlg",ClubDetailsDlg),ClubDlg=QPDlg.extend({uiPath:"ui/Club/ClubDlg.ui",curTag:0,msgLayer:null,mgrLayer:null,matchLayer:null,ctor:function(t,e,i){QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){QPDlg.prototype.onLoaded.call(this);var t=this;t.addListener("UnionExitSucces",function(e){e.getUserData();t.close()}),t.addListener("AgreeApplySucces",function(e){t.checkRedPoint()}),t.addListener("RefuseApplySucces",function(e){t.checkRedPoint()}),this.selectTag(1),this.checkRedPoint()},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this),cc.eventManager.dispatchCustomEvent("ClubDlgActionEnd")},checkRedPoint:function(){DataMgr.clubCtrl.clubApplyList||[];0==DataMgr.clubCtrl.clubApplyCount?this.img_red_2&&this.img_red_2.setVisible(!1):this.img_red_2&&this.img_red_2.setVisible(!0),this.img_red_2&&this.img_red_2.setLocalZOrder(9999)},selectTag:function(t){var e=this;if(e.curTag!=t){for(var i=1;i<=3;i++)e["btn_tab_"+i]&&e["btn_tab_"+i].setEnabled(i!=t),i!=t?this["btn_tab_"+i].setLocalZOrder(1):this["btn_tab_"+i].setLocalZOrder(2);this.curTag=t,e.msgLayer&&e.msgLayer.setVisible(!1),e.mgrLayer&&e.mgrLayer.setVisible(!1),e.matchLayer&&e.matchLayer.setVisible(!1),1==t?e.msgLayer?(e.msgLayer.setVisible(!0),e.msgLayer.refreshUi()):ModuleMgr.createNode(ClubMsg,null,e.grp_content,function(t){e.msgLayer=t,e.msgLayer.setVisible(!0)}):2==t?e.mgrLayer?(e.mgrLayer.setVisible(!0),e.mgrLayer.refreshUi()):ModuleMgr.createNode(ClubMgr,null,e.grp_content,function(t){e.mgrLayer=t,e.mgrLayer.setVisible(!0)}):3==t&&(e.matchLayer?(e.matchLayer.setVisible(!0),e.matchLayer.refreshUi()):ModuleMgr.createNode(ClubMatch,null,e.grp_content,function(t){e.matchLayer=t,e.matchLayer.setVisible(!0)}))}},tap_btn_tab_1:function(){this.selectTag(1)},tap_btn_tab_2:function(){var t=DataMgr.clubCtrl.getSelfInfo();if(t)return t.position!=UNION_POSITION_MASTER&&t.position!=UNION_POSITION_ASSISTANT?ModuleMgr.showTipMsg("权限不足!"):void this.selectTag(2)},tap_btn_tab_3:function(){if(!IS_OPEN_MATCH)return ModuleMgr.showTipMsg("此功能暂未开放");var t=DataMgr.clubCtrl.getSelfInfo();if(t)if(t.position==UNION_POSITION_MASTER||t.position==UNION_POSITION_ASSISTANT)this.selectTag(3);else{if(!DataMgr.clubCtrl.bolMatchExist())return ModuleMgr.showTipMsg("赛制暂未开放!");this.selectTag(3)}},tap_btn_close:function(){QPDlg.prototype.tap_btn_close.call(this),cc.eventManager.dispatchCustomEvent("showChatInput")}}),ClubDlg.create=function(t,e,i){return new ClubDlg(t,e,i)},ModuleMgr.registerModule("ClubDlg",ClubDlg),ClubMsg=QPLayer.extend({uiPath:"ui/Club/ClubMsg.ui",list_member_item:null,selectData:null,limitNum:5,maxCount:0,curPageIndex:0,ctor:function(t,e,i){this.data=t,this.list_member_item=ClubMsgListItem,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.curMemNum=0,this.isSendGetMem=!1,this.getMemList();var t=this;t.addListener("MemberListSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("MemberKickSucces",function(e){e.getUserData();t.grp_master_mgr.setVisible(!1),t.maxCount=DataMgr.clubCtrl.clubMemCount||0,t.curPageIndex>(t.maxCount-1)/t.limitNum&&t.curPageIndex--,t.getMemList()}),t.addListener("MemberAppointSucces",function(e){e.getUserData();t.grp_master_mgr.setVisible(!1),t.getMemList()}),t.addListener("UnionDissolveSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ClubDlgActionEnd",function(e){e.getUserData();t.refreshUi()}),t.grp_master_mgr.setVisible(!1),this.refreshUi(),this.scheduleUpdate()},getMemList:function(t){var e=this;t=t||e.curPageIndex;var i=t*e.limitNum;ME_D.send_message(CMD_UNION_MESSAGE,"member_list",{game_type:GAME_TYPE,offset:i,limit_num:e.limitNum})},refreshUi:function(){var t=ModuleMgr.getDlg("ClubDlg");if(t&&t.isDlgActionEnd){this.grp_master_mgr.setVisible(!1);var e=DataMgr.clubCtrl.getClubMaster();if(e){var i=DataMgr.clubCtrl.curClubData;this.item_head.setData({url:i.head_icon}),this.setText("lab_level",i.lv),this.lab_club_name.setString(toDecodeURIComponent(i.name)),this.setText("lab_master_name",toDecodeURIComponent(e.name)),this.setText("lab_people",DataMgr.clubCtrl.getClubOnlineNum()+"/"+DataMgr.clubCtrl.getClubMemNum()),this.setText("lab_active",i.all_join)}this.grp_exit.setVisible(!1),this.grp_dissolve.setVisible(!1),this.grp_dissolve_cancel.setVisible(!1);var a=DataMgr.clubCtrl.getSelfInfo(),i=DataMgr.clubCtrl.curClubData;if(i){if(a){var s=a.position==UNION_POSITION_MASTER;s?1==i.status?this.grp_dissolve_cancel.setVisible(!0):this.grp_dissolve.setVisible(!0):this.grp_exit.setVisible(!0)}this.refreshMemberList();var r=CsvMgr.getDataWithFileAndId("union",i.lv);r&&this.setText("lab_master_levelup",DataMgr.clubCtrl.getClubPositionNum(UNION_POSITION_ASSISTANT)+"/"+r.leader_num),this.lab_master_levelup.setVisible(r)}}},refreshMemberList:function(){var t=DataMgr.clubCtrl.clubMemberList||[];this.maxCount=DataMgr.clubCtrl.clubMemCount||0,this.refreshList({name:"list_member",list:t,async:!0});var e=Math.ceil(this.maxCount/this.limitNum);e=0==e?1:e,this.lab_page.setString(this.curPageIndex+1+"/"+e)},tap_begin_list_member:function(){this.grp_master_mgr.setVisible(!1)},tap_end_list_member:function(t){this.selectData=null;var e=DataMgr.clubCtrl.getSelfInfo();if(e&&(e.position==UNION_POSITION_MASTER||e.position==UNION_POSITION_ASSISTANT)&&this.list_member){var i=this.list_member.getItems(),a=i[t];if(a&&(this.selectData=a.getData(),this.selectData.rid!=e.rid&&this.selectData.position!=e.position)){var s=a.convertToWorldSpace(),r=this.convertToNodeSpace(s);this.grp_master_mgr.setPositionY(r.y),e.position==UNION_POSITION_MASTER?(this.grp_master_levelup.setVisible(!0),this.grp_master_leveldown.setVisible(!0),this.grp_master_exit_club.setVisible(!0),this.selectData.position==UNION_POSITION_ASSISTANT&&this.grp_master_levelup.setVisible(!1),this.selectData.position>UNION_POSITION_ASSISTANT&&this.grp_master_leveldown.setVisible(!1)):(this.grp_master_levelup.setVisible(!1),this.grp_master_leveldown.setVisible(!1),this.grp_master_exit_club.setVisible(!0));var n=[];n[0]=this.grp_master_levelup,n[1]=this.grp_master_leveldown,n[2]=this.grp_master_exit_club;for(var o=70,c=0,l=0;l<3;++l)n[l]&&n[l].isVisible()&&(c++,n[l].setPositionY(o),o-=60);this.scale_btn.setContentSize(cc.size(190,65*c)),this.grp_master_mgr.setVisible(!0)}}},setDissolveTime:function(){var t=DataMgr.clubCtrl.curClubData;if(t&&1==t.status){var e=t.finish_time,i=e-DataMgr.timeCtrl.getServerTime(),a=calDate(i),s=a[0],r=a[1]+24*s,n=a[2],o=a[3];r=r<10?"0"+r:r,n=n<10?"0"+n:n,o=o<10?"0"+o:o;var c=r+":"+n+":"+o;this.txt_dissolve_time.setString(c)}},update:function(t){QPLayer.prototype.update.call(this,t),this.setDissolveTime();var e=this.input_page.getString();if(e&&""!=e&&2==e.length){var i=parseInt(e);i>0&&i<=Math.floor(this.maxCount/this.limitNum)+1&&this.curPageIndex!=i-1&&(this.curPageIndex=i-1,this.getMemList()),this.input_page.setString("")}},tap_btn_master_levelup:function(){this.selectData&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"member_appoint",{game_type:GAME_TYPE,rid:this.selectData.rid,position:UNION_POSITION_ASSISTANT})},tap_btn_master_leveldown:function(){this.selectData&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"member_appoint",{game_type:GAME_TYPE,rid:this.selectData.rid,position:UNION_POSITION_NORMAL})},tap_btn_master_exit_club:function(){var t=this;t.selectData&&ModuleMgr.showConfirmCancelMsg("确定把 "+toDecodeURIComponent(t.selectData.name)+" 踢出好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"member_kick",{game_type:GAME_TYPE,rid:t.selectData.rid})})},tap_btn_exit:function(){ModuleMgr.showConfirmCancelMsg("确定退出好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"union_exit",{game_type:GAME_TYPE})})},tap_btn_dissolve:function(){ModuleMgr.showConfirmCancelMsg("确定解散好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"union_dissolve",{game_type:GAME_TYPE})})},tap_btn_dissolve_cancel:function(){ModuleMgr.showConfirmCancelMsg("确定取消解散好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"union_dissolve",{game_type:GAME_TYPE,is_cancel:1})})},tap_grp_tap:function(){this.grp_master_mgr.setVisible(!1)},tap_btn_share_club:function(){ModuleMgr.runDlg("ClubShareDlg")},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getMemList(this.curPageIndex))},tap_btn_next_page:function(){this.curPageIndex>=Math.floor((this.maxCount-1)/this.limitNum)||(this.curPageIndex++,this.getMemList(this.curPageIndex))}}),ClubMsg.create=function(t,e,i){return new ClubMsg(t,e,i)},ModuleMgr.registerModule("ClubMsg",ClubMsg),ClubMsgListItem=QPListItem.extend({uiPath:"ui/Club/ClubMsgListItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("MemberAppointSucces",function(e){t.refreshUi()})},getData:function(){return this.data},refreshUi:function(){var t=this.data;if(t){if(this.item_head.setData({url:t.headimgurl}),this.lab_name.setString((toDecodeURIComponent(t.name)||"").substring(0,6)),this.lab_position.setString(UNION_POSITION_NAME_TABLE[t.position]),this.lab_round_num.setString(t.all_join),this.setText("lab_id",t.account_uid),t.last_login_time>t.last_logout_time)this.lab_status.setString("在线"),this.lab_status.setColor(cc.color("#3cb371"));else{var e=DataMgr.timeCtrl.getServerTime()-t.last_logout_time,i="",a=calDate(e);i=a[0]>0?"离线 "+a[0]+" 天":a[1]>0?"离线 "+a[1]+" 小时":a[2]>0?"离线 "+a[2]+" 分":"离线 1 分",this.lab_status.setString(i),this.lab_status.setColor(cc.color("#BDB0A5"))}t.rid==ME_D.get_rid()?this.lab_name.setColor(cc.color(255,0,0)):this.lab_name.setColor(cc.color(255,255,255))}},setData:function(t){t&&(this.data=t,this.refreshUi())}}),ClubMsgListItem.create=function(t,e,i){return new ClubMsgListItem(t,e,i)},ModuleMgr.registerModule("ClubMsgListItem",ClubMsgListItem),ClubMgr=QPLayer.extend({uiPath:"ui/Club/ClubMgr.ui",ctor:function(t,e,i){QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("LevelUpUnionSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifiScoreSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifyCostRatioSucces",function(e){t.refreshUi()}),t.addListener("AppendMatchMoneySucces",function(e){t.refreshUi()}),t.addListener("ShowNoticeInput",function(t){t.getUserData()}),t.addListener("AgreeApplySucces",function(e){t.checkRedPoint()}),t.addListener("RefuseApplySucces",function(e){t.checkRedPoint()}),t.refreshUi(),t.checkRedPoint()},hideSomething:function(){for(var t=["scale_up","lab_notice","lab_notice1","lab_notice2","input_notice","input_apply_notice"],e=0;e<t.length;++e)this[t[e]]&&this[t[e]].setVisible(!1);for(var i=["scale_down","cur_level","next_level","img_arrow","grp_bottom"],e=0;e<i.length;++e)this[i[e]]&&(this[i[e]].oldY=this[i[e]].oldY||this[i[e]].y),this[i[e]]&&(this[i[e]].y=this[i[e]].oldY+290)},checkRedPoint:function(){DataMgr.clubCtrl.clubApplyList||[];0==DataMgr.clubCtrl.clubApplyCount?this.img_apply_red&&this.img_apply_red.setVisible(!1):this.img_apply_red&&this.img_apply_red.setVisible(!0)},refreshUi:function(){var t=DataMgr.clubCtrl.curClubData;if(t){this.setText("lab_room_card1",ROOM_CARD_NAME),this.setText("lab_room_card2",ROOM_CARD_NAME),this.lab_money.setString(t.match_money),this.lab_normal_ratio.setString((t.cost_ratio||100)+"%"),t.match_rid?(this.grp_match_ratio.setVisible(!0),this.lab_match_ratio.setString((t.cost_match_ratio||100)+"%")):this.grp_match_ratio.setVisible(!1);var e=t.lv,i=e+1,a=CsvMgr.getDataWithFile("union"),s=a&&a[GAME_TYPE+":"+e],r=a&&a[GAME_TYPE+":"+i];this.setText("txt_curlevel",e),s&&(this.setText("txt_curnum",s.max_num),this.setText("txt_curminister",s.leader_num),this.lab_cost.setString("X"+s.cost)),r?(this.setText("txt_nextlevel",i),this.setText("txt_nextnum",r.max_num),this.setText("txt_nextminister",r.leader_num),this.txt_nextlevel.setVisible(!0),this.txt_nextnum.setVisible(!0),this.txt_nextminister.setVisible(!0),this.txt_null.setVisible(!1)):(this.txt_nextlevel.setVisible(!1),this.txt_nextnum.setVisible(!1),this.txt_nextminister.setVisible(!1),this.txt_null.setVisible(!0),this.grp_apply.setPositionX(280)),this.grp_levelup.setVisible(r),this.chaye.setVisible(r),this.lab_cost.setVisible(r);var n=DataMgr.clubCtrl.getSelfInfo();n&&(n.position==UNION_POSITION_MASTER||n.position==UNION_POSITION_ASSISTANT)?this.grp_bottom.setVisible(!0):this.grp_bottom.setVisible(!1)}},tap_btn_apply:function(){ModuleMgr.runDlg("ClubApplyList")},tap_btn_levelup:function(){var t=DataMgr.clubCtrl.curClubData;if(t){var e=t.lv,i=null,a=CsvMgr.getDataWithFile("union");return a&&(i=a[GAME_TYPE+":"+e]||0),i&&i.cost>ME_D.get_user().room_card?ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！"):void ME_D.send_message_waiting(CMD_UNION_OPER,"level_up_union",{game_type:GAME_TYPE,lv:t.lv})}},tap_btn_change:function(){ModuleMgr.runDlg("ClubModifiClubDlg")},do_apply_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();if(i.length>=20)return e.setString(i.substring(0,20)),ModuleMgr.showTipMsg("申请公告内容不能超过20个字！")}else if("end"==t.name||"return"==t.name){var e=t.target;if(DataMgr.clubCtrl.curClubData){var i=e.getString();DataMgr.clubCtrl.curClubData.apply_notice!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_apply_notice",{game_type:GAME_TYPE,apply_notice:i})}}},do_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();i.length>=50&&(i=i.substring(0,50),e.setString(i),ModuleMgr.showTipMsg("公告内容不能超过50个字！")),this.lab_notice.setString(i)}else if("begin"==t.name)this.lab_notice.setVisible(!1),this.input_notice.setString(this.lab_notice._text);else if("end"==t.name||"return"==t.name){var e=t.target;if(DataMgr.clubCtrl.curClubData){var i=e.getString();DataMgr.clubCtrl.curClubData.notice!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_notice",{game_type:GAME_TYPE,notice:i})}e.setString("")}},hideInput:function(){this.input_notice.setVisible(!1),this.input_apply_notice.setVisible(!1)},showInput:function(){this.input_notice.setVisible(!0),this.input_apply_notice.setVisible(!0)},btn_share_match:function(){var t=DataMgr.clubCtrl.curClubData,e=getQueryString("guest")||0,i=getQueryString("test")||0,a=toDecodeURIComponent(t.name),s="["+a+"]好友圈,邀请您加入",r="点击申请加入["+a+"]好友圈";platform.share(s,r,SHARE_URL+"?game_type="+GAME_TYPE+"&test="+i+"&guest="+e+"&union_rid="+t.rid,0)}}),ClubMgr.create=function(t,e,i){return new ClubMgr(t,e,i)},ModuleMgr.registerModule("ClubMgr",ClubMgr),ClubMatch=QPLayer.extend({uiPath:"ui/Club/ClubMatch.ui",day:1,minScore:0,matchMoner:0,masterPer:0,cost:0,list_score_itme:null,limitNum:5,maxCount:0,curPageIndex:0,ctor:function(t,e,i){this.list_score_item=ClubMatchListItem,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;this.getMemRank(),t.addListener("RefreshMatchList",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifiScoreSucces",function(t){t.getUserData()}),t.addListener("CreateMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("GetMatchInfoSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ContinueMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifyMatchCharSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("StopMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("CloseMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifyMatchNameSucces",function(e){e.getUserData();t.refreshUi()}),this.refreshUi(),this.scheduleUpdate()},getMemRank:function(t){var e=this;t=t||e.curPageIndex;var i=t*e.limitNum;ME_D.send_message(CMD_UNION_MESSAGE,"member_money_list",{game_type:GAME_TYPE,offset:i,limit_num:e.limitNum})},hideSomething:function(){for(var t=["lab_theme","input_notice","scale_1","scale_3","lab_notice"],e=0;e<t.length;++e)this[t[e]]&&this[t[e]].setVisible(!1);for(var i=["lab_days","btn_sub_day","scale_2","lab_create_day","btn_add_day","lab_rate","ck_per_0","ck_per_1","ck_per_2","lab_rate_0","lab_rate_1","lab_rate_2"],e=0;e<i.length;++e)this[i[e]].oldY=this[i[e]].oldY||this[i[e]].y,this[i[e]]&&(this[i[e]].y=this[i[e]].oldY+250)},refreshUi:function(){var t=DataMgr.clubCtrl.curClubData;t&&(this.grp_create.setVisible(!1),this.grp_normal.setVisible(!1),DataMgr.clubCtrl.bolMatchExist()?(this.grp_normal.setVisible(!0),this.refreshNormalGrp()):(this.grp_create.setVisible(!0),this.refreshCreateGrp()))},do_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();this.lab_notice.setString(i)}else if("begin"==t.name)this.lab_notice.setVisible(!1),this.input_notice.setString(this.lab_notice._text);else if("end"==t.name||"return"==t.name){var e=t.target;e.setString(""),this.lab_notice.setVisible(!0)}},do_inputCallBack:function(t){"began"==t.name&&this.input_notice&&this.input_notice._focusEvent()},refreshCreateGrp:function(){this.lab_notice&&this.lab_notice.setString("赛制组局，多重奖励，一起来玩吧"),this.refreshDay(),this.setPer(1)},refreshDay:function(){var t=CsvMgr.getDataWithFile("union"),e=0;t&&(e=(t[GAME_TYPE+":match"]||{}).cost||0),this.lab_create_day&&this.lab_create_day.setString(this.day),this.cost=this.day*e,this.lab_cost&&this.lab_cost.setString(this.cost)},tap_btn_sub_day:function(){return this.day<=1?void ModuleMgr.showTipMsg("赛制不能少于 1 天"):(this.day--,void this.refreshDay())},tap_btn_add_day:function(){this.day++,this.refreshDay()},setPer:function(t){this.masterPer=t;for(var e=0;e<=2;e++)this["ck_per_"+e]&&this["ck_per_"+e].setSelected(t==e),this["lab_rate_"+e]&&this["lab_rate_"+e].setColor(this.getLabColor(this["ck_per_"+e].isSelected()))},getLabColor:function(t){return t?cc.color("#CE7D52"):cc.color("#6e464e")},OnSelectPer:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(7,1));this.setPer(e)}else if("unselected"==t.name){t.target.setSelected(!0);for(var i=0;i<=2;i++)this["lab_rate_"+i]&&this["lab_rate_"+i].setColor(this.getLabColor(this["ck_per_"+i].isSelected()))}},tap_btn_create:function(){if(this.cost>ME_D.get_user().room_card)return ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！");var t=this.lab_notice._text;cc.log(" this.lab_notice.getString()=",this.lab_notice.getString());var e=50*this.masterPer;ME_D.send_message_waiting(CMD_UNION_OPER,"create_match",{name:t,game_type:GAME_TYPE,vaild_days:this.day,min_money:-999999,match_money:0,cost_ratio:e})},refreshNormalGrp:function(){var t=DataMgr.clubCtrl.matchData;if(t){this.lab_normal_notice.setString("[c255:255:255]"+t.name+"[/c]");var e=DataMgr.clubCtrl.getSelfInfo();this.grp_n_change.setVisible(!1),e&&(e.position==UNION_POSITION_MASTER||e.position==UNION_POSITION_ASSISTANT)?(this.grp_n_score_log.setVisible(!0),this.grp_n_match_change.setVisible(!0)):(this.grp_n_score_log.setVisible(!1),this.grp_n_match_change.setVisible(!1)),this.refreshScoreList();var e=DataMgr.clubCtrl.getSelfInfo();e&&(this.lab_n_my_score.setString(e.money),this.lab_n_my_rank.setString(e.rank||0)),this.setDownTime()}},refreshScoreList:function(){var t=DataMgr.clubCtrl.clubSaiZhiList||[];this.maxCount=DataMgr.clubCtrl.clubSaiZhiCount||0;for(var e=0;e<t.length;e++){var i=t[e];t[e].sortNum=i.money}for(var e=0;e<t.length;e++){var i=t[e];i.rank=e+1}this.refreshList({name:"list_score",list:t,async:!0});var a=Math.ceil(this.maxCount/this.limitNum);a=0==a?1:a,this.lab_page.setString(this.curPageIndex+1+"/"+a)},tap_btn_n_score_log:function(){ModuleMgr.runDlg("ClubScoreLogDlg")},tap_btn_n_match_change:function(){ModuleMgr.runDlg("ClubModifiMatchDlg")},tap_end_list_score:function(t){if(this.list_score){var e=this.list_score.getItems(),i=e[t];if(i){var a=i.getData();ModuleMgr.runDlg("ClubScoreDetailsDlg",a,null,null)}}},setDownTime:function(){var t=DataMgr.clubCtrl.matchData;if(t){var e=t.vaild_time,i=e-DataMgr.timeCtrl.getServerTime();if(i<0)return void this.lab_n_down_time.setString("本赛制结束");var a=calDate(i),s=a[0],r=a[1],n=a[2];a[3];this.lab_n_down_time.setString(s+"天"+r+"时"+n+"分")}},update:function(t){QPLayer.prototype.update.call(this,t);var e=this.input_page.getString();if(e&&""!=e&&2==e.length){var i=parseInt(e);i>0&&i<=Math.floor(this.maxCount/this.limitNum)+1&&this.curPageIndex!=i-1&&(this.curPageIndex=i-1,this.getMemRank()),this.input_page.setString("")}},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getMemRank(this.curPageIndex))},tap_btn_next_page:function(){this.curPageIndex>=Math.floor((this.maxCount-1)/this.limitNum)||(this.curPageIndex++,this.getMemRank(this.curPageIndex))}}),ClubMatch.create=function(t,e,i){return new ClubMatch(t,e,i)},ModuleMgr.registerModule("ClubMatch",ClubMatch),ClubModifiSubDlg=QPDlg.extend({uiPath:"ui/Club/ClubModifiSubDlg.ui",data:null,minNum:0,curNum:0,noLower:!1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.refreshUi()},refreshUi:function(){if(this.data){var t=this.data,e=t.type||1;this.curNum=t.num||0,this.minNum=this.curNum,this.noLower=t.noLower||!1;var i="res/uires/club/txt_xiugaijifen.png",a="最低进入积分将更改为：";2==e&&(i="res/uires/club/txt_xiugaizijin.png",a="增加赛制基金为："),this.img_title.loadTexture(i),this.lab_title.setString(a),this.lab_num.setString(this.curNum)}},calcNum:function(t){return this.curNum=this.curNum+t,this.data&&2==this.data.type&&this.curNum-this.minNum>ME_D.get_user().room_card?(this.curNum=this.minNum+ME_D.get_user().room_card,ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！")):(this.noLower&&(this.curNum=this.curNum<this.minNum?this.minNum:this.curNum),this.curNum<0&&(this.curNum=0),void this.lab_num.setString(this.curNum))},tap_btn_sub_100:function(){this.calcNum(-100)},tap_btn_sub_10:function(){this.calcNum(-10)},tap_btn_add_100:function(){this.calcNum(100)},tap_btn_add_10:function(){this.calcNum(10)},tap_btn_sure:function(){var t={num:this.curNum,type:this.data.type};cc.eventManager.dispatchCustomEvent("ModifiScoreSucces",t),this.close()}}),ClubModifiSubDlg.create=function(t,e,i){return new ClubModifiSubDlg(t,e,i)},ModuleMgr.registerModule("ClubModifiSubDlg",ClubModifiSubDlg),ClubScoreLogDlg=QPDlg.extend({uiPath:"ui/Club/ClubScoreLogDlg.ui",listView_item:null,maxCount:0,curPageIndex:0,sorceMap:[],sorceList:[],ctor:function(t,e,i){this.data=t,this.listView_item=ClubScoreLogItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("GetMatchLogListSucces",function(e){var i=e.getUserData();t.maxCount=i.count,t.sorceList=i.map_list.reverse(),t.refreshScoreList()}),this.getLogList()},getLogList:function(){ME_D.send_message(CMD_UNION_MESSAGE,"get_match_log_list",{game_type:GAME_TYPE,offset:10*this.curPageIndex+1})},refreshScoreList:function(){var t=this;0==this.sorceList.length?(this.lab_null.setVisible(!0),this.listView.setVisible(!1)):(this.lab_null.setVisible(!1),this.listView.setVisible(!0),this.refreshList({name:"listView",list:t.sorceList,async:!0}));var e=Math.ceil(this.maxCount/10);e=0==e?1:e,this.lab_page.setString(t.curPageIndex+1+"/"+e)},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getLogList())},tap_btn_next_page:function(){this.curPageIndex>=Math.floor(this.maxCount/10)||(this.curPageIndex++,this.getLogList())}}),ClubScoreLogDlg.create=function(t,e,i){return new ClubScoreLogDlg(t,e,i)},ModuleMgr.registerModule("ClubScoreLogDlg",ClubScoreLogDlg),ClubScoreLogItem=QPListItem.extend({uiPath:"ui/Club/ClubScoreLogItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},setData:function(t){if(t){this.data=t;var e=DataMgr.clubCtrl.getMemberByRid(t.user_rid)||{},i=e.name||"";i=toDecodeURIComponent(i);var a=DataMgr.timeCtrl.getServerTime()-t.create_time,s="",r=calDate(a);s=r[0]>0?"("+r[0]+"天前)":r[1]>0?"("+r[1]+"小时前)":r[2]>0?"("+r[2]+"分钟前)":"(1分钟前)";var n="";n="manger_score_change"==t.log_type?"● "+t.oper_name+" 将 "+i+" 的积分由 "+t.cur_value+" 更改为 "+(t.cur_value+t.step_value)+" "+s:"● "+i+"  比赛结束 积分由 "+t.cur_value+" 更改为 "+(t.cur_value+t.step_value)+" "+s,this.lab_txt.setString("[c0:0:0]"+n+"[/c]")}}}),ClubScoreLogItem.create=function(t,e,i){return new ClubScoreLogItem(t,e,i)},ModuleMgr.registerModule("ClubScoreLogItem",ClubScoreLogItem),ClubMatchListItem=QPListItem.extend({uiPath:"ui/Club/ClubMatchListItem.ui",lab_rank_x:0,data:null,ctor:function(t,e,i){
QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this.lab_rank_x=this.lab_rank.x},getData:function(){return this.data},refreshUi:function(){var t=this.data;if(t)if(this.item_head.setData({url:t.headimgurl}),this.lab_name.setString((toDecodeURIComponent(t.name)||"").substring(0,6)),this.lab_position.setString(UNION_POSITION_NAME_TABLE[t.position]),this.lab_num.setString(t.money),this.lab_rank.setString(t.rank),this.lab_rank.x=this.lab_rank_x,this.setText("lab_id",t.account_uid),t.last_login_time>t.last_logout_time)this.lab_status.setString("在线"),this.lab_status.setColor(cc.color("#3cb371"));else{var e=DataMgr.timeCtrl.getServerTime()-t.last_logout_time,i="",a=calDate(e);i=a[0]>0?"离线 "+a[0]+" 天":a[1]>0?"离线 "+a[1]+" 小时":a[2]>0?"离线 "+a[2]+" 分":"离线 1 分",this.lab_status.setString(i),this.lab_status.setColor(cc.color("#BDB0A5"))}},setData:function(t){t&&(this.data=t,this.refreshUi())}}),ClubMatchListItem.create=function(t,e,i){return new ClubMatchListItem(t,e,i)},ModuleMgr.registerModule("ClubMatchListItem",ClubMatchListItem),ClubModifiMatchDlg=QPDlg.extend({uiPath:"ui/Club/ClubModifiMatchDlg.ui",addDay:0,cost:0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("ContinueMatchSucces",function(e){t.refreshDay()}),t.addListener("StopMatchSucces",function(e){t.close()}),t.addListener("CloseMatchSucces",function(e){t.close()}),this.lab_notice.setString(DataMgr.clubCtrl.matchData.name),this.lab_notice.setVisible(!0),t.refreshDay()},hideSomething:function(){for(var t=["lab_theme","input_notice"],e=0;e<t.length;++e)this[t[e]]&&this[t[e]].setVisible(!1);for(var i=["lab_state","lab_status","btn_stop_match","btn_close_match"],e=0;e<i.length;++e)this[i[e]].oldY=this[i[e]].oldY||this[i[e]].y,this[i[e]]&&(this[i[e]].y=this[i[e]].oldY+100)},refreshDay:function(){var t=DataMgr.clubCtrl.matchData;if(t){var e=t.vaild_time,i=e-DataMgr.timeCtrl.getServerTime();i=i<0?0:i;var a=calDate(i),s=a[0],r=a[1],n=a[2];this.lab_time.setString(this.addDay+s+"天"+r+"时"+n+"分");var o=0,c=CsvMgr.getDataWithFile("union");c&&(o=(c[GAME_TYPE+":match"]||{}).cost||0),this.cost=this.addDay*o,this.lab_cost&&this.lab_cost.setString(this.cost),DataMgr.clubCtrl.bolMatchOver()?this.lab_status.setString("停止"):this.lab_status.setString("进行中"),this.hideSomething()}},tap_btn_time_sub:function(){return this.addDay<=0?ModuleMgr.showTipMsg("不能低于现在的时间"):(this.addDay--,void this.refreshDay())},tap_btn_add_sub:function(){this.addDay++,this.refreshDay()},do_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();this.lab_notice.setString(i)}else if("begin"==t.name)this.lab_notice.setVisible(!1),this.input_notice.setString(this.lab_notice._text);else if("end"==t.name||"return"==t.name){var e=t.target;if(DataMgr.clubCtrl.curClubData){var i=e.getString();DataMgr.clubCtrl.curClubData.notice!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_match_name",{game_type:GAME_TYPE,name:i})}e.setString(""),this.lab_notice.setVisible(!0)}},tap_btn_stop_match:function(){return DataMgr.clubCtrl.bolMatchOver()?ModuleMgr.showTipMsg("赛制已经停止"):void ModuleMgr.showConfirmCancelMsg("赛制时间将被清零，确定停止赛制？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"stop_match",{game_type:GAME_TYPE})})},tap_btn_close_match:function(){ModuleMgr.showConfirmCancelMsg("积分榜将被清空，确定关闭赛制？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"close_match",{game_type:GAME_TYPE})})},tap_btn_sure:function(){if(this.cost>ME_D.get_user().room_card)return ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！");var t=this;this.addDay>0?ModuleMgr.showConfirmCancelMsg("确定延长"+this.addDay+"天？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"continue_match",{game_type:GAME_TYPE,vaild_days:t.addDay}),t.addDay=0}):ModuleMgr.showTipMsg("未修改持续时间！")},changeScore:function(t){if(t){var e=t.type||1,i=t.num||0;1==e?DataMgr.clubCtrl.matchData.min_money!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_match_min_money",{game_type:GAME_TYPE,min_money:i}):2==e&&DataMgr.clubCtrl.matchData.match_money!=i&&ME_D.send_message_waiting(CMD_UNION_OPER,"append_match_money",{game_type:GAME_TYPE,match_money:i-DataMgr.clubCtrl.matchData.match_money})}},tap_btn_change_1:function(){DataMgr.clubCtrl.matchData&&ModuleMgr.showConfirmCancelMsg("确定延长7天？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"continue_match",{game_type:GAME_TYPE,vaild_days:7})})},tap_btn_change_2:function(){if(DataMgr.clubCtrl.matchData){var t={type:1,num:DataMgr.clubCtrl.matchData.min_money};ModuleMgr.runDlg("ClubModifiSubDlg",t,null,null)}},tap_btn_change_3:function(){if(DataMgr.clubCtrl.matchData){var t={type:2,num:DataMgr.clubCtrl.matchData.match_money,noLower:!0};ModuleMgr.runDlg("ClubModifiSubDlg",t,null,null)}},tap_btn_change_4:function(){if(DataMgr.clubCtrl.matchData){var t=100==DataMgr.clubCtrl.matchData.cost_ratio?50:100;ModuleMgr.showConfirmCancelMsg("确定把抵扣比例调整为 "+t+"% ?",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_cost_ratio",{game_type:GAME_TYPE,cost_ratio:t})})}}}),ClubModifiMatchDlg.create=function(t,e,i){return new ClubModifiMatchDlg(t,e,i)},ModuleMgr.registerModule("ClubModifiMatchDlg",ClubModifiMatchDlg),ClubScoreDetailsDlg=QPDlg.extend({uiPath:"ui/Club/ClubScoreDetailsDlg.ui",listView_item:null,maxCount:0,curPageIndex:0,sorceMap:[],sorceList:[],ctor:function(t,e,i){this.data=t,this.listView_item=ClubScoreDetailsItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("ModifiScoreSucces",function(e){var i=e.getUserData();t.changeScore(i)}),t.addListener("ModifyMatchCharSucces",function(e){var i=e.getUserData();t.data=i,t.refreshTopInfo(),0==t.curPageIndex&&t.getLogList()}),t.addListener("GetMatchLogListSucces",function(e){var i=e.getUserData();t.maxCount=i.count,t.sorceList=i.map_list.reverse(),t.refreshScoreList()}),t.getLogList(),t.refreshTopInfo()},getLogList:function(){this.data&&this.data&&ME_D.send_message(CMD_UNION_MESSAGE,"get_match_log_list",{game_type:GAME_TYPE,offset:10*this.curPageIndex+1,rid:this.data.rid})},refreshTopInfo:function(){if(this.data){var t=this.data;this.item_head.setData({url:t.headimgurl}),this.lab_name.setString(toDecodeURIComponent(t.name)),this.lab_score.setString(t.money),this.btn_change.setVisible(!1)}},refreshScoreList:function(){var t=this;this.refreshList({name:"listView",list:t.sorceList,async:!0});var e=Math.ceil(this.maxCount/10);e=0==e?1:e,this.lab_page.setString(t.curPageIndex+1+"/"+e)},changeScore:function(t){if(t){t.type||1,t.num||0;t.num!=this.data.money&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_match_char_money",{game_type:GAME_TYPE,rid:this.data.rid,step_value:t.num-this.data.money})}},tap_btn_change:function(){!this.data},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getLogList())},tap_btn_next_page:function(){this.curPageIndex>=Math.floor(this.maxCount/10)||(this.curPageIndex++,this.getLogList())}}),ClubScoreDetailsDlg.create=function(t,e,i){return new ClubScoreDetailsDlg(t,e,i)},ModuleMgr.registerModule("ClubScoreDetailsDlg",ClubScoreDetailsDlg),ClubScoreDetailsItem=QPListItem.extend({uiPath:"ui/Club/ClubScoreDetailsItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},setData:function(t){if(t){this.data=t;var e=DataMgr.timeCtrl.getServerTime()-t.create_time,i="",a=calDate(e);i=a[0]>0?a[0]+"天前":a[1]>0?a[1]+"小时前":a[2]>0?a[2]+"分钟前":"1分钟前";var s="比赛";"manger_score_change"==t.log_type&&(s="调分"),this.lab_1.setString(s),this.lab_2.setString(i),this.lab_3.setString(t.step_value),this.lab_4.setString(t.cur_value+t.step_value)}},tap_btn_touch:function(){if(this.data){if("manger_score_change"==this.data.log_type)return void ModuleMgr.showTipMsg("比赛积分变动才可查询！");var t=function(t){t&&t.lists&&ModuleMgr.showRecordDetailDlg(t.lists[0])},e=ConvertToJson(this.data.log_detail);DataMgr.recordCtrl.getOneRecord(e.rid,t)}}}),ClubScoreDetailsItem.create=function(t,e,i){return new ClubScoreDetailsItem(t,e,i)},ModuleMgr.registerModule("ClubScoreDetailsItem",ClubScoreLogItem),ClubModifiScoreDlg=QPDlg.extend({uiPath:"ui/Club/ClubModifiScoreDlg.ui",data:null,minNum:0,curNum:0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.refreshUi()},refreshUi:function(){if(this.data){var t=this.data;t.type||1;this.curNum=t.num||0,this.minNum=this.curNum,this.input_num.setString(this.curNum+"")}},calcNum:function(t){var e=this.input_num.getString();e=parseInt(e),NaN==e?(ModuleMgr.runDlg("输入不合法！"),this.curNum=0):this.curNum=e,this.curNum=this.curNum+t,this.input_num.setString(this.curNum)},tap_btn_sub_100:function(){this.calcNum(-100)},tap_btn_sub_10:function(){this.calcNum(-10)},tap_btn_add_100:function(){this.calcNum(100)},tap_btn_add_10:function(){this.calcNum(10)},tap_btn_sure:function(){var t=this.input_num.getString();if(t=parseInt(t),NaN==t)return ModuleMgr.runDlg("输入不合法！"),void this.close();var e={num:t,type:this.data.type};cc.eventManager.dispatchCustomEvent("ModifiScoreSucces",e),this.close()}}),ClubModifiScoreDlg.create=function(t,e,i){return new ClubModifiScoreDlg(t,e,i)},ModuleMgr.registerModule("ClubModifiScoreDlg",ClubModifiScoreDlg),ClubResultListItem=QPListItem.extend({uiPath:"ui/Club/ClubResultListItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},setData:function(t){if(t){this.data=t,this.txt_time&&this.txt_time.setString(parseTime(t.create_time));for(var e=ConvertToJson(t.log_detail),i=e.users||[],a=e.score,s=0,r=null,n=0;n<i.length;n++){var o=n+1,c=i[n];if(c.rid){var l=a["idx"+o];l>s&&(s=l,r=c)}}r&&(this.item_head&&this.item_head.setData({url:r.headimgurl}),this.lab_score&&this.lab_score.setString("+"+s),this.lab_name&&this.lab_name.setString(toDecodeURIComponent(r.name)))}},tap_btn_view:function(){if(this.data){var t=function(t){t&&t.lists&&ModuleMgr.showRecordDetailDlg(t.lists[0])},e=ConvertToJson(this.data.log_detail);DataMgr.recordCtrl.getOneRecord(e.rid,t)}}}),ClubResultListItem.create=function(t,e,i){return new ClubResultListItem(t,e,i)},ModuleMgr.registerModule("ClubResultListItem",ClubResultListItem),ClubResultDlg=QPDlg.extend({uiPath:"ui/Club/ClubResultDlg.ui",listView_item:null,curPage:1,maxCount:0,curTag:0,scoreList:[],curPageIndex:0,ctor:function(t,e,i){this.data=t,this.listView_item=ClubResultListItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},dlgActionEnd:function(){this._super(),this.scheduleUpdate()},onExit:function(){this._super(),this.unscheduleUpdate()},update:function(t){var e=this.input_page.getString();if(e&&""!=e&&2==e.length){var i=parseInt(e);i>0&&i<=Math.floor(this.maxCount/10)+1&&(this.curPageIndex=i-1,this.getResultList()),this.input_page.setString("")}},onLoaded:function(){this._super();var t=this;t.addListener("GetMatchLogListSucces",function(e){var i=e.getUserData();t.maxCount=i.count,t.scoreList=i.map_list.reverse(),t.refreshListView()}),t.selectTag(1)},selectTag:function(t){var e=this;e.curTag!=t&&(1==t?(this.btn_tab_1.setOpacity(255),this.btn_tab_2.setOpacity(0)):(this.btn_tab_1.setOpacity(0),this.btn_tab_2.setOpacity(255)),this.curTag=t,this.curPageIndex=0,this.getResultList())},getResultList:function(){1==this.curTag?ME_D.send_message_waiting(CMD_UNION_MESSAGE,"get_union_log_list",{game_type:GAME_TYPE,offset:10*this.curPageIndex+1}):2==this.curTag&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"get_match_log_list",{game_type:GAME_TYPE,offset:10*this.curPageIndex+1,log_type:UNION_MATCH_LOG_USER_PLAY_SCORE})},refreshListView:function(){var t=this;0==t.scoreList.length?(t.lab_null.setVisible(!0),t.listView.setVisible(!1)):(t.lab_null.setVisible(!1),t.listView.setVisible(!0),t.refreshList({name:"listView",list:this.scoreList,async:!0}),this.listView&&this.listView.jumpToTop());var e=Math.ceil(this.maxCount/10);e=0==e?1:e,t.lab_page&&t.lab_page.setString(t.curPageIndex+1+"/"+e)},tap_btn_tab_1:function(){this.selectTag(1)},tap_btn_tab_2:function(){if(0==IS_OPEN_MATCH)return ModuleMgr.showTipMsg("此功能暂未开放");var t=DataMgr.clubCtrl.curClubData;if(t)return t.match_rid?void this.selectTag(2):void ModuleMgr.showTipMsg("赛制尚未开启,无法查看战绩！")},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getResultList())},tap_btn_next_page:function(){this.curPageIndex>=Math.floor(this.maxCount/10)||(this.curPageIndex++,this.getResultList())},tap_btn_close:function(){QPDlg.prototype.tap_btn_close.call(this),cc.eventManager.dispatchCustomEvent("showChatInput")}}),ClubResultDlg.create=function(t,e,i){return new ClubResultDlg(t,e,i)},ModuleMgr.registerModule("ClubResultDlg",ClubResultDlg),ClubModifiClubDlg=QPDlg.extend({uiPath:"ui/Club/ClubModifiClubDlg.ui",cost_ratio:0,cost_match_ratio:0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("ModifiScoreSucces",function(e){var i=e.getUserData();t.changeMomey(i)}),t.addListener("ModifyCostRatioSucces",function(e){t.refreshUi()}),t.addListener("AppendMatchMoneySucces",function(e){t.refreshUi()}),t.refreshUi()},refreshUi:function(){var t=DataMgr.clubCtrl.curClubData;t&&(this.setText("lab_room_card1",ROOM_CARD_NAME),this.setText("lab_room_card2",ROOM_CARD_NAME),this.lab_money.setString(t.match_money),this.lab_club_ratio.setString((t.cost_ratio||0)+"%"),t.match_rid?(this.grp_match_ratio_btn.setVisible(!0),this.grp_match_ratio.setVisible(!0),this.lab_match_ratio.setString((t.cost_match_ratio||0)+"%"),this.lab_match_type_0&&this.lab_match_type_0.setVisible(!0),this.lab_match_type_1&&this.lab_match_type_1.setVisible(!0),this.lab_match_type_2&&this.lab_match_type_2.setVisible(!0),this.ck_match_type0&&this.ck_match_type0.setVisible(!0),this.ck_match_type50&&this.ck_match_type50.setVisible(!0),this.ck_match_type100&&this.ck_match_type100.setVisible(!0)):(this.grp_match_ratio_btn.setVisible(!1),this.grp_match_ratio.setVisible(!1),this.grp_match_ratio.setVisible(!1),this.lab_match_type_0&&this.lab_match_type_0.setVisible(!1),this.lab_match_type_1&&this.lab_match_type_1.setVisible(!1),this.lab_match_type_2&&this.lab_match_type_2.setVisible(!1),this.ck_match_type0&&this.ck_match_type0.setVisible(!1),this.ck_match_type50&&this.ck_match_type50.setVisible(!1),this.ck_match_type100&&this.ck_match_type100.setVisible(!1)),this.cost_ratio=DataMgr.clubCtrl.curClubData.cost_ratio,this.cost_match_ratio=DataMgr.clubCtrl.curClubData.cost_match_ratio,this.refreshCkRound())},changeMomey:function(t){if(t){var e=t.type||1,i=t.num||0;2==e&&DataMgr.clubCtrl.curClubData.match_money!=i&&ME_D.send_message_waiting(CMD_UNION_OPER,"append_match_money",{game_type:GAME_TYPE,match_money:i-DataMgr.clubCtrl.curClubData.match_money})}},tap_btn_change_money:function(){if(DataMgr.clubCtrl.curClubData){var t={type:2,num:DataMgr.clubCtrl.curClubData.match_money,noLower:!0};ModuleMgr.runDlg("ClubModifiSubDlg",t,null,null)}},tap_btn_change_club_ratio:function(){if(DataMgr.clubCtrl.curClubData){var t=this.cost_ratio;ModuleMgr.showConfirmCancelMsg("确定把普通抵扣比例调整为 "+t+"% ?",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_cost_ratio",{game_type:GAME_TYPE,cost_ratio:t,cost_match_ratio:DataMgr.clubCtrl.curClubData.cost_match_ratio})})}},refreshCkRound:function(){this.ck_type0.setSelected(0==this.cost_ratio),this.ck_type50.setSelected(50==this.cost_ratio),this.ck_type100.setSelected(100==this.cost_ratio),this.ck_match_type0.setSelected(0==this.cost_match_ratio),this.ck_match_type50.setSelected(50==this.cost_match_ratio),this.ck_match_type100.setSelected(100==this.cost_match_ratio)},setTypeNum:function(t){this.cost_ratio=t,this.refreshCkRound()},getLabColor:function(t){return t?cc.color("#CE7D52"):cc.color("#6e464e")},OnSelecType:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(7,3));this.setTypeNum(e)}else"unselected"==t.name&&t.target.setSelected(!0);this.lab_type_0&&this.lab_type_0.setColor(this.getLabColor(this.ck_type0.isSelected())),this.lab_type_1&&this.lab_type_1.setColor(this.getLabColor(this.ck_type50.isSelected())),this.lab_type_2&&this.lab_type_2.setColor(this.getLabColor(this.ck_type100.isSelected()))},setMatchTypeNum:function(t){this.cost_match_ratio=t,this.refreshCkRound()},OnSelecMatchType:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(13,3));this.setMatchTypeNum(e)}else"unselected"==t.name&&t.target.setSelected(!0);this.lab_match_type_0&&this.lab_match_type_0.setColor(this.getLabColor(this.ck_match_type0.isSelected())),this.lab_match_type_1&&this.lab_match_type_1.setColor(this.getLabColor(this.ck_match_type50.isSelected())),this.lab_match_type_2&&this.lab_match_type_2.setColor(this.getLabColor(this.ck_match_type100.isSelected()))},tap_btn_change_match_ratio:function(){if(DataMgr.clubCtrl.curClubData){var t=this.cost_match_ratio;ModuleMgr.showConfirmCancelMsg("确定把赛制抵扣比例调整为 "+t+"% ?",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_cost_ratio",{game_type:GAME_TYPE,cost_match_ratio:t,cost_ratio:DataMgr.clubCtrl.curClubData.cost_ratio})})}},tap_btn_close:function(){QPDlg.prototype.tap_btn_close.call(this),cc.eventManager.dispatchCustomEvent("ShowNoticeInput")}}),ClubModifiClubDlg.create=function(t,e,i){return new ClubModifiClubDlg(t,e,i)},ModuleMgr.registerModule("ClubModifiClubDlg",ClubModifiClubDlg),ClubMatchResultDlg=QPDlg.extend({uiPath:"ui/Club/ClubMatchResultDlg.ui",listView_item:null,ctor:function(t,e,i){this.data=t,this.listView_item=ClubMatchResultItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){for(var t=DataMgr.clubCtrl.clubMemberList||[],e=0;e<t.length;e++){var i=t[e];t[e].sortNum=i.money}t.sort(function(t,e){return t.sortNum<e.sortNum});for(var e=0;e<t.length;e++){var i=t[e];i.rank=e+1}this.refreshList({name:"listView",list:t,async:!0})}}),ClubMatchResultDlg.create=function(t,e,i){return new ClubMatchResultDlg(t,e,i)},ModuleMgr.registerModule("ClubMatchResultDlg",ClubMatchResultDlg),ClubMatchResultItem=QPListItem.extend({uiPath:"ui/Club/ClubMatchResultItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},getData:function(){return this.data},refreshUi:function(){var t=this.data;t&&(this.item_head.setData({url:t.headimgurl}),this.lab_name.setString(toDecodeURIComponent(t.name)),this.lab_num.setString(t.money),this.lab_rank.setString(t.rank))},setData:function(t){t&&(this.data=t,this.refreshUi())}}),ClubMatchResultItem.create=function(t,e,i){return new ClubMatchResultItem(t,e,i)},ModuleMgr.registerModule("ClubMatchResultItem",ClubMatchResultItem),ClubShareDlg=QPDlg.extend({uiPath:"ui/Club/ClubShareDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},share:function(t){var e=DataMgr.clubCtrl.curClubData,i=getQueryString("guest")||0,a=getQueryString("test")||0,s=toDecodeURIComponent(e.name),r="["+s+"]好友圈,邀请您加入",n="点击申请加入["+s+"]好友圈";platform.share(r,n,SHARE_URL+"?game_type="+GAME_TYPE+"&test="+a+"&guest="+i+"&union_rid="+e.rid,t)},tap_btn_share_wx:function(){this.share(0)},tap_btn_share_py:function(){this.share(1)}}),ClubShareDlg.create=function(t,e,i){return new ClubShareDlg(t,e,i)},ModuleMgr.registerModule("ClubShareDlg",ClubShareDlg),ClubChatItem=QPLayer.extend({uiPath:"ui/Club/ClubChatLeft.ui",chatData:null,bolLeft:!0,ctor:function(t,e){t=t||this.uiPath,UILayer.prototype.ctor.call(this,t,e)},onLoaded:function(){this.lab_content.ignoreContentAdaptWithSize(!1)},setData:function(t){this.chatData=t;var e=DataMgr.clubCtrl.getMemberByRid(t.send_rid);e&&e.headimgurl&&this.head&&this.head.setData({url:e.headimgurl});var i=DataMgr.clubCtrl.calChatData(t);if(i){this.lab_name.setString(i.name),"系统"===i.name&&this.lab_name.setColor(cc.color(255,0,0)),this.head&&this.head.setData({url:i.headimgurl}),this.lab_content.setString(i.content),this.lab_time.setString(i.time||""),this.lab_content.formatText();var a=this.lab_content.getContentSize(),s=this.lab_content.getVirtualRendererSize();if(s.width=s.width+50,s.height=s.height+20,s.width=Math.max(s.width,100),s.height=Math.max(s.height,90),!this.bolLeft)if(s.width>=a.width&&s.width<this.bg.getContentSize().width)s.width=this.bg.getContentSize().width;else if(s.width<=a.width){var r=this.lab_content.getPositionX()+a.width-s.width+50;this.lab_content.setPositionX(r)}this.bg.setContentSize(s),this.btn_touch.setContentSize(s);var n=this.getContentSize();if(n.height=s.height+45,n.height=Math.max(n.height,70),this.setContentSize(n),this.grp_container.setPositionY(n.height-this.grp_container.getContentSize().height),t.chat_info&&t.chat_info.send_content&&"f"==t.chat_info.send_content[0]){var o=t.chat_info.send_content.slice(1);this.img_chat_face.loadTexture("res/uires/face/"+o+".png"),this.lab_content.setVisible(!1)}else this.img_chat_face.setVisible(!1)}},tap_btn_touch:function(){if(this.chatData)if(this.chatData.chat_type==CHAT_TYPE_OPEN_DESK){var t=this.chatData.chat_info.desk_idx,e=DataMgr.clubCtrl.getMyClub(),i="",a="";e&&(i=e.match_rid,a=e.rid),ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:t,union_rid:a,match_rid:i})}else if(this.chatData.chat_type==CHAT_TYPE_SHARE_SCORE){var s=function(t){t&&t.lists&&DataMgr.recordCtrl.showRecordDetail(t.lists[0])},r=ConvertToJson(this.chatData.chat_info.record_detail);DataMgr.recordCtrl.getOneRecord(r.rid,s)}}}),ClubChatItem.create=function(t,e){return new ClubChatItem(t,e)},ModuleMgr.registerModule("ClubChatItem",ClubChatItem),ClubChatLeft=ClubChatItem.extend({uiPath:"ui/Club/ClubChatLeft.ui"}),ClubChatLeft.create=function(t,e){return new ClubChatLeft(t,e)},ModuleMgr.registerModule("ClubChatLeft",ClubChatLeft),ClubChatRight=ClubChatItem.extend({uiPath:"ui/Club/ClubChatRight.ui",bolLeft:!1}),ClubChatRight.create=function(t,e){return new ClubChatRight(t,e)},ModuleMgr.registerModule("ClubChatRight",ClubChatRight),DataMgr.registerConst=function(){GAME_TYPE==GAME_TYPE_NCMJ?(GAME_NAME="[掌上南昌]",ROOM_CARD_NAME="茶叶",BOL_AN_GANG_FANG_PAI=!0,WEAVE_POKER_SHOW_TYPE=1,WEAVE_POKER_SHOW_ARROW=1,GAME_PAY_TYPE=GAME_PAY_TYPE_HEEPAY,GAME_TYPE_CFG={desk_type:["","上下精","埋地雷","同一首歌","地雷战"],turn_back:["不回头","回头一笑"],chao_master:["不抄庄","抄庄"],discard_poker:["弃牌不算","弃牌也算"]},chatCfgList=["大家多多关照啊！","牌好，心情就好~","牌品好，人品才得好","看到了啵，赌神来了！","你赶快切归，嫩屋里娘刊辣里晴嫩哟。哈哈","哈哈，风水轮流转呀！","给盘看嫩龙样办~","都是自己人，何必呢？","哎呀，龙样会葛样哩。。。","手气龙样咯么猫！","噶切了货哩","嫩最近在做犀利东西哦，扎系出牌哟","你好结棍哦","快来唆泡哟，我听口了哈。","崽哩子不要走，决战到天光","小钵子，打完牌一起切跨街啵","快点子出牌哟，我等到花儿都谢了","赢了钱想跑呀，留下来打通宵","哎，打到天光输到黑","兄弟们不好意思，我要先走一脚","快点子出牌哟，人都打得要困着了"],MUSIC_TYPE_CFG=["ncmj_pt","ncmj_nan","ncmj"],DataMgr.setMusicType(),IS_OPEN_MATCH=!0):IsGameTypeFzmjOrNdmj()?(IS_OPEN_MATCH=!0,GAME_NAME="[福州麻将]",ROOM_CARD_NAME="茶叶",MUSIC_DIFF_SEX=1,chatCfgList=["天空一身巨响，雀神闪亮登场","不好意思，刚去接电话了","不好意思，我有点事离开一会","快点出牌咯","又断线了，网络怎么这么差","大吉大利，今晚吃鸡","手气这么差，今晚要吃土","输赢都不走，能做一把手","一看就是老司机","打完这局我要下啦","赶紧给我碰一个","我听牌了，各位赶紧放炮吧","你的牌打得太好啦"],MUSIC_TYPE=GAME_TYPE_FZMJ,MUSIC_CHI_ARR=[0],MUSIC_PENG_ARR=[0],MUSIC_HULE_ARR=[0],MUSIC_ZIMO_ARR=[0]):(ROOM_CARD_NAME="茶叶",GAME_NAME="[麻将]")},DataMgr.registerGameCtrl=function(){GAME_TYPE==GAME_TYPE_NCMJ?DataMgr.gameCtrl=new GameCtrlNcmj:IsGameTypeFzmjOrNdmj()?DataMgr.gameCtrl=new GameCtrlFzmj:DataMgr.gameCtrl=new GameCtrl},DataMgr.registerModule=function(){GAME_TYPE==GAME_TYPE_NCMJ&&(ModuleMgr.registerModule("CreateRoomDlg",CreateRoomNcmjDlg),ModuleMgr.registerModule("GameResult",GameResultNcmj),ModuleMgr.registerModule("SetingDlg",SetingNcmjDlg),GAME_LAYER_NAME="GameLayerNcmj")},DataMgr.registerReplacePathMap=function(){},DataMgr.setMusicType=function(){cc.sys.localStorage.getItem(GAME_TYPE+"musicType")||0;MUSIC_TYPE=GAME_TYPE},DataMgr.registerGameLogLayer=function(){var t=GameLayer;GAME_TYPE==GAME_TYPE_NCMJ?t=GameLayerNcmj:IsGameTypeFzmjOrNdmj()&&(t=GameLayerFzmj),GameLogLayerCreate(t)},DataMgr.calGameType=function(){DataMgr.registerConst(),DataMgr.registerGameCtrl(),DataMgr.registerModule(),DataMgr.registerReplacePathMap(),DataMgr.registerGameLogLayer()};var bol_new_main_layer_frist_enter=!0;NewMainLayer=QPLayer.extend({uiPath:"ui/new/main/NewMainLayer.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){function t(t,e){if(t&&e){t=parseFloat(t),e=parseFloat(e);var i=new Date(1e3*t),a=new Date(1e3*e);if(i.getDay()==a.getDay()&&i.getMonth()==a.getMonth()&&i.getFullYear()==a.getFullYear())return!0}return!1}var e=this;e.addListener("OnReceiveAward",function(t){e.showAwardTip()}),e.addListener("IDENTIFICATION_SUCCESS",function(t){e.btn_identify.setVisible(!1),e.sortGrp("grp_down_btn",5,1,0)}),e.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){e.showAwardTip()}))),DataMgr.recordCtrl.isBanGambling||t(DataMgr.timeCtrl.getServerTime(),cc.sys.localStorage.getItem(GAME_TYPE+"_ban_gambling_time")||0)||this.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){ModuleMgr.runDlg("BanGamblingDlg")}))),bol_new_main_layer_frist_enter&&DataMgr.activityCtrl.doForeceUserCodeOpene(),DataMgr.accountCtrl.isBindUserCode()?this.btn_identify.setVisible(!1):(setTimeout(function(){ModuleMgr.runDlg("UserCodeDlg"),cc.sys.localStorage.setItem("user_code",1)},1),this.btn_identify.setVisible(!1)),e.sortGrp("grp_down_btn",5,1,0),bol_new_main_layer_frist_enter=!1},showAwardTip:function(){gInReview||!isAgent()&&DataMgr.accountCtrl.receiveAwardNum&&(ModuleMgr.showAwardConfirm("每日登陆，风雨不改，钻石无限惊喜送",[{type:"diamond",num:DataMgr.accountCtrl.receiveAwardNum}]),DataMgr.accountCtrl.receiveAwardNum=0)},tap_btn_create:function(){if(0==DataMgr.gameCtrl.deskIdx)ModuleMgr.runDlg("NewCreateRoomDlg",{isClub:!1,isAuto:!1},null,null);else{var t=DataMgr.clubCtrl.getMyClub(),e="",i="";t&&(e=t.match_rid,i=t.rid);var a=GetGameTypeByRoomId(DataMgr.gameCtrl.deskIdx);ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:a,desk_idx:DataMgr.gameCtrl.deskIdx,union_rid:i,match_rid:e})}},tap_btn_join:function(){if(0==DataMgr.gameCtrl.deskIdx){var t=1585965600,e=158598e4;"1"==isTestServer&&(t=1585922400,e=1585929600);var i=DataMgr.timeCtrl.getServerTime();if(i>=t&&i<=e)return ModuleMgr.showConfirmTxtMsg("《拱趴游戏》于4月4日10点至14点\n暂停对局，以表达我们对抗击新冠\n疫情斗争牺牲烈士和逝世同胞的深切\n哀悼。愿逝者安息，生者坚强！");ModuleMgr.runDlg("NewJoinRoomDlg")}else{var a=DataMgr.clubCtrl.getMyClub(),s="",r="";a&&(s=a.match_rid,r=a.rid);var n=GetGameTypeByRoomId(DataMgr.gameCtrl.deskIdx);ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:n,desk_idx:DataMgr.gameCtrl.deskIdx,union_rid:r,match_rid:s})}},tap_btn_home:function(){goHome()},tap_btn_club:function(){return ModuleMgr.showTipMsg("好友圈升级中！")},tap_btn_identify:function(){ModuleMgr.runDlg("UserCodeDlg"),cc.sys.localStorage.setItem("user_code",1)},onTouchHead:function(t){"ended"===t.name&&ModuleMgr.runDlg("UserInfoDlg")}}),NewMainLayer.create=function(t,e,i){return new NewMainLayer(t,e,i)},ModuleMgr.registerModule("NewMainLayer",NewMainLayer),NewRoleInfoTop=QPLayer.extend({uiPath:"ui/new/main/NewRoleInfoTop.ui",onLoaded:function(){var t=this;t.refreshUi(),t.addListener("userChange",function(e){t.refreshUi()}),t.addListener("HEAD_USE_PROP",function(e){var i=DataMgr.propCtrl.getHeadPropInfo(),a=i?i.icon:null;t.item_head.setData({url:ME_D.get_user().headimgurl,frame:a})}),t.addListener("SHIMING_OK",function(e){t.btn_shiming.setVisible(!1)}),this.addListener("SuccessBindPhone",function(e){t.btn_bind.setVisible(!1)});var e=cc.sys.localStorage.getItem("tel_account_login")||"";e.length>0&&parseInt(e)>0&&this.btn_bind.setVisible(!1);var i=cc.sys.localStorage.getItem("user_code");"1"!==i?this.btn_shiming.setVisible(!0):this.btn_shiming.setVisible(!1)},refreshUi:function(){this.lab_name.setString(toDecodeURIComponent(ME_D.get_user().name)),this.lab_chaye.setString(ME_D.get_user().room_card),this.lab_stone.setString(ME_D.get_user().stone),this.lab_id.setString("ID:"+ME_D.get_user().account_uid);var t=DataMgr.propCtrl.getHeadPropInfo(),e=t?t.icon:null;this.item_head.setData({url:ME_D.get_user().headimgurl,frame:e})},tap_btn_add_chaye:function(){ModuleMgr.runDlg("RechargeDlg")},tap_btn_add_zuanshi:function(){ModuleMgr.runDlg("RechargeDlg",{is_zuanshi:!0},null,null)},tap_btn_setting:function(){ModuleMgr.runDlg("NewSettingDlg")},tap_btn_shiming:function(){var t=cc.sys.localStorage.getItem("user_code"),e=!1;return e||"1"!==t?(cc.sys.localStorage.setItem("user_code",4),void ModuleMgr.runDlg("UserCodeDlg")):(cc.sys.localStorage.setItem("user_code",1),this.btn_shiming.setVisible(!1),void ModuleMgr.showTipMsg("实名认证成功"))},tap_btn_bind:function(){var t=cc.sys.localStorage.getItem("tel_account_login")||"";return t.length>0&&parseInt(t)>0?(this.btn_bind.setVisible(!1),void ModuleMgr.showTipMsg("手机号码已绑定")):void ModuleMgr.runDlg("BindPhoneDlg")}}),NewRoleInfoTop.create=function(t,e,i){return new NewRoleInfoTop(t,e,i)},UIUtils.RegisterPathTemple("ui/new/main/NewRoleInfoTop.ui",NewRoleInfoTop),NewHeadIcon=UrlHead.extend({uiPath:"ui/new/main/NewHeadIcon.ui",data:null,ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.btn_head.setOpacity(0);var t=1585965600,e=158598e4;"1"==isTestServer&&(t=1585922400,e=1585929600);var i=DataMgr.timeCtrl.getServerTime();i>=t&&i<=e?this.head_gray.setVisible(!0):this.head_gray.setVisible(!1)},setData:function(t){var e=t.url;this.setUrl(e),this.setFrame(t.frame)},set_head_btn_enable:function(t){this.btn_head.setEnabled(t)},tap_btn_head:function(){ModuleMgr.runDlg("NewRoleInfoDlg")},setFrame:function(t){t&&""!=t?this.head_frame.loadTexture("item/"+t+".png",ccui.Widget.PLIST_TEXTURE):this.head_frame.loadTexture("item/touxiang.png",ccui.Widget.PLIST_TEXTURE),this.head_frame.setVisible(!0),this.head_frame.setLocalZOrder(LOCAL_Z_ORDER_OF_HEAD_FRAME)}}),NewHeadIcon.create=function(t,e,i){return new NewHeadIcon(t,e,i)},UIUtils.RegisterPathTemple("ui/new/main/NewHeadIcon.ui",NewHeadIcon);var bol_main_layer_frist_enter=!0;NewRoleInfoBottom=QPLayer.extend({uiPath:"ui/new/main/NewRoleInfoBottom.ui",onLoaded:function(){if(bol_main_layer_frist_enter){var t=function(t){t&&t.length>0&&ModuleMgr.runDlg("NewNoticeDlg",t,null,null)};DataMgr.recordCtrl.getOpenNotice(t)}bol_main_layer_frist_enter=!1},tap_btn_notice:function(){var t=function(t){ModuleMgr.runDlg("NewNoticeDlg",t||{},null,null)};DataMgr.recordCtrl.getCloseNotice(t)},tap_btn_shop:function(){ModuleMgr.runDlg("ShopDlg")},tap_btn_train:function(){ModuleMgr.showTipMsg("暂不开放")},tap_btn_rule:function(){ModuleMgr.runDlg("GameRuleDlg")},tap_btn_share:function(){ModuleMgr.runDlg("NewClubShareDlg",{open_from_main_layer:1},null)},tap_btn_record:function(){var t={ret:0,lists:[]},e=!1,i=!1,a=function(a,s){if(0==a.ret&&a.lists)for(var r=0;r<a.lists.length;r++){var n=a.lists[r];n.gameType=s,t.lists.push(n)}IsGameTypeNdmj(s)?e=!0:IsGameTypeFzmj(s)&&(i=!0),e&&i&&(t.lists.sort(function(t,e){var i=t.all_cost_time||0,a=e.all_cost_time||0;return e.create_time+a-(t.create_time+i)}),ModuleMgr.runDlg("NewRecordDlg",t,null,null))};DataMgr.recordCtrl.getRecord(a,GAME_TYPE_NDMJ),DataMgr.recordCtrl.getRecord(a,GAME_TYPE_FZMJ)},tap_btn_ban:function(){ModuleMgr.runDlg("BanGamblingDlg")}}),NewRoleInfoBottom.create=function(t,e,i){return new NewRoleInfoBottom(t,e,i)},UIUtils.RegisterPathTemple("ui/new/main/NewRoleInfoBottom.ui",NewRoleInfoBottom),NewJoinRoomDlg=QPDlg.extend({uiPath:"ui/new/joinRoom/NewJoinRoomDlg.ui",inputIdx:1,maxNum:6,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.onReset()},onReset:function(){for(var t=1;t<=this.maxNum;t++)this["lab_num"+t].setString("");inputIdx=1},tap_btn_del:function(t){null!=this["lab_num"+(inputIdx-1)]&&(inputIdx--,this["lab_num"+inputIdx].setString(""))},tap_btn_reset:function(t){this.onReset()},DoSelectNum:function(t){if("ended"==t.name){if(inputIdx>this.maxNum)return;var e=t.target.name.substr(7,1);if(this["lab_num"+inputIdx].setString(e),inputIdx++,inputIdx>this.maxNum)return void this.tap_btn_join(t)}},tap_btn_join:function(t){for(var e=0,i=1;i<=this.maxNum;i++)e+=parseInt(this["lab_num"+i].getString()),e=10*e;e/=10;var a=DataMgr.clubCtrl.getMyClub(),s="",r="";a&&(s=a.match_rid,r=a.rid);var n=GetGameTypeByRoomId(e);return DataMgr.accountCtrl.isBindUserCode()?void ME_D.send_message_waiting(CMD_ENTER_DESK,{
game_type:n,desk_idx:e,union_rid:r,match_rid:s}):ModuleMgr.showConfirmCancelMsg("未实名认证玩家不能加入房间，点击确定前往认证",function(){ModuleMgr.runDlg("UserCodeDlg")})}}),NewJoinRoomDlg.create=function(t,e){return new NewJoinRoomDlg(t,e)},ModuleMgr.registerModule("NewJoinRoomDlg",NewJoinRoomDlg),NewCreateRoomDlg=QPDlg.extend({uiPath:"ui/new/createRoom/NewCreateRoomDlg.ui",listView_item:null,roomList:[],gameType:"",data:null,costRatio:0,curCost:0,ctor:function(t,e,i){this.data=t,t?(this.isClub=t.isClub||!1,this.clubData=t.clubData||null,this.isMatch=t.isMatch||!1,this.autoDeskIdx=t.autoDeskIdx,this.isAuto=t.isAuto||!1):(this.isClub=!1,this.isMatch=!1,this.isAuto=!1),this.listView_item=NewCreateTypeItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i);var a=this;this.addListener("mjGameTypeInfoEvent",function(t){var e=t.getUserData();a.updateInfo(e)}),this.addListener(EVENT_MJ_ROOM_CK_ROUND_CHANGE,function(t){a.refreshCost()}),a.addListener("GetUnionMoneySucces",function(t){a.refreshCost()})},dlgActionEnd:function(){if(QPDlg.prototype.dlgActionEnd.call(this),this.roomList=[{gameType:GAME_TYPE_NDMJ,gameImg:"ningdemajiang"},{gameType:GAME_TYPE_FZMJ,gameImg:"fuzhoumajiang"}],this.isAuto?(ME_D.send_message(CMD_UNION_MESSAGE,"get_union_money",{game_type:GAME_TYPE}),this.btn_quick_create.setVisible(!0),this.btn_create.setVisible(!1),this.btn_aa.setVisible(!1)):this.isClub&&(this.btn_quick_create.setVisible(!1),this.btn_create.loadTextures("res/uires/new/createRoom/qinyouquanBtn.png","","",ccui.Widget.LOCAL_TEXTURE),this.clubData&&(this.isMatch?(this.matchRid=this.clubData.match_rid,this.unionRid=this.clubData.rid,this.matchMoney=this.clubData.match_money,this.costRatio=this.clubData.cost_match_ratio,this.lab_club_cost&&this.lab_club_cost.setVisible(!0)):(this.costRatio=this.clubData.cost_ratio,this.matchRid="",this.unionRid=this.clubData.rid,this.matchMoney=this.clubData.match_money,this.lab_club_cost&&this.lab_club_cost.setVisible(!0)),this.gameType=this.roomList[0].gameType,this.refreshCost())),0==this.roomList.length)this.listView.setVisible(!1);else{this.listView.setVisible(!0);for(var t=0,e=cc.sys.localStorage.getItem("mj_create_room_gameType"),i=0;i<this.roomList.length;i++)e==this.roomList[i].gameType&&(t=i);this.refreshList({name:"listView",list:this.roomList,async:!0,selectId:t}),this.listView.setBounceEnabled(!1)}},refreshCost:function(){if(this.isClub){var t=this["item_"+this.gameType+"Room"];if(t&&(this.curCost=t.getChayeCost(),this.costRatio=100,this.costRatio>=0)){var e=Math.ceil(this.curCost*(this.costRatio/100));this.curCost=this.curCost-e,this.setText("lab_club_cost",e)}}this.isAuto&&(this.lab_club_cost.setString("(好友圈茶叶："+DataMgr.clubCtrl.getClubDataMatchMoney()+")"),this.lab_club_cost.setVisible(!0))},updateInfo:function(t){this.gameType=t;for(var e=0;e<this.roomList.length;e++){var i=this["item_"+this.roomList[e].gameType+"Room"];i&&i.setVisible(!1)}var a=this["item_"+t+"Room"];a&&a.setVisible(!0),this.refreshCost()},tap_btn_aa:function(){this._createRoom(!0)},tap_btn_create:function(){this._createRoom(!1)},tap_btn_quick_create:function(){var t=this["item_"+this.gameType+"Room"];if(t){var e=t.getRoomInfo();e.union_rid="",e.match_rid="";var i=DataMgr.clubCtrl.getMyClub();if(!i)return;e.union_rid=i.rid,e.idx=this.autoDeskIdx,ME_D.send_message(CMD_UNION_MESSAGE,"open_auto_desk_setting",e),this.close()}},_createRoom:function(t){var e=1585965600,i=158598e4;"1"==isTestServer&&(e=1585922400,i=1585929600);var a=DataMgr.timeCtrl.getServerTime();if(a>=e&&a<=i)return ModuleMgr.showConfirmTxtMsg("《拱趴游戏》于4月4日10点至14点\n暂停对局，以表达我们对抗击新冠\n疫情斗争牺牲烈士和逝世同胞的深切\n哀悼。愿逝者安息，生者坚强！");var s=this["item_"+this.gameType+"Room"];if(s){var r=s.getRoomInfo();t&&(r.is_win_cost_mode=3),r.union_rid="",r.match_rid="";var n=DataMgr.clubCtrl.getMyClub();if(this.data.isClub&&n&&(r.union_rid=n.rid,this.data.isMatch&&(r.match_rid=n.match_rid)),cc.log("roomInfo",r),!DataMgr.accountCtrl.isBindUserCode())return ModuleMgr.showConfirmCancelMsg("未实名认证玩家不能创建房间，点击确定前往认证",function(){ModuleMgr.runDlg("UserCodeDlg")});ME_D.send_message(CMD_CREATE_DESK,r)}},tap_btn_touch:function(){cc.eventManager.dispatchCustomEvent("closeRoomTips")}}),NewCreateRoomDlg.create=function(t,e,i){return new NewCreateRoomDlg(t,e,i)},ModuleMgr.registerModule("NewCreateRoomDlg",NewCreateRoomDlg),NewCreateTypeItem=QPListItem.extend({uiPath:"ui/new/createRoom/NewCreateTypeItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e,i)},setData:function(t){this.data=t,this.btn.loadTexture(GetRealPath("res/uires/new/createRoom/"+this.data.gameImg+".png"),ccui.Widget.LOCAL_TEXTURE)},_onSelect:function(){this.data&&this.data.gameImg&&(this.btn.loadTexture(GetRealPath("res/uires/new/createRoom/"+this.data.gameImg+"_1.png"),ccui.Widget.LOCAL_TEXTURE),cc.eventManager.dispatchCustomEvent("mjGameTypeInfoEvent",this.data.gameType))},_onNormal:function(){this.data&&this.data.gameImg&&this.btn.loadTexture(GetRealPath("res/uires/new/createRoom/"+this.data.gameImg+".png"),ccui.Widget.LOCAL_TEXTURE)}}),NewCreateTypeItem.create=function(t,e,i){return new NewCreateTypeItem(t,e,i)},ModuleMgr.registerModule("NewCreateTypeItem",NewCreateTypeItem),FzmjRoom=QPLayer.extend({uiPath:"ui/new/createRoom/FzmjRoom.ui",data:null,_optionData:[],_roomData:[],is_first:!0,ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i);var a=this;a.addListener("closeRoomTips",function(t){a.isVisible()&&a.item_info&&a.item_info.setVisible(!1)})},onLoaded:function(){this._optionData=[{name:"ck_round",type:1,option:[8,16]},{name:"ck_num",type:1,option:[4,3,2]},{name:"ck_type",type:0,option:[1,2,3,4]},{name:"ck_result",type:1,option:[1,0]}],this._roomData=["10","100","1000","10"];var t=cc.sys.localStorage.getItem("fzmj_create_room_data");t&&(this._roomData=t.split(",")),this.initOption()},initOption:function(){for(var t=gDup(this._roomData),e=0;e<this._optionData.length;e++){for(var i=this._optionData[e],a=t[e],s=!1,r=0;r<a.length;r++)"1"==a[r]&&(s=!0,1==i.type?this.OnSelectBtnEvent({name:"ended",target:this[i.name+r+"_btn"]}):this.OnCheckBtnEvent({name:"ended",target:this[i.name+r+"_btn"]}));1!=i.type||s||this.OnSelectBtnEvent({name:"ended",target:this[i.name+0+"_btn"]})}},OnSelectEvent:function(t){if("selected"==t.name){var e=t.target.name,i=e.substr(0,e.length-1),a=parseInt(e.substr(e.length-1,1));this.setSelect(i,a)}else"unselected"==t.name&&t.target.setSelected(!0)},OnSelectBtnEvent:function(t){if("ended"==t.name){var e=t.target.name,i=e.substr(0,e.length-4),a={name:"selected",target:this[""+i]};this.OnSelectEvent(a)}},setSelect:function(t,e){for(var i=0,a=0;a<this._optionData.length;a++)this._optionData[a].name==t&&(i=a);this._roomData[i]="";for(var a=0;a<this._optionData[i].option.length;a++)a==e?this._roomData[i]+="1":this._roomData[i]+="0";this.refreshSelect(t,i,e),"ck_round"!=t||this.is_first||cc.eventManager.dispatchCustomEvent(EVENT_MJ_ROOM_CK_ROUND_CHANGE),"ck_num"!=t||this.is_first||(0==e?(this.img_card1&&this.img_card1.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao5.png")),this.img_card2&&this.img_card2.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao10.png"))):1!=e&&2!=e||(this.img_card1&&this.img_card1.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao4.png")),this.img_card2&&this.img_card2.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao8.png"))),cc.eventManager.dispatchCustomEvent(EVENT_MJ_ROOM_CK_ROUND_CHANGE)),this.is_first=!1},refreshSelect:function(t,e,i){for(var a=0;a<this._optionData[e].option.length;a++)this[t+a]&&this[t+a].setSelected(a==i)},OnCheckEvent:function(t){var e=t.target.name,i=e.substr(0,e.length-1),a=parseInt(e.substr(e.length-1,1));this.setCheck(i,a,t.name)},OnCheckBtnEvent:function(t){if("ended"==t.name){var e=t.target.name,i=e.substr(0,e.length-4),a=this[""+i].selected,s=a?"unselected":"selected",r={name:s,target:this[""+i]};this.OnCheckEvent(r);var n=i.substr(0,i.length-1),o=parseInt(i.substr(i.length-1,1));this[n+o]&&this[n+o].setSelected(!a)}},setCheck:function(t,e,i){for(var a=0,s=0;s<this._optionData.length;s++)this._optionData[s].name==t&&(a=s);for(var r="",n=this._roomData[a],s=0;s<this._optionData[a].option.length;s++)r+=s==e?"selected"==i?"1":"0":"1"==n[s]?"1":"0";this._roomData[a]=r},getChayeCost:function(){var t=0,e=this.getRoomInfo();return 8===e.full_round?t=4===e.full_num?5:4:16===e.full_round&&(t=4===e.full_num?10:8),t},getRoomInfo:function(){for(var t="",e=0;e<this._roomData.length;e++)e>0&&(t+=","),t+=this._roomData[e];cc.sys.localStorage.setItem("fzmj_create_room_data",t),cc.sys.localStorage.setItem("mj_create_room_gameType",GAME_TYPE_FZMJ);for(var i=[],e=0;e<this._roomData.length;e++){var a=this._roomData[e],s=this._optionData[e].type,r=this._optionData[e].option;1!=s&&(i[e]=[]);for(var n=0;n<a.length;n++)1==a[n]&&(1==s?i[e]=r[n]:i[e].push(r[n]))}var o={game_type:GAME_TYPE_FZMJ,full_round:i[0],full_num:i[1],result_data:{spec1:0,spec2:0,spec3:0,spec4:0},cost:i[3],test_pokers:TEST_POKERS};for(var e in i[2])1==i[2][e]?o.result_data.spec1=1:2==i[2][e]?o.result_data.spec2=1:3==i[2][e]?o.result_data.spec3=1:4==i[2][e]&&(o.result_data.spec4=1);return o},tap_btn_info:function(){this.item_info&&this.item_info.setVisible(!this.item_info.isVisible())}}),FzmjRoom.create=function(t,e,i){return new FzmjRoom(t,e,i)},UIUtils.RegisterPathTemple("ui/new/createRoom/FzmjRoom.ui",FzmjRoom),NdmjRoom=QPLayer.extend({uiPath:"ui/new/createRoom/NdmjRoom.ui",data:null,_optionData:[],_roomData:[],is_first:!0,ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i);var a=this;a.addListener("closeRoomTips",function(t){a.isVisible()&&a.item_info&&a.item_info.setVisible(!1)})},onLoaded:function(){this._optionData=[{name:"ck_round",type:1,option:[8,16]},{name:"ck_num",type:1,option:[4,3,2]},{name:"ck_type",type:1,option:[1,0]},{name:"ck_result",type:1,option:[1,0]}],this._roomData=["10","100","10","10"];var t=cc.sys.localStorage.getItem("ndmj_create_room_data");t&&(this._roomData=t.split(",")),this.initOption()},initOption:function(){for(var t=gDup(this._roomData),e=0;e<this._optionData.length;e++){for(var i=this._optionData[e],a=t[e],s=!1,r=0;r<a.length;r++)"1"==a[r]&&(s=!0,1==i.type?this.OnSelectBtnEvent({name:"ended",target:this[i.name+r+"_btn"]}):this.OnCheckBtnEvent({name:"ended",target:this[i.name+r+"_btn"]}));1!=i.type||s||this.OnSelectBtnEvent({name:"ended",target:this[i.name+0+"_btn"]})}},OnSelectEvent:function(t){if("selected"==t.name){var e=t.target.name,i=e.substr(0,e.length-1),a=parseInt(e.substr(e.length-1,1));this.setSelect(i,a)}else"unselected"==t.name&&t.target.setSelected(!0)},OnSelectBtnEvent:function(t){if("ended"==t.name){var e=t.target.name,i=e.substr(0,e.length-4),a={name:"selected",target:this[""+i]};this.OnSelectEvent(a)}},setSelect:function(t,e){for(var i=0,a=0;a<this._optionData.length;a++)this._optionData[a].name==t&&(i=a);this._roomData[i]="";for(var a=0;a<this._optionData[i].option.length;a++)a==e?this._roomData[i]+="1":this._roomData[i]+="0";this.refreshSelect(t,i,e),"ck_round"!=t||this.is_first||cc.eventManager.dispatchCustomEvent(EVENT_MJ_ROOM_CK_ROUND_CHANGE),"ck_num"!=t||this.is_first||(0==e?(this.img_card1&&this.img_card1.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao5.png")),this.img_card2&&this.img_card2.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao10.png"))):1!=e&&2!=e||(this.img_card1&&this.img_card1.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao4.png")),this.img_card2&&this.img_card2.loadTexture(GetRealPath("res/uires/new/createRoom/xiaohao8.png"))),cc.eventManager.dispatchCustomEvent(EVENT_MJ_ROOM_CK_ROUND_CHANGE)),this.is_first=!1},refreshSelect:function(t,e,i){for(var a=0;a<this._optionData[e].option.length;a++)this[t+a]&&this[t+a].setSelected(a==i)},OnCheckEvent:function(t){var e=t.target.name,i=e.substr(0,e.length-1),a=parseInt(e.substr(e.length-1,1));this.setCheck(i,a,t.name)},OnCheckBtnEvent:function(t){if("ended"==t.name){var e=t.target.name,i=e.substr(0,e.length-4),a=this[""+i].selected,s=a?"unselected":"selected",r={name:s,target:this[""+i]};this.OnCheckEvent(r);var n=i.substr(0,i.length-1),o=parseInt(i.substr(i.length-1,1));this[n+o]&&this[n+o].setSelected(!a)}},setCheck:function(t,e,i){for(var a=0,s=0;s<this._optionData.length;s++)this._optionData[s].name==t&&(a=s);for(var r="",n=this._roomData[a],s=0;s<this._optionData[a].option.length;s++)r+=s==e?"selected"==i?"1":"0":"1"==n[s]?"1":"0";this._roomData[a]=r},getChayeCost:function(){var t=0,e=this.getRoomInfo();return 8===e.full_round?t=4===e.full_num?5:4:16===e.full_round&&(t=4===e.full_num?10:8),t},getRoomInfo:function(){for(var t="",e=0;e<this._roomData.length;e++)e>0&&(t+=","),t+=this._roomData[e];cc.sys.localStorage.setItem("ndmj_create_room_data",t),cc.sys.localStorage.setItem("mj_create_room_gameType",GAME_TYPE_NDMJ);for(var i=[],e=0;e<this._roomData.length;e++){var a=this._roomData[e],s=this._optionData[e].type,r=this._optionData[e].option;1!=s&&(i[e]=[]);for(var n=0;n<a.length;n++)1==a[n]&&(1==s?i[e]=r[n]:i[e].push(r[n]))}var o={game_type:GAME_TYPE_NDMJ,full_round:i[0],full_num:i[1],spec_type:i[2],cost:i[3],test_pokers:TEST_POKERS};return o},tap_btn_info:function(){this.item_info&&this.item_info.setVisible(!this.item_info.isVisible())}}),NdmjRoom.create=function(t,e,i){return new NdmjRoom(t,e,i)},UIUtils.RegisterPathTemple("ui/new/createRoom/NdmjRoom.ui",NdmjRoom),NewSettingDlg=QPDlg.extend({uiPath:"ui/new/setting/NewSettingDlg.ui",isFirstShowWidgetUI2:!0,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.showWidget1UI()},showWidget1UI:function(){var t=cc.sys.localStorage.getItem("musicVolume"),e=cc.sys.localStorage.getItem("effectsVolume"),i="res/uires/new/setting/music_close.png",a="res/uires/new/setting/music_close.png";t>0&&(i="res/uires/new/setting/music_open.png"),e>0&&(a="res/uires/new/setting/music_open.png"),this.btn_music.loadTexture(GetRealPath(i)),this.btn_effect.loadTexture(GetRealPath(a));for(var s=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_game_setting_ck_bg"))||1,r=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_game_setting_ck_size"))||1,n=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_game_setting_ck_color"))||1,o=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_game_setting_ck_click"))||1,c=0;c<3;c++)this["ck_bg"+c]&&this["ck_bg"+c].setSelected(s-1==c),this["ck_size"+c]&&this["ck_size"+c].setSelected(r-1==c),this["ck_color"+c]&&this["ck_color"+c].setSelected(n-1==c),this["ck_click"+c]&&this["ck_click"+c].setSelected(o-1==c)},OnSelectBtnEvent:function(t){if("ended"==t.name){var e=t.target.name,i=e.substr(0,e.length-4),t={name:"selected",target:this[""+i]};this.OnSelectEvent(t)}},OnSelectEvent:function(t){if("selected"==t.name){var e=t.target.name,i=e.substr(0,e.length-1),a=parseInt(e.substr(e.length-1,1));this.setTypeId(i,a)}else"unselected"==t.name&&t.target.setSelected(!0)},setTypeId:function(t,e){cc.sys.localStorage.setItem(GAME_TYPE+"_game_setting_"+t,e+1);for(var i=0;i<3;i++)this[t+i]&&this[t+i].setSelected(e==i);"ck_bg"==t?cc.eventManager.dispatchCustomEvent("SuccesSetDeskBg"):"ck_size"==t?cc.eventManager.dispatchCustomEvent("SuccesSetTileSize"):"ck_color"==t&&cc.eventManager.dispatchCustomEvent("SuccesSetTileBg")},tap_btn_wanfa:function(){ModuleMgr.runDlg("GameRuleDlg")},tap_btn_qiehuan:function(){DataMgr.accountCtrl.lastLoginTime=0,WsNetwork.getInstance().close()},tap_btn_music:function(){var t=cc.sys.localStorage.getItem("musicVolume"),e="res/uires/new/setting/music_open.png";t>0&&(e="res/uires/new/setting/music_close.png"),this.btn_music.loadTexture(GetRealPath(e)),gSetMusic(t>0)},tap_btn_effect:function(){var t=cc.sys.localStorage.getItem("effectsVolume"),e="res/uires/new/setting/music_open.png";t>0&&(e="res/uires/new/setting/music_close.png"),this.btn_effect.loadTexture(GetRealPath(e)),gSetMusicEffect(t>0)}}),NewSettingDlg.create=function(t,e){return new NewSettingDlg(t,e)},ModuleMgr.registerModule("NewSettingDlg",NewSettingDlg),GameRuleTxtItem=QPLayer.extend({uiPath:"ui/new/main/GameRuleTxtItem.ui",userData:null,isSelect:!1,isShow:!0,isImg2CanShow:!1,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},loadImgPath:function(t){t&&"object"==typeof t&&(this.userData=this.userData||{},this.userData.img_path=t),t&&"string"==typeof t[0]&&this.img_1.loadTexture(t[0]),t&&"string"==typeof t[1]&&(this.img_2.loadTexture(t[1]),this.isImg2CanShow=!0)},setData:function(t){t&&(this.userData=t,this.loadImgPath(t.img_path),t.isSelect===!0&&this.setSelect(t.isSelect),t.isShow===!1&&this.setVisible(!1))},getUserDataId:function(){var t=0;return this.userData&&(t=this.userData.id),t},onMenuItem:function(t){if("began"==t.name&&!this.isSelect){var e=0;this.userData&&(e=this.userData.id),cc.eventManager.dispatchCustomEvent(EVENT_GAME_RULE_DLG_ITEM_CLICK,e),this.setSelect(!this.isSelect)}},getSelect:function(){return this.isSelect},setSelect:function(t){void 0!==t&&(this.isSelect=t,this.img_1.setVisible(!t),this.isImg2CanShow&&this.img_2.setVisible(t))}}),GameRuleTxtItem.create=function(t,e,i){return new GameRuleTxtItem(t,e,i)},ModuleMgr.registerModule("GameRuleTxtItem",GameRuleTxtItem),UIUtils.RegisterPathTemple("ui/GameRuleTxtItem.ui",GameRuleTxtItem),GameRuleDlg=QPDlg.extend({uiPath:"ui/new/main/GameRuleDlg.ui",ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){var t=this;t.scroll_txts&&t.scroll_txts.setClippingType(ccui.Layout.CLIPPING_STENCIL),this.addListener(EVENT_GAME_RULE_DLG_ITEM_CLICK,function(e){var i=e.getUserData();t.freshItemSelectFlag(i),t.setImg(i)}),this.scheduleOnce(function(){t.list_items.setBounceEnabled(!1),t.showTxtList()},.3)},freshItemSelectFlag:function(t){for(var e=this.list_items.getItems(),i=0;i<e.length;i++){var a=e[i].getUserDataId();a!=t&&e[i].setSelect(!1)}},showTxtList:function(){var t=[{id:GAME_FZMJ_MENU_ITEM_ID,img_path:[GetRealPath("res/uires/new/wanfa/btn_fuzhoumajiang.png"),GetRealPath("res/uires/new/wanfa/btn_light_fuzhoumajiang.png")],isSelect:!0},{id:GAME_NDMJ_BAI_MENU_ITEM_ID,img_path:[GetRealPath("res/uires/new/wanfa/btn_ningdebaiban.png"),GetRealPath("res/uires/new/wanfa/btn_light_ningdebaiban.png")]},{id:GAME_NDMJ_KAI_MENU_ITEM_ID,img_path:[GetRealPath("res/uires/new/wanfa/btn_ningdekaijin.png"),GetRealPath("res/uires/new/wanfa/btn_light_ningdekaijin.png")]}];this.refreshList({name:"list_items",list:t,async:!0,itemCell:GameRuleTxtItem});var e=this;this.scheduleOnce(function(){e.setImg(GAME_FZMJ_MENU_ITEM_ID)},.2)},setImg:function(t){var e=this;e.scroll_txts.removeAllChildren();var i=e.scroll_txts.getContentSize(),a=[];switch(t){case GAME_FZMJ_MENU_ITEM_ID:a=HELP_IMG_CFG_FZMJ;break;case GAME_NDMJ_BAI_MENU_ITEM_ID:a=HELP_IMG_CFG_NDMJ_BAI;break;case GAME_NDMJ_KAI_MENU_ITEM_ID:a=HELP_IMG_CFG_NDMJ_KAI;break;default:a=HELP_IMG_CFG}cc.loader.load(a,function(t,e,i){},function(){for(var t=0,s=a.length-1;s>=0;s--){var r=new ccui.ImageView(a[s]);r.anchorX=.5,r.anchorY=0,r.y=t,r.x=i.width/2,e.scroll_txts.addChild(r),t+=r.height}i.height=t,e.scroll_txts.setInnerContainerSize(i),e.scroll_txts.setBounceEnabled(!0)})}}),GameRuleDlg.create=function(t,e){return new GameRuleDlg(t,e)},ModuleMgr.registerModule("GameRuleDlg",GameRuleDlg),UserCodeDlg=QPDlg.extend({uiPath:"ui/UserCodeDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this.lab_name_input=new ccui.TextField,this.lab_name_input.setPlaceHolder(""),this.lab_name_input.setFontSize(23),this.lab_name_input.setTouchAreaEnabled(!0),this.lab_name_input.setTouchSize(this.lab_name_input_pos.getContentSize()),this.lab_name_input.setAnchorPoint(cc.p(0,.5)),this.lab_name_input.setPosition(this.lab_name_input_pos.getPosition()),this.addChild(this.lab_name_input),this.lab_code_input=new ccui.TextField,this.lab_code_input.setPlaceHolder(""),this.lab_code_input.setFontSize(23),this.lab_code_input.setTouchAreaEnabled(!0),this.lab_code_input.setTouchSize(this.lab_code_input_pos.getContentSize()),this.lab_code_input.setAnchorPoint(cc.p(0,.5)),this.lab_code_input.setPosition(this.lab_code_input_pos.getPosition()),this.addChild(this.lab_code_input)},tap_btn_send:function(){var t=this.lab_name_input.getString();if(""==t)return ModuleMgr.showTipMsg("名字不能为空！");var e=this.lab_code_input.getString();if(18!=e.length)return ModuleMgr.showTipMsg("身份证必须18位！");var i=new Date,a=i.getFullYear(),s=i.getMonth()+1,r=i.getDate(),n=parseInt(e.substr(6,4)),o=parseInt(e.substr(10,2)),c=parseInt(e.substr(12,2)),l=a-n,_=!0;if(l<18?_=!1:18==l&&(_=o<s||o==s&&c<=r),0==_)return ModuleMgr.showTipMsg("未满18岁，不能进行实名验证！");var u=this,h=function(i){return 0!=i.ret?void ModuleMgr.showTipMsg(i.error):(DataMgr.accountCtrl.realname=t.substring(0,1)+"**",DataMgr.accountCtrl.userCode=e.substring(0,6)+"************",ModuleMgr.showTipMsg("实名认证成功"),cc.eventManager.dispatchCustomEvent("IDENTIFICATION_SUCCESS"),void u.close())};DataMgr.accountCtrl.bindIDCard(t,e,h)},close:function(){QPDlg.prototype.close.call(this);var t=cc.sys.localStorage.getItem("user_code");t&&!DataMgr.accountCtrl.isForeceUserCodeOpen&&(2==t?ModuleMgr.runDlg("RechargeDlg"):3==t&&ModuleMgr.runDlg("RechargeDlg",{is_zuanshi:!0},null,null))}}),UserCodeDlg.create=function(t,e,i){return new UserCodeDlg(t,e,i)},ModuleMgr.registerModule("UserCodeDlg",UserCodeDlg),UserInfoDlg=QPDlg.extend({uiPath:"ui/UserInfoDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this._super();var t=this;t.addListener("IDENTIFICATION_SUCCESS",function(e){t.refreshUi()}),this.refreshUi()},refreshUi:function(){this.txt_name&&this.txt_name.setString(decodeURIComponent(ME_D.get_user().name)),this.txt_uid&&this.txt_uid.setString(ME_D.get_user().account_uid),this.item_head&&this.item_head.setData({url:ME_D.get_user().headimgurl}),DataMgr.accountCtrl.isBindUserCode()&&(this.txt_wait1.setVisible(!1),this.txt_wait2.setVisible(!1),this.txt_real_name.setVisible(!0),this.txt_id_card.setVisible(!0),this.txt_real_name.setText(DataMgr.accountCtrl.realname),this.txt_id_card.setText(DataMgr.accountCtrl.userCode))},tap_btn_identify:function(){cc.sys.localStorage.setItem("user_code",1),ModuleMgr.runDlg("UserCodeDlg")}}),UserInfoDlg.create=function(t,e,i){return new UserInfoDlg(t,e,i)},ModuleMgr.registerModule("UserInfoDlg",UserInfoDlg),NewRoleInfoDlg=QPDlg.extend({uiPath:"ui/new/main/NewRoleInfoDlg.ui",ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.headIcon.set_head_btn_enable(!1),this.txt_name.setString(toDecodeURIComponent(ME_D.get_user().name)),this.txt_ID.setString(ME_D.get_user().account_uid);var t=DataMgr.propCtrl.getHeadPropInfo(),e=t?t.icon:null;this.headIcon.setData({url:ME_D.get_user().headimgurl,frame:e});var i=this;this.refreshCoin(),i.addListener("userChange",function(t){i.refreshCoin()}),i.addListener("HEAD_USE_PROP",function(t){var e=DataMgr.propCtrl.getHeadPropInfo(),a=e?e.icon:null;i.headIcon.setData({url:ME_D.get_user().headimgurl,frame:a})}),i.addListener("IDENTIFICATION_SUCCESS",function(t){i.refreshUi()}),this.refreshUi();var a=ME_D.get_user().sex,s=2===a?"icon_nv":"icon_nan";this.img_sex.loadTexture(GetRealPath("res/uires/new/info/"+s+".png"),ccui.Widget.LOCAL_TEXTURE)},refreshUi:function(){DataMgr.accountCtrl.isBindUserCode()&&(this.txt_wait1.setVisible(!1),this.txt_wait2.setVisible(!1),this.txt_real_name.setVisible(!0),this.txt_id_card.setVisible(!0),this.txt_real_name.setText(DataMgr.accountCtrl.realname),this.txt_id_card.setText(DataMgr.accountCtrl.userCode))},refreshCoin:function(){this.lab_chaye.setString(ME_D.get_user().room_card),this.lab_stone.setString(ME_D.get_user().stone)},tap_btn_qiehuan:function(t){DataMgr.accountCtrl.lastLoginTime=0,WsNetwork.getInstance().close()},tap_btn_huantouxiang:function(t){ModuleMgr.runDlg("ShopDlg",{showIndex:2},null)},onBtnAddTea:function(t){"ended"==t.name&&ModuleMgr.showTipMsg("暂不开放")},onChk1Event:function(t){},onChk2Event:function(t){},tap_btn_identify:function(){cc.sys.localStorage.setItem("user_code",1),ModuleMgr.runDlg("UserCodeDlg")}}),NewRoleInfoDlg.create=function(t,e){return new NewRoleInfoDlg(t,e)},ModuleMgr.registerModule("NewRoleInfoDlg",NewRoleInfoDlg),NewNoticeDlg=QPDlg.extend({uiPath:"ui/new/main/NewNoticeDlg.ui",data:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;cc.log("  self.scroll_txts.getClippingType= ",t.scroll_txts.getClippingType(),"  isClippingEnabled()=",t.scroll_txts.isClippingEnabled()," ccui.Layout.CLIPPING_STENCIL=",ccui.Layout.CLIPPING_STENCIL," ccui.Layout.CLIPPING_SCISSOR=",ccui.Layout.CLIPPING_SCISSOR),t.scroll_txts&&t.scroll_txts.setClippingType(ccui.Layout.CLIPPING_STENCIL),this.data=this.data||[],this.scheduleOnce(function(){t.showNoticeContent()},.2)},getStr:function(t){var e="";return e+=t.title+"[br] \n ",e+=t.content},showNoticeContent:function(){for(var t=this,e=this.data||[],i=0,a=18,s=0;s<5;s++){var r=this["lab_new_"+s];if(r)if(s<e.length){r.setVisible(!0),r.setString(this.getStr(e[s]));var n=r.getVirtualRendererSize();i+=n.height+a}else r.setVisible(!1)}var o=t.scroll_txts.getContentSize();o.height<i&&(o.height=i),this.scroll_txts.setInnerContainerSize(o),i=o.height;for(var s=0;s<5;s++){var r=this["lab_new_"+s];r&&r.isVisible()&&(r.setPositionY(i),i=i-r.getVirtualRendererSize().height-a)}t.scroll_txts.setBounceEnabled(!0)}}),NewNoticeDlg.create=function(t,e){return new NewNoticeDlg(t,e)},ModuleMgr.registerModule("NewNoticeDlg",NewNoticeDlg),NoticeTxtItem=QPLayer.extend({uiPath:"ui/new/main/NoticeTxtItem.ui",data:null,isSelect:!1,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setData:function(t){t&&(this.data=t,t.title&&"string"==typeof t.title&&this.txt.setString(t.title),1===t.id&&this.setSelect(!0))},getUserDataId:function(){var t=0;return this.data&&(t=this.data.id),t},onMenuItem:function(t){if("began"==t.name&&!this.isSelect){var e=0;this.data&&(e=this.data.id),cc.eventManager.dispatchCustomEvent(EVENT_NOTICE_DLG_ITEM_CLICK,e),this.setSelect(!this.isSelect)}},getSelect:function(){return this.isSelect},setSelect:function(t){void 0!==t&&(this.isSelect=t,this.img_1.setVisible(!t),this.img_2.setVisible(t))}}),NoticeTxtItem.create=function(t,e,i){return new NoticeTxtItem(t,e,i)},ModuleMgr.registerModule("NoticeTxtItem",NoticeTxtItem),UIUtils.RegisterPathTemple("ui/NoticeTxtItem.ui",NoticeTxtItem),NewRecordDlg=QPDlg.extend({uiPath:"ui/new/record/NewRecordDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this);var t=this.data.lists||[];t.length>0?(this.lab_none.setVisible(!1),this.listView.setVisible(!0),this.refreshList({name:"listView",itemCell:NewRecordItem,list:t})):(this.lab_none.setVisible(!0),this.listView.setVisible(!1))},tap_btn_replayCode:function(){ModuleMgr.runDlg("RecordReplayCode")}}),NewRecordDlg.create=function(t,e,i){return new NewRecordDlg(t,e,i)},ModuleMgr.registerModule("NewRecordDlg",NewRecordDlg),NewRecordItem=QPListItem.extend({uiPath:"ui/new/record/NewRecordItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e,i)},setData:function(t){switch(this.data=t,t.gameType){case GAME_TYPE_NDMJ:this.lab_gameType.setString("宁德麻将");break;case GAME_TYPE_FZMJ:this.lab_gameType.setString("福州麻将")}this.lab_roomId.setString("房号:"+t.desk_no);var e=t.all_cost_time||0,i=new Date(1e3*(t.create_time+e)),a=i.format("yyyy-MM-dd"),s=i.format("hh:mm:ss");this.lab_date.setString(a),this.lab_time.setString(s);for(var r=1;r<=4;r++)this["lab_name"+r]&&this["lab_name"+r].setString(""),this["lab_score"+r]&&this["lab_score"+r].setString("");for(var n=ConvertToJson(t.record_detail),r=0;r<n.users.length;r++){var o=n.users[r].name||"";o=cutOffStr(o,8,!0),this["lab_name"+(r+1)]&&this["lab_name"+(r+1)].setString(o);var c=""+n.score["idx"+(r+1)]||"";this["lab_score"+(r+1)]&&this["lab_score"+(r+1)].setString(c)}n.union_rid?this.lab_roomType.setString("好友圈开房"):this.lab_roomType.setString("房主开房")},tap_btn_bg:function(){ModuleMgr.runDlg("NewRecordDetailsDlg",this.data,null,null)}}),NewRecordItem.create=function(t,e,i){return new NewRecordItem(t,e,i)},ModuleMgr.registerModule("NewRecordItem",NewRecordItem),NewRecordDetailsDlg=QPDlg.extend({uiPath:"ui/new/record/NewRecordDetailsDlg.ui",ctor:function(t,e,i){this.data=t,this.recordData=ConvertToJson(this.data.record_detail),cc.log("NewRecordDetailsDlg-data",t),cc.log("NewRecordDetailsDlg-recordData",this.recordData),QPDlg.prototype.ctor.call(this,this.uiPath,e)},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this);for(var t=1;t<=4;t++)this["lab_name"+t]&&this["lab_name"+t].setString("");var e=[],i=this.recordData.replay_records;if(i.length>0)for(var t=0;t<i.length;t++){var a=i[t];a.gameType=this.data.gameType,a.deskId=this.data.desk_no,a.round=this.data.full_round,a.creatTime=a.time,e.push(a)}if(e.length>0){this.lab_num&&this.lab_num.setString("序号");for(var t=0;t<this.recordData.users.length;t++){var s=cutOffStr(this.recordData.users[t].name,8,!0);this["lab_name"+(t+1)]&&this["lab_name"+(t+1)].setString(s)}this.lab_none.setVisible(!1),this.listView.setVisible(!0),this.refreshList({name:"listView",itemCell:NewRecordDetailsItem,list:e})}else this.lab_num&&this.lab_num.setString(""),this.lab_none.setVisible(!0),this.listView.setVisible(!1)}}),NewRecordDetailsDlg.create=function(t,e,i){return new NewRecordDetailsDlg(t,e,i)},ModuleMgr.registerModule("NewRecordDetailsDlg",NewRecordDetailsDlg),NewRecordDetailsItem=QPListItem.extend({uiPath:"ui/new/record/NewRecordDetailsItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e,i)},setData:function(t){this.data=t,this.lab_num.setString(this.data.idx);for(var e=1;e<=4;e++)this["lab_score"+e]&&this["lab_score"+e].setString("");for(var e=0;e<this.data.users.length;e++)this["lab_score"+(e+1)]&&this["lab_score"+(e+1)].setString(this.data.users[e].score)},tap_btn_look:function(){cc.log("replay_records",this.data);var t=function(t,e){cc.log("data",t)};DataMgr.recordCtrl.getGameDetailRecord(this.data.rid,t,this.data.gameType)},tap_btn_share:function(){var t=this.data.gameType+"_"+this.data.rid;platform.share(SHARE_DETAIL_TITLE_DES(this.data),SHARE_DETAIL_DES(this.data),getShareUrl(0,t),0,SHARE_URL+"res/icon/record2.png")}}),NewRecordDetailsItem.create=function(t,e,i){return new NewRecordDetailsItem(t,e,i)},ModuleMgr.registerModule("NewRecordDetailsItem",NewRecordDetailsItem),NewOtherRecordDlg=QPDlg.extend({uiPath:"ui/new/record/NewOtherRecordDlg.ui",ctor:function(t,e,i){this.data=t,this.recordData=null,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){if(this.data&&this.data.record_detail){this.recordData=ConvertToJson(this.data.record_detail);for(var t=0;t<this.recordData.users.length;t++){var e=cutOffStr(this.recordData.users[t].name,8,!0);this["lab_name"+(t+1)]&&this["lab_name"+(t+1)].setString(e),this["lab_score"+(t+1)]&&this["lab_score"+(t+1)].setString(this.recordData.users[t].score)}this.lab_num.setString(this.recordData.cur_round),this.grp_title.setVisible(!0),this.grp_item.setVisible(!0)}else this.lab_none.setVisible(!0)},tap_btn_look:function(){ModuleMgr.enterGameScene(!0)}}),NewOtherRecordDlg.create=function(t,e,i){return new NewOtherRecordDlg(t,e,i)},ModuleMgr.registerModule("NewOtherRecordDlg",NewOtherRecordDlg),RecordReplayCode=QPDlg.extend({uiPath:"ui/new/record/RecordReplayCode.ui",ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e)},onLoaded:function(){},tap_btn_look:function(){var t=this.lab_input.getString();if(cc.log("shareCode",t),""==t)return void ModuleMgr.showTipMsg("请输入回放码");var e=t.split("_"),i=e[0],a=e[1];if(void 0==i||void 0==a)return void ModuleMgr.showTipMsg("回放码错误");var s=function(t,e){cc.log("data",t),0==t.lists.length&&ModuleMgr.showTipMsg("战绩不存在")};DataMgr.recordCtrl.getGameDetailRecord(a,s,i)}}),RecordReplayCode.create=function(t,e,i){
return new RecordReplayCode(t,e,i)},ModuleMgr.registerModule("RecordReplayCode",RecordReplayCode);var hasQueryParam=!1,hasQueryDeskParam=!1;NewLoginLayer=QPLayer.extend({uiPath:"ui/new/game/Login.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.addListener(EVENT_ENTER_GAME,function(){ModuleMgr.removeWaitMsg(),ModuleMgr.enterEnterScene()}),this.btn_download.setVisible(!1),0==cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID,this.btn_weixin.setVisible(!1),platform.isInstalled()&&this.btn_weixin.setVisible(!0),this.btn_guest.setVisible(!1);var t=parseInt(getQueryString("guest"))||0;(1==t||gInReview)&&this.btn_guest.setVisible(!0),this.scheduleUpdate();var e=getQueryString("recordId")||"0";if(e.length>1)if(IsGameTypeFzmjOrNdmj()){var i=function(t,e){t&&t.lists&&ModuleMgr.runDlg("NewOtherRecordDlg",t.lists[0],null,null)},a=e.split("_"),s=a[0],r=a[1];DataMgr.recordCtrl.getOtherRecord(r,i,s)}else{var i=function(t){t&&t.lists&&ModuleMgr.showRecordDetailDlg(t.lists[0])};DataMgr.recordCtrl.getOneRecord(e,i)}else{do if(0==cc.sys.isNative&&0==hasQueryParam){if(hasQueryParam=!0,0==getQueryString("loginsuc")){ModuleMgr.showConfirmTxtMsg("微信授权失败");break}if(""==DataMgr.accountCtrl.wechatAccount||""==DataMgr.accountCtrl.wechatPass)break;return void platform.doWechatLogin()}while(!1);var n=parseInt(getQueryString("desk"))||0;if(n>0&&0==hasQueryDeskParam)hasQueryDeskParam=!0,""!=DataMgr.accountCtrl.wechatAccount&&""!=DataMgr.accountCtrl.wechatPass&&platform.doWechatLogin();else if(""!=DataMgr.accountCtrl.wechatAccount&&""!=DataMgr.accountCtrl.wechatPass&&getTimestamp()-DataMgr.accountCtrl.lastLoginTime<platform.weixinTimeOut)return void platform.login()}},update:function(){platform.retCode&&(ModuleMgr.removeWaitMsg(),platform.loginCallback(platform.retCode),platform.retCode=null)},tap_btn_download:function(t){cc.sys.os==cc.sys.OS_ANDROID&&cc.sys.openURL("http://chessres.oss-cn-shanghai.aliyuncs.com/hotfire.apk")},tap_btn_weixin:function(t){platform.login()},tap_btn_guest:function(t){function e(){DataMgr.accountCtrl.isGuest=!0,DataMgr.accountCtrl.apilogin(DataMgr.accountCtrl.guestAccount,DataMgr.accountCtrl.guestPsw,function(t,e){t?ModuleMgr.showTipMsg(t):LOGIN_D.login(null,null)})}function i(t){0!=t.ret?ModuleMgr.showConfirmTxtMsg(t.error):(DataMgr.accountCtrl.guestAccount=t.user,DataMgr.accountCtrl.guestPsw=t.password),e()}return""!=DataMgr.accountCtrl.guestAccount&&""!=DataMgr.accountCtrl.guestPsw?void e():(DataMgr.accountCtrl.apiGuestLogin(i),void(0==cc.sys.isNative&&doMainShare()))},tap_btn_mostone:function(t){platform.login(LOCATE_PLAFORM.MOSTONE)},tap_btn_phone:function(){ModuleMgr.runDlg("PhoneLoginDlg")}}),NewLoginLayer.create=function(t,e,i){return new NewLoginLayer(t,e,i)},ModuleMgr.registerModule("NewLoginLayer",NewLoginLayer),PhoneLoginDlg=QPDlg.extend({uiPath:"ui/new/phoneUI/PhoneLoginDlg.ui",ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){var t=cc.sys.localStorage.getItem("tel_account_login")||"";t&&this.input_phone.setString(t)},tap_btn_forget_pw:function(){ModuleMgr.runDlg("ForgetAndChangePWDlg")},tap_btn_phone_login:function(){var t=this.input_phone.getString();if(!checkPhone(t))return ModuleMgr.showTipMsg("请输入正确手机号！"),!1;var e=this.input_password.getString();if(!e)return ModuleMgr.showTipMsg("请输入密码！"),!1;var i=DataMgr.accountCtrl.getTelPassward(e);DataMgr.accountCtrl.apiTelphoneLogin(t,i)}}),PhoneLoginDlg.create=function(t,e,i){return new PhoneLoginDlg(t,e,i)},ModuleMgr.registerModule("PhoneLoginDlg",PhoneLoginDlg),BindPhoneDlg=QPDlg.extend({uiPath:"ui/new/phoneUI/BindPhoneDlg.ui",curPhoneNum:"",isHidePossWord:!1,_verificateTime:1200,chayeNum:20,verificateTime:this._verificateTime,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this._super();var t=ModuleMgr.getDlg("PhoneLoginDlg"),e=cc.sys.localStorage.getItem("tel_account_login")||"";t&&t.setVisible(!1),this.input_phone.setString(e),this.input_password.setInputFlag(cc.EDITBOX_INPUT_FLAG_SENSITIVE),this.lab_chaye&&this.lab_chaye.setString("x"+this.chayeNum),this.isHidePossWord=!1},dlgActionEnd:function(){},tap_btn_get_verified:function(){if(this.verificateTime>this._verificateTime&&this.verificateTime>0)return void ModuleMgr.showTipMsg("验证码信息已发送，请及时查收");var t=this.input_phone.getString();if(!checkPhone(t))return ModuleMgr.showTipMsg("请输入正确手机号！"),!1;var e=this,i=function(t){t.createtime?(e.verificateTime=t.createtime-DataMgr.timeCtrl.getServerTime()+e._verificateTime,ModuleMgr.showTipMsg("验证码信息已发送，请及时查收")):e.verificateTime=e._verificateTime,e.btn_get_verified.setVisible(!1),e.scheduleUpdate()};this.curPhoneNum=t,DataMgr.accountCtrl.getVerificationCode(t,i)},tap_btn_hide_word:function(){this.isHidePossWord?(this.input_password.setInputFlag(cc.EDITBOX_INPUT_FLAG_SENSITIVE),this.isHidePossWord=!1,this.btn_hide_word.loadTextureNormal(GetRealPath("res/uires/new/phone/btn_yincang.png"))):(this.input_password.setInputFlag(cc.EDITBOX_INPUT_FLAG_PASSWORD),this.isHidePossWord=!0,this.btn_hide_word.loadTextureNormal(GetRealPath("res/uires/new/phone/btn_kejian.png")))},tap_btn_bind_phone:function(){var t=this.input_phone.getString(),e=this.input_verified.getString(),i=this.input_password.getString();if(!checkPhone(t))return ModuleMgr.showTipMsg("请输入正确手机号！"),!1;if(!/^(\w){6,16}$/.test(i))return void ModuleMgr.showTipMsg("密码为6-16个字符");if(!e)return void ModuleMgr.showTipMsg("请输入验证码");var a=this,s=function(e){a.setVisible(!1),ModuleMgr.showConfirmTxtMsg("绑定帐号成功，恭喜获得"+a.chayeNum+"个茶叶奖励",function(){a.close()}),cc.sys.localStorage.setItem("tel_account_login",t),cc.eventManager.dispatchCustomEvent("SuccessBindPhone")},r=DataMgr.accountCtrl.getTelPassward(i);DataMgr.accountCtrl.bindPhoneNumber(t,e,r,s)},update:function(t){this.verificateTime-=t,this.txt_second&&this.txt_second.setString("("+Math.floor(this.verificateTime)+"s)"),this.verificateTime<=0&&(this.txt_second&&this.txt_second.setString(""),this.btn_get_verified.setVisible(!0),this.unscheduleUpdate())},onExit:function(){this._super();var t=ModuleMgr.getDlg("PhoneLoginDlg");t&&t.setVisible(!0)}}),BindPhoneDlg.create=function(t,e,i){return new BindPhoneDlg(t,e,i)},ModuleMgr.registerModule("BindPhoneDlg",BindPhoneDlg),ForgetAndChangePWDlg=BindPhoneDlg.extend({uiPath:"ui/new/phoneUI/ForgetAndChangePWDlg.ui",tap_btn_change_pw:function(){var t=this.input_phone.getString(),e=this.input_verified.getString(),i=this.input_password.getString();if(!checkPhone(t))return ModuleMgr.showTipMsg("请输入正确手机号！"),!1;if(!/^(\w){6,16}$/.test(i))return void ModuleMgr.showTipMsg("密码为6-16个字符");if(!e)return void ModuleMgr.showTipMsg("请输入验证码");var a=this,s=function(t){a.setVisible(!1),ModuleMgr.showConfirmTxtMsg("更改成功",function(){a.close()})},r=DataMgr.accountCtrl.getTelPassward(i);DataMgr.accountCtrl.findPhonePW(t,e,r,s)}}),ForgetAndChangePWDlg.create=function(t,e,i){return new ForgetAndChangePWDlg(t,e,i)},ModuleMgr.registerModule("ForgetAndChangePWDlg",ForgetAndChangePWDlg),ChangePWDlg=QPDlg.extend({uiPath:"ui/new/phoneUI/ChangePWDlg.ui",isHidePW1:!1,isHidePW2:!1,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},tap_btn_hide_word1:function(){this.isHidePW1?(this.input_pw_new1.setInputFlag(cc.EDITBOX_INPUT_FLAG_SENSITIVE),this.isHidePW1=!1,this.btn_hide_word1.loadTextureNormal(GetRealPath("res/uires/new/phone/btn_yincang.png"))):(this.input_pw_new1.setInputFlag(cc.EDITBOX_INPUT_FLAG_PASSWORD),this.isHidePW1=!0,this.btn_hide_word1.loadTextureNormal(GetRealPath("res/uires/new/phone/btn_kejian.png")))},tap_btn_hide_word2:function(){this.isHidePW2?(this.input_pw_new2.setInputFlag(cc.EDITBOX_INPUT_FLAG_SENSITIVE),this.isHidePW2=!1,this.btn_hide_word2.loadTextureNormal(GetRealPath("res/uires/new/phone/btn_yincang.png"))):(this.input_pw_new2.setInputFlag(cc.EDITBOX_INPUT_FLAG_PASSWORD),this.isHidePW2=!0,this.btn_hide_word2.loadTextureNormal(GetRealPath("res/uires/new/phone/btn_kejian.png")))},tap_btn_chang_pw:function(){var t=this.input_pw_old.getString(),e=this.input_pw_new1.getString(),i=this.input_pw_new2.getString();if(!/^(\w){6,16}$/.test(e))return void ModuleMgr.showTipMsg("密码为6-16个字符");if(e!==i)return void ModuleMgr.showTipMsg("重复密码不一致");if(t===e)return void ModuleMgr.showTipMsg("新旧密码一样，请重新输入");var a=this,s=function(t){a.setVisible(!1),ModuleMgr.showConfirmTxtMsg("更改成功",function(){a.close()})},r=DataMgr.accountCtrl.getTelPassward(t),n=DataMgr.accountCtrl.getTelPassward(e);DataMgr.accountCtrl.changePhonePW(r,n,s)}}),ChangePWDlg.create=function(t,e,i){return new ChangePWDlg(t,e,i)},ModuleMgr.registerModule("ChangePWDlg",ChangePWDlg),MsgBuyPropConfirm=QPDlg.extend({uiPath:"ui/new/shop/MsgBuyPropConfirm.ui",data:null,index:1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this._super(),this.lab_txt.ignoreContentAdaptWithSize(!1),this.lab_txt.setContentSize(cc.size(418,58)),this.setData(1)},setData:function(t){this.index=t;var e=UIUtils.dup(this.data);e.midIcon=!0,this.item.setData(e);var i=DataMgr.propCtrl.getPropInfoById(e.class_id);i&&(this.lab_name.setString(i.name),this.lab_txt.setString("("+i.describe+"有效期为"+(e.day[t-1]||1)+"天)")),e.money_type&&"room_card"==e.money_type[t-1]&&this.img_currency_type.loadTexture(GetRealPath("res/uires/new/common/chaye.png")),e.money_type&&"stone"==e.money_type[t-1]&&this.img_currency_type.loadTexture(GetRealPath("res/uires/new/common/zuanshi.png")),this.lab_money.setString(e.money[t-1]);for(var a=1;a<=2;++a)this["check_box"+a].setSelected(a==t),this.setText("lab_day"+a,e.day[a-1]||1)},OnSelect:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(9,1));this.setData(e)}else"unselected"==t.name&&t.target.setSelected(!0)},tap_btn_cancel:function(){this.close()},tap_btn_ok:function(){var t=this.data;if(t.money_type&&"room_card"==t.money_type[this.index-1]&&ME_D.get_user().room_card<t.money[this.index-1])return ModuleMgr.showTipMsg("茶叶不足！");if(t.money_type&&t.money_type[this.index-1]&&ME_D.get_user().stone<t.money[this.index-1])return ModuleMgr.showTipMsg("钻石不足！");var e=parseInt(this.data.day[this.index-1]||1);ME_D.send_message(CMD_ITEM_OPER,{oper:"buy",id:this.data.id,vaild_days:e,game_type:GAME_TYPE}),this.close()}}),MsgBuyPropConfirm.create=function(t,e,i){return new MsgBuyPropConfirm(t,e,i)},ModuleMgr.registerModule("MsgBuyPropConfirm",MsgBuyPropConfirm),ShopDlg=QPDlg.extend({uiPath:"ui/new/shop/ShopDlg.ui",showIndex:SHOP_ALL_MENU_ITEM_ID,ctor:function(t,e,i){t=t||this.uiPath,t&&t.showIndex&&(this.showIndex=t.showIndex),QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this._super(),DataMgr.propCtrl.extendUsedPropObj(DataMgr.propCtrl.usedMapList),DataMgr.propCtrl.ownPropListUsed(),cc.eventManager.dispatchCustomEvent("HEAD_USE_PROP");var t=this;this.addListener("SUCCESS_GET_SOLD_PROP",function(e){t.refreshSoldProp(DataMgr.propCtrl.soldPropList)}),this.addListener("SUCCESS_GET_OWN_PROP",function(e){t.refreshOwnProp(DataMgr.propCtrl.ownPropList)}),this.addListener(EVENT_GAME_RULE_DLG_ITEM_CLICK,function(e){var i=e.getUserData();t.freshItemSelectFlag(i),t.showListView(i==SHOP_ALL_MENU_ITEM_ID)}),t.list_view_all.setClippingType(ccui.Layout.CLIPPING_STENCIL),t.list_view_own.setClippingType(ccui.Layout.CLIPPING_STENCIL),this.scheduleOnce(function(){var e={item_png:"res/plist/item.png",item_plist:"res/plist/item.plist"},i=[];for(var a in e)i.push(GetRealPath(e[a]));cc.loader.load(i,function(t,e,i){},function(){cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/item.plist")),t.showTxtList(),t.showListView(t.showIndex==SHOP_ALL_MENU_ITEM_ID)})},.2)},freshItemSelectFlag:function(t){for(var e=this.list_items.getItems(),i=0;i<e.length;i++){var a=e[i].getUserDataId();a!=t&&e[i].setSelect(!1)}},showTxtList:function(){var t=[{id:SHOP_ALL_MENU_ITEM_ID,img_path:[GetRealPath("res/uires/new/shop/btn_quanbu.png"),GetRealPath("res/uires/new/shop/btn_light_quanbu.png")],isSelect:this.showIndex==SHOP_ALL_MENU_ITEM_ID||null},{id:GAME_NDMJ_BAI_MENU_ITEM_ID,img_path:[GetRealPath("res/uires/new/shop/btn_yiyongyou.png"),GetRealPath("res/uires/new/shop/btn_light_yiyongyou.png")],isSelect:this.showIndex==SHOP_OWN_MENU_ITEM_ID||null}];this.refreshList({name:"list_items",list:t,async:!1,itemCell:GameRuleTxtItem}),this.list_items.setInertiaScrollEnabled(!1),this.list_items.setBounceEnabled(!1);var e=this;this.scheduleOnce(function(){e.refreshSoldProp(),e.refreshOwnProp(DataMgr.propCtrl.ownPropList)},.2)},refreshSoldProp:function(){var t=DataMgr.propCtrl.getSoldPropList();if(t&&t.length>0){t.sort(function(t,e){return t.weight=t.weight||1,e.weight=e.weight||1,e.weight-t.weight});for(var e=3,i=[],a=0;a<t.length;++a)a%e==0&&i.push([]),i[Math.floor(a/e)].push(t[a]);this.refreshList({name:"list_view_all",list:i,async:!0,itemCell:ShopItemGroup})}},refreshOwnProp:function(t){var e=function(t,e){var a=DataMgr.propCtrl.getPropInfoById(t.class_id),s=DataMgr.propCtrl.getPropInfoById(e.class_id);return a.quality==s.quality?i(t,e):s.quality-a.quality},i=function(t,e){return e.end_time==t.end_time?t.class_id-e.class_id:e.end_time-t.end_time};t.sort(function(t,i){return t.is_used==i.is_used?e(t,i):t.is_used&&!i.is_used?-1:!t.is_used&&i.is_used?1:void 0});for(var a=[],s=0;s<t.length;++s)t[s].class_id<400&&a.push(t[s]);for(var r=3,n=[],s=0;s<a.length;++s)s%r==0&&n.push([]),n[Math.floor(s/r)].push(a[s]);this.refreshList({name:"list_view_own",list:n,async:!0,itemCell:ShopItemGroup})},showListView:function(t){this.list_view_all.setVisible(t),this.list_view_own.setVisible(!t)}}),ShopDlg.create=function(t,e,i){return new ShopDlg(t,e,i)},ModuleMgr.registerModule("ShopDlg",ShopDlg),ShopItemGroup=QPLayer.extend({uiPath:"ui/new/shop/ShopItemGroup.ui",data:null,itemNum:3,ctor:function(t,e,i){this.data=t,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){for(var t=0;t<this.itemNum;++t)this["item_"+(t+1)].setVisible(!1)},setData:function(t){if(t&&"object"==typeof t&&(this.data=t,this._isCallLoaded))for(var e=0;e<this.itemNum&&this.data[e];++e){var i=e+1;this["item_"+i].setVisible(!0),this["item_"+i].setData(this.data[e])}}}),ShopItemGroup.create=function(t,e,i){return new ShopItemGroup(t,e,i)},ModuleMgr.registerModule("ShopItemGroup",ShopItemGroup),UIUtils.RegisterPathTemple("ui/new/shop/ShopItemGroup.ui",ShopItemGroup),ShopItem=QPLayer.extend({uiPath:"ui/new/shop/ShopItem.ui",data:null,propInfo:null,ctor:function(t,e,i){this.data=t,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this._super()},initUI:function(){this.img_item.setVisible(!1),this.wgt_buy.setVisible(!1),this.btn_use.setVisible(!1),this.img_flag.setVisible(!1),this.img_flag_use.setVisible(!1),this.lab_name.setVisible(!1),this.left_time.setVisible(!1)},getLeftTime:function(t){if(t<0)return"永久";var e=t-DataMgr.timeCtrl.getServerTime();if(e<=0)return"剩余 0:0:0";var i=calDate(e),a=i[0],s=i[1],r=i[2],n=i[3];return a>0?"剩余 "+(a+1)+"天":"剩余 "+s+":"+r+":"+n},setData:function(t){var e=this,i=function(){e.left_time.setString(e.getLeftTime(t.end_time))};this.unscheduleAllCallbacks(),t=t||this.data,t&&"object"==typeof t&&(this.data=t,t.class_id&&(this.propInfo=DataMgr.propCtrl.getPropInfoById(t.class_id),this.propInfo&&(this.lab_name.setString(this.propInfo.name),this.data.day&&!this.data.midIcon&&this.lab_name.setString(this.propInfo.name+"("+this.data.day[0]+"天)"))),this.propInfo&&(this.img_item.loadTexture("item/"+this.propInfo.icon+".png",ccui.Widget.PLIST_TEXTURE),this.img_item.setVisible(!0)),t.is_own_prop&&(t.is_used?(this.img_flag_use.setVisible(!0),this.btn_use.setVisible(!1)):(this.img_flag_use.setVisible(!1),this.btn_use.setVisible(!0)),this.left_time.setVisible(!0),t.end_time&&t.end_time!=-1?t.end_time>0&&(this.left_time.setString(this.getLeftTime(t.end_time)),this.schedule(i,1,null,1)):this.left_time.setString("永久")),t.money_type&&"room_card"==t.money_type[0]&&this.img_currency_type.loadTexture(GetRealPath("res/uires/new/common/chaye.png")),t.money_type&&"stone"==t.money_type[0]&&this.img_currency_type.loadTexture(GetRealPath("res/uires/new/common/zuanshi.png")),this.lab_name.setVisible(t.money_type),this.img_currency_type.setVisible(t.money_type),this.btn_buy.setVisible(t.money_type),t.money?(this.lab_money.setString(t.money[0]),this.lab_money.setVisible(!0)):this.lab_money.setVisible(!1),this.setOtherData())},setOtherData:function(){this.data&&(this.data.midIcon&&(this.wgt_buy.setVisible(!1),this.btn_use.setVisible(!1),this.img_item.y=132,this.sp9_black_bg.y=129,this.lab_name.y=55),this.propInfo.position==PROP_TYPES.GUN&&this.data.class_id!=DEFUALT_USED_ID.GUN_ID&&(this.img_item.x=109,this.img_item.y=133,this.img_item.setScale(1)),this.data.ob_type&&(this.img_flag.setVisible(!0),this.img_flag.loadTexture(GetRealPath("res/uires/new/shop/tip_"+this.data.ob_type+".png"))))},onTouched:function(){this.tap_btn_buy()},tap_btn_buy:function(t){var e=this.data;e.money_type&&ModuleMgr.runDlg("MsgBuyPropConfirm",e,null,null)},tap_btn_use:function(){var t=this.data;this.propInfo&&t.is_own_prop&&ModuleMgr.showConfirmCancelMsg("是否使用"+this.propInfo.name+"("+(this.propInfo.position==PROP_TYPES.HEAD?"头像":" ")+")?",function(){t.class_id==DEFUALT_USED_ID.HEAD_ID?ME_D.send_message(CMD_ITEM_OPER,{oper:"take_off",position:PROP_TYPES.HEAD,game_type:GAME_TYPE}):ME_D.send_message(CMD_ITEM_OPER,{oper:"put_on",class_id:t.class_id,game_type:GAME_TYPE})})},onExit:function(){this.unscheduleAllCallbacks(),this._super()}}),ShopItem.create=function(t,e,i){return new ShopItem(t,e,i)},ModuleMgr.registerModule("ShopItem",ShopItem),UIUtils.RegisterPathTemple("ui/new/shop/ShopItem.ui",ShopItem),RechargeDlg=QPDlg.extend({uiPath:"ui/new/recharge/RechargeDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.momeyList=[10,200,375,1300,2100,4500],this.cardList=[10,200,1500,6e3,14e3,35e3],this.giveList=[0,50,0,0,0,0];var t=this.data&&this.data.is_zuanshi;t&&(this.momeyList=[10,30,50,100,200],this.cardList=[100,300,500,1e3,2e3],this.giveList=[0,0,0,0,0]);for(var e=0;e<this.momeyList.length;e++){var i=e+1,a=this["item_"+i];if(a){var s={};s.iconPath=GetRealPath("res/uires/new/recharge/cy_lv"+i+".png"),t&&(s.iconPath=GetRealPath("res/uires/new/recharge/zuanshi"+i+".png")),s.cardNum=this.cardList[e],s.money=this.momeyList[e],s.give=this.giveList[e]||0,s.is_zuanshi=t,a.setData(s)}}}}),RechargeDlg.create=function(t,e,i){return new RechargeDlg(t,e,i)},ModuleMgr.registerModule("RechargeDlg",RechargeDlg),RechargeItem=QPLayer.extend({uiPath:"ui/new/recharge/RechargeItem.ui",isControlNode:!0,data:null,ctor:function(t,e,i){this.data=t,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},setData:function(t){if(this.data=t,t){var e=t.iconPath,i=t.cardNum||0,a=t.give||0,s=t.money||6,r=t.is_zuanshi;e&&this.icon_card.loadTexture(e);var n=i;n+=r?"钻石":"茶叶",this.lab_num.setString(n),0==a?this.grp_give.setVisible(!1):(this.grp_give.setVisible(!0),this.setText("lab_give",a)),this.lab_money.setString(s)}},tap_btn_recharge:function(){if(this.data){if(!DataMgr.accountCtrl.isBindUserCode())return ModuleMgr.showConfirmCancelMsg("未实名认证玩家不能充值，\n点击确定前往认证",function(){ModuleMgr.runDlg("UserCodeDlg")});var t=this.data.money||6,e=this.data.cardNum+(this.data.give||0);this.data.is_zuanshi?HEEPAY_PAY_WEB(t,e,"stone"):GAME_PAY_TYPE==GAME_PAY_TYPE_JTPAY?ModuleMgr.runDlg("RechangeDlg",t,null,null):HEEPAY_PAY_WEB(t,e)}}}),RechargeItem.create=function(t,e,i){return new RechargeItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/recharge/RechargeItem.ui",RechargeItem),RechangeDlg=QPDlg.extend({uiPath:"ui/new/recharge/RechangeDlg.ui",payType:0,payMoney:[6,30,68,128,328,648],userCode:"10210372",userAppid:"20170303171424262044",keyString:"238ccd182fbd8d52e7dc67127ce68564",ivString:"54c28d536fb54769",ctor:function(t,e,i){this.payType=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i),GAME_TYPE==GAME_TYPE_WZ&&(this.userCode="10211074",this.userAppid="20170413171630227041",this.keyString="549cc4e82fa4a75f71c2162c474afb30",this.ivString="940aabc8e46f579b"),GAME_TYPE==GAME_TYPE_LS&&(this.userCode="10211074",this.userAppid="20170612151336846359",this.keyString="2c0c6ded05dcad313bd7851223b5bfdf",this.ivString="1007f4ef54daa42f"),GAME_TYPE==GAME_TYPE_DD&&(this.userCode="10211074",this.userAppid="20170612151303846273",this.keyString="cf297c88c5951eaa26df13d4d4aece1e",this.ivString="afa5666896215b52"),GAME_TYPE==GAME_TYPE_Q8&&(this.userCode="10211074",this.userAppid="20170612151408846454",this.keyString="f29ecb0a70e48c156bafa33f8904cdb5",this.ivString="46f98ae79a8bfe52"),GAME_TYPE==GAME_TYPE_DZ&&(this.userCode="10211074",this.userAppid="20170612151350846400",this.keyString="758663b68af78ec0bd0ba8c79189d26d",this.ivString="9e591895dad0c36e"),GAME_TYPE==GAME_TYPE_QL&&(this.userCode="10211074",this.userAppid="20170612151459846595",this.keyString="a323adcc4575dae2b40b5bdfa59bbb56",this.ivString="61b315a4dcff214a"),isGp()&&(this.userCode="10211074",this.userAppid="20170502202200400082",this.keyString="7545083e7ca115122b76419d78af6070",this.ivString="6c70d864f62b0272")},onLoaded:function(){},get_order:function(t,e){var i={};this.moeny=t,i.p3_money=t,i.p1_usercode=this.userCode,i.p5_notifyurl="unknow",i.p4_returnurl="unknow",i.ownMoney=ME_D.get_user().room_card,0==i.ownMoney&&(i.ownMoney="0.0"),i.extendUid=ME_D.get_user().extend_uid||"unknow",i.userName=ME_D.get_user().name,i.userRid=ME_D.get_user().rid,i.userUid=ME_D.get_user().account_uid,i.detail=GAME_TYPE;var a=GAME_WEB_PORT;isGp()&&GAME_TYPE!=GAME_TYPE_QQ&&(a=":1338");var s={method:"POST",timeout:5e3,url:GAME_WEB_URL+a+"/apijftpay/ApiRequestSign",data:JSON.stringify(i)},r=this;ModuleMgr.showWaitMsg("获取订单中",0),HttpNetworkRequest(s,function(t,i){ModuleMgr.removeWaitMsg(),console.log(i);var a=ConvertToJson(i);return a.ret==-1?ModuleMgr.showTipMsg(a.error):(a.userCode=r.userCode,a.userAppid=r.userAppid,a.keyString=r.keyString,a.ivString=r.ivString,void e(JSON.stringify(a)))})},tap_btn_weixin:function(t){var e=this,i=function(t){platform.pay(e.moeny,3,t)};this.get_order(this.payMoney[this.payType-1],i)},tap_btn_zifubao:function(t){var e=this,i=function(t){platform.pay(e.moeny,4,t)};this.get_order(this.payMoney[this.payType-1],i)}}),RechangeDlg.create=function(t,e,i){return new RechangeDlg(t,e,i)},ModuleMgr.registerModule("RechangeDlg",RechangeDlg),NewClubApplyList=QPDlg.extend({uiPath:"ui/new/club/NewClubApplyList.ui",listView_item:null,applyList:[],limitNum:5,maxCount:0,curPageIndex:0,ctor:function(t,e,i){this.data=t,this.listView_item=NewClubApplyListItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.getApplyList(this.curPageIndex);var t=this;t.addListener("GetUnionApplyedListSucces",function(e){var i=e.getUserData();t.applyList=i.map_list||[],t.refreshApplyList()})},getApplyList:function(t){var e=this;t=t||e.curPageIndex;var i=t*e.limitNum;this.maxCount=DataMgr.clubCtrl.clubApplyCount||0,ME_D.send_message(CMD_UNION_MESSAGE,"get_union_applyed_list",{game_type:GAME_TYPE,offset:i,limit_num:e.limitNum})},refreshApplyList:function(){if(0==this.applyList.length)this.lab_null.setVisible(!0),this.listView.setVisible(!1);else{this.lab_null.setVisible(!1),this.listView.setVisible(!0),this.maxCount=DataMgr.clubCtrl.clubApplyCount||0,this.refreshList({name:"listView",list:this.applyList,async:!0});var t=Math.ceil(this.maxCount/this.limitNum);t=0==t?1:t,this.lab_page.setString(this.curPageIndex+1+"/"+t)}},tap_btn_close:function(){QPDlg.prototype.tap_btn_close.call(this),cc.eventManager.dispatchCustomEvent("ShowNoticeInput")},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getApplyList(this.curPageIndex))},tap_btn_next_page:function(){var t=!1;if(this.maxCount!=DataMgr.clubCtrl.clubApplyCount?(this.curPageIndex+1)*this.limitNum<DataMgr.clubCtrl.clubApplyCount?t=!0:DataMgr.clubCtrl.clubApplyCount%this.limitNum==0&&this.curPageIndex>0&&this.curPageIndex--:t=!0,t){if(this.curPageIndex>=Math.floor((this.maxCount-1)/this.limitNum))return;this.curPageIndex++}this.getApplyList(this.curPageIndex)}}),NewClubApplyList.create=function(t,e,i){return new NewClubApplyList(t,e,i)},ModuleMgr.registerModule("NewClubApplyList",NewClubApplyList),NewClubApplyListItem=QPListItem.extend({uiPath:"ui/new/club/NewClubApplyListItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("AgreeApplySucces",function(e){var i=e.getUserData();t.calAgree(i.rid)}),t.addListener("RefuseApplySucces",function(e){var i=e.getUserData();t.calRefuse(i.rid)})},setData:function(t){t&&(this.data=t,this.img_agreeed.setVisible(!1),this.img_refuseed.setVisible(!1),this.grp_agree.setVisible(!0),this.grp_refuse.setVisible(!0),this.item_head.setData({url:t.head_icon}),this.lab_name.setString(toDecodeURIComponent(t.name)))},tap_btn_agree:function(t){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"agree_apply",{game_type:GAME_TYPE,rid:this.data.rid})},calAgree:function(t){this.data&&this.data.rid==t&&(this.img_agreeed.setVisible(!0),this.grp_agree.setVisible(!1),this.grp_refuse.setVisible(!1))},tap_btn_refuse:function(){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"refuse_apply",{game_type:GAME_TYPE,rid:this.data.rid})},calRefuse:function(t){this.data&&this.data.rid==t&&(this.img_refuseed.setVisible(!0),this.grp_agree.setVisible(!1),this.grp_refuse.setVisible(!1))}}),NewClubApplyListItem.create=function(t,e,i){return new NewClubApplyListItem(t,e,i)},ModuleMgr.registerModule("NewClubApplyListItem",NewClubApplyListItem),NewClubChatItem=QPLayer.extend({uiPath:"ui/new/club/NewClubChatLeft.ui",chatData:null,bolLeft:!0,ctor:function(t,e){t=t||this.uiPath,UILayer.prototype.ctor.call(this,t,e)},onLoaded:function(){this.lab_content.ignoreContentAdaptWithSize(!1)},setData:function(t){if(this.chatData=t,ME_D.get_rid()==t.send_rid){this.head.setData({url:ME_D.get_user().headimgurl});var e=DataMgr.propCtrl.getHeadPropInfo(),i=e?e.icon:null;this.head.setFrame(i)}else{var a=DataMgr.clubCtrl.getMemberByRid(t.send_rid);a&&a.headimgurl&&this.head?(this.head.setData({url:a.headimgurl}),this.head.setFrame(a.extra_data?a.extra_data.head:null)):(this.head.setData({url:t.headimgurl}),this.head.setFrame(t.extra_data?t.extra_data.head:null))}var s=DataMgr.clubCtrl.calChatData(t);this.lab_name.setString(s.name+" "+s.time||""),this.lab_content.setString(s.content),this.lab_content.formatText();var r=this.lab_content.getContentSize(),n=this.lab_content.getVirtualRendererSize();if(n.width=n.width+50,n.height=n.height+20,n.width=Math.max(n.width,100),n.height=Math.max(n.height,90),!this.bolLeft)if(n.width>=r.width&&n.width<this.bg.getContentSize().width)n.width=this.bg.getContentSize().width;else if(n.width<=r.width){var o=this.lab_content.getPositionX()+r.width-n.width+50;this.lab_content.setPositionX(o)}this.bg.setContentSize(n),this.btn_touch.setContentSize(n);var c=this.getContentSize();if(c.height=n.height+45,c.height=Math.max(c.height,70),this.setContentSize(c),this.grp_container.setPositionY(c.height-this.grp_container.getContentSize().height),t.chat_info&&t.chat_info.send_content&&"f"==t.chat_info.send_content[0]){var l=t.chat_info.send_content.slice(1);this.img_chat_face.loadTexture(GetRealPath("res/uires/face/"+l+".png")),this.lab_content.setVisible(!1)}else this.img_chat_face.setVisible(!1)},tap_btn_touch:function(){if(this.chatData)if(this.chatData.chat_type==CHAT_TYPE_OPEN_DESK){var t=this.chatData.chat_info.desk_idx,e=DataMgr.clubCtrl.getMyClub(),i="",a="";e&&(i=e.match_rid,a=e.rid);var s=GetGameTypeByRoomId(t);ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:s,desk_idx:t,union_rid:a,match_rid:i})}else if(this.chatData.chat_type==CHAT_TYPE_SHARE_SCORE){var r=function(t){t&&t.lists&&ModuleMgr.showRecordDetailDlg(t.lists[0])},n=ConvertToJson(this.chatData.chat_info.record_detail),o=n.game_type||GAME_TYPE;DataMgr.recordCtrl.getOneRecord(n.rid,r,o)}}}),NewClubChatItem.create=function(t,e){return new NewClubChatItem(t,e)},ModuleMgr.registerModule("NewClubChatItem",NewClubChatItem),NewClubChatLeft=NewClubChatItem.extend({uiPath:"ui/new/club/NewClubChatLeft.ui"}),NewClubChatLeft.create=function(t,e){return new NewClubChatLeft(t,e)},ModuleMgr.registerModule("NewClubChatLeft",NewClubChatLeft),NewClubChatRight=NewClubChatItem.extend({uiPath:"ui/new/club/NewClubChatRight.ui",bolLeft:!1}),NewClubChatRight.create=function(t,e){return new NewClubChatRight(t,e)},ModuleMgr.registerModule("NewClubChatRight",NewClubChatRight),NewClubCreateDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubCreateDlg.ui",curTag:0,costNum:0,searchList:[],ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("CreateUnionSucces",function(e){t.close()}),t.addListener("RecommendUnionSucces",function(e){var i=e.getUserData();t.searchList=i.union_list||[],t.refreshSeachList()}),t.addListener("SearchUnionSucces",function(e){var i=e.getUserData();t.searchList=i.union_list||[],t.refreshSeachList(),0==t.searchList.length&&ModuleMgr.showTipMsg("找不到该好友圈！")}),this.addListener(EVENT_NEW_CLUB_DLG_ITEM_CLICK,function(e){var i=e.getUserData();i>NEW_CLUB_MENU_ITEM_ID_SEARCH||i<NEW_CLUB_MENU_ITEM_ID_CTREATE||(t.dealShowMenuItem(i),t.selectTag(i))});var e=CsvMgr.getDataWithFile("union");e&&(this.costNum=(e[GAME_TYPE+":create"]||{}).cost||0),this.setText("lab_cost",this.costNum),this.scheduleOnce(function(){t.showTxtList(),t.selectTag(NEW_CLUB_MENU_ITEM_ID_CTREATE)},.25),this.input_search.setDelegate(this)},editBoxReturn:function(t){if("1"==(getQueryString("test")||"0")&&t==this.input_search){var e=this.input_search.getString();e&&ME_D.send_message(CMD_UNION_OPER,"search_union",{name:e,game_type:GAME_TYPE})}},showTxtList:function(){var t=[{id:NEW_CLUB_MENU_ITEM_ID_CTREATE,img_path:["btn_chuangjianhaoyouquan","btn_light_chuangjianhaoyouquan"],isSelect:!0},{id:NEW_CLUB_MENU_ITEM_ID_SEARCH,img_path:["btn_haoyouquansousuo","btn_light_haoyouquansousuo"]}];this.refreshList({name:"list_items",list:t,async:!0,itemCell:NewClubTxtItem}),this.list_items.setBounceEnabled(!1),this.list_items.setItemsMargin(3)},dealShowMenuItem:function(t){for(var e=this.list_items.getItems(),i=0;i<e.length;i++)e[i].getUserDataId()===t?e[i].setSelectStatus(!0):e[i].setSelectStatus(!1)},selectTag:function(t){this.curTag!=t&&(this.curTag=t,t===NEW_CLUB_MENU_ITEM_ID_CTREATE?(this.grp_create.setVisible(!0),this.grp_search.setVisible(!1)):t===NEW_CLUB_MENU_ITEM_ID_SEARCH&&(this.grp_create.setVisible(!1),this.grp_search.setVisible(!0),0==DataMgr.clubCtrl.applyList.length&&ME_D.send_message(CMD_UNION_MESSAGE,"get_apply_list",{game_type:GAME_TYPE}),ME_D.send_message(CMD_UNION_OPER,"recommend_union",{game_type:GAME_TYPE})))},refreshSeachList:function(){this.refreshList({name:"listView",list:this.searchList,async:!0,itemCell:NewClubItem})},tap_btn_create_club:function(){var t=this.input_name.getString(),e=this.input_weixin.getString();return t?this.costNum>ME_D.get_user().room_card?ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！"):void ME_D.send_message_waiting(CMD_UNION_OPER,"create_union",{name:t,wechat:e,game_type:GAME_TYPE}):ModuleMgr.showTipMsg("好友圈名字不能是空！")},tap_btn_search:function(t){var e=this.input_search.getString();return e?void ME_D.send_message(CMD_UNION_OPER,"search_union",{name:e,game_type:GAME_TYPE}):ModuleMgr.showTipMsg("名字不能是空！")}}),NewClubCreateDlg.create=function(t,e,i){return new NewClubCreateDlg(t,e,i)},ModuleMgr.registerModule("NewClubCreateDlg",NewClubCreateDlg),NewClubDetailsDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubDetailsDlg.ui",isTouchClose:!0,data:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){if(this.data){var t=this.data;this.item_head.setData({url:t.head_icon}),this.lab_club_name.setString(toDecodeURIComponent(t.name)),this.setText("lab_lv",t.lv),this.setText("lab_active",t.all_join),this.setText("lab_people",t.union_mem_num+"/"+DataMgr.clubCtrl.getMaxClubPeople(t.lv)),this.lab_notice.setString(t.apply_notice||"无");
}}}),NewClubDetailsDlg.create=function(t,e,i){return new NewClubDetailsDlg(t,e,i)},ModuleMgr.registerModule("NewClubDetailsDlg",NewClubDetailsDlg),NewClubDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubDlg.ui",curTag:0,msgLayer:null,mgrLayer:null,matchLayer:null,ctor:function(t,e,i){QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("UnionExitSucces",function(e){t.close()}),t.addListener("UnionDissolveSucces",function(e){t.updateExitClubItemImg()}),t.addListener("AgreeApplySucces",function(e){t.checkRedPoint()}),t.addListener("RefuseApplySucces",function(e){t.checkRedPoint()}),this.addListener(EVENT_NEW_CLUB_DLG_ITEM_CLICK,function(e){var i=e.getUserData();if(!(i>NEW_CLUB_MENU_ITEM_ID_TUICHU||i<NEW_CLUB_MENU_ITEM_ID_XINXI_SECOND)){if(i===NEW_CLUB_MENU_ITEM_ID_GUANLI){var a=DataMgr.clubCtrl.getSelfInfo();if(!a)return ModuleMgr.showTipMsg("权限不足!");if(a.position!==UNION_POSITION_MASTER&&a.position!==UNION_POSITION_ASSISTANT)return ModuleMgr.showTipMsg("权限不足!")}else if(i===NEW_CLUB_MENU_ITEM_ID_SAIZHI&&!IS_OPEN_MATCH)return ModuleMgr.showTipMsg("此功能暂未开放");t.dealShowMenuItem(i),t.selectTag(i)}}),this.scheduleOnce(function(){t.showTxtList(),t.selectTag(NEW_CLUB_MENU_ITEM_ID_XINXI_SECOND)},.3),this.checkRedPoint(),this.scheduleUpdate()},update:function(t){QPLayer.prototype.update.call(this,t),this.setDissolveTime()},updateExitClubItemImg:function(){for(var t=this.get_exit_img_path(),e=this.list_items.getItems(),i=0;i<e.length;i++)if(e[i].getUserDataId()===NEW_CLUB_MENU_ITEM_ID_TUICHU){e[i].loadImgPath([t]);break}},get_exit_img_path:function(){var t="btn_tuichu",e=DataMgr.clubCtrl.getSelfInfo(),i=DataMgr.clubCtrl.curClubData;if(e){var a=e.position===UNION_POSITION_MASTER;a&&(t="btn_jiesanhaoyouquan",1==i.status&&(t="btn_quxiaojiesan"))}return t},showTxtList:function(){var t=[{id:NEW_CLUB_MENU_ITEM_ID_XINXI_SECOND,img_path:["btn_xinxi","btn_light_xinxi"],isSelect:!0},{id:NEW_CLUB_MENU_ITEM_ID_GUANLI,img_path:["btn_guanli","btn_light_guanli"]},{id:NEW_CLUB_MENU_ITEM_ID_SAIZHI,img_path:["btn_saizhi","btn_light_saizhi"]},{id:NEW_CLUB_MENU_ITEM_ID_FENXIANG,img_path:["btn_fenxiang"]},{id:NEW_CLUB_MENU_ITEM_ID_TUICHU,img_path:[this.get_exit_img_path()]}];this.refreshList({name:"list_items",list:t,async:!0,itemCell:NewClubTxtItem}),this.list_items.setBounceEnabled(!1),this.list_items.setItemsMargin(3)},dealShowMenuItem:function(t){if(t!==NEW_CLUB_MENU_ITEM_ID_FENXIANG&&t!==NEW_CLUB_MENU_ITEM_ID_TUICHU)for(var e=this.list_items.getItems(),i=0;i<e.length;i++)e[i].getUserDataId()===t?e[i].setSelectStatus(!0):e[i].setSelectStatus(!1)},checkRedPoint:function(){var t=DataMgr.clubCtrl.getApplyCount();t<=0?this.img_red_2&&this.img_red_2.setVisible(!1):this.img_red_2&&this.img_red_2.setVisible(!0),this.img_red_2&&this.img_red_2.setLocalZOrder(9999)},selectTag:function(t){var e=this;if(this.curTag=t,t==NEW_CLUB_MENU_ITEM_ID_XINXI_SECOND)e.mgrLayer&&e.mgrLayer.setVisible(!1),e.matchLayer&&e.matchLayer.setVisible(!1),e.msgLayer?(e.msgLayer.setVisible(!0),e.msgLayer.refreshUi()):ModuleMgr.createNode(NewClubMsg,null,e.grp_content,function(t){e.msgLayer=t,e.msgLayer.setVisible(!0)});else if(t==NEW_CLUB_MENU_ITEM_ID_GUANLI)e.msgLayer&&e.msgLayer.setVisible(!1),e.matchLayer&&e.matchLayer.setVisible(!1),e.mgrLayer?(e.mgrLayer.setVisible(!0),e.mgrLayer.refreshUi()):ModuleMgr.createNode(NewClubMgr,null,e.grp_content,function(t){e.mgrLayer=t,e.mgrLayer.setVisible(!0)});else if(t==NEW_CLUB_MENU_ITEM_ID_SAIZHI)e.msgLayer&&e.msgLayer.setVisible(!1),e.mgrLayer&&e.mgrLayer.setVisible(!1),e.matchLayer?(e.matchLayer.setVisible(!0),e.matchLayer.doSomethingShow()):ModuleMgr.createNode(NewClubMatch,null,e.grp_content,function(t){e.matchLayer=t,e.matchLayer.setVisible(!0)});else if(t===NEW_CLUB_MENU_ITEM_ID_FENXIANG)ModuleMgr.runDlg("NewClubShareDlg");else if(t===NEW_CLUB_MENU_ITEM_ID_TUICHU){var i=DataMgr.clubCtrl.getSelfInfo(),a=DataMgr.clubCtrl.curClubData;if(i){var s=i.position===UNION_POSITION_MASTER;s?1==a.status?ModuleMgr.showConfirmCancelMsg("确定取消解散好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"union_dissolve",{game_type:GAME_TYPE,is_cancel:1})}):ModuleMgr.showConfirmCancelMsg("确定解散好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"union_dissolve",{game_type:GAME_TYPE})}):ModuleMgr.showConfirmCancelMsg("确定退出好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"union_exit",{game_type:GAME_TYPE})})}}},setDissolveTime:function(){var t=DataMgr.clubCtrl.curClubData;if(!t||1!=t.status)return void this.txt_dissolve_time.setVisible(!1);var e=t.finish_time,i=e-DataMgr.timeCtrl.getServerTime(),a=calDate(i),s=a[0],r=a[1]+24*s,n=a[2],o=a[3];r=r<10?"0"+r:r,n=n<10?"0"+n:n,o=o<10?"0"+o:o;var c=r+":"+n+":"+o;this.txt_dissolve_time.setString(c),this.txt_dissolve_time.setVisible(!0)}}),NewClubDlg.create=function(t,e,i){return new NewClubDlg(t,e,i)},ModuleMgr.registerModule("NewClubDlg",NewClubDlg),NewClubItem=QPListItem.extend({uiPath:"ui/new/club/NewClubItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("ApplyUnionSucces",function(e){t.refreshStatus()})},setData:function(t){if(!t||!this.item_head)return void this.setVisible(!1);this.setVisible(!0),this.data=t;this.item_head.setData({url:t.head_icon}),this.lab_club_name.setString(toDecodeURIComponent(t.name)),this.lab_notice.setString(t.apply_notice||"无"),this.lab_people.setString(t.union_mem_num+"/"+DataMgr.clubCtrl.getMaxClubPeople(t.lv)),this.refreshStatus()},refreshStatus:function(){if(this.data){this.img_applyed.setVisible(!1),this.btn_apply.setVisible(!0);for(var t=!1,e=DataMgr.clubCtrl.applyList,i=0;i<e.length;i++)if(e[i]==this.data.rid){t=!0;break}t?(this.btn_apply.setVisible(!1),this.img_applyed.setVisible(!0)):this.btn_apply.setVisible(!0)}},getData:function(){return this.data},tap_item_head:function(){ModuleMgr.runDlg("NewClubDetailsDlg",this.data,null,null)},tap_btn_apply:function(){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"apply_union",{union_rid:this.data.rid,game_type:GAME_TYPE})}}),NewClubItem.create=function(t,e,i){return new NewClubItem(t,e,i)},ModuleMgr.registerModule("NewClubItem",NewClubItem),NewClubMassageItem=QPListItem.extend({uiPath:"ui/new/club/NewClubMassageItem.ui",isControl:!1,ismassage:!1,data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("AgreeApplySucces",function(e){var i=e.getUserData();t.calAgree(i.rid)}),t.addListener("RefuseApplySucces",function(e){var i=e.getUserData();t.calRefuse(i.rid)})},setData:function(t){t&&(this.data=t,this.grp_massage.setVisible(!1),this.grp_apply.setVisible(!1),this.grp_ctrBtn.setVisible(!1),this.item_head.setData({url:t.head_icon}),this.lab_name.setString(toDecodeURIComponent(t.name)))},tap_btn_agree:function(t){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"agree_apply",{game_type:GAME_TYPE,rid:this.data.rid})},calAgree:function(t){this.data&&this.data.rid==t&&(this.lab_agreeed.setVisible(!0),this.grp_agree.setVisible(!1),this.grp_refuse.setVisible(!1))},tap_btn_refuse:function(){this.data&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"refuse_apply",{game_type:GAME_TYPE,rid:this.data.rid})},calRefuse:function(t){this.data&&this.data.rid==t&&(this.lab_refuseed.setVisible(!0),this.grp_agree.setVisible(!1),this.grp_refuse.setVisible(!1))}}),NewClubMassageItem.create=function(t,e,i){return new NewClubMassageItem(t,e,i)},ModuleMgr.registerModule("NewClubMassageItem",NewClubMassageItem),NewClubMatch=QPLayer.extend({uiPath:"ui/new/club/NewClubMatch.ui",day:1,minScore:0,matchMoner:0,masterPer:0,cost:0,list_score_itme:null,limitNum:3,maxCount:0,curPageIndex:0,ctor:function(t,e,i){this.list_score_item=NewClubMatchListItem,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;this.doSomethingShow(),t.addListener("RefreshMatchList",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifiScoreSucces",function(t){t.getUserData()}),t.addListener("CreateMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("GetMatchInfoSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ContinueMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifyMatchCharSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("StopMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("CloseMatchSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifyMatchNameSucces",function(e){e.getUserData();t.refreshUi()}),this.list_score.setItemsMargin(5),this.scheduleUpdate()},doSomethingShow:function(){this.getMemRank(),this.refreshUi()},getMemRank:function(t){var e=this;t=t||e.curPageIndex;var i=t*e.limitNum;ME_D.send_message(CMD_UNION_MESSAGE,"member_money_list",{game_type:GAME_TYPE,offset:i,limit_num:e.limitNum})},refreshUi:function(){var t=DataMgr.clubCtrl.curClubData;t&&(this.grp_create.setVisible(!1),this.grp_normal.setVisible(!1),DataMgr.clubCtrl.bolMatchExist()?(this.grp_normal.setVisible(!0),this.refreshNormalGrp()):(this.grp_create.setVisible(!0),this.refreshCreateGrp()))},do_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();this.lab_notice.setString(i)}else if("begin"==t.name)this.lab_notice.setVisible(!1),this.input_notice.setString(this.lab_notice._text);else if("end"==t.name||"return"==t.name){var e=t.target;e.setString(""),this.lab_notice.setVisible(!0)}},do_inputCallBack:function(t){"began"==t.name&&this.input_notice&&this.input_notice._focusEvent()},refreshCreateGrp:function(){this.lab_notice&&this.lab_notice.setString("赛制组局，多重奖励，一起来玩吧"),this.refreshDay(),this.setPer(1)},refreshDay:function(){var t=CsvMgr.getDataWithFile("union"),e=0;t&&(e=(t[GAME_TYPE+":match"]||{}).cost||0),this.lab_create_day&&this.lab_create_day.setString(this.day),this.cost=this.day*e,this.lab_cost&&this.lab_cost.setString(this.cost)},tap_btn_sub_day:function(){return this.day<=1?void ModuleMgr.showTipMsg("赛制不能少于 1 天"):(this.day--,void this.refreshDay())},tap_btn_add_day:function(){this.day++,this.refreshDay()},setPer:function(t){this.masterPer=t;for(var e=0;e<=2;e++)this["ck_per_"+e]&&this["ck_per_"+e].setSelected(t==e)},OnSelectPer:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(7,1));this.setPer(e)}else"unselected"==t.name&&t.target.setSelected(!0)},tap_btn_create:function(){if(this.cost>ME_D.get_user().room_card)return ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！");var t=this.lab_notice.getString(),e=100;ME_D.send_message_waiting(CMD_UNION_OPER,"create_match",{name:t,game_type:GAME_TYPE,vaild_days:this.day,min_money:-999999,match_money:0,cost_ratio:e})},refreshNormalGrp:function(){var t=DataMgr.clubCtrl.matchData;if(t){this.lab_normal_notice.setString(t.name);var e=DataMgr.clubCtrl.getSelfInfo();e&&(e.position==UNION_POSITION_MASTER||e.position==UNION_POSITION_ASSISTANT)?this.grp_n_score_log.setVisible(!0):this.grp_n_score_log.setVisible(!1),this.refreshScoreList();var e=DataMgr.clubCtrl.getSelfInfo();e&&(this.lab_n_my_score.setString(e.money),this.lab_n_my_rank.setString(e.rank||0)),this.setDownTime()}},refreshScoreList:function(){var t=DataMgr.clubCtrl.clubSaiZhiList||[];this.maxCount=DataMgr.clubCtrl.clubSaiZhiCount||0;for(var e=0;e<t.length;e++){var i=t[e];t[e].sortNum=i.money}for(var e=0;e<t.length;e++){var i=t[e];i.rank=e+1+this.curPageIndex*this.limitNum}this.refreshList({name:"list_score",list:t,async:!0});var a=Math.ceil(this.maxCount/this.limitNum);a=0==a?1:a,this.lab_page.setString(this.curPageIndex+1+"/"+a)},tap_btn_n_score_log:function(){ModuleMgr.runDlg("NewClubScoreLogDlg")},tap_btn_n_match_change:function(){ModuleMgr.runDlg("NewClubModifiMatchDlg")},tap_end_list_score:function(t){if(this.list_score){var e=this.list_score.getItems(),i=e[t];if(i){var a=i.getData();ModuleMgr.runDlg("NewClubScoreDetailsDlg",a,null,null)}}},setDownTime:function(){var t=DataMgr.clubCtrl.matchData;if(t){var e=t.vaild_time,i=e-DataMgr.timeCtrl.getServerTime();if(i<0)return void this.lab_n_down_time.setString("本赛制结束");var a=calDate(i),s=a[0],r=a[1],n=a[2];a[3];this.lab_n_down_time.setString(s+"天"+r+"时"+n+"分")}},update:function(t){QPLayer.prototype.update.call(this,t)},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getMemRank(this.curPageIndex))},tap_btn_next_page:function(){this.curPageIndex>=Math.floor((this.maxCount-1)/this.limitNum)||(this.curPageIndex++,this.getMemRank(this.curPageIndex))}}),NewClubMatch.create=function(t,e,i){return new NewClubMatch(t,e,i)},ModuleMgr.registerModule("NewClubMatch",NewClubMatch),NewClubMatchListItem=QPListItem.extend({uiPath:"ui/new/club/NewClubMatchListItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},getData:function(){return this.data},showPosition:function(t){t||(t=this.data.position),this.lab_position.setString(UNION_POSITION_NAME_TABLE[t])},refreshUi:function(){var t=this.data;if(t)if(this.item_head.setData({url:t.headimgurl}),this.item_head.setFrame(t.extra_data?t.extra_data.head:null),this.lab_name.setString(toDecodeURIComponent(t.name)),this.showPosition(t.position),this.lab_num.setString(t.money),this.lab_rank.setString(t.rank),t.rank>0&&t.rank<4?(this.img_rank.loadTexture(GetRealPath("res/uires/new/club/"+t.rank+".png")),this.img_rank.setVisible(!0),this.lab_rank.setVisible(!1)):(this.lab_rank.setVisible(!0),this.img_rank.setVisible(!1)),this.setText("lab_id",t.account_uid),t.last_login_time>t.last_logout_time)this.lab_status.setString("在线"),this.lab_status.setColor(cc.color(0,255,0));else{var e=DataMgr.timeCtrl.getServerTime()-t.last_logout_time,i="",a=calDate(e);i=a[0]>0?"离线 "+a[0]+" 天":a[1]>0?"离线 "+a[1]+" 小时":a[2]>0?"离线 "+a[2]+" 分":"离线 1 分",this.lab_status.setString(i),this.lab_status.setColor(cc.color(112,128,144))}},setData:function(t){t&&(this.data=t,this.refreshUi())}}),NewClubMatchListItem.create=function(t,e,i){return new NewClubMatchListItem(t,e,i)},ModuleMgr.registerModule("NewClubMatchListItem",NewClubMatchListItem),NewClubMatchResultDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubMatchResultDlg.ui",listView_item:null,ctor:function(t,e,i){this.data=t,this.listView_item=NewClubMatchResultItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){for(var t=DataMgr.clubCtrl.clubMemberList||[],e=0;e<t.length;e++){var i=t[e];t[e].sortNum=i.money}t.sort(function(t,e){return t.sortNum<e.sortNum});for(var e=0;e<t.length;e++){var i=t[e];i.rank=e+1}this.refreshList({name:"listView",list:t,async:!0})}}),NewClubMatchResultDlg.create=function(t,e,i){return new NewClubMatchResultDlg(t,e,i)},ModuleMgr.registerModule("NewClubMatchResultDlg",NewClubMatchResultDlg),NewClubMatchResultItem=QPListItem.extend({uiPath:"ui/new/club/NewClubMatchResultItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},getData:function(){return this.data},refreshUi:function(){var t=this.data;t&&(this.item_head.setData({url:t.headimgurl}),this.item_head.setFrame(t.extra_data?t.extra_data.head:null),this.lab_name.setString(toDecodeURIComponent(t.name)),this.lab_num.setString(t.money),this.lab_rank.setString(t.rank))},setData:function(t){t&&(this.data=t,this.refreshUi())}}),NewClubMatchResultItem.create=function(t,e,i){return new NewClubMatchResultItem(t,e,i)},ModuleMgr.registerModule("NewClubMatchResultItem",NewClubMatchResultItem),NewClubMgr=QPLayer.extend({uiPath:"ui/new/club/NewClubMgr.ui",ctor:function(t,e,i){QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("LevelUpUnionSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifiScoreSucces",function(e){e.getUserData();t.refreshUi()}),t.addListener("ModifyCostRatioSucces",function(e){t.refreshUi()}),t.addListener("AppendMatchMoneySucces",function(e){t.refreshUi()}),t.addListener("ShowNoticeInput",function(e){e.getUserData();t.showInput()}),t.addListener("AgreeApplySucces",function(e){t.checkRedPoint()}),t.addListener("RefuseApplySucces",function(e){t.checkRedPoint()}),t.refreshUi(),t.checkRedPoint()},checkRedPoint:function(){var t=DataMgr.clubCtrl.getApplyCount();t<=0?this.img_apply_red&&this.img_apply_red.setVisible(!1):this.img_apply_red&&this.img_apply_red.setVisible(!0)},refreshUi:function(){var t=DataMgr.clubCtrl.curClubData;if(t){this.setText("lab_room_card1",ROOM_CARD_NAME),this.setText("lab_room_card2",ROOM_CARD_NAME),this.lab_money.setString(t.match_money),this.lab_normal_ratio.setString((t.cost_ratio||100)+"%");var e=t.lv,i=e+1,a=CsvMgr.getDataWithFile("union"),s=a&&a[GAME_TYPE+":"+e],r=a&&a[GAME_TYPE+":"+i];this.setText("txt_curlevel",e),s&&(this.setText("txt_curnum",s.max_num),this.setText("txt_curminister",s.leader_num),this.lab_cost.setString("X"+s.cost)),r?(this.setText("txt_nextlevel",i),this.setText("txt_nextnum",r.max_num),this.setText("txt_nextminister",r.leader_num),this.txt_nextlevel.setVisible(!0),this.txt_nextnum.setVisible(!0),this.txt_nextminister.setVisible(!0),this.txt_null.setVisible(!1)):(this.txt_nextlevel.setVisible(!1),this.txt_nextnum.setVisible(!1),this.txt_nextminister.setVisible(!1),this.txt_null.setVisible(!0));var n=DataMgr.clubCtrl.getSelfInfo();n&&(n.position==UNION_POSITION_MASTER||n.position==UNION_POSITION_ASSISTANT)?this.grp_bottom.setVisible(!0):this.grp_bottom.setVisible(!1)}},tap_btn_apply:function(){this.hideInput(),ModuleMgr.runDlg("NewClubApplyList")},tap_btn_levelup:function(){var t=DataMgr.clubCtrl.curClubData;if(t){var e=t.lv,i=null,a=CsvMgr.getDataWithFile("union");return a&&(i=a[GAME_TYPE+":"+e]||0),i&&i.cost>ME_D.get_user().room_card?ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！"):void ME_D.send_message_waiting(CMD_UNION_OPER,"level_up_union",{game_type:GAME_TYPE,lv:t.lv})}},tap_btn_change:function(){this.hideInput(),ModuleMgr.runDlg("NewClubModifiClubDlg")},do_apply_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();if(i.length>=20)return e.setString(i.substring(0,20)),ModuleMgr.showTipMsg("申请公告内容不能超过20个字！")}else if("end"==t.name||"return"==t.name){var e=t.target;if(DataMgr.clubCtrl.curClubData){var i=e.getString();DataMgr.clubCtrl.curClubData.apply_notice!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_apply_notice",{game_type:GAME_TYPE,apply_notice:i})}}},do_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();i.length>=50&&(i=i.substring(0,50),e.setString(i),ModuleMgr.showTipMsg("公告内容不能超过50个字！")),this.lab_notice.setString(i)}else if("begin"==t.name)this.lab_notice.setVisible(!1),this.input_notice.setString(this.lab_notice._text);else if("end"==t.name||"return"==t.name){var e=t.target;if(DataMgr.clubCtrl.curClubData){var i=e.getString();DataMgr.clubCtrl.curClubData.notice!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_notice",{game_type:GAME_TYPE,notice:i})}e.setString(""),this.lab_notice.setVisible(!0)}},hideInput:function(){},showInput:function(){},btn_share_match:function(){var t=DataMgr.clubCtrl.curClubData,e=getQueryString("guest")||0,i=getQueryString("test")||0,a=toDecodeURIComponent(t.name),s="["+a+"]好友圈,邀请您加入",r="点击申请加入["+a+"]好友圈";platform.share(s,r,SHARE_URL+"?game_type="+GAME_TYPE+"&test="+i+"&guest="+e+"&union_rid="+t.rid,0)}}),NewClubMgr.create=function(t,e,i){return new NewClubMgr(t,e,i)},ModuleMgr.registerModule("NewClubMgr",NewClubMgr),NewClubModifiMatchDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubModifiMatchDlg.ui",addDay:0,cost:0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("ContinueMatchSucces",function(e){t.refreshDay()}),t.addListener("StopMatchSucces",function(e){t.close()}),t.addListener("CloseMatchSucces",function(e){t.close()}),this.lab_notice.setString(DataMgr.clubCtrl.matchData.name),this.lab_notice.setVisible(!0),t.refreshDay()},refreshDay:function(){var t=DataMgr.clubCtrl.matchData;if(t){var e=t.vaild_time,i=e-DataMgr.timeCtrl.getServerTime();i=i<0?0:i;var a=calDate(i),s=a[0],r=a[1],n=a[2];this.lab_time.setString(this.addDay+s+"天"+r+"时"+n+"分");var o=0,c=CsvMgr.getDataWithFile("union");c&&(o=(c[GAME_TYPE+":match"]||{}).cost||0),this.cost=this.addDay*o,this.lab_cost&&this.lab_cost.setString(this.cost),DataMgr.clubCtrl.bolMatchOver()?this.lab_status.setString("停止"):this.lab_status.setString("进行中")}},tap_btn_time_sub:function(){return this.addDay<=0?ModuleMgr.showTipMsg("不能低于现在的时间"):(this.addDay--,void this.refreshDay())},tap_btn_add_sub:function(){this.addDay++,this.refreshDay()},do_notice:function(t){if("changed"==t.name){var e=t.target,i=e.getString();this.lab_notice.setString(i)}else if("begin"==t.name)this.lab_notice.setVisible(!1),this.input_notice.setString(this.lab_notice._text);else if("end"==t.name||"return"==t.name){var e=t.target;if(DataMgr.clubCtrl.curClubData){var i=e.getString();DataMgr.clubCtrl.curClubData.notice!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_match_name",{game_type:GAME_TYPE,name:i})}e.setString(""),this.lab_notice.setVisible(!0)}},tap_btn_stop_match:function(){return DataMgr.clubCtrl.bolMatchOver()?ModuleMgr.showTipMsg("赛制已经停止"):void ModuleMgr.showConfirmCancelMsg("赛制时间将被清零，确定停止赛制？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"stop_match",{game_type:GAME_TYPE})})},tap_btn_close_match:function(){ModuleMgr.showConfirmCancelMsg("积分榜将被清空，确定关闭赛制？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"close_match",{game_type:GAME_TYPE})})},tap_btn_sure:function(){if(this.cost>ME_D.get_user().room_card)return ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！");var t=this;this.addDay>0&&ModuleMgr.showConfirmCancelMsg("确定延长"+this.addDay+"天？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"continue_match",{game_type:GAME_TYPE,vaild_days:t.addDay}),t.addDay=0})},changeScore:function(t){if(t){var e=t.type||1,i=t.num||0;1==e?DataMgr.clubCtrl.matchData.min_money!=i&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_match_min_money",{game_type:GAME_TYPE,min_money:i}):2==e&&DataMgr.clubCtrl.matchData.match_money!=i&&ME_D.send_message_waiting(CMD_UNION_OPER,"append_match_money",{game_type:GAME_TYPE,match_money:i-DataMgr.clubCtrl.matchData.match_money})}},tap_btn_change_1:function(){DataMgr.clubCtrl.matchData&&ModuleMgr.showConfirmCancelMsg("确定延长7天？",function(){ME_D.send_message_waiting(CMD_UNION_OPER,"continue_match",{game_type:GAME_TYPE,vaild_days:7})})},tap_btn_change_2:function(){if(DataMgr.clubCtrl.matchData){var t={type:1,num:DataMgr.clubCtrl.matchData.min_money};ModuleMgr.runDlg("NewClubModifiSubDlg",t,null,null)}},tap_btn_change_3:function(){if(DataMgr.clubCtrl.matchData){var t={type:2,num:DataMgr.clubCtrl.matchData.match_money,noLower:!0};ModuleMgr.runDlg("NewClubModifiSubDlg",t,null,null)}},tap_btn_change_4:function(){if(DataMgr.clubCtrl.matchData){var t=100==DataMgr.clubCtrl.matchData.cost_ratio?50:100;ModuleMgr.showConfirmCancelMsg("确定把抵扣比例调整为 "+t+"% ?",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_cost_ratio",{game_type:GAME_TYPE,cost_ratio:t})})}}}),NewClubModifiMatchDlg.create=function(t,e,i){return new NewClubModifiMatchDlg(t,e,i)},ModuleMgr.registerModule("NewClubModifiMatchDlg",NewClubModifiMatchDlg),NewClubModifiClubDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubModifiClubDlg.ui",cost_ratio:100,cost_match_ratio:100,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("ModifiScoreSucces",function(e){var i=e.getUserData();t.changeMomey(i)}),t.addListener("ModifyCostRatioSucces",function(e){t.refreshUi()}),t.addListener("AppendMatchMoneySucces",function(e){t.refreshUi()}),t.refreshUi()},refreshUi:function(){var t=DataMgr.clubCtrl.curClubData;t&&(this.setText("lab_room_card1",ROOM_CARD_NAME),this.setText("lab_room_card2",ROOM_CARD_NAME),this.lab_money.setString(t.match_money),this.lab_club_ratio.setString((t.cost_ratio||100)+"%"),t.match_rid?(this.grp_match_ratio_btn.setVisible(!0),this.grp_match_ratio.setVisible(!0),this.lab_match_ratio.setString((t.cost_match_ratio||0)+"%"),this.lab_match_type_0&&this.lab_match_type_0.setVisible(!0),this.lab_match_type_1&&this.lab_match_type_1.setVisible(!0),this.lab_match_type_2&&this.lab_match_type_2.setVisible(!0),this.ck_match_type0&&this.ck_match_type0.setVisible(!0),this.ck_match_type50&&this.ck_match_type50.setVisible(!0),this.ck_match_type100&&this.ck_match_type100.setVisible(!0)):(this.grp_match_ratio_btn.setVisible(!1),this.grp_match_ratio.setVisible(!1),this.grp_match_ratio.setVisible(!1),this.lab_match_type_0&&this.lab_match_type_0.setVisible(!1),this.lab_match_type_1&&this.lab_match_type_1.setVisible(!1),this.lab_match_type_2&&this.lab_match_type_2.setVisible(!1),this.ck_match_type0&&this.ck_match_type0.setVisible(!1),this.ck_match_type50&&this.ck_match_type50.setVisible(!1),this.ck_match_type100&&this.ck_match_type100.setVisible(!1)),this.cost_ratio=DataMgr.clubCtrl.curClubData.cost_ratio,this.cost_match_ratio=DataMgr.clubCtrl.curClubData.cost_match_ratio,this.refreshCkRound())},changeMomey:function(t){if(t){var e=t.type||1,i=t.num||0;2==e&&DataMgr.clubCtrl.curClubData.match_money!=i&&ME_D.send_message_waiting(CMD_UNION_OPER,"append_match_money",{game_type:GAME_TYPE,match_money:i-DataMgr.clubCtrl.curClubData.match_money})}},tap_btn_change_money:function(){if(DataMgr.clubCtrl.curClubData){var t={type:2,num:DataMgr.clubCtrl.curClubData.match_money,noLower:!0};ModuleMgr.runDlg("NewClubModifiSubDlg",t,null,null)}},tap_btn_change_club_ratio:function(){if(DataMgr.clubCtrl.curClubData){var t=100;ModuleMgr.showConfirmCancelMsg("确定把普通抵扣比例调整为 "+t+"% ?",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_cost_ratio",{game_type:GAME_TYPE,cost_ratio:t,cost_match_ratio:DataMgr.clubCtrl.curClubData.cost_match_ratio})})}},refreshCkRound:function(){this.ck_type0.setSelected(0==this.cost_ratio),this.ck_type50.setSelected(50==this.cost_ratio),this.ck_type100.setSelected(100==this.cost_ratio),this.ck_match_type0.setSelected(0==this.cost_match_ratio),this.ck_match_type50.setSelected(50==this.cost_match_ratio),this.ck_match_type100.setSelected(100==this.cost_match_ratio)},setTypeNum:function(t){this.cost_ratio=t,this.refreshCkRound()},OnSelecType:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(7,3));this.setTypeNum(e)}else"unselected"==t.name&&t.target.setSelected(!0)},setMatchTypeNum:function(t){this.cost_match_ratio=t,this.refreshCkRound()},OnSelecMatchType:function(t){if("selected"==t.name){var e=parseInt(t.target.name.substr(13,3));this.setMatchTypeNum(e)}else"unselected"==t.name&&t.target.setSelected(!0)},tap_btn_change_match_ratio:function(){if(DataMgr.clubCtrl.curClubData){var t=100;ModuleMgr.showConfirmCancelMsg("确定把赛制抵扣比例调整为 "+t+"% ?",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_cost_ratio",{game_type:GAME_TYPE,cost_match_ratio:t,cost_ratio:DataMgr.clubCtrl.curClubData.cost_ratio})})}},tap_btn_close:function(){QPDlg.prototype.tap_btn_close.call(this)}}),NewClubModifiClubDlg.create=function(t,e,i){return new NewClubModifiClubDlg(t,e,i)},ModuleMgr.registerModule("NewClubModifiClubDlg",NewClubModifiClubDlg),NewClubModifiScoreDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubModifiScoreDlg.ui",data:null,minNum:0,curNum:0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.refreshUi()},refreshUi:function(){if(this.data){var t=this.data;t.type||1;this.curNum=t.num||0,this.minNum=this.curNum,this.input_num.setString(this.curNum+"")}},calcNum:function(t){var e=this.input_num.getString();e=parseInt(e),NaN==e?(ModuleMgr.showTipMsg("输入不合法！"),this.curNum=0):this.curNum=e,this.curNum=this.curNum+t,this.input_num.setString(this.curNum)},tap_btn_sub_100:function(){this.calcNum(-100)},tap_btn_sub_10:function(){this.calcNum(-10)},tap_btn_add_100:function(){this.calcNum(100)},tap_btn_add_10:function(){this.calcNum(10)},tap_btn_sure:function(){var t=this.input_num.getString();if(t=parseInt(t),NaN==t)return ModuleMgr.showTipMsg("输入不合法！"),void this.close();var e={num:t,type:this.data.type};cc.eventManager.dispatchCustomEvent("ModifiScoreSucces",e),this.close()}}),NewClubModifiScoreDlg.create=function(t,e,i){return new NewClubModifiScoreDlg(t,e,i)},ModuleMgr.registerModule("NewClubModifiScoreDlg",NewClubModifiScoreDlg),NewClubModifiSubDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubModifiSubDlg.ui",data:null,minNum:0,curNum:0,noLower:!1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.refreshUi()},refreshUi:function(){if(this.data){var t=this.data,e=t.type||1;this.curNum=t.num||0,this.minNum=this.curNum,this.noLower=t.noLower||!1;var i="最低进入积分将更改为：";2==e&&(i="增加赛制基金为："),this.lab_title.setString(i),this.lab_num.setString(this.curNum)}},calcNum:function(t){return this.curNum=this.curNum+t,this.data&&2==this.data.type&&this.curNum-this.minNum>ME_D.get_user().room_card?(this.curNum=this.minNum+ME_D.get_user().room_card,ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！")):(this.noLower&&(this.curNum=this.curNum<this.minNum?this.minNum:this.curNum),this.curNum<0&&(this.curNum=0),void this.lab_num.setString(this.curNum))},tap_btn_sub_100:function(){this.calcNum(-100)},tap_btn_sub_10:function(){this.calcNum(-10)},tap_btn_add_100:function(){this.calcNum(100)},tap_btn_add_10:function(){this.calcNum(10)},tap_btn_sure:function(){var t={num:this.curNum,type:this.data.type};cc.eventManager.dispatchCustomEvent("ModifiScoreSucces",t),this.close()}}),NewClubModifiSubDlg.create=function(t,e,i){return new NewClubModifiSubDlg(t,e,i)},ModuleMgr.registerModule("NewClubModifiSubDlg",NewClubModifiSubDlg),NewClubMsg=QPLayer.extend({uiPath:"ui/new/club/NewClubMsg.ui",list_member_item:null,selectData:null,limitNum:4,maxCount:0,curPageIndex:0,ctor:function(t,e,i){this.data=t,this.list_member_item=NewClubMsgListItem,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.getMemList();var t=this;t.addListener("MemberListSucces",function(e){t.refreshUi()}),t.addListener("MemberKickSucces",function(e){t.grp_master_mgr.setVisible(!1),t.maxCount=DataMgr.clubCtrl.clubMemCount||0,t.curPageIndex>(t.maxCount-1)/t.limitNum&&t.curPageIndex--,t.getMemList()}),t.addListener("MemberAppointSucces",function(e){t.grp_master_mgr.setVisible(!1),t.getMemList()}),t.addListener("ClubDlgActionEnd",function(e){t.refreshUi()}),t.grp_master_mgr.setVisible(!1),this.list_member.setItemsMargin(5)},getMemList:function(t){var e=this;t=t||e.curPageIndex;var i=t*e.limitNum;ME_D.send_message(CMD_UNION_MESSAGE,"member_list",{game_type:GAME_TYPE,offset:i,limit_num:e.limitNum})},refreshUi:function(){var t=ModuleMgr.getDlg("NewClubDlg");if(t){this.grp_master_mgr.setVisible(!1);var e=DataMgr.clubCtrl.curClubData;if(e){this.refreshMemberList();var i=CsvMgr.getDataWithFileAndId("union",e.lv);i&&this.setText("lab_master_levelup",DataMgr.clubCtrl.getClubPositionNum(UNION_POSITION_ASSISTANT)+"/"+i.leader_num),this.lab_master_levelup.setVisible(i)}}},refreshMemberList:function(){var t=DataMgr.clubCtrl.clubMemberList||[];this.maxCount=DataMgr.clubCtrl.clubMemCount||0,this.refreshList({name:"list_member",list:t,async:!0});var e=Math.ceil(this.maxCount/this.limitNum);e=0==e?1:e,this.lab_page.setString(this.curPageIndex+1+"/"+e)},tap_begin_list_member:function(){this.grp_master_mgr.setVisible(!1)},tap_end_list_member:function(t){this.grp_master_mgr.setVisible(!1),this.selectData=null;var e=DataMgr.clubCtrl.getSelfInfo();if(e&&(e.position==UNION_POSITION_MASTER||e.position==UNION_POSITION_ASSISTANT)&&this.list_member){var i=this.list_member.getItems(),a=i[t];if(a&&(this.selectData=a.getData(),this.selectData.rid!=e.rid&&this.selectData.position!=e.position)){var s=a.convertToWorldSpace(),r=this.convertToNodeSpace(s);this.grp_master_mgr.setPositionY(r.y),e.position==UNION_POSITION_MASTER?(this.grp_master_levelup.setVisible(!0),this.grp_master_leveldown.setVisible(!0),this.grp_master_exit_club.setVisible(!0),this.selectData.position==UNION_POSITION_ASSISTANT&&this.grp_master_levelup.setVisible(!1),
this.selectData.position>UNION_POSITION_ASSISTANT&&this.grp_master_leveldown.setVisible(!1)):(this.grp_master_levelup.setVisible(!1),this.grp_master_leveldown.setVisible(!1),this.grp_master_exit_club.setVisible(!0));var n=[];n[0]=this.grp_master_levelup,n[1]=this.grp_master_leveldown,n[2]=this.grp_master_exit_club;for(var o=58,c=0,l=0;l<3;++l)n[l]&&n[l].isVisible()&&(c++,n[l].setPositionY(o),o-=39);this.scale_btn.setContentSize(cc.size(140,60*c)),this.grp_master_mgr.setVisible(!0)}}},tap_btn_master_levelup:function(){this.selectData&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"member_appoint",{game_type:GAME_TYPE,rid:this.selectData.rid,position:UNION_POSITION_ASSISTANT})},tap_btn_master_leveldown:function(){this.selectData&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"member_appoint",{game_type:GAME_TYPE,rid:this.selectData.rid,position:UNION_POSITION_NORMAL})},tap_btn_master_exit_club:function(){var t=this;t.selectData&&ModuleMgr.showConfirmCancelMsg("确定把 "+toDecodeURIComponent(t.selectData.name)+" 踢出好友圈？",function(){ME_D.send_message_waiting(CMD_UNION_MESSAGE,"member_kick",{game_type:GAME_TYPE,rid:t.selectData.rid})})},tap_grp_tap:function(){this.grp_master_mgr.setVisible(!1)},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getMemList(this.curPageIndex))},tap_btn_next_page:function(){this.curPageIndex>=Math.floor((this.maxCount-1)/this.limitNum)||(this.curPageIndex++,this.getMemList(this.curPageIndex))}}),NewClubMsg.create=function(t,e,i){return new NewClubMsg(t,e,i)},ModuleMgr.registerModule("NewClubMsg",NewClubMsg),NewClubMsgListItem=QPListItem.extend({uiPath:"ui/new/club/NewClubMsgListItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("MemberAppointSucces",function(e){t.refreshUi()})},getData:function(){return this.data},refreshUi:function(){var t=this.data;if(t)if(this.item_head.setData({url:t.headimgurl}),this.item_head.setFrame(t.extra_data?t.extra_data.head:null),this.lab_name.setString(toDecodeURIComponent(t.name)),this.lab_position.setString(UNION_POSITION_NAME_TABLE[t.position]),this.lab_round_num.setString(t.all_join),this.setText("lab_id",t.account_uid),t.last_login_time>t.last_logout_time)this.lab_status.setString("在线"),this.lab_status.setColor(cc.color(0,255,0));else{var e=DataMgr.timeCtrl.getServerTime()-t.last_logout_time,i="",a=calDate(e);i=a[0]>0?"离线 "+a[0]+" 天":a[1]>0?"离线 "+a[1]+" 小时":a[2]>0?"离线 "+a[2]+" 分":"离线 1 分",this.lab_status.setString(i),this.lab_status.setColor(cc.color(112,128,144))}},setData:function(t){t&&(this.data=t,this.refreshUi())}}),NewClubMsgListItem.create=function(t,e,i){return new NewClubMsgListItem(t,e,i)},ModuleMgr.registerModule("NewClubMsgListItem",NewClubMsgListItem),NewClubResultDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubResultDlg.ui",curPage:1,maxCount:0,curTag:0,scoreList:[],curPageIndex:0,pageNum:10,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("GetMatchLogListSucces",function(e){var i=e.getUserData();t.maxCount=i.count,t.scoreList=i.map_list.reverse(),t.refreshListView()}),t.addListener("GetUnionAutoPlayListSuccess",function(e){var i=e.getUserData();t.maxCount=i.count,t.scoreList=i.map_list||[],t.refreshListView()}),this.addListener(EVENT_NEW_CLUB_DLG_ITEM_CLICK,function(e){var i=e.getUserData();if(!(i>NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU||i<NEW_CLUB_MENU_ITEM_ID_ZHANJI_NORMAL)){if(i===NEW_CLUB_MENU_ITEM_ID_ZHANJI_SAIZHI){if(0==IS_OPEN_MATCH)return ModuleMgr.showTipMsg("此功能暂未开放"),void t.dealNoShowMenuItem(i);var a=DataMgr.clubCtrl.curClubData;if(!a)return void t.dealNoShowMenuItem(i);if(!DataMgr.clubCtrl.bolMatchExist())return ModuleMgr.showTipMsg("赛制尚未开启,无法查看战绩！"),void t.dealNoShowMenuItem(i)}t.dealShowMenuItem(i),t.selectTag(i)}}),this.scheduleOnce(function(){t.showTxtList()},.3)},showTxtList:function(){var t=[],e=NEW_CLUB_MENU_ITEM_ID_ZHANJI_NORMAL;this.data&&this.data.id===NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU?(e=NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU,t=[{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI_NORMAL,img_path:["btn_putong","btn_light_putong"]},{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI_SAIZHI,img_path:["btn_saizhi","btn_light_saizhi"]},{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU,img_path:["btn_kuaisuzuju","btn_light_kuaisuzuju"],isSelect:!0}]):t=[{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI_NORMAL,img_path:["btn_putong","btn_light_putong"],isSelect:!0},{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI_SAIZHI,img_path:["btn_saizhi","btn_light_saizhi"]},{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU,img_path:["btn_kuaisuzuju","btn_light_kuaisuzuju"]}],this.refreshList({name:"list_items",list:t,async:!0,itemCell:NewClubTxtItem}),this.list_items.setBounceEnabled(!1),this.list_items.setItemsMargin(3),this.selectTag(e)},dealShowMenuItem:function(t){for(var e=this.list_items.getItems(),i=0;i<e.length;i++)e[i].getUserDataId()===t?e[i].setSelectStatus(!0):e[i].setSelectStatus(!1)},dealNoShowMenuItem:function(t){for(var e=this.list_items.getItems(),i=0;i<e.length;i++)e[i].getUserDataId()===t&&e[i].setSelectStatus(!1)},selectTag:function(t){this.curTag=t,this.getResultList()},getResultList:function(){this.curTag==NEW_CLUB_MENU_ITEM_ID_ZHANJI_NORMAL?ME_D.send_message_waiting(CMD_UNION_MESSAGE,"get_union_log_list",{game_type:GAME_TYPE,offset:this.curPageIndex*this.pageNum+1}):this.curTag==NEW_CLUB_MENU_ITEM_ID_ZHANJI_SAIZHI?ME_D.send_message_waiting(CMD_UNION_MESSAGE,"get_match_log_list",{game_type:GAME_TYPE,offset:this.curPageIndex*this.pageNum+1,log_type:UNION_MATCH_LOG_USER_PLAY_SCORE}):this.curTag==NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"get_union_auto_play_log_list",{game_type:GAME_TYPE,offset:this.curPageIndex*this.pageNum+1})},refreshListView:function(){var t=this;0==t.scoreList.length?(t.lab_null.setVisible(!0),t.listView.setVisible(!1)):(t.lab_null.setVisible(!1),t.listView.setVisible(!0),t.refreshList({name:"listView",list:this.scoreList,async:!0,itemCell:NewClubResultListItem}));var e=Math.ceil(this.maxCount/this.pageNum);e=0==e?1:e,t.lab_page&&t.lab_page.setString(t.curPageIndex+1+"/"+e)},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getResultList())},tap_btn_next_page:function(){this.curPageIndex>=Math.floor(this.maxCount/this.pageNum)||(this.curPageIndex++,this.getResultList())}}),NewClubResultDlg.create=function(t,e,i){return new NewClubResultDlg(t,e,i)},ModuleMgr.registerModule("NewClubResultDlg",NewClubResultDlg),NewClubResultListItem=QPListItem.extend({uiPath:"ui/new/club/NewClubResultListItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},setData:function(t){if(t){this.data=t,this.txt_time&&this.txt_time.setString(parseTime(t.create_time));for(var e=ConvertToJson(t.log_detail),i=e.users||[],a=e.score,s=0,r=null,n=0,o=null,c=null,l=null,_=0;_<i.length;_++){var u=_+1,h=i[_];if(0===_&&(o=h,n=a["idx"+u]),h.rid){var g=a["idx"+u];g>s&&(s=g,r=h)}h.rid===ME_D.get_rid()&&(l=h,c=a["idx"+u])}r||(l?(r=l,s=c):o&&(r=o,s=n)),r&&(DataMgr.accountCtrl.setExtraData(r),this.item_head&&this.item_head.setData({url:r.headimgurl}),this.item_head.setFrame(r.extra_data?r.extra_data.head:null),this.lab_score&&this.lab_score.setString("+"+s),this.lab_name&&this.lab_name.setString(toDecodeURIComponent(r.name)))}},tap_btn_view:function(){if(this.data){var t=function(t){t&&t.lists&&ModuleMgr.showRecordDetailDlg(t.lists[0])},e=ConvertToJson(this.data.log_detail),i=e.game_type||GetGameTypeByRoomId(e.desk_no)||GAME_TYPE;DataMgr.recordCtrl.getOneRecord(e.rid,t,i)}}}),NewClubResultListItem.create=function(t,e,i){return new NewClubResultListItem(t,e,i)},ModuleMgr.registerModule("NewClubResultListItem",NewClubResultListItem);var ClubRoomDlg_send_time=0;NewClubRoomDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubRoomDlg.ui",curTag:0,todoChatList:[],newChatList:[],data:null,zhankai:!1,bolSendMsg:!1,lastChatRid:"",bolCanChatList:!1,noticeChatData:null,autoLayer:null,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.clearUi();var t=this;t.addListener("GetMatchInfoSucces",function(e){t.refreshUi()}),t.addListener("EnterUnionSucces",function(e){t.refreshUi();var i=DataMgr.clubCtrl.curClubData;i.match_rid&&ME_D.send_message(CMD_UNION_MESSAGE,"get_match_info",{game_type:GAME_TYPE})}),t.addListener("GetUnionChatListSucces",function(e){for(var i=e.getUserData(),a=i.map_list||[],s=0;s<a.length;++s)DataMgr.accountCtrl.setExtraData(a[s]);if(0!==a.length){t.lastChatRid=a[a.length-1].rid,t.bolCanChatList=!1,t.noticeChatData&&t.noticeChatData.chat_info&&t.noticeChatData.chat_info.send_content&&(t.todoChatList.push(t.noticeChatData),t.noticeChatData=null);for(var s=0;s<a.length;s++)t.todoChatList.push(a[s])}}),ME_D.send_message(CMD_UNION_OPER,"enter_union",{game_type:GAME_TYPE}),ME_D.send_message(CMD_UNION_MESSAGE,"get_union_chat_list",{game_type:GAME_TYPE}),t.addListener("MemberListSucces",function(e){e.getUserData();t.refreshUi();var i=DataMgr.clubCtrl.getSelfInfo();i&&(i.position!=UNION_POSITION_MASTER&&i.position!=UNION_POSITION_ASSISTANT||ME_D.send_message(CMD_UNION_MESSAGE,"get_union_applyed_list",{game_type:GAME_TYPE,offset:0,limit_num:1}))}),t.addListener("GetUnionApplyedListSucces",function(e){t.checkRedPoint()}),t.addListener("UnionChatSucces",function(e){var i=e.getUserData();DataMgr.accountCtrl.setExtraData(i),t.newChatList.push(i)}),this.addListener(EVENT_NEW_CLUB_DLG_ITEM_CLICK,function(e){var i=e.getUserData();i>NEW_CLUB_MENU_ITEM_ID_SAIZHI_ZUJU||i<NEW_CLUB_MENU_ITEM_ID_XINXI_BIG||t.selectTag(i)}),t.addListener("CreateMatchSucces",function(e){t.refreshUi()}),t.addListener("CloseMatchSucces",function(e){t.refreshUi()}),this.addListener("AgreeApplySucces",function(e){t.refreshUi()}),this.addListener("RefuseApplySucces",function(e){t.checkRedPoint()}),this.addListener("HideChatLayer",function(e){e.getUserData();t.hideChatLayer()}),this.addListener("SetsBoolSendMsg",function(e){e.getUserData();t.bolSendMsg=!0}),0==DataMgr.clubCtrl.clubMemberList.length?t.scheduleOnce(function(){ME_D.send_message(CMD_UNION_MESSAGE,"member_list",{game_type:GAME_TYPE,offset:0,limit_num:1})},.5):this.refreshUi(),this.showList.setBounceEnabled(!0),this.showList&&this.showList.setClippingType(ccui.Layout.CLIPPING_STENCIL),this.scheduleOnce(function(){t.showTxtList(),t.selectTag(NEW_CLUB_MENU_ITEM_ID_XINXI_BIG)},.25),this.scheduleUpdate()},showTxtList:function(){var t=[{id:NEW_CLUB_MENU_ITEM_ID_XINXI_BIG,img_path:["btn_xinxi","btn_light_xinxi"],isSelect:!0},{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI,img_path:["btn_zhanji"]},{id:NEW_CLUB_MENU_ITEM_ID_LIAOTIAN,img_path:["btn_liaotian"]},{id:NEW_CLUB_MENU_ITEM_ID_CLUB_ZUJU,img_path:["btn_haoyouquanzuju"]},{id:NEW_CLUB_MENU_ITEM_ID_QUICK_ZUJU,img_path:["btn_kuaisuzuju","btn_light_kuaisuzuju"]},{id:NEW_CLUB_MENU_ITEM_ID_SAIZHI_ZUJU,img_path:["btn_saizhizuju"],isShow:!DataMgr.clubCtrl.bolMatchOver()}];this.refreshList({name:"list_items",list:t,async:!0,itemCell:NewClubTxtItem}),this.list_items.setBounceEnabled(!1),this.list_items.setItemsMargin(3)},selectTag:function(t){if(this.curTag=t,t===NEW_CLUB_MENU_ITEM_ID_XINXI_BIG)this.autoLayer&&this.autoLayer.setVisible(!1),this.dealShowMenuItem(NEW_CLUB_MENU_ITEM_ID_XINXI_BIG,NEW_CLUB_MENU_ITEM_ID_QUICK_ZUJU),this.hideInput(),this.wgt_info.setVisible(!0),this.layer_chat.setVisible(!1);else if(t===NEW_CLUB_MENU_ITEM_ID_ZHANJI)ModuleMgr.runDlg("NewClubResultDlg");else if(t===NEW_CLUB_MENU_ITEM_ID_LIAOTIAN)this.autoLayer&&this.autoLayer.setVisible(!1),this.dealShowMenuItem(NEW_CLUB_MENU_ITEM_ID_XINXI_BIG,NEW_CLUB_MENU_ITEM_ID_QUICK_ZUJU),this.hideInput(),this.wgt_info.setVisible(!0),this.layer_chat.setVisible(!0);else if(t===NEW_CLUB_MENU_ITEM_ID_CLUB_ZUJU)this.createGame(!1);else if(t===NEW_CLUB_MENU_ITEM_ID_QUICK_ZUJU)if(this.wgt_info.setVisible(!1),this.layer_chat.setVisible(!1),this.dealShowMenuItem(NEW_CLUB_MENU_ITEM_ID_QUICK_ZUJU,NEW_CLUB_MENU_ITEM_ID_XINXI_BIG),this.autoLayer)this.autoLayer.setVisible(!0),this.autoLayer.refreshUi();else{var e=this;ModuleMgr.createNode(NewClubAuto,null,this.wgt_content,function(t){e.autoLayer=t,e.autoLayer.setVisible(!0)})}else t===NEW_CLUB_MENU_ITEM_ID_SAIZHI_ZUJU&&this.createGame(!0)},dealShowMenuItem:function(t,e){for(var i=this.list_items.getItems(),a=0;a<i.length;a++){var s=i[a].getUserDataId();s===t?i[a].setSelectStatus(!0):s===e&&i[a].setSelectStatus(!1)}},onExit:function(){DataMgr.clubCtrl.getMyClub()&&ME_D.send_message(CMD_UNION_OPER,"close_union",{game_type:GAME_TYPE}),QPDlg.prototype.onExit.call(this)},clearUi:function(){this.lab_clubname.setVisible(!1),this.lab_people.setVisible(!1)},hideInput:function(){this.input_chat.setVisible(!1),this.btn_send.setVisible(!1)},showInput:function(){this.input_chat.setVisible(!0),this.btn_send.setVisible(!0)},refreshUi:function(){this.checkRedPoint();var t=DataMgr.clubCtrl.curClubData;t&&(this.lab_clubname.setString(toDecodeURIComponent(t.name)),this.setText("lab_people",DataMgr.clubCtrl.getClubOnlineNum()+"/"+DataMgr.clubCtrl.getClubMemNum()),this.lab_clubname.setVisible(!0),this.lab_people.setVisible(!0),this.item_head.setData({url:t.head_icon}),this.item_head.setFrameNoVisible(),this.doShowMenuItem(NEW_CLUB_MENU_ITEM_ID_SAIZHI_ZUJU,!DataMgr.clubCtrl.bolMatchOver()))},doShowMenuItem:function(t,e){for(var i=this.list_items.getItems(),a=0;a<i.length;a++)i[a].getUserDataId()===t&&i[a].setVisible(e)},checkRedPoint:function(){var t=DataMgr.clubCtrl.getApplyCount();t<=0?this.img_msg_red&&this.img_msg_red.setVisible(!1):this.img_msg_red&&this.img_msg_red.setVisible(!0)},_onAddChat:function(){var t=this,e=null,i=!1;if(this.todoChatList.length>0&&(e=this.todoChatList[0],this.todoChatList.splice(0,1),i=!1),this.newChatList.length>0&&(e=this.newChatList[0],this.newChatList.splice(0,1),i=!0),e){var a=t.showList,s=NewClubChatLeft;e.send_rid==ME_D.get_rid()&&(s=NewClubChatRight),ModuleMgr.createNode(s,function(r){var n=s.create();n.anchorY=1,n.setData(e),n.setTouchEnabled(!0),i?a.pushBackCustomItem(n):a.insertCustomItem(n,0),t.lastChatRid==e.rid&&(t.bolCanChatList=!0);var o=a.getInnerContainerPosition();0==o.y||t.bolSendMsg?(t.bolSendMsg=!1,a.forceDoLayout(),a.jumpToBottom()):(a.forceDoLayout(),o.y=o.y-r.getContentSize().height-a.getItemsMargin(),a.setInnerContainerPosition(o))})}},update:function(t){QPDlg.prototype.update.call(this,t),this._onAddChat();var e=this.showList;if(e){var i=e.getInnerContainerPosition().y,a=e.getInnerContainerSize(),s=e.getContentSize();this.lastChatRid&&this.bolCanChatList&&a.height>s.height&&s.height-a.height-10>i&&(ME_D.send_message(CMD_UNION_MESSAGE,"get_union_chat_list",{game_type:GAME_TYPE,rid:this.lastChatRid}),this.lastChatRid="",this.bolCanChatList=!1)}},tap_btn_massage:function(t){this.hideInput(),ModuleMgr.runDlg("NewClubDlg")},tap_btn_send:function(t){var e=new Date;if(e.getTime()-ClubRoomDlg_send_time<4e3)return ModuleMgr.showTipMsg("发送太频繁，请稍后发送！");ClubRoomDlg_send_time=e.getTime();var i=this.input_chat.getString();if(!i)return void ModuleMgr.showTipMsg("发送消息不能为空！");var a=this,s=function(t){var e=!1;for(var s in t){var r=s,n=i.indexOf(r);if(n>-1){e=!0;break}}return e?ModuleMgr.showTipMsg("存在非法字符！"):(a.bolSendMsg=!0,ME_D.send_message(CMD_UNION_MESSAGE,"union_chat",{game_type:GAME_TYPE,send_content:i}),void a.input_chat.setString(""))};CsvMgr.getBannedWordMap(s)},createGame:function(t){if(0==DataMgr.gameCtrl.deskIdx){var e=DataMgr.clubCtrl.curClubData;if(!e)return;this.hideInput(),ModuleMgr.runDlg("NewCreateRoomDlg",{isClub:!0,clubData:e,isMatch:t},null,null)}else{var i=DataMgr.clubCtrl.getMyClub(),a="",s="";i&&(a=i.match_rid,s=i.rid);var r=GetGameTypeByRoomId(DataMgr.gameCtrl.deskIdx);ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:r,desk_idx:DataMgr.gameCtrl.deskIdx,union_rid:s,match_rid:a})}},showChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!0)},hideChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!1)}}),NewClubRoomDlg.create=function(t,e,i){return new NewClubRoomDlg(t,e,i)},ModuleMgr.registerModule("NewClubRoomDlg",NewClubRoomDlg),NewClubScoreLogDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubScoreLogDlg.ui",listView_item:null,maxCount:0,curPageIndex:0,sorceMap:[],sorceList:[],ctor:function(t,e,i){this.data=t,this.listView_item=NewClubScoreLogItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("GetMatchLogListSucces",function(e){var i=e.getUserData();t.maxCount=i.count,t.sorceList=i.map_list.reverse(),t.refreshScoreList()}),this.getLogList()},getLogList:function(){ME_D.send_message(CMD_UNION_MESSAGE,"get_match_log_list",{game_type:GAME_TYPE,offset:10*this.curPageIndex+1})},refreshScoreList:function(){var t=this;0==this.sorceList.length?(this.lab_null.setVisible(!0),this.listView.setVisible(!1)):(this.lab_null.setVisible(!1),this.listView.setVisible(!0),this.refreshList({name:"listView",list:t.sorceList,async:!0}));var e=Math.ceil(this.maxCount/10);e=0==e?1:e,this.lab_page.setString(t.curPageIndex+1+"/"+e)},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getLogList())},tap_btn_next_page:function(){this.curPageIndex>=Math.floor(this.maxCount/10)||(this.curPageIndex++,this.getLogList())}}),NewClubScoreLogDlg.create=function(t,e,i){return new NewClubScoreLogDlg(t,e,i)},ModuleMgr.registerModule("NewClubScoreLogDlg",NewClubScoreLogDlg),NewClubScoreLogItem=QPListItem.extend({uiPath:"ui/new/club/NewClubScoreLogItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},setData:function(t){if(t){this.data=t;var e=DataMgr.clubCtrl.getMemberByRid(t.user_rid)||{},i=e.name||"";i=toDecodeURIComponent(i);var a=DataMgr.timeCtrl.getServerTime()-t.create_time,s="",r=calDate(a);s=r[0]>0?"("+r[0]+"天前)":r[1]>0?"("+r[1]+"小时前)":r[2]>0?"("+r[2]+"分钟前)":"(1分钟前)";var n="";n="manger_score_change"==t.log_type?"● "+t.oper_name+" 将 "+i+" 的积分由 "+t.cur_value+" 更改为 "+(t.cur_value+t.step_value)+" "+s:"● "+i+"  比赛结束 积分由 "+t.cur_value+" 更改为 "+(t.cur_value+t.step_value)+" "+s,this.lab_txt.setString("[c0:0:0]"+n+"[/c]")}}}),NewClubScoreLogItem.create=function(t,e,i){return new NewClubScoreLogItem(t,e,i)},ModuleMgr.registerModule("NewClubScoreLogItem",NewClubScoreLogItem),NewClubShareDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubShareDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){cc.sys.isNative||"undefined"!=typeof MostOneJSApis||(this.btn_share_most&&this.btn_share_most.setVisible(!1),this.btn_share_wx.x+=50,this.btn_share_py.x-=50)},share:function(t,e){var i=DataMgr.clubCtrl.curClubData,a=getQueryString("guest")||0,s=getQueryString("test")||0;i||(i={},i.name="",cc.log(" error no club !!! "));var r=toDecodeURIComponent(i.name),n="["+r+"]好友圈,邀请您加入",o="点击申请加入["+r+"]好友圈";this.data&&this.data.open_from_main_layer&&(r=toDecodeURIComponent(ME_D.get_user().name),n="["+r+"]邀请您体验拱趴麻将",o="点击即刻体验拱趴麻将");var c=SHARE_URL;e==LOCATE_PLAFORM.MOSTONE&&(c="http://gongpa.5913yx.com/fjmj/","1"==isTestServer&&(c="http://test.gongpaa.com/fjmj/")),e==LOCATE_PLAFORM.MOSTONE?platform.share(n,o,c+"?game_type="+GAME_TYPE+"&test="+s+"&guest="+a+"&union_rid="+i.rid,t,SHARE_URL+"res/icon/invite3.png","",e):platform.share(n,o,c+"?game_type="+GAME_TYPE+"&test="+s+"&guest="+a+"&union_rid="+i.rid,t)},tap_btn_share_wx:function(){this.share(0,LOCATE_PLAFORM.WECHAT)},tap_btn_share_py:function(){this.share(1,LOCATE_PLAFORM.WECHAT)},tap_btn_share_most:function(){this.share(3,LOCATE_PLAFORM.MOSTONE)}}),NewClubShareDlg.create=function(t,e,i){return new NewClubShareDlg(t,e,i)},ModuleMgr.registerModule("NewClubShareDlg",NewClubShareDlg),NewClubScoreDetailsDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubScoreDetailsDlg.ui",listView_item:null,maxCount:0,curPageIndex:0,sorceMap:[],sorceList:[],ctor:function(t,e,i){this.data=t,this.listView_item=NewClubScoreDetailsItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){var t=this;t.addListener("ModifiScoreSucces",function(e){var i=e.getUserData();t.changeScore(i)}),t.addListener("ModifyMatchCharSucces",function(e){var i=e.getUserData();t.data=i,t.refreshTopInfo(),0==t.curPageIndex&&t.getLogList()}),t.addListener("GetMatchLogListSucces",function(e){var i=e.getUserData();t.maxCount=i.count,t.sorceList=i.map_list.reverse(),t.refreshScoreList()}),t.getLogList(),t.refreshTopInfo()},getLogList:function(){this.data&&this.data&&ME_D.send_message(CMD_UNION_MESSAGE,"get_match_log_list",{game_type:GAME_TYPE,offset:10*this.curPageIndex+1,rid:this.data.rid})},refreshTopInfo:function(){if(this.data){var t=this.data;this.item_head.setData({url:t.headimgurl}),this.item_head.setFrame(t.extra_data?t.extra_data.head:null),this.lab_name.setString(toDecodeURIComponent(t.name)),this.lab_score.setString(t.money)}},refreshScoreList:function(){var t=this;this.refreshList({name:"listView",list:t.sorceList,async:!0});var e=Math.ceil(this.maxCount/10);e=0==e?1:e,this.lab_page.setString(t.curPageIndex+1+"/"+e)},changeScore:function(t){if(t){t.type||1,t.num||0;t.num!=this.data.money&&ME_D.send_message_waiting(CMD_UNION_MESSAGE,"modify_match_char_money",{game_type:GAME_TYPE,rid:this.data.rid,step_value:t.num-this.data.money})}},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getLogList())},tap_btn_next_page:function(){this.curPageIndex>=Math.floor(this.maxCount/10)||(this.curPageIndex++,this.getLogList())}}),NewClubScoreDetailsDlg.create=function(t,e,i){return new NewClubScoreDetailsDlg(t,e,i)},ModuleMgr.registerModule("NewClubScoreDetailsDlg",NewClubScoreDetailsDlg),NewClubScoreDetailsItem=QPListItem.extend({uiPath:"ui/new/club/NewClubScoreDetailsItem.ui",data:null,ctor:function(t,e,i){QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},setData:function(t){if(t){this.data=t;var e=DataMgr.timeCtrl.getServerTime()-t.create_time,i="",a=calDate(e);i=a[0]>0?a[0]+"天前":a[1]>0?a[1]+"小时前":a[2]>0?a[2]+"分钟前":"1分钟前";var s="比赛";"manger_score_change"==t.log_type&&(s="调分"),this.lab_1.setString(s),this.lab_2.setString(i),this.lab_3.setString(t.step_value),this.lab_4.setString(t.cur_value+t.step_value)}},tap_btn_touch:function(){if(this.data){if("manger_score_change"==this.data.log_type)return void ModuleMgr.showTipMsg("比赛积分变动才可查询！");var t=function(t){t&&t.lists&&ModuleMgr.showRecordDetailDlg(t.lists[0])},e=ConvertToJson(this.data.log_detail),i=e.game_type||GAME_TYPE;DataMgr.recordCtrl.getOneRecord(e.rid,t,i)}}}),NewClubScoreDetailsItem.create=function(t,e,i){return new NewClubScoreDetailsItem(t,e,i)},ModuleMgr.registerModule("NewClubScoreDetailsItem",NewClubScoreLogItem),NewClubTxtItem=QPLayer.extend({uiPath:"ui/new/club/NewClubTxtItem.ui",userData:null,isSelect:!1,isShow:!0,isImg2CanShow:!1,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},loadImgPath:function(t){t&&"object"==typeof t&&(this.userData=this.userData||{},this.userData.img_path=t),t&&"string"==typeof t[0]&&this.img_1.loadTexture(GetRealPath("res/uires/new/club/"+t[0]+".png")),t&&"string"==typeof t[1]&&(this.img_2.loadTexture(GetRealPath("res/uires/new/club/"+t[1]+".png")),this.isImg2CanShow=!0)},setData:function(t){t&&(this.userData=t,this.loadImgPath(t.img_path),t.isSelect===!0&&this.setSelectStatus(t.isSelect),t.isShow===!1&&this.setVisible(!1))},getUserDataId:function(){var t=0;return this.userData&&(t=this.userData.id),t},onMenuItem:function(t){if("began"==t.name&&!this.isSelect){var e=0;this.userData&&(e=this.userData.id),cc.eventManager.dispatchCustomEvent(EVENT_NEW_CLUB_DLG_ITEM_CLICK,e)}},getSelect:function(){return this.isSelect},setSelectStatus:function(t){void 0!==t&&(this.isSelect=t,this.img_1.setVisible(!t),this.isImg2CanShow&&this.img_2.setVisible(t))}}),NewClubTxtItem.create=function(t,e,i){return new NewClubTxtItem(t,e,i)},ModuleMgr.registerModule("NewClubTxtItem",NewClubTxtItem),UIUtils.RegisterPathTemple("ui/NewClubTxtItem.ui",NewClubTxtItem),NewClubRecordDetailDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/new/club/NewClubRecordDetailDlg.ui",curLoadSubUiIdx:0,curCost:0,bolDlgAction:!1,ctor:function(t,e,i){t&&!t.gameType&&t.deskId&&(t.gameType=GetGameTypeByRoomId(t.deskId)||GAME_TYPE),this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e);var a=this;this.addListener("SUCCECES_ROOM_CREATE",function(t){a.close()})},onEnter:function(){QPDlg.prototype.onEnter.call(this)},getOwnerInfo:function(t){for(var e=t.desk_own_rid,i=ConvertToJson(t.record_detail),a=i.users,s=0;s<a.length;s++){var r=a[s];if(r.rid==e)return r}return null},onLoaded:function(){this.listView_item=NewClubRecordDetailItem;var t=this.data;if(this.setText("txt_num",t.deskId),this.setText("txt_round",t.round),this.setText("txt_time",parseTime(t.createTime+t.all_cost_time)),this.setText("txt_name",toDecodeURIComponent(t.ownerName)),this.refreshRank(this.data),this.data.needShare){var e=this,i=function(){e.doShareImg()};this.runAction(cc.sequence(cc.delayTime(.6),cc.callFunc(i))),this.rotation=this.rotation-90}},tap_btn_view:function(){var t=this.data.replayRecords;ModuleMgr.runDlg("RecordReplayDlg",t,null,null)},refreshRank:function(t){for(var e=[],i=0;i<t.players.length;i++){var a=t.players[i];a&&(a.round=t.round,a.sortNum=a.score,e.push(a))}for(var i=0;i<4;i++){var s=this["txt_name"+(i+1)],r=this["txt_score"+(i+1)],n=e[i];if(null!=n){var o=cutOffStr(n.name||"",10,!0);s.setString(o),r.setString(n.score)}else s.setString(""),r.setString("")}3==e.length?(this.txt_name2&&this.txt_name2.setPositionX(this.txt_name2.getPositionX()+20),this.txt_name3&&this.txt_name3.setPositionX(this.txt_name3.getPositionX()+40),this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+20),this.txt_score3&&this.txt_score3.setPositionX(this.txt_score3.getPositionX()+40)):2==e.length&&(this.txt_name1&&this.txt_name1.setPositionX(this.txt_name1.getPositionX()+40),this.txt_name2&&this.txt_name2.setPositionX(this.txt_name2.getPositionX()+80),this.txt_score1&&this.txt_score1.setPositionX(this.txt_score1.getPositionX()+40),this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+80));for(var c=this.data.replayRecords,l=GetGameTypeByRoomId(this.data.deskId)||GAME_TYPE,i=0;i<c.length;i++)c[i].game_type=l;this.refreshList({name:"listView",list:c,async:!0})},doShareImg:function(){var t="",e=this,i=function(){platform.shareImage(t,0),e.listView.setClippingType(ccui.Layout.CLIPPING_STENCIL)};this.listView.setClippingType(ccui.Layout.CLIPPING_SCISSOR),t=saveScreenShot(i)},tap_btn_share:function(){var t=this.data;if(cc.sys.isNative)if(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&null==this.data.needShare){var t=this.data;this.close(),t.needShare=!0,ModuleMgr.runDlg("NewClubRecordDetailDlg",t,null,null)}else this.doShareImg();else{var e=t.gameType+"_"+t.recordId;platform.share(SHARE_DETAIL_TITLE_DES(t),SHARE_DETAIL_DES(t),getShareUrl(0,e),0,SHARE_URL+"res/icon/record3.png")}},tap_btn_close:function(){this.close(),this.data.dlgType&&1==this.data.dlgType||(0==DataMgr.gameCtrl.deskIdx?ModuleMgr.enterEnterScene():(DataMgr.gameCtrl.deskIdx=0,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"leave_desk"})))}}),NewClubRecordDetailDlg.create=function(t,e,i){return new NewClubRecordDetailDlg(t,e,i)},ModuleMgr.registerModule("NewClubRecordDetailDlg",NewClubRecordDetailDlg),NewClubRecordDetailItem=QPLayer.extend({isControlNode:!0,uiPath:"ui/new/club/NewClubRecordDetailItem.ui",data:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},tap_btn_view:function(){var t=function(t){};DataMgr.gameCtrl.recordRid=this.data.rid,DataMgr.recordCtrl.getGameDetailRecord(this.data.rid,t,this.data.game_type)},setData:function(t){this.txt_rank.setString(t.idx),this.btn_view.setVisible("GameScene"!=g_scene.name),this.data=t;for(var e=t.cur_hu_types||[],i=(arrayToMap(e),0),a=0,s=0;s<4;s++){var r=t.users[s];r?(this["txt_score"+(s+1)].setString(r.score),i<r.score&&(i=r.score,a=s)):this["txt_score"+(s+1)].setString("")}3==t.users.length?(this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+20),this.txt_score3&&this.txt_score3.setPositionX(this.txt_score3.getPositionX()+40)):2==t.users.length&&(this.txt_score1&&this.txt_score1.setPositionX(this.txt_score1.getPositionX()+40),this.txt_score2&&this.txt_score2.setPositionX(this.txt_score2.getPositionX()+80))}}),NewClubRecordDetailItem.create=function(t,e,i){return new NewClubRecordDetailItem(t,e,i)},ModuleMgr.registerModule("NewClubRecordDetailItem",NewClubRecordDetailItem),UIUtils.RegisterPathTemple("ui/NewClubRecordDetailItem.ui",NewClubRecordDetailItem),NewClubAutoWinnerDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubAutoWinnerDlg.ui",listView_item:null,winnerList:[],limitNum:10,maxCount:0,curPageIndex:0,ctor:function(t,e,i){this.data=t,this.listView_item=NewClubAutoWinnerItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.getWinnerList(this.curPageIndex);var t=this;t.addListener("GetUnionAutoPlayListSuccess",function(e){var i=e.getUserData();t.maxCount=i.count,t.winnerList=i.map_list||[],t.refreshWinnerList()})},getWinnerList:function(t){t=t||this.curPageIndex;var e=t*this.limitNum;ME_D.send_message(CMD_UNION_MESSAGE,"get_union_auto_play_log_list",{game_type:GAME_TYPE,offset:e+1,limit_num:this.limitNum})},refreshWinnerList:function(){if(0===this.winnerList.length)this.lab_null.setVisible(!0),this.listView.setVisible(!1);else{this.lab_null.setVisible(!1),this.listView.setVisible(!0),this.maxCount=DataMgr.clubCtrl.clubAutoPlayLogCount,this.refreshList({name:"listView",list:this.winnerList,async:!0});var t=Math.ceil(this.maxCount/this.limitNum);t=0===t?1:t,this.lab_page.setString(this.curPageIndex+1+"/"+t)}},tap_btn_per_page:function(){this.curPageIndex<=0||(this.curPageIndex--,this.getWinnerList(this.curPageIndex))},tap_btn_next_page:function(){var t=Math.ceil(this.maxCount/this.limitNum);t>this.curPageIndex+1&&(this.curPageIndex++,this.getWinnerList(this.curPageIndex))}}),NewClubAutoWinnerDlg.create=function(t,e,i){return new NewClubAutoWinnerDlg(t,e,i)},ModuleMgr.registerModule("NewClubAutoWinnerDlg",NewClubAutoWinnerDlg),NewClubAutoWinnerItem=QPListItem.extend({uiPath:"ui/new/club/NewClubAutoWinnerItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},parseTime:function(t){t=t||0;var e=new Date(1e3*t),i=e.getFullYear()+"/";return i+=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"/",i+=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",i+=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",i+=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes()},setData:function(t){if(t){this.data=t;var e=ConvertToJson(t.log_detail);this.lab_desk_id.setString(e.desk_no),this.lab_create_time.setString(this.parseTime(this.data.create_time));var i=GET_CHAYE_COST_BY_ROOM_DATA(e);this.lab_cost.setString(i);for(var a="",s=0,r=e.users||[],n=e.score,o=0,c=null,l=0,_=null,u=null,h=null,g=0;g<r.length;g++){var d=g+1,m=r[g];if(0===g&&(_=m,l=n["idx"+d]),m.rid){var f=n["idx"+d];f>o&&(o=f,c=m)}m.rid===ME_D.get_rid()&&(h=m,u=n["idx"+d])}c||(h?(c=h,o=u):_&&(c=_,o=l)),c&&(a=toDecodeURIComponent(c.name),s=o),this.lab_winner_name.setString(a),this.lab_winner_score.setString(s)}}}),NewClubAutoWinnerItem.create=function(t,e,i){return new NewClubAutoWinnerItem(t,e,i)},ModuleMgr.registerModule("NewClubAutoWinnerItem",NewClubAutoWinnerItem),NewClubAutoTipDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubAutoTipDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){if(this.data&&this.data.desk_detail){this.lab_game_name.setString(this.data.desk_detail.game_type===GAME_TYPE_FZMJ?"福州麻将":"宁德麻将"),this.setText("lab_round",this.data.desk_detail.full_round),this.setText("lab_num",this.data.desk_detail.full_num);var t="";if(this.data.desk_detail.game_type===GAME_TYPE_FZMJ){if(this.data.desk_detail.result_data){var e=!1;1===this.data.desk_detail.result_data.spec1&&(t="清一色",
e=!0),1===this.data.desk_detail.result_data.spec2&&(e&&(t+=","),t+="单钓剩金不平胡",e=!0),1===this.data.desk_detail.result_data.spec3&&(e&&(t+=","),t+="可胡金龙",e=!0),1===this.data.desk_detail.result_data.spec4&&(e&&(t+=","),t+="金雀开口不平胡")}}else this.data.desk_detail.game_type===GAME_TYPE_NDMJ&&(0===this.data.desk_detail.spec_type?t="开金":1===this.data.desk_detail.spec_type&&(t="白板为金"));this.lab_setting.ignoreContentAdaptWithSize(!1),this.lab_setting.setContentSize(cc.size(444,66)),this.lab_setting.setString(t);var i="";this.data.desk_detail.game_type===GAME_TYPE_FZMJ?0===this.data.desk_detail.cost?i="放胡单赔":1===this.data.desk_detail.cost&&(i="放胡均摊"):this.data.desk_detail.game_type===GAME_TYPE_NDMJ&&(0===this.data.desk_detail.cost?i="放胡单赔":1===this.data.desk_detail.cost&&(i="放胡均摊")),this.setText("lab_jiesuan",i)}},tap_btn_cancel:function(){this.close()},tap_btn_join:function(){if(this.data&&this.data.desk_idx){var t=this.data.desk_idx,e=DataMgr.clubCtrl.getMyClub(),i="",a="";e&&(i=e.match_rid,a=e.rid);var s=GetGameTypeByRoomId(t);ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:s,desk_idx:t,union_rid:a,match_rid:i})}}}),NewClubAutoTipDlg.create=function(t,e,i){return new NewClubAutoTipDlg(t,e,i)},ModuleMgr.registerModule("NewClubAutoTipDlg",NewClubAutoTipDlg),NewClubDonateDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubDonateDlg.ui",listView_item:null,donateLogList:[],limitNum:30,maxCount:0,offset:0,last_num:0,ctor:function(t,e,i){this.listView_item=NewClubDonateItem,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.getUnionMoney(),this.getDonateLogList(this.offset),this.changeDonateNum(0),this.changeUnionMoney(DataMgr.clubCtrl.getClubDataMatchMoney());var t=this;t.addListener("GetUnionDonateListSuccess",function(e){var i=e.getUserData();t.donateLogList=i.map_list||[],t.refreshDonateLogList()}),t.addListener("ModifiDonateSucces",function(e){var i=e.getUserData();t.changeDonateNum(i.num)}),t.addListener("GetUnionMoneySucces",function(e){var i=e.getUserData();t.changeUnionMoney(i.match_money)}),t.addListener("AppendUnionAutoMoneySucces",function(e){var i=e.getUserData();t.changeUnionMoney(i.match_money),t.addNewDonateLogShow(t.last_num)})},addNewDonateLogShow:function(t){var e={union_rid:DataMgr.clubCtrl.getMyClub().rid,create_time:Date.now()/1e3,name:ME_D.get_user().name,rid:ME_D.get_user().rid,room_card:t};this.donateLogList.unshift(e),this.refreshDonateLogList()},changeDonateNum:function(t){t=t||0,t>0?(this.setText("lab_chaye",t),this.last_num=t,ME_D.send_message_waiting(CMD_UNION_OPER,"append_union_auto_play_money",{game_type:GAME_TYPE,match_money:t})):this.setText("lab_chaye",0)},changeUnionMoney:function(t){t=t||0,t>0?this.setText("lab_union_chaye",t):this.setText("lab_union_chaye",0)},getUnionMoney:function(){ME_D.send_message(CMD_UNION_MESSAGE,"get_union_money",{game_type:GAME_TYPE})},getDonateLogList:function(t){t=t||this.offset;var e=t*this.limitNum;ME_D.send_message(CMD_UNION_MESSAGE,"get_union_donate_log_list",{game_type:GAME_TYPE,offset:e+1,limit_num:this.limitNum})},refreshDonateLogList:function(){0==this.donateLogList.length?(this.lab_null.setVisible(!0),this.listView.setVisible(!1)):(this.lab_null.setVisible(!1),this.listView.setVisible(!0),this.maxCount=DataMgr.clubCtrl.clubDonateLogCount||0,this.refreshList({name:"listView",list:this.donateLogList,async:!0}))},tap_btn_donate:function(){ModuleMgr.runDlg("NewClubDoDonateDlg")}}),NewClubDonateDlg.create=function(t,e,i){return new NewClubDonateDlg(t,e,i)},ModuleMgr.registerModule("NewClubDonateDlg",NewClubDonateDlg),NewClubDonateItem=QPListItem.extend({uiPath:"ui/new/club/NewClubDonateItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){},parseTime:function(t){t=t||0;var e=new Date(1e3*t),i=e.getFullYear()+"/";return i+=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"/",i+=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",i+=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",i+=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes()},setData:function(t){t&&(this.data=t,this.lab_create_time.setString(this.parseTime(this.data.create_time)),this.lab_user_name.setString(this.data.name),this.lab_donate_num.setString(this.data.room_card))}}),NewClubDonateItem.create=function(t,e,i){return new NewClubDonateItem(t,e,i)},ModuleMgr.registerModule("NewClubDonateItem",NewClubDonateItem),NewClubDoDonateDlg=QPDlg.extend({uiPath:"ui/new/club/NewClubDoDonateDlg.ui",data:null,minNum:0,curNum:0,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.refreshUi()},refreshUi:function(){this.lab_num.setString(0)},calcNum:function(t){var e=this.lab_num.getString();e=parseInt(e),NaN==e?(ModuleMgr.showTipMsg("输入不合法！"),this.curNum=0):this.curNum=e,this.curNum=this.curNum+t,this.curNum<0&&(this.curNum=0),this.lab_num.setString(this.curNum)},tap_btn_sub_100:function(){this.calcNum(-100)},tap_btn_sub_10:function(){this.calcNum(-10)},tap_btn_add_100:function(){this.calcNum(100)},tap_btn_add_10:function(){this.calcNum(10)},tap_btn_sure:function(){var t=this.lab_num.getString();if(t=parseInt(t),NaN==t)return ModuleMgr.showTipMsg("输入不合法！"),void this.close();var e={num:t};cc.eventManager.dispatchCustomEvent("ModifiDonateSucces",e),this.close()}}),NewClubDoDonateDlg.create=function(t,e,i){return new NewClubDoDonateDlg(t,e,i)},ModuleMgr.registerModule("NewClubDoDonateDlg",NewClubDoDonateDlg),NewClubAuto=QPLayer.extend({uiPath:"ui/new/club/NewClubAuto.ui",pageView:null,pageItemNum:4,curPageIndex:0,ctor:function(t,e,i){QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.getAutoDeskSettingList(),this.getAutoDeskList();var t=this,e=new ccui.PageView;e.setDirection(ccui.ScrollView.DIR_HORIZONTAL),e.setTouchEnabled(!0),e.setBounceEnabled(!0),e.setContentSize(this.wgt_content.getContentSize()),this.wgt_content.addChild(e),this.pageView=e,e.setItemsMargin(15),e.addEventListener(function(e,i){var a=t.pageView.getCurrentPageIndex();t.curPageIndex!==a&&(t.curPageIndex=a,t.showArrow())},this),t.addListener("GetAutoDeskSettingInfo",function(e){t.refreshUi()}),t.addListener("GetAutoDeskInfo",function(e){t.scheduleOnce(function(){t.loadAutoItemPageView()},0)}),t.addListener("AutoDeskSettingChange",function(e){var i=e.getUserData();t.setSettingData(i.idx+1,i),t.showDesksAttachUi()}),t.addListener("AutoDeskRoundChange",function(e){var i=e.getUserData(),a=t.getAutoDeskItemByDeskIdx(i.desk_idx);a&&a.item&&a.item.showItemCurRound(a.idx+1,i.cur_round,i.full_round)}),t.addListener("AddAutoDeskUser",function(e){var i=e.getUserData(),a=t.getAutoDeskItemByDeskIdx(i.desk_idx);a&&a.item&&a.item.addItemUser(a.idx,i)}),t.addListener("RemoveAutoDeskUser",function(e){var i=e.getUserData(),a=t.getAutoDeskItemByDeskIdx(i.desk_idx);a&&a.item&&a.item.removeItemUser(a.idx,i)}),t.addListener("RemoveAutoDesk",function(e){var i=e.getUserData(),a=t.getAutoDeskItemByDeskIdx(i);a&&a.item&&a.item.setWgtItemData(a.idx+1,null),t.refreshAllItems()}),t.addListener("AutoDeskNew",function(e){t.refreshAllItems()})},tap_btn_donate:function(){ModuleMgr.runDlg("NewClubDonateDlg")},tap_btn_auto_log:function(){ModuleMgr.runDlg("NewClubResultDlg",{id:NEW_CLUB_MENU_ITEM_ID_ZHANJI_QUICK_ZUJU},null,null)},tap_btn_winner_log:function(){ModuleMgr.runDlg("NewClubAutoWinnerDlg")},tap_btn_next:function(){var t=this.pageView.getPages();this.curPageIndex+1<t.length&&(this.curPageIndex++,this.doShowCurPage()),this.showArrow()},doShowCurPage:function(){this.pageView.setCurrentPageIndex(this.curPageIndex)},showArrow:function(){this.btn_pre.setVisible(this.curPageIndex>0);var t=this.pageView.getPages();this.btn_next.setVisible(this.curPageIndex+1<t.length)},tap_btn_pre:function(){this.curPageIndex>0&&(this.curPageIndex--,this.doShowCurPage()),this.showArrow()},onBtnOpen:function(t){if("ended"===t.name){if(!DataMgr.clubCtrl.isIWasClubManager())return void ModuleMgr.showTipMsg("快速组局只能部长才能开启，快联系他吧！");var e=t.target.name,i=parseInt(e.substr(e.length-1,1))-1;this.doOpenCreateRoom(i)}},doOpenCreateRoom:function(t){isInteger(t)&&t<3&&t>=0&&ModuleMgr.runDlg("NewCreateRoomDlg",{isAuto:!0,autoDeskIdx:t},null,null)},onBtnClose:function(t){if("ended"===t.name){if(!DataMgr.clubCtrl.isIWasClubManager())return void ModuleMgr.showTipMsg("没有权限操作");var e=t.target.name,i=parseInt(e.substr(e.length-1,1))-1;this.doCloseAutoDeskSetting(i)}},doCloseAutoDeskSetting:function(t){if(isInteger(t)&&t<3&&t>=0){var e=DataMgr.clubCtrl.getMyClub();if(!e)return void ModuleMgr.showTipMsg("没有权限操作");if(!DataMgr.clubCtrl.isIWasClubManager())return void ModuleMgr.showTipMsg("没有权限操作");ME_D.send_message(CMD_UNION_MESSAGE,"close_auto_desk_setting",{game_type:GAME_TYPE,idx:t,union_rid:e.rid}),this.setSettingData(t+1,null)}},getAutoDeskSettingList:function(){ME_D.send_message(CMD_UNION_MESSAGE,"get_auto_desk_setting_list",{game_type:GAME_TYPE})},getAutoDeskList:function(t){ME_D.send_message(CMD_UNION_MESSAGE,"get_auto_desk_list",{game_type:GAME_TYPE})},refreshUi:function(){this.showSetting(),this.showDesksAttachUi()},showSetting:function(){for(var t=DataMgr.clubCtrl.getClubAutoDeskSettingList(),e=0;e<3;e++)this.setSettingData(e+1,t[e])},setSettingData:function(t,e){if(e&&0!==e.status&&0!==lengthOfObj(e)){var i=e.desk_detail.game_type===GAME_TYPE_FZMJ?"福州麻将,":"宁德麻将,";i=i+e.desk_detail.full_round+"局",i=i+e.desk_detail.full_num+"人",e.desk_detail.game_type===GAME_TYPE_FZMJ?(e.desk_detail.result_data&&(1===e.desk_detail.result_data.spec1&&(i+=",清一色"),1===e.desk_detail.result_data.spec2&&(i+=",单钓剩金不平胡"),1===e.desk_detail.result_data.spec3&&(i+=",可胡金龙"),1===e.desk_detail.result_data.spec4&&(i+=",金雀开口不平胡")),0===e.desk_detail.cost?i+=",放胡单赔":1===e.desk_detail.cost&&(i+=",放胡均摊")):e.desk_detail.game_type===GAME_TYPE_NDMJ&&(0===e.desk_detail.spec_type?i+=",开金":1===e.desk_detail.spec_type&&(i+=",白板为金"),0===e.desk_detail.cost?i+=",放胡单赔":1===e.desk_detail.cost&&(i+=",放胡均摊")),this["txt_setting"+t].ignoreContentAdaptWithSize(!1),this["txt_setting"+t].setContentSize(cc.size(172,42)),this["txt_setting"+t].setString(cutOffStr(i,48)),this["txt_setting"+t].setVisible(!0),this["btn_close"+t].setVisible(!0),this["txt_null"+t].setVisible(!1),this["btn_open"+t].setVisible(!1)}else this["txt_setting"+t].setVisible(!1),this["btn_close"+t].setVisible(!1),this["txt_null"+t].setVisible(!0),this["btn_open"+t].setVisible(!0)},showDesksAttachUi:function(){var t=DataMgr.clubCtrl.isAllClubAutoDeskSettingClose(),e=DataMgr.clubCtrl.getClubAutoDeskDatasLength()>0;t&&!e?this.showNull():(this.wgt_null.setVisible(!1),this.wgt_content.setVisible(!0))},showNull:function(){this.wgt_null.setVisible(!0),this.wgt_content.setVisible(!1),this.btn_pre.setVisible(!1),this.btn_next.setVisible(!1)},loadAutoItemPageView:function(){for(var t,e=[],i=[],a=DataMgr.clubCtrl.getClubAutoDeskDatasLength(),s=0;s<a;s++)t=DataMgr.clubCtrl.getClubAutoDeskDataByIndex(s),t&&i.push(t),i.length%4===0&&(e.push(i),i=[]);i.length>0&&e.push(i),e.length>0&&this.refreshList({name:"pageView",list:e,async:!0,itemCell:NewClubAutoItem,isNotAddListen:!0}),this.curPageIndex=0,this.btn_pre.setVisible(!1),this.btn_next.setVisible(this.curPageIndex+1<e.length),this.doShowCurPage(),this.showDesksAttachUi()},getAutoDeskItemByDeskIdx:function(t){for(var e=this.pageView.getPages(),i=0;i<e.length;i++)for(var a=e[i].getItemDeskData(),s=0;s<a.length;s++)if(t&&a[s]&&a[s].desk_idx===t)return{item:e[i],idx:s}},refreshAllItems:function(){var t=this;this.scheduleOnce(function(){t.loadAutoItemPageView()},.01)}}),NewClubAuto.create=function(t,e,i){return new NewClubAuto(t,e,i)},ModuleMgr.registerModule("NewClubAuto",NewClubAuto),NewClubAutoItem=QPListItem.extend({uiPath:"ui/new/club/NewClubAutoItem.ui",autoDeskDataList:[],nullDeskItems:{},ctor:function(t,e,i){this.autoDeskDataList=t,QPListItem.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this.autoDeskDataList&&"object"==typeof this.autoDeskDataList&&this.autoDeskDataList.length>0&&this.showUI()},getItemDeskData:function(){return this.autoDeskDataList},setData:function(t){if(t&&t.length){this.autoDeskDataList=t;for(var e=0;e<4;e++)this.autoDeskDataList[e]=this.autoDeskDataList[e]||{};this.showUI()}},showUI:function(){for(var t=0;t<4;t++)this.setWgtItemData(t+1,this.autoDeskDataList[t])},setWgtItemData:function(t,e){if(e&&e.desk_detail){this["txt_game_name"+t].setString(e.desk_detail.game_type===GAME_TYPE_FZMJ?"福州麻将":"宁德麻将"),this.showItemCurRound(t,e.cur_round||0,e.desk_detail.full_round),this.setText("txt_desk_id"+t,e.desk_idx);var i="";if(e.desk_detail.game_type===GAME_TYPE_FZMJ){if(e.desk_detail.result_data){var a=!1;1===e.desk_detail.result_data.spec1&&(i="清一色",a=!0),1===e.desk_detail.result_data.spec2&&(a&&(i+=","),i+="单钓剩金不平胡",a=!0),1===e.desk_detail.result_data.spec3&&(a&&(i+=","),i+="可胡金龙",a=!0),1===e.desk_detail.result_data.spec4&&(a&&(i+=","),i+="金雀开口不平胡")}}else e.desk_detail.game_type===GAME_TYPE_NDMJ&&(0===e.desk_detail.spec_type?i="开金":1===e.desk_detail.spec_type&&(i="白板为金"));var s=cutOffStr(i||"",8,!0);this.setText("txt_setting"+t,s);for(var r=0,n=0;n<e.users.length;n++)if(e.users[n].user_rid){r+=1,this["lab_name"+t+r].setString(cutOffStr(e.users[n].name||"",4,!0));var o=e.users[n].headimgurl||"",c=e.users[n].icon||"";this["item_head"+t+r].setData({url:o,frame:c,user_rid:e.users[n].user_rid}),this["wgt"+t+r].setVisible(!0)}for(var l=r+1;l<=4;l++)this["wgt"+t+l].setVisible(!1),this["lab_name"+t+l].setString(""),this["item_head"+t+l].setData({}),this["item_head"+t+l].setHeadData(null);this["wgt_item"+t].setVisible(!0),this.nullDeskItems["wgt_item"+t]=null}else{this["wgt_item"+t].setVisible(!1),this.nullDeskItems["wgt_item"+t]=this["wgt_item"+t];for(var r=1;r<=4;r++)this["wgt"+t+r].setVisible(!1),this["lab_name"+t+r].setString(""),this["item_head"+t+r].setData({}),this["item_head"+t+r].setHeadData(null)}},showItemCurRound:function(t,e,i){if(e=e||0,!i){var a=this["txt_round"+t].getString(),s=a.indexOf("/");i=a.substring(s+1,a.length)}0===t&&(t=1),this["txt_round"+t].setString("局数："+e+"/"+i)},removeItemUser:function(t,e){t+=1;for(var i=null,a=1;a<=4;a++)if(i=this["item_head"+t+a].getHeadData(),i&&i.user_rid===e.user_rid){this["wgt"+t+a].setVisible(!1),this["lab_name"+t+a].setString(""),this["item_head"+t+a].setData({}),this["item_head"+t+a].setHeadData(null);break}},addItemUser:function(t,e){for(var i=t+1,a=!1,s=1;s<=4;s++){var r=this["item_head"+i+s].getHeadData();if(r&&r.user_rid===e.user_rid){a=!0,this["lab_name"+i+s].setString(cutOffStr(e.name,4,!0)),this["item_head"+i+s].setData({url:e.headimgurl,frame:"",user_rid:e.user_rid}),this["wgt"+i+s].setVisible(!0);break}}if(!a){t+=1;for(var n=1;n<=4;n++)if(!this["item_head"+t+n].getHeadData()){this["lab_name"+t+n].setString(cutOffStr(e.name,4,!0));var o=e.headimgurl,c="";this["item_head"+t+n].setData({url:o,frame:c,user_rid:e.user_rid}),this["wgt"+t+n].setVisible(!0);break}}},getNullDeskItem:function(){for(var t in this.nullDeskItems)return this.nullDeskItems[t]},updateAutoItemData:function(t){for(var e=null,i=[],a=0;a<4;a++)e=DataMgr.clubCtrl.getClubAutoDeskDataByIndex(t+a),i.push(e);this.setData(i)},onClubAutoItemClick:function(t){if("ended"===t.name){var e=t.target.name,i=parseInt(e.substr(e.length-1,1));this.doOnSubItemClick(i)}},doOnSubItemClick:function(t){var e=this.autoDeskDataList[t-1];ModuleMgr.runDlg("NewClubAutoTipDlg",e,null,null)}}),NewClubAutoItem.create=function(t,e,i){return new NewClubAutoItem(t,e,i)},ModuleMgr.registerModule("NewClubAutoItem",NewClubAutoItem),UIUtils.RegisterPathTemple("ui/new/club/NewClubAutoItem.ui",NewClubAutoItem),NewGameLayer=QPLayer.extend({uiPath:"ui/new/game/NewGameLayer.ui",musicDt:0,isPlaying:!1,isTurning:!1,isAction:!1,isDispatchPoker:!1,touchCardIndex:-1,touchMoveCardIndex:-1,bolCardMove:!1,updateDt:0,cardOrgX:0,isScreenRotationDirty:!1,showKingType:1,touchInterval:0,downCardTime:.4,stepRandMasterTime:4.5,stepOpenDoorTime:2,stepRandKingTime:2.5,startType:0,deskTypeKeyArr:[],isDissolve:!1,heartDt:0,sendHeadTime:0,faceInfo:null,isInitFixFlower:!1,isFirstFixFlower:!1,shareToclubTime:0,ctor:function(t,e,i){this.isLog=DataMgr.gameCtrl.isLog,this.replayData=DataMgr.gameCtrl.replayData,this.events=["SuccessUserReady","SuccesRefreshPlayers","SuccessEnterDesk","SuccessLeaveDesk","SuccessOwnLeaveDesk","SuccessDissolve","RefreshRound","SuccessRandMaster","SuccessStepChange","SuccessStartGame","SuccessOpenDoor","SuccessPokerInit","DispatchPoker","SuccesAllPokersFixFlower","SuccessFixFlower","AddFlowerPokers","TurnIndex","SuccessRandPoker","refreshPoker","SuccessDealPoker","HideDispatchPoker","HideCurOutCard","SuccessNoAction","SuccessSelectAction","PlayActionEfc","RefreshWeakPoker","SuccessShowResult","SuccessGameEnd","RefreshRoleScore","SuccesScoreChange","SuccessTswScoreEnd","ShowResultDesktopBtn","ClearResuleCard","ShowDesktopLine","SuccesSetDeskBg","SuccesSetTileSize","SuccesShowFinger","SuccesShowTingCard","SuccesShowSurplus","SuccesLogExit","SuccessPlayChatTxt","SuccessPlayChatFace","HideChatLayer","SuccessStartPlayRecord","SuccessEndPlayRecord","FaceInter","SUCCECES_ROOM_CREATE","ErrorOp","ShowDownKing","CheckCardSelectMove","SuccesShowCard","SuccesSelectPiao","SuccesChaoMaster","SuccesSetCardBg","RefreshRandMineLayer","OnReceiveAward"],QPLayer.prototype.ctor.call(this,this.uiPath,e,i);var a=this;this.addListener("OnReceiveAward",function(t){return a.isAllUILoaded===!1?void(a.eventStack.OnReceiveAward=t.getUserData()):void a.showAwardTip()}),this.faceInfo=CsvMgr.getDataWithFile("face"),this.scheduleUpdate(),this.sendHeadTime=parseInt((new Date).getTime()%1e7)},onLoaded:function(){this.setDeskBg(),this.initUi(),this.initGameUI(),this.showAwardTip()},showAwardTip:function(){gInReview||!isAgent()&&DataMgr.accountCtrl.receiveAwardNum&&(ModuleMgr.showTipMsg("赠送每日登陆钻石"+DataMgr.accountCtrl.receiveAwardNum),DataMgr.accountCtrl.receiveAwardNum=0)},initGameUI:function(){this.refreshRound(),this.onAllUiLoaded(),this.checkKingGrp(),this.refreshDesk(),this.selectAction(),this.playOutCard(),this.refreshRoleScore(),this.stepChange(),this.dealEventStack()},setDeskBg:function(){var t=cc.sys.localStorage.getItem("fzmj_game_setting_ck_bg")||1,e="res/uires/new/game/desktop/bg"+t+".png";this.img_bg&&this.img_bg.loadTexture(e)},initUi:function(){this.grp_log&&this.grp_log.setVisible(this.isLog),this.btn_wang&&this.btn_wang.setVisible(!this.isLog),this.btn_gps&&this.btn_gps.setVisible(!this.isLog),this.btn_chat&&this.btn_chat.setVisible(!this.isLog),this.btn_record&&this.btn_record.setVisible(!this.isLog),cc.sys.isNative||this.btn_download&&this.btn_download.setVisible(!0),this.item_down.isAlreadyOpen=!1,this.item_down.isMoving=!1,this.item_last_tile&&this.item_last_tile.setData(0,mjGame.Direction.TOP,mjGame.TileStatus.STAND,mjGame.TilePlace.HAND),this.resetUI()},resetUI:function(){this.item_waiting&&this.item_waiting.setVisible(!1),this.item_waitinglabel&&this.item_waitinglabel.showWaiting(!1),this.item_king&&this.item_king.setVisible(!1),this.btn_desktop&&this.btn_desktop.setVisible(!1),this.grp_last_num&&this.grp_last_num.setVisible(!1),this.item_quick&&this.item_quick.setVisible(!1),this._showFinger(!1),this.hidePutOutArrowAni(),this.unschedule(555);for(var t=1;t<=4;t++)this["item_outTips"+t]&&this["item_outTips"+t].setData(void 0);this.item_alreadyTingTips&&this.item_alreadyTingTips.setVisible(!1)},refreshRound:function(){if(DataMgr.gameCtrl.deskInfo){var t=DataMgr.gameCtrl.deskInfo.cur_round+"/"+DataMgr.gameCtrl.deskInfo.full_round;this.lab_round.setString("局数:"+t)}},onAllUiLoaded:function(){cc.log("onAllUiLoaded======");for(var t=1;t<=4;t++)if(null==this["role_card"+t])return void cc.log("card "+t+" empty");if(this.refreshPlayers(),"dissolve"==DataMgr.gameCtrl.deskStatus&&this.scheduleOnce(function(){ModuleMgr.runDlg("NewGameDissolve")},1),this.resetUI(),this.isPlaying=!0,this.isTurning=!1,this.isAction=!1,this.grp_last_num&&this.grp_last_num.setVisible(!0),DataMgr.gameCtrl.deskInfo){var e=DataMgr.gameCtrl.deskInfo.cur_step;cc.log("step=======",e),e==MJ_STEP_DEAL_END?this.onPokerInited():e==MJ_STEP_SHOW_RESULT?1!=DataMgr.gameCtrl.myWheelInfo.is_score_end?(this.onPokerInited(),this.refreshResultPokers(),this.setTurnIndexEnable(!0),ModuleMgr.runDlg("NewGameResult",{isReconnect:!0},null,null)):(this.item_waitinglabel.showWaiting(!0,1),this.grp_last_num&&this.grp_last_num.setVisible(!1),this.item_king&&this.item_king.setVisible(!1)):DataMgr.gameCtrl.isBeforeGame()?(this.grp_last_num&&this.grp_last_num.setVisible(!1),this.item_waiting.setVisible(!0),this.item_waitinglabel.showWaiting(!0,0),DataMgr.gameCtrl.deskInfo&&DataMgr.gameCtrl.deskInfo.union_rid?this.btn_invite_club&&this.btn_invite_club.setVisible(!0):this.btn_invite_club&&this.btn_invite_club.setVisible(!1),DataMgr.gameCtrl.deskInfo.real_desk_own_rid==DataMgr.gameCtrl.deskInfo.desk_own_rid&&DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()?(this.btn_dissolve.setVisible(!0),this.btn_exit.setVisible(!1)):(this.btn_exit.setVisible(!0),this.btn_dissolve.setVisible(!1)),this.item_detection&&(this.item_detection.setState(!1),this.item_detection.setVisible(!0)),this.isPlaying=!1):e==MJ_STEP_GAME_END?this.isPlaying=!1:e==MJ_STEP_OPEN_DOOR&&this.tap_btn_open_door(),e==MJ_STEP_PLAY?(this.onPokerInited(),this.setTurnIndexEnable(),this.setSelectActionEnable()):e==MJ_STEP_INIT_POKER?this.onPokerInited():e==MJ_STEP_SELECT_RAND_POKER&&this.onPokerInited()}this.showAccountTip()},showAccountTip:function(){function t(t,e){if(t&&e){t=parseFloat(t),e=parseFloat(e);var i=new Date(1e3*t),a=new Date(1e3*e);if(i.getDay()==a.getDay()&&i.getMonth()==a.getMonth()&&i.getFullYear()==a.getFullYear())return!0}return!1}ModuleMgr.showConfirmTxtMsg("请检查您的游戏ID，谨防上当受骗。",null,34),DataMgr.recordCtrl.isBanGambling||t(DataMgr.timeCtrl.getServerTime(),cc.sys.localStorage.getItem(GAME_TYPE+"_ban_gambling_time")||0)||this.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){ModuleMgr.runDlg("BanGamblingDlg")})))},refreshPlayers:function(){cc.log("=====refreshPlayers"),DataMgr.gameCtrl.sortPlayers();for(var t=1;t<=4;t++)if(this["role_card"+t].card_tag=t,DataMgr.gameCtrl.deskPlayers[t]){this["role_card"+t].setVisible(!0);var e=DataMgr.gameCtrl.deskPlayers[t].wheel_idx;this["role_card"+t].wheelIdx=e;var i=DataMgr.gameCtrl.wheelInfos[e];this["role_card"+t].setData(DataMgr.gameCtrl.deskPlayers[t]),this["role_card"+t].setWheelInfo(i),DataMgr.gameCtrl.isBeforeGame()?this["role_card"+t].setReady(i.is_ready):DataMgr.gameCtrl.deskInfo.cur_step==MJ_STEP_SHOW_RESULT?this["role_card"+t].setReady(i.is_score_end):(this["role_card"+t].setReady(0),IsGameTypeFzmj(DataMgr.gameCtrl.deskInfo.game_type)&&this["role_card"+t].showFlower())}else this["role_card"+t].setEmpty(),this["role_card"+t].setVisible(!1);IsGameTypeFzmj(DataMgr.gameCtrl.deskInfo.game_type)?DataMgr.gameCtrl.isBeforeGame()||DataMgr.gameCtrl.deskInfo.cur_step==MJ_STEP_SHOW_RESULT||this.btn_flower&&this.btn_flower.setVisible(!0):this.btn_flower&&this.btn_flower.setVisible(!1),this.refreshPlayersOnline(),this.refreshMaster()},refreshPlayersOnline:function(){if(DataMgr.gameCtrl.deskPlayers)for(var t=1;t<=4;t++)if(DataMgr.gameCtrl.deskPlayers[t]){var e=DataMgr.gameCtrl.deskPlayers[t].wheel_idx,i=DataMgr.gameCtrl.online[e];DataMgr.gameCtrl.deskPlayers[t].rid==ME_D.get_rid()&&(i=!0),this["role_card"+t]&&this["role_card"+t].setOnline(i)}},refreshLastPokerNum:function(){var t=parseInt(DataMgr.gameCtrl.remainPokerNum);t<0&&(t=0),this.txt_last_num&&this.txt_last_num.setString(t)},subtractLastPokerNum:function(t){if(this.txt_last_num){var e=parseInt(this.txt_last_num.getString())-t;e<0&&(e=0),this.txt_last_num.setString(e)}},refreshDesk:function(){DataMgr.gameCtrl.sortPlayers(),this.lab_roomId.setString("房号:"+DataMgr.gameCtrl.deskIdx),this.refreshLastPokerNum(),this.refreshGameTypeTxt()},refreshGameTypeTxt:function(){var t=DataMgr.gameCtrl.deskInfo,e=t.info;this.isLog&&(t=this.replayData.desk_info,e=this.replayData.desk_info),this.img_gameType&&this.img_gameType.loadTexture(GetRealPath("res/uires/new/game/play/gameType_"+t.game_type+".png"),ccui.Widget.LOCAL_TEXTURE);var i=[];switch(t.game_type){case GAME_TYPE_FZMJ:e&&(1==e.cost?i.push(1):i.push(2),1==e.spec1&&i.push(5),1==e.spec3&&i.push(7),1==e.spec2&&i.push(6),1==e.spec4&&i.push(8));break;case GAME_TYPE_NDMJ:e&&(1==e.cost?i.push(1):i.push(2),1==e.spec_type?i.push(3):i.push(4))}for(var a=0;a<i.length;a++)this["img_infoType"+a]&&this["img_infoType"+a].loadTexture(GetRealPath("res/uires/new/game/play/"+i[a]+".png"),ccui.Widget.LOCAL_TEXTURE);this.item_playInfo&&this.item_playInfo.setVisible(!0)},update:function(t){var e=DataMgr.timeCtrl.getServerTime(),i=new Date(1e3*e),a=i.format("hh:mm");if(this.lab_time&&this.lab_time.setString(a),this.checkAlreadyTing(),this.musicDt+=t,this.musicDt>=.2&&(this.musicDt=0),this.shareToclubTime-=t,this.shareToclubTime<0&&(this.shareToclubTime=0),this.heartDt+=t,this.heartDt>=3){this.heartDt-=3,this.sendHeadTime=parseInt((new Date).getTime()%1e7);var s=this.sendHeadTime;WsNetwork.getInstance().sendMessage(CMD_CHECK_HEART,{cmstime:s})}if(0!=DataMgr.timeCtrl.disMstime){var r=DataMgr.timeCtrl.disMstime,n=(this.sendHeadTime-3e3-DataMgr.timeCtrl.cmstime)/2;if(n>r&&(r=n),r<=0&&(r=0),this.icon_network){var o=GetRealPath("res/uires/new/game/desktop/signal1_3.png");o=GetRealPath(r<=100?"res/uires/new/game/desktop/signal1_3.png":r<=200?"res/uires/new/game/desktop/signal1_2.png":"res/uires/new/game/desktop/signal1_1.png"),this.icon_network.loadTexture(o)}}if(this.updateDt+=t,!(this.updateDt<.2)){if(this.updateDt-=.2,1==this.endRecord&&Date.parse(new Date)-this.recordTime>800&&(this.txt_record.setVisible(!1),this.endRecord=!1,platform.stopRecord()),1==this.startRecord){if(this.startRecord=!1,this.endRecord)return;platform.startRecord()}platform.retRecordStartPlay&&(cc.eventManager.dispatchCustomEvent("SuccessStartPlayRecord",platform.retRecordStartPlay),platform.retRecordStartPlay=null),platform.retRecordEndPlay&&(cc.eventManager.dispatchCustomEvent("SuccessEndPlayRecord",platform.retRecordEndPlay),platform.retRecordEndPlay=null),platform.retRecordUploaded&&(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",media_id:DOWN_RECORD_SERVER+"/apidown?file="+platform.retRecordUploaded,platform:"native"}),platform.retRecordUploaded=null)}},DoRecord:function(t){if("began"==t.name){if(!cc.sys.isNative)return void ModuleMgr.showTipMsg("下载APP才可使用该功能！");this.startRecord=!0,this.endRecord=!1,this.recordTime=Date.parse(new Date),this.txt_record.setVisible(!0)}else"ended"!=t.name&&"canceled"!=t.name||(this.endRecord=!0)},stepRandMaster:function(){for(var t=this,e=1;e<=4;e++)this["role_card"+e]&&this["role_card"+e].setMaster(!1);this.scheduleOnce(function(){this.tap_btn_open_door()},this.stepRandMasterTime);var i=function(){var e=DataMgr.gameCtrl.lastWinIdx,i=DataMgr.gameCtrl.getChairIdByWheelIdx(e),a=t["role_card"+i];a&&t.refreshMaster()};ModuleMgr.runDlg("GameStart",{callback:i,dlgZorder:99},null,null)},refreshMaster:function(){for(var t=1;t<=4;t++)this["role_card"+t]&&this["role_card"+t].setMaster(!1);var e=DataMgr.gameCtrl.lastWinIdx;if(!(e<0)){var i=DataMgr.gameCtrl.getChairIdByWheelIdx(e);this["role_card"+i]&&this["role_card"+i].setMaster(!0)}},stepChange:function(){var t=DataMgr.gameCtrl.curStep;DataMgr.gameCtrl.isBeforeGame()&&this.grp_last_num&&this.grp_last_num.setVisible(!1),t==MJ_STEP_DEAL_START&&this.refreshDesk()},setHandTileEnabled:function(t){var e=DataMgr.gameCtrl.getChairIdxByRid(DataMgr.gameCtrl.myWheelInfo.rid);this["game_card"+e]&&this["game_card"+e].setTouchEnabled(t),this.btn_quick&&this.btn_quick.setTouchEnabled(t),t||this._showFinger(!1)},SuccessStartGame:function(){var t=this;if(this.setHandTileEnabled(!1),this.btn_flower&&this.btn_flower.setTouchEnabled(!1),DataMgr.gameCtrl.deskInfo.cur_round>DataMgr.gameCtrl.deskInfo.full_round)return void t.refreshRound();t.isPlaying=!0,DataMgr.gameCtrl.myWheelInfo.is_show_card=0,this.resetUI(),this.item_detection&&(this.item_detection.setState(!0),this.item_detection.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){this.item_detection.setVisible(!1)},this)))),this.refreshRound();for(var e=1;e<=4;e++)DataMgr.gameCtrl.deskPlayers[e]&&(t["role_card"+e].startGame(),t["role_card"+e].setReady(0),IsGameTypeFzmj(DataMgr.gameCtrl.deskInfo.game_type)&&t["role_card"+e].initFlower());IsGameTypeFzmj(DataMgr.gameCtrl.deskInfo.game_type)?this.btn_flower&&this.btn_flower.setVisible(!0):this.btn_flower&&this.btn_flower.setVisible(!1)},stepOpenDoor:function(){},setTileSize:function(){if(DataMgr.gameCtrl.myWheelInfo){var t=DataMgr.gameCtrl.getChairIdxByRid(DataMgr.gameCtrl.myWheelInfo.rid);if(this["game_card"+t]){var e=(cc.winSize.height-30)/this["game_card"+t].width,i=cc.sys.localStorage.getItem("fzmj_game_setting_ck_size")||1;2==i&&(e=.85*e),this["game_card"+t].setScale(e)}}},onPokerInited:function(t){this.setTileSize();for(var e=1;e<=4;e++)if(DataMgr.gameCtrl.deskPlayers[e]){var i=this["role_card"+e],a=this["game_disCard"+e],s=this["game_card"+e];a&&(a.setVisible(!0),a.setSex(i.getSex())),s&&(s.setVisible(!0),s.setTileStatus(mjGame.TileStatus.STAND),s.setTileData(0,void 0))}this.refreshPoker(),this.dispatchPoker(),this.refreshWeakPoker(t),this.refreshOutPoker()},refreshPoker:function(t,e){var i=this.getPokerList(t),a=0,s=0,r=i.length;if(r%3==2)if(e){var n=DataMgr.gameCtrl.lastDispatchPoker;if(n>0){for(var o=[],c=!1,l=0;l<i.length;l++)i[l]!=n||c?o.push(i[l]):c=!0;i=o}DataMgr.gameCtrl.lastDispatchIdx==DataMgr.gameCtrl.myWheelIdx&&(a=DataMgr.gameCtrl.lastDispatchIdx,s=DataMgr.gameCtrl.lastDispatchPoker)}else cc.log("摸牌-list[0]",i[0]),a=DataMgr.gameCtrl.myWheelIdx,s=i[0],i.splice(0,1);for(var _=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.myWheelIdx),l=1;l<=16;l++)this["game_card"+_]&&this["game_card"+_].setTileData(l,i[l-1]);a>0&&s>0&&this.dispatchPoker(a,s)},refreshOutPoker:function(){for(var t=DataMgr.gameCtrl.deskInfo.full_num,e=1;e<=t;e++){var i=DataMgr.gameCtrl.wheelInfos[e];if(i){var a=DataMgr.gameCtrl.getChairIdByWheelIdx(e),s=this["game_disCard"+a];if(s&&s.isVisible()){var r=i.out_pokers;s.refreshPokers(r)}}}},refreshWeakPoker:function(t){for(var e=DataMgr.gameCtrl.deskInfo.full_num,i=1;i<=e;i++){var a=DataMgr.gameCtrl.wheelInfos[i];if(a){var s=DataMgr.gameCtrl.getChairIdByWheelIdx(i),r=this["game_card"+s];if(r&&r.isVisible()){var n=t?void 0:a.poker_num;r.refreshPokers(a.weave_pokers,i,n)}}}},dealPoker:function(){var t=this;playEffect("card_send_effect.mp3"),t.playOutCard()},hidePutOutArrowAni:function(){for(var t=1;t<=4;t++)this["game_disCard"+t]&&this["game_disCard"+t].hidePutOutArrowAni()},playOutCard:function(t){if(DataMgr.gameCtrl.deskInfo.cur_step==MJ_STEP_PLAY){this.hidePutOutArrowAni(),this.unschedule(555);for(var e=1;e<=4;e++)this["item_outTips"+e]&&this["item_outTips"+e].setData(void 0);var i=DataMgr.gameCtrl.lastOutPoker;if(i>0){var a=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.lastOutPokerIdx),s=this["game_disCard"+a];s&&s.addOutCard(i,t),s&&s.showPutOutArrow(),this["item_outTips"+a]&&this["item_outTips"+a].setData(i),this.item_quick&&this.item_quick.setVisible(!1),this._showFinger(!1)}}},hideCurOutCard:function(){var t=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.lastOutPokerIdx),e=this["game_disCard"+t];e&&e.removeOutCard()},noAction:function(){},getPokerList:function(t){for(var e=DataMgr.gameCtrl.myCards||[],i=[],a=e.length-1;a>=0;a--)i.push(e[a]);if(!t){var s=DataMgr.gameCtrl.deskInfo;if(IsGameTypeNdmj(s.game_type)&&s.info&&0==s.info.spec_type){var r=DataMgr.gameCtrl.randPokerList||[];67==r[0]?i.sort(sort_card):i.sort(sort_card_ndmjOpenKing)}else i.sort(sort_card);i=i.reverse()}return i},dispatchPoker:function(t,e){if(this.isFirstFixFlower)return!1;t=t||DataMgr.gameCtrl.lastDispatchIdx,e=e||DataMgr.gameCtrl.lastDispatchPoker,this.refreshLastPokerNum();var i=DataMgr.gameCtrl.getChairIdByWheelIdx(t);if(e>0&&t==DataMgr.gameCtrl.myWheelIdx){this["game_card"+i]&&this["game_card"+i].setTileData(0,e),this.item_quick&&(this.item_quickTile.setData(e,mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND,mjGame.TilePlace.HAND),this.item_quick.setVisible(!0));
var a=DataMgr.gameCtrl.actionList||[];0!=a.length||this.isInitFixFlower||this._showFinger(!0,!0)}else this["game_card"+i]&&this["game_card"+i].setTileData(0,0);return i>0&&(this.unschedule(555),this.scheduleOnce(function(){for(var t=1;t<=4;t++)this["item_outTips"+t]&&this["item_outTips"+t].setData(void 0)},1,555)),!0},hideDispatchPoker:function(){for(var t=1;t<=4;t++)this["game_card"+t]&&this["game_card"+t].setTileData(0,void 0)},_showFinger:function(t,e){cc.log("显示手指_showFinger-visible",t),this.img_finger&&(this.checkTing(t),t?(this.img_finger.stopAllActions(),this.img_finger.y=150,this.img_finger.runAction(cc.sequence(cc.moveBy(.8,cc.p(0,100)),cc.moveBy(0,cc.p(0,-100))).repeatForever()),e?this.img_finger.runAction(cc.sequence(cc.delayTime(3),cc.callFunc(function(){this.img_finger&&cc.sys.isObjectValid(this.img_finger)&&this.img_finger.setVisible(!0)},this))):this.img_finger.setVisible(!0)):(this.img_finger.stopAllActions(),this.img_finger.setVisible(!1)))},selectAction:function(){if(this.isAction&&!this.isFirstFixFlower){this.grp_myBtn.setAction();var t=DataMgr.gameCtrl.actionList||[];t.length>0&&this._showFinger(!1)}},setSelectActionEnable:function(){var t=this;t.isAction=!0,t.selectAction()},_flowerIdx:0,playFixFlowerAction:function(t){var e=DataMgr.gameCtrl.allFlowerList,i=e[t];if(!i)return void this.scheduleOnce(function(){this.showKing(!0),this.isInitFixFlower=!1},1);var a=DataMgr.gameCtrl.getChairIdByWheelIdx(i.idx);i.idx==DataMgr.gameCtrl.myWheelIdx?this.checkFlower(i.poker_list):this["role_card"+a]&&this["role_card"+a].refreshFlowerPokers(i.flower_list),this.playActionEfc(i.idx,{mj_action:MJ_FLOWER}),this._nowMap=i,this.scheduleOnce(function(){this.refreshPoker(!1,!0),this.isFirstFixFlower=!1},.5),this._flowerIdx=t+1,this.scheduleOnce(function(){this.playFixFlowerAction(this._flowerIdx)},1)},playFixFlowerAction2:function(t){for(var e=DataMgr.gameCtrl.allFlowerList,i=[],a=0;a<e.length;a++){var s=e[a].idx;i[s]=i[s]||[],i[s].push(e[a])}for(var r=!1,a=0;a<i.length;a++)if(i[a]){var n=i[a][t];if(n){r=!0;var o=DataMgr.gameCtrl.getChairIdByWheelIdx(n.idx);n.idx==DataMgr.gameCtrl.myWheelIdx?this.checkFlower(n.poker_list):this["role_card"+o]&&this["role_card"+o].refreshFlowerPokers(n.flower_list),this.playActionEfc(n.idx,{mj_action:MJ_FLOWER}),this._nowMap=n,this.scheduleOnce(function(){this.refreshPoker(!1,!0),this.isFirstFixFlower=!1},.5)}}r?(this._flowerIdx=t+1,this.scheduleOnce(function(){this.playFixFlowerAction2(this._flowerIdx)},.7)):this.scheduleOnce(function(){this.showKing(!0),this.isInitFixFlower=!1},1)},addFixFlower:function(t){var e=this.lastFlowerList,i=this.firstFlowerNum+t,a=e[i];if(!a)return this.isFirstFixFlower=!1,DataMgr.gameCtrl.curStep==MJ_STEP_SHOW_RESULT?void this.showResult():(this.dispatchPoker(),this.setHandTileEnabled(!0),this.btn_flower&&this.btn_flower.setTouchEnabled(!0),void this.setSelectActionEnable());this.subtractLastPokerNum(1);var s=DataMgr.gameCtrl.getChairIdByWheelIdx(this.firstFlowerWheelIdx);this.firstFlowerWheelIdx==DataMgr.gameCtrl.myWheelIdx?(this["game_card"+s]&&this["game_card"+s].setTileData(0,a),this["game_card"+s]&&this["game_card"+s].checkFlower()):this["role_card"+s]&&this["role_card"+s].addFlowerPokers(a),this.playActionEfc(this.firstFlowerWheelIdx,{mj_action:MJ_FLOWER}),this._flowerIdx=t+1,this.scheduleOnce(function(){this.addFixFlower(this._flowerIdx)},.5)},playActionEfc:function(t,e){if(e){var i=DataMgr.gameCtrl.getChairIdByWheelIdx(t),a=DataMgr.gameCtrl.wheelInfos[t],s=0;if((e.mj_action==MJ_CHI||e.mj_action==MJ_PENG||e.mj_action==MJ_GANG||e.mj_action==MJ_AN_GANG||e.mj_action==MJ_BU_GANG)&&a){var r=a.weave_pokers||[];if(s=r.length,e.mj_action==MJ_BU_GANG)for(var n=0;n<r.length;n++)if(e.poker_list[0]==r[n].poker_list[0]){s=n+1;break}var o=this["game_card"+i];s>0&&o&&o.playActionEfc(r,t),IsGameTypeNdmj(DataMgr.gameCtrl.deskInfo.game_type)&&(e.mj_action==MJ_AN_GANG?this.subtractLastPokerNum(2):e.mj_action!=MJ_GANG&&e.mj_action!=MJ_BU_GANG||this.subtractLastPokerNum(1))}var c=this["item_actionEfc"+i],l=this["role_card"+i];c&&l&&(c.setSex(l.getSex()),c.setData(e)),this.clearMyBtn(e),this.unschedule(555);for(var n=1;n<=4;n++)this["item_outTips"+n]&&this["item_outTips"+n].setData(void 0);this.hidePutOutArrowAni()}},clearMyBtn:function(t){t&&(t.mj_action!=MJ_PENG&&t.mj_action!=MJ_GANG&&t.mj_action!=MJ_AN_GANG&&t.mj_action!=MJ_BU_GANG&&t.mj_action!=MJ_HU||this.grp_myBtn&&this.grp_myBtn.clear())},checkFlower:function(t){var e=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.myWheelIdx);this["game_card"+e]&&this["game_card"+e].checkFlower(),DataMgr.gameCtrl.initMyCards(t)},turnIndex:function(t){if(this.isTurning){this.item_turn.setVisible(!0);var e=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.curIndex);return this.item_turn.turn(e,15,t),!0}},setTurnIndexEnable:function(t){var e=this;e.isTurning=!0,e.turnIndex(t)},stepRandKing:function(){var t=this,e=DataMgr.gameCtrl.tbDownRandPokerList.length/2*3;t.scheduleOnce(function(){t.showKing()},e+2.5)},showKing:function(t){var e=this,i=1.5;DataMgr.gameCtrl.downRandPokerList.length>0&&(i=DataMgr.gameCtrl.curStep==MJ_STEP_GAME_END||DataMgr.gameCtrl.curStep==MJ_STEP_SHOW_RESULT?2.5:4),e.scheduleOnce(function(){cc.log("检测金-显示剩余牌"),e.setSelectActionEnable(),e.grp_last_num&&e.grp_last_num.setVisible(!0),e.setTurnIndexEnable()},i+DataMgr.gameCtrl.downRandPokerList.length/2*2);var a={},s=DataMgr.gameCtrl.deskInfo;IsGameTypeNdmj(s.game_type)&&s.info&&0==s.info.spec_type?a.pokerList=[67]:a.pokerList=DataMgr.gameCtrl.randPokerList,a.showKingType=this.showKingType,a.func=function(){var i=DataMgr.gameCtrl.deskInfo;set_king_map(IsGameTypeNdmj(i.game_type)&&i.info&&0==i.info.spec_type?[67]:DataMgr.gameCtrl.randPokerList),e.checkKingGrp(),t?e.refreshPoker(!1,!0):e.refreshPoker(),e.dispatchPoker()},a.dlgZorder=99,ModuleMgr.runDlg("NewGameShowKing",a,null,null)},checkKingGrp:function(){if(!DataMgr.gameCtrl.randPokerList||DataMgr.gameCtrl.randPokerList.length<=0)return void this.item_king.setVisible(!1);this.item_king.setVisible(!0);var t=DataMgr.gameCtrl.deskInfo,e=t.info;this.isLog&&(t=this.replayData.desk_info,e=this.replayData.desk_info),IsGameTypeNdmj(t.game_type)&&e&&0==e.spec_type?this.item_king.setData(MJ_KING_ARR):this.item_king.setData(DataMgr.gameCtrl.randPokerList),DataMgr.gameCtrl.myWheelInfo&&(this.setHandTileEnabled(!0),this.btn_flower&&this.btn_flower.setTouchEnabled(!0),DataMgr.gameCtrl.setUserFlowerList())},showResult:function(){if(!this.isFirstFixFlower){var t=this;t.grp_myBtn.setVisible(!1),this.item_quick&&this.item_quick.setVisible(!1),this.item_alreadyTingTips&&this.item_alreadyTingTips.setVisible(!1),this.setHandTileEnabled(!1),t.isTurning=!1,t.isAction=!1,t.isDispatchPoker=!1,this.refreshResultPokers();var e=0;DataMgr.gameCtrl.huIdx>0?(this.playActionEfc(DataMgr.gameCtrl.huIdx,{mj_action:MJ_HU}),e=2):(t.grp_liuju&&t.grp_liuju.setVisible(!0),t.ani_liuju&&t.ani_liuju.getAnimation().play("stand",-1,-1),t.ani_liuju&&t.ani_liuju.getAnimation().setMovementEventCallFunc(function(e,i,a){i==ccs.MovementEventType.complete&&t.grp_liuju.setVisible(!1)},t),e=2);for(var i=!1,a=DataMgr.gameCtrl.huTypeList||[],s=0;s<a.length;s++)if(a[s]==MJ_ZI_MO){i=!0;break}this.showResultDlg(e)}},refreshRoleScore:function(){if(DataMgr.gameCtrl.curRoundScore)for(var t=1;t<=4;t++){var e=DataMgr.gameCtrl.curRoundScore["idx"+t],i=DataMgr.gameCtrl.getChairIdByWheelIdx(t);this["role_card"+i]&&this["role_card"+i].setScore(e)}},scoreChange:function(t){this.scoreChangeAction()},scoreChangeAction:function(t){t=t||DataMgr.gameCtrl.curRoundScore;for(var e=1;e<=4;e++){var t=t["idx"+e],i=DataMgr.gameCtrl.getChairIdByWheelIdx(e),a=this["role_card"+i];if(a){var s=a.getScore(),r=t-s;0!=r&&a.setAddScore(r)}}},refreshResultPokers:function(){var t=DataMgr.gameCtrl.resultData,e=t.details,i=t.cur_hu_types||[];if(e){for(var a=0;a<e.length;a++){var s=e[a],r=s.idx||a+1,n=DataMgr.gameCtrl.getChairIdByWheelIdx(r),o=this["game_card"+n];if(o){var c=gDup(s.poker_list),l=DataMgr.gameCtrl.deskInfo;if(IsGameTypeNdmj(l.game_type)&&l.info&&0==l.info.spec_type){var _=DataMgr.gameCtrl.randPokerList||[];67==_[0]?c.sort(sort_card):c.sort(sort_card_ndmjOpenKing)}else c.sort(sort_card);if(c=c.reverse(),t.win_idx==r){for(var u=t.last_out_poker,h=0;h<i.length;h++)i[h]==MJ_HU_CATCH_KING&&MJ_KING_ARR[0]&&(u=MJ_KING_ARR[0]);o.refreshResultPokers(!0,c,t.last_dispatch_poker,u)}else o.refreshResultPokers(!0,c);o.refreshWeavePoker(s.weave_pokers,r)}}playEffect("tanpai.mp3")}},showResultDlg:function(t){var e=this,i=DataMgr.gameCtrl.downRandPokerList,a=Math.floor((i.length||0)/2);1==DataMgr.gameCtrl.deskType&&(a=0),this.scheduleOnce(function(){e.showSubResult()},t+3.5*a)},showSubResult:function(){for(var t={},e=1;e<=4;e++){var i=DataMgr.gameCtrl.curRoundScore["idx"+e],a=DataMgr.gameCtrl.getChairIdByWheelIdx(e),s=this["role_card"+a];if(s&&!DataMgr.gameCtrl.isLog){var r=s.getScore(),n=i-r;e==DataMgr.gameCtrl.myWheelIdx?t.addScore=n:s.setAddScore(n)}}this.refreshRoleScore();var o=DataMgr.gameCtrl.deskInfo.cur_step;o!=MJ_STEP_SHOW_RESULT&&o!=MJ_STEP_GAME_END||this.item_huEffect.showHuEffect()},clearResuleCard:function(){var t=this;t.hideDispatchPoker();for(var e=1;e<=4;e++)t["role_card"+e]&&t["role_card"+e].setResultStatus(),t["game_card"+e]&&t["game_card"+e].setResultStatus(),t["game_disCard"+e]&&t["game_disCard"+e].setResultStatus();t.resetUI(),t.item_waitinglabel&&t.item_waitinglabel.showWaiting(!0,1),t.item_turn&&t.item_turn.setVisible(!1),t.btn_flower&&t.btn_flower.setVisible(!1)},gameOver:function(){var t={};t.deskId=DataMgr.gameCtrl.deskInfo.desk_idx,t.round=DataMgr.gameCtrl.deskInfo.full_round,t.creatTime=DataMgr.gameCtrl.deskInfo.desk_create_time,t.crazyLv=DataMgr.gameCtrl.deskInfo.crazy_lv,t.deskScoreType=DataMgr.gameCtrl.deskInfo.desk_score_type,t.players=[],t.recordId=DataMgr.gameCtrl.recordId,t.hasBigPoker=DataMgr.gameCtrl.hasBigPoker,t.union_rid=DataMgr.gameCtrl.deskInfo.union_rid;var e=ConvertToJson(DataMgr.gameCtrl.recordDetail);t.deskScoreType=e.desk_score_type,t.curRound=e.cur_round;var i=e.score,a=e.users,s=e.mj_count_list||[];t.replayRecords=e.replay_records;for(var r=0;r<a.length;r++){var n=r+1,o=a[r];if(o.rid){var c={headUrl:o.headimgurl,baseScore:0,score:i["idx"+n],idx:n,name:o.name,rid:o.rid,accountUid:o.account_uid,mjCountData:s[r]};t.players.push(c)}}for(var l=DataMgr.gameCtrl.deskInfo.desk_own_rid,r=0;r<t.players.length;r++)t.players[r]&&t.players[r].rid==l&&(t.ownerName=t.players[r].name,t.ownerRid=l);this.openRecordDetail(t)},openRecordDetail:function(t){cc.log("openRecordDetail-detailData",t),ModuleMgr.runDlg("NewGameLastResult",t,null,null)},faceInter:function(t){var e=this,i=this.faceInfo[t.faceId];if(1==i.type){if(t.idx1!=DataMgr.gameCtrl.myWheelIdx)return;var a=ccs.Armature.create(i.effect_name);return void(a&&(playEffect("face/face_qifu.mp3"),a.getAnimation().play("stand",-1,-1),a.setPosition(cc.winSize.width/2,cc.winSize.height/2),"effect_guanyu"==i.effect_name&&(a.x=a.x+40),"effect_money_man"==i.effect_name&&(a.x=a.x+40,a.y=a.y+40),SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&a.setPosition(cc.winSize.height/2,cc.winSize.width/2),a.setZOrder(9999),a.setScale(2),a.getAnimation().setMovementEventCallFunc(function(t,e,i){e==ccs.MovementEventType.complete&&t.removeFromParent()},this),e.addChild(a)))}var s=t.idx1,r=t.idx2,n=i.effect_name,o=DataMgr.gameCtrl.getChairIdByWheelIdx(s),c=DataMgr.gameCtrl.getChairIdByWheelIdx(r),l=e["role_card"+o]&&e["role_card"+o].getChildByName("head"),_=e["role_card"+c]&&e["role_card"+c].getChildByName("head");if(l&&_){var u=l.item_head.getParent().convertToWorldSpace(l.item_head.getPosition()),h=cc.p(e.convertToNodeSpace(u).x,e.convertToNodeSpace(u).y);u=_.item_head.getParent().convertToWorldSpace(_.item_head.getPosition());var g=cc.p(e.convertToNodeSpace(u).x,e.convertToNodeSpace(u).y),a=ccs.Armature.create(n);a&&(a.targetpos2=g,a.targetpos1=h,a.chairId1=o,a.chairId2=c,a.getAnimation().play("stand",-1,-1),a.setVisible(!0),a.setPosition(h),a.setZOrder(9999),e.addChild(a),a.getAnimation().setMovementEventCallFunc(function(t,i,a){if(i==ccs.MovementEventType.complete){var s=ModuleMgr.getDlg("NewGameLayer").getBezierControlPoint(t.targetpos1,t.targetpos2,t.chairId1,t.chairId2),r=[s,s,t.targetpos2],o=cc.BezierTo.create(.6,r),c=cc.RotateTo.create(.6,720),l=cc.RotateTo.create(.6,720),_=cc.Sequence.create(c,l),u=cc.CallFunc.create(function(){var i=ccs.Armature.create(n+"_hit");playEffect("face/"+n+".mp3"),i&&(i.getAnimation().play("stand",-1,-1),i.setPosition(t.targetpos2),e.addChild(i),i.getAnimation().setMovementEventCallFunc(function(t,e,i){e==ccs.MovementEventType.complete&&t.removeFromParent()},this))}),h=cc.Sequence.create(o,cc.CallFunc.create(function(t){t.removeFromParent()},t),u);t.runAction(cc.Spawn.create(_,h))}},this))}},getBezierControlPoint:function(t,e,i,a){var s=cc.p(0,0);return 1==i&&2==a||2==i&&1==a?t.x>e.x?(s.x=e.x+(t.x-e.x)/2+200,s.y=e.y+(t.y-e.y)/2-200):(s.x=t.x+(e.x-t.x)/2+200,s.y=t.y+(e.y-t.y)/2-200):2==i&&3==a||3==i&&2==a?t.x>e.x?SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=t.x-(t.x-e.x)/2-200,s.y=t.y+(e.y-t.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=t.x-(t.x-e.x)/2+200,s.y=t.y+(e.y-t.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=e.x-(e.x-t.x)/2+200,s.y=e.y+(t.y-e.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=t.x+(e.x-t.x)/2+200,s.y=e.y+(t.y-e.y)/2+200):3==i&&4==a||4==i&&3==a?t.x>e.x?SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=e.x+(t.x-e.x)/2+200,s.y=e.y+(t.y-e.y)/2+200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=e.x+(t.x-e.x)/2-200,s.y=e.y+(t.y-e.y)/2+200):(s.x=t.x+(e.x-t.x)/2-200,s.y=t.y+(e.y-t.y)/2+200):1==i&&4==a||4==i&&1==a?t.x>e.x?SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE?(s.x=e.x+(t.x-e.x)/2-200,s.y=e.y+(t.y-e.y)/2-200):SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(s.x=e.x+(t.x-e.x)/2-200,s.y=e.y+(t.y-e.y)/2+200):(s.x=t.x+(e.x-t.x)/2-200,s.y=t.y+(e.y-t.y)/2+200):2==i&&4==a||4==i&&2==a?t.y>e.y?(s.x=e.x+200,s.y=e.y+cc.pDistance(t,e)/2):(s.x=t.x+200,s.y=t.y+cc.pDistance(t,e)/2):(1==i&&3==a||3==i&&1==a)&&(t.y>e.y?(s.x=e.x-200,s.y=e.y+cc.pDistance(t,e)/2):(s.x=t.x-200,s.y=t.y+cc.pDistance(t,e)/2)),s},checkTing:function(t){this.game_card4&&this.game_card4.checkTing(t)},checkAlreadyTing:function(){if(!DataMgr.gameCtrl.isLog&&DataMgr.gameCtrl.deskInfo.cur_step==MJ_STEP_PLAY){var t=this.game_card4;if(t&&t.isVisible()&&this.item_alreadyTingTips){var e=!1,i=[],a=!1,s=DataMgr.gameCtrl.deskInfo;IsGameTypeNdmj(s.game_type)&&(a=!0,i=[mjGame.Common.CardType.JIAN_3]);var r=t.getHeadCodeList(),n=r.length;if(n>0&&n%3!=2){if(this.item_alreadyTingTips.isVisible())return;var o=0,c=s.info,l=DataMgr.gameCtrl.randPokerList||[];l.length>0&&(o=getCodeByNum(IsGameTypeNdmj(s.game_type)&&c&&0==c.spec_type?67:l[0]));for(var _=[],u=DataMgr.gameCtrl.myWheelInfo.weave_pokers||[],h=0;h<u.length;h++){var g=mjGame.Common.PaiXing.NO;switch(u[h].mj_action){case MJ_CHI:g=mjGame.Common.PaiXing.CHI;break;case MJ_PENG:g=mjGame.Common.PaiXing.PENG;break;case MJ_GANG:g=mjGame.Common.PaiXing.GANG_DIAN;break;case MJ_BU_GANG:g=mjGame.Common.PaiXing.GANG_MING;break;case MJ_AN_GANG:g=mjGame.Common.PaiXing.GANG_AN}_.push({cardList:u[h].poker_list,paixing:g})}for(var d=[],m=mjGame.Common.Func.isCanTing(r,_,o,e,i,!0),h=0;h<m.length;h++)d.push(m[h]);if(a)for(var f=mjGame.Common.Func.isBig7DuiTing(r,_,o,e,i,!0),h=0;h<f.length;h++){for(var p=f[h].dropCard,M=f[h].tingCards,C=null,D=0;D<d.length;D++)p==d[D].dropCard&&(C=D);if(null!=C){for(var b=0;b<M.length;b++)d[C].tingCards.push(M[b]);d[C].tingCards=unique(d[C].tingCards),d[C].tingCards.sort(function(t,e){return t-e})}else d.push(f[h])}for(var y=[],h=0;h<d.length;h++){var v=d[h].dropCard;if(0==v){l.length>0&&IsGameTypeNdmj(s.game_type)&&c&&0==c.spec_type&&(v==getCodeByNum(67)?v=getCodeByNum(l[0]):v==getCodeByNum(l[0])&&(v=getCodeByNum(67)));for(var E=0;E<d[h].tingCards.length;E++){var I=d[h].tingCards[E],S=4-DataMgr.gameCtrl.getAppearCountByTile(getNumByCode(I));S<0&&(S=0),y.push({card:I,num:S})}}}if(y.length>0)return this.item_alreadyTingTips.setTingList(y),void this.item_alreadyTingTips.setVisible(!0)}this.item_alreadyTingTips.setVisible(!1)}}},deal_SuccessUserReady:function(t){cc.log("deal_SuccessUserReady");var e=this,i=t.getUserData(),a=i.idx,s=DataMgr.gameCtrl.getChairIdByWheelIdx(a);e["role_card"+s]&&e["role_card"+s].setReady(1);for(var r=DataMgr.gameCtrl.deskInfo,n=0,o=r.full_num,c=1;c<=o;c++){var l=DataMgr.gameCtrl.wheelInfos[c];l&&1==l.is_ready&&(n+=1)}n>=o&&r&&1!=r.is_check_allready&&r.desk_own_rid==ME_D.get_rid()&&0==this.startType&&this.tap_do_start_game()},deal_SuccesRefreshPlayers:function(t){cc.log("deal_SuccesRefreshPlayers");var e=this;e.refreshPlayers()},deal_SuccessEnterDesk:function(t){cc.log("deal_SuccessEnterDesk");var e=this,i=t.getUserData();i?e.refreshPlayers():e.refreshPlayersOnline()},deal_SuccessLeaveDesk:function(t){cc.log("deal_SuccessLeaveDesk");var e=this,i=t.getUserData();i?e.refreshPlayers():e.refreshPlayersOnline()},deal_SuccessOwnLeaveDesk:function(t){cc.log("deal_SuccessOwnLeaveDesk"),this.isDissolve||ModuleMgr.enterEnterScene()},deal_SuccessDissolve:function(t){cc.log("deal_SuccessDissolve"),DataMgr.gameCtrl.deskInfo&&DataMgr.gameCtrl.deskInfo.cur_round>1&&(this.isDissolve=!0,ModuleMgr.closeDlg("NewGameDissolve"),this.gameOver())},deal_RefreshRound:function(t){cc.log("deal_RefreshRound"),this.refreshRound()},deal_SuccessRandMaster:function(t){cc.log("deal_SuccessRandMaster"),this.stepRandMaster()},deal_SuccessStepChange:function(t){cc.log("deal_SuccessStepChange"),this.stepChange()},deal_SuccessStartGame:function(t){cc.log("deal_SuccessStartGame"),this.SuccessStartGame(),this.setTurnIndexEnable(!0)},deal_SuccessOpenDoor:function(t){cc.log("deal_SuccessOpenDoor"),this.stepOpenDoor()},deal_SuccessPokerInit:function(t){cc.log("deal_SuccessPokerInit"),set_king_map([]),this.onPokerInited(!0),IsGameTypeNdmj(DataMgr.gameCtrl.deskInfo.game_type)&&this.stepRandKing()},deal_DispatchPoker:function(t){cc.log("deal_DispatchPoker");var e=t.getUserData(),i=e.idx,a=e.poker_num;this.dispatchPoker(i,a)},deal_SuccesAllPokersFixFlower:function(t){cc.log("deal_SuccesAllPokersFixFlower"),this.isFirstFixFlower=!0,this.isInitFixFlower=!0,this.scheduleOnce(function(){this.playFixFlowerAction2(0)},1)},firstFlowerWheelIdx:0,firstFlowerNum:0,lastFlowerList:[],deal_SuccessFixFlower:function(t){cc.log("deal_SuccessFixFlower");var e=t.getUserData();if(DataMgr.gameCtrl.curStep==MJ_STEP_PLAY){if(this.lastFlowerList=e.flower_list,this.isFirstFixFlower)return;this.setHandTileEnabled(!1),this.btn_flower&&this.btn_flower.setTouchEnabled(!1),this.item_quick&&this.item_quick.setVisible(!1),this.isFirstFixFlower=!0,this.firstFlowerWheelIdx=e.idx,this.firstFlowerNum=e.flower_list.length-1;var i=DataMgr.gameCtrl.getChairIdByWheelIdx(e.idx),a=e.flower_list[this.firstFlowerNum];this["game_card"+i]&&this["game_card"+i].setTileData(0,a),this.scheduleOnce(function(){this.addFixFlower(0)},0)}},deal_AddFlowerPokers:function(t){cc.log("deal_AddFlowerPokers");var e=t.getUserData(),i=DataMgr.gameCtrl.getChairIdByWheelIdx(e.idx),a=this["role_card"+i];a&&a.addFlowerPokers(e.poker),this.refreshPoker(!1,!0)},deal_TurnIndex:function(t){cc.log("deal_TurnIndex"),this.turnIndex()},deal_SuccessRandPoker:function(t){cc.log("deal_SuccessRandPoker")},deal_refreshPoker:function(t){cc.log("deal_refreshPoker"),this.refreshPoker()},deal_SuccessDealPoker:function(t){cc.log("deal_SuccessDealPoker"),this.dealPoker()},deal_HideDispatchPoker:function(t){cc.log("deal_HideDispatchPoker"),this.hideDispatchPoker()},deal_HideCurOutCard:function(t){cc.log("deal_HideCurOutCard"),this.hideCurOutCard()},deal_SuccessNoAction:function(t){cc.log("deal_SuccessNoAction"),this.noAction()},deal_SuccessSelectAction:function(t){cc.log("deal_SuccessSelectAction"),this.selectAction()},deal_PlayActionEfc:function(t){cc.log("deal_PlayActionEfc");var e=t.getUserData(),i=e.idx,a=e.data;this.playActionEfc(i,a)},deal_RefreshWeakPoker:function(t){cc.log("deal_RefreshWeakPoker"),this.refreshWeakPoker()},deal_SuccessShowResult:function(t){cc.log("deal_SuccessShowResult"),this.showResult()},deal_RefreshRoleScore:function(t){cc.log("deal_RefreshRoleScore"),this.refreshRoleScore()},deal_SuccessGameEnd:function(t){cc.log("deal_SuccessGameEnd"),this.gameOver(),this.isPlaying=!1},deal_ShowResultDesktopBtn:function(t){cc.log("deal_ShowResultDesktopBtn"),this.isLog?this.btn_desktop2.setVisible(!0):this.btn_desktop.setVisible(!0)},deal_SuccesScoreChange:function(t){cc.log("deal_SuccesScoreChange");var e=t.getUserData();this.scoreChange(e)},deal_SuccessTswScoreEnd:function(t){cc.log("deal_SuccessTswScoreEnd");var e=this,i=t.getUserData(),a=i.idx,s=DataMgr.gameCtrl.getChairIdByWheelIdx(a);e["role_card"+s]&&e["role_card"+s].setReady(1)},deal_ClearResuleCard:function(t){cc.log("deal_ClearResuleCard"),this.clearResuleCard()},deal_ShowDesktopLine:function(t){var e=t.getUserData();this.item_line&&this.item_line.setVisible(e)},deal_SuccesSetDeskBg:function(t){cc.log("deal_SuccesSetDeskBg"),this.setDeskBg()},deal_SuccesSetTileSize:function(t){cc.log("deal_SuccesSetTileSize"),this.setTileSize()},deal_SuccesShowFinger:function(t){cc.log("deal_SuccesShowFinger"),this.item_quick&&this.item_quick.isVisible()&&this._showFinger(!0,!0)},deal_SuccesShowTingCard:function(t){cc.log("deal_SuccesShowTingCard");var e=t.getUserData();cc.log("data",e),this.item_tingTips&&(e.isShow&&e.tingCards&&e.tingCards.length>0?(this.item_tingTips.setTingList(e.tingCards),this.item_tingTips.setVisible(!0)):this.item_tingTips.setVisible(!1))},deal_SuccesShowSurplus:function(t){cc.log("deal_SuccesShowSurplus");var e=t.getUserData();cc.log("data",e),this.item_surplusTips&&(e.isShow&&e.card>0?(this.item_surplusTips.setData(e.card),this.item_surplusTips.setVisible(!0)):this.item_surplusTips.setVisible(!1))},deal_SuccessPlayChatTxt:function(t){cc.log("deal_SuccessPlayChatTxt");var e=t.getUserData(),i=e.chair;this["role_card"+i]&&this["role_card"+i].showChatLab(e.txt)},deal_SuccessPlayChatFace:function(t){cc.log("deal_SuccessPlayChatFace");var e=t.getUserData(),i=e.chair;this["role_card"+i]&&this["role_card"+i].showChatFace(e.faceId)},deal_SuccessStartPlayRecord:function(t){cc.log("deal_SuccessStartPlayRecord");var e=this,i=t.getUserData(),a=DataMgr.gameCtrl.deskChat[i];e["role_card"+a]&&e["role_card"+a].showTalk()},deal_SuccessEndPlayRecord:function(t){cc.log("deal_SuccessEndPlayRecord");var e=this,i=t.getUserData(),a=DataMgr.gameCtrl.deskChat[i];e["role_card"+a]&&e["role_card"+a].stopTalk()},deal_FaceInter:function(t){if(cc.log("deal_FaceInter"),0==this.isAllUILoaded)return void(this.eventStack.SuccessFaceInter=t.getUserData());var e=t.getUserData();this.faceInter(e)},deal_SuccesLogExit:function(t){cc.log("deal_SuccesLogExit"),cc.sys.isNative||parseInt(ME_D.get_uid())>0?(console.log("deal_SuccesLogExit enterEnterScene"),ModuleMgr.enterEnterScene()):(console.log("deal_SuccesLogExit LoginScene"),ModuleMgr.runScene("LoginScene"))},deal_CheckCardSelectMove:function(t){cc.log("deal_CheckCardSelectMove")},deal_SUCCECES_ROOM_CREATE:function(t){cc.log("deal_SUCCECES_ROOM_CREATE")},deal_ErrorOp:function(t){cc.log("deal_ErrorOp")},deal_ShowDownKing:function(t){cc.log("deal_ShowDownKing")},deal_SuccesShowCard:function(t){cc.log("deal_SuccesShowCard")},deal_SuccesSelectPiao:function(t){cc.log("deal_SuccesSelectPiao")},deal_SuccesChaoMaster:function(t){cc.log("deal_SuccesChaoMaster")},deal_SuccesSetCardBg:function(t){cc.log("deal_SuccesSetCardBg")},deal_RefreshRandMineLayer:function(t){cc.log("deal_RefreshRandMineLayer")},_testResult:function(){DataMgr.gameCtrl.resultData={game_type:GAME_TYPE_FZMJ,win_idx:1,last_out_poker_idx:3,last_out_poker:6,last_dispatch_idx:255,last_dispatch_poker:0,last_win_op_idx:1,cur_op_idx:4,last_master_times:0,cur_hu_types:[291],cur_round_score:{idx1:0,idx2:0,idx3:0,idx4:0},cur_score:{idx1:51,idx2:-17,idx3:-17,idx4:-17},details:[{idx:1,hu_score:51,poker_list:[24,23,22,18,18,8,7],out_pokers:[],flower_list:[66],weave_pokers:[{mj_action:2,last_out_poker_idx:3,last_out_poker:41,poker_list:[41,41,41]},{mj_action:2,last_out_poker_idx:2,last_out_poker:9,poker_list:[9,9,9]},{mj_action:1,last_out_poker_idx:4,last_out_poker:7,poker_list:[7,8,9]}]},{idx:2,hu_score:-17,poker_list:[24,24,21,8,8,7,7],flower_list:[50,51,51,67,83,65,67,66,51,52,50],out_pokers:[],weave_pokers:[{mj_action:2,last_out_poker_idx:1,last_out_poker:40,poker_list:[40,40,40]},{mj_action:2,last_out_poker_idx:4,last_out_poker:3,poker_list:[3,3,3]},{mj_action:2,last_out_poker_idx:3,last_out_poker:4,poker_list:[4,4,4]}]},{idx:3,hu_score:-17,poker_list:[38,36,25,23,23,22,22,17,6,5],out_pokers:[],flower_list:[49,49,66,67,97,51],weave_pokers:[{mj_action:2,last_out_poker_idx:2,last_out_poker:20,poker_list:[20,20,20]},{mj_action:1,last_out_poker_idx:2,last_out_poker:33,poker_list:[33,34,35]}]},{idx:4,hu_score:-17,poker_list:[40,39,38,37,35,35,34,25,22,21,20,18,18],out_pokers:[],flower_list:[49,52,65,67,99,100,82,66],weave_pokers:[{mj_action:2,last_out_poker_idx:2,last_out_poker:19,poker_list:[19,19,19]}]}],other_score:[{idx:4,pg_score:0,kind_score:0,all_score:8,flower_score:8,score_n:0},{idx:1,all_score:1,flower_score:1,kind_score:0,pg_score:0,score_n:0},{idx:2,all_score:11,pg_score:0,kind_score:0,flower_score:11,score_n:0},{idx:3,flower_score:6,kind_score:1,all_score:7,pg_score:0,score_n:0}]}},_testAllResult:function(){return{crazyLv:void 0,creatTime:1536042926,deskId:200487,deskScoreType:void 0,hasBigPoker:void 0,ownerName:"auto_18211",ownerRid:"1WXYDZ501005",recordId:"1X1P47301004",curRound:1,round:8,players:[{idx:1,headUrl:"",baseScore:0,score:0,name:"auto_18211",rid:"1WXYDZ501005",accountUid:"18211",headData:{name:"",headimgurl:"",isOwn:!0},mjCountData:{angang_count:1}},{idx:2,headUrl:"",baseScore:0,score:0,name:"auto_18212",rid:"1WXYG6201007",accountUid:"18212",headData:{name:"",headimgurl:"",isOwn:!1},mjCountData:{angang_count:1}},{idx:3,headUrl:"",baseScore:0,score:0,name:"auto_18213",rid:"1WXYGA601009",accountUid:"18213",headData:{name:"",headimgurl:"",isOwn:!1},mjCountData:{angang_count:1}},{idx:4,headUrl:"",baseScore:0,score:0,name:"auto_18214",rid:"1WXYGD20100C",accountUid:"18214",mjCountData:{angang_count:1}}],replayRecords:[{time:1536047332,cur_hu_types:{},rid:"1X1N4D401001",idx:1,users:[{score:3,headimgurl:"",rid:"1WXYDZ501005",name:"auto_18211"},{score:-1,headimgurl:"",rid:"1WXYG6201007",name:"auto_18212"},{score:-1,headimgurl:"",rid:"1WXYGA601009",name:"auto_18213"},{score:-1,headimgurl:"",rid:"1WXYGD20100C",name:"auto_18214"}]},{time:1536047332,cur_hu_types:{},rid:"1X1NCP501002",idx:2,users:[{score:-2,headimgurl:"",rid:"1WXYDZ501005",name:"auto_18211"},{score:4,headimgurl:"",rid:"1WXYG6201007",name:"auto_18212"},{score:-1,headimgurl:"",rid:"1WXYGA601009",name:"auto_18213"},{score:-1,headimgurl:"",rid:"1WXYGD20100C",name:"auto_18214"}]},{time:1536047332,cur_hu_types:{},rid:"1X1NTY101003",idx:3,users:[{score:3,headimgurl:"",rid:"1WXYDZ501005",name:"auto_18211"},{score:-1,headimgurl:"",rid:"1WXYG6201007",name:"auto_18212"},{score:-1,headimgurl:"",rid:"1WXYGA601009",name:"auto_18213"},{score:-1,headimgurl:"",rid:"1WXYGD20100C",name:"auto_18214"}]}]}},tap_btn_touch:function(){this._downBtnEvent(!1,!0),this.game_card4&&this.game_card4.setAllTileDown()},_downBtnEvent:function(t,e){if(!this.item_down.isMoving){var i="res/uires/new/game/desktop/downBtn.png",a=cc.winSize.width;t&&(i="res/uires/new/game/desktop/downBtn_1.png",a=cc.winSize.width-this.item_down.height-65),this.btn_down.loadTextures(i,i,i,ccui.Widget.LOCAL_TEXTURE),this.item_down.runAction(cc.sequence(cc.callFunc(function(){this.item_down.isMoving=!0},this),cc.moveTo(.2,cc.p(this.item_down.x,a)),cc.callFunc(function(){this.item_down.isMoving=!1},this))),e?this.item_down.isAlreadyOpen=!1:this.item_down.isAlreadyOpen=!this.item_down.isAlreadyOpen}},tap_btn_down:function(){this._downBtnEvent(!this.item_down.isAlreadyOpen)},tap_btn_back:function(){if(this.isLog)return console.log("back isLog==true"),void ModuleMgr.showConfirmCancelMsg("是否要退出房间?",function(){console.log("layer-back SuccesLogExit"),cc.eventManager.dispatchCustomEvent("SuccesLogExit")},function(){});var t=this,e=!1;(DataMgr.gameCtrl.deskInfo.desk_own_rid==DataMgr.gameCtrl.deskInfo.real_desk_own_rid&&DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()||t.isPlaying)&&(e=!0);var i=function(){cc.log("tap_btn_back---onOk"),e?ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"apply_dissolve"}):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"leave_desk"})},a=function(){},s="是否要退出房间?";e&&(s="是否要解散房间?"),ModuleMgr.showConfirmCancelMsg(s,i,a)},tap_btn_setting:function(){ModuleMgr.runDlg("GameSettingDlg",{isPlaying:this.isPlaying},null,null)},tap_btn_gps:function(){ModuleMgr.runDlg("GameLocationDlg")},tap_btn_flower:function(){ModuleMgr.runDlg("FlowerCardDlg")},tap_btn_dissolve:function(){this.tap_btn_back()},tap_btn_exit:function(){this.tap_btn_back()},tap_btn_invite:function(){cc.sys.isNative?ModuleMgr.runDlg("SocialInviteDlg"):"undefined"!=typeof MostOneJSApis?shareRoomToLocate(3,LOCATE_PLAFORM.MOSTONE):shareRoomToLocate(0,LOCATE_PLAFORM.WECHAT)},tap_btn_invite_club:function(){if(DataMgr.gameCtrl.deskInfo.union_rid){if(this.shareToclubTime>0)return ModuleMgr.showTipMsg("分享功能冷却中，请稍等");this.shareToclubTime=5;var t=" (普通房)";DataMgr.gameCtrl.deskInfo.match_rid&&(t=" (赛制房)"),ModuleMgr.showTipMsg("成功"+t+"分享到好友圈");var e=this.getInviteInfo();t=e.title+t;var i=e.content;ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"share_to_match",title:t,content:i})}},getInviteInfo:function(t){var e={title:"",content:""},i=DataMgr.gameCtrl.deskInfo;if(i){var a=DataMgr.gameCtrl.deskPlayers,s="",r=i.game_type;r==GAME_TYPE_FZMJ?s="福州麻将":r==GAME_TYPE_NDMJ&&(s="宁德麻将"),e.title+=s+"，房号 <"+DataMgr.gameCtrl.deskIdx+"> ，";for(var n=i.full_num||4,o=0,c="",l=0;l<a.length;l++)a[l]&&a[l].info&&(c+="，"+a[l].info.name,o++);e.title+=o+"缺"+(n-o),e.title+=c,e.content+="玩法："+s,t&&(i.union_rid?e.content+="，好友圈开房":e.content+="，房主开房"),e.content+="，"+i.full_round+"局",e.content+="，"+i.full_num+"人";var _=i.info;switch(i.game_type){case"fzmj":_&&(1==_.cost?e.content+="，放胡均摊":e.content+="，放胡单赔",1==_.spec1&&(e.content+="，清一色"),1==_.spec3&&(e.content+="，可胡金龙"),1==_.spec2&&(e.content+="，单钓剩金不平胡"),1==_.spec4&&(e.content+="，金雀开口不平胡"));break;case"ndmj":_&&(1==_.cost?e.content+="，放胡均摊":e.content+="，放胡单赔",1==_.spec_type?e.content+="，白板为金":e.content+="，开金")}}return e},tap_btn_copy:function(){cc.log("tap_btn_copy"),ModuleMgr.showTipMsg("暂未开启该功能")},tap_do_start_game:function(){DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"start_game"})},tap_btn_open_door:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"open_door"})},tap_btn_desktop:function(){this.btn_desktop.setVisible(!1);var t=DataMgr.gameCtrl.curStep;t!=MJ_STEP_SHOW_RESULT&&t!=MJ_STEP_GAME_END||(DataMgr.gameCtrl.isLog||(t==MJ_STEP_GAME_END?cc.eventManager.dispatchCustomEvent("SuccessGameEnd"):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"score_end"})),cc.eventManager.dispatchCustomEvent("ClearResuleCard"))},tap_btn_desktop2:function(){console.log("桌面退出按钮"),this.btn_desktop2.setVisible(!1),console.log("layer-desktop SuccesLogExit"),cc.eventManager.dispatchCustomEvent("SuccesLogExit")},tap_btn_wang:function(){this.item_wang.setVisible(!this.item_wang.isVisible())},tap_btn_wang1:function(){ModuleMgr.getDlg("XiShouAni")||ModuleMgr.getDlg("BaiShenAni")||ModuleMgr.runDlg("XiShouAni")},tap_btn_wang2:function(){ModuleMgr.getDlg("XiShouAni")||ModuleMgr.getDlg("BaiShenAni")||ModuleMgr.runDlg("BaiShenAni")},tap_btn_quick:function(){this.item_quickTile&&this.item_quickTile.discard(),this.game_card4&&this.game_card4.setAllTileDown()},tap_btn_chat:function(){ModuleMgr.runDlg("GameChatDlg")},tap_btn_download:function(){if(!cc.sys.isNative){var t="";t=/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?"http://fir.im/42nd":"http://a.app.qq.com/o/simple.jsp?pkgname=com.gongpa.hall&fromcase=20000&ckey=CK1369326626282&g_f=1002963",
window.open(t)}}}),NewGameLayer.create=function(t,e,i){return new NewGameLayer(t,e,i)},ModuleMgr.registerModule("NewGameLayer",NewGameLayer),NewGameHead=QPLayer.extend({uiPath:"ui/new/game/NewGameHead.ui",data:null,ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.setScore(0),this.setScoreVisible(!0),this.setFlower(!1)},setData:function(t){var e=toDecodeURIComponent(t.name);if(e=cutOffStr(e,10,!0),this.lab_name&&this.lab_name.setString(e),ME_D.get_rid()==t.rid){this.item_head.setData(t);var i=DataMgr.propCtrl.getHeadPropInfo(),a=i?i.icon:null;this.item_head.setFrame(a)}else{this.item_head.setData(t);var a=null;t&&t.extra_data&&""!=t.extra_data.head&&(a=t.extra_data.head),this.item_head.setFrame(a)}},setOnline:function(t){t?this.icon_online.setVisible(!1):this.icon_online.setVisible(!0)},setScore:function(t){this.lab_score&&this.lab_score.setString("分: "+t)},setScoreVisible:function(t){this.lab_score&&this.lab_score.setVisible(t)},setMaster:function(t){this.img_master.setVisible(t)},setFlower:function(t,e){t?(this.item_flower.setVisible(!0),this.lab_flower&&this.lab_flower.setString(e)):this.item_flower.setVisible(!1)},setOwer:function(t){this.icon_ower.setVisible(t)},setNameColor:function(t){this.lab_name&&this.lab_name.setColor(t)}}),NewGameHead.create=function(t,e,i){return new NewGameHead(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameHead.ui",NewGameHead),NewGameHeadIcon=UrlHead.extend({uiPath:"ui/new/game/NewGameHeadIcon.ui",data:null,ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setData:function(t){this.setUrl(t.headimgurl)},setFrame:function(t){t&&""!=t?this.head_frame.loadTexture("item/"+t+".png",ccui.Widget.PLIST_TEXTURE):this.head_frame.loadTexture("item/touxiang.png",ccui.Widget.PLIST_TEXTURE),this.head_frame.setVisible(!0),this.head_frame.setLocalZOrder(LOCAL_Z_ORDER_OF_HEAD_FRAME)}}),NewGameHeadIcon.create=function(t,e,i){return new NewGameHeadIcon(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameHeadIcon.ui",NewGameHeadIcon),WaitingLabel=QPLayer.extend({uiPath:"ui/new/game/WaitingLabel.ui",data:null,_images:[],ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},showWaiting:function(t,e){if(!t)return void this.setVisible(!1);this.setVisible(!0),0==e?(this._images=[1,2,3,4,5,6,7,8,9],this.item_wait1.setVisible(!0),this.item_wait2.setVisible(!1)):(this._images=[11,12,13,14,15,16,17,18],this.item_wait2.setVisible(!0),this.item_wait1.setVisible(!1));var i=this._images.length;if(i>0){this.sprMove();var a=.2,s=cc.delayTime(i*a+1),r=cc.sequence(s,cc.callFunc(function(){this.sprMove()},this));this.runAction(cc.repeatForever(r))}},sprMove:function(){for(var t=.2,e=0;e<this._images.length;e++){var i=this["img_wait"+this._images[e]],a=cc.delayTime(.2*e),s=cc.moveBy(.2,cc.p(0,20)),r=cc.sequence(a,s,s.reverse(),cc.delayTime(7*t));i.runAction(r)}}}),WaitingLabel.create=function(t,e,i){return new WaitingLabel(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/WaitingLabel.ui",WaitingLabel),NewGameRoleCard=QPLayer.extend({uiPath:"ui/new/game/NewGameRoleCard1.ui",score:0,isReady:!1,rid:null,wheelIdx:0,wheelInfo:null,lieCardBaseClass:null,actionItemClass:null,outCardLineNum:8,outCardScale:0,flowerList:[],sex:0,putOutArrowAni:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.bg_chat.setScale9Enabled(!0),this.setEmpty()},setEmpty:function(){this.head&&this.head.setVisible(!1),this.icon_ready&&this.icon_ready.setVisible(!1)},setData:function(t){null!=t&&(this.rid=t.rid,this.wheelIdx=t.wheel_idx,this.setVisible(!0),this._data=t.info,this.head.setVisible(!0),this.head.setData(t.info),this.sex=t.info&&t.info.sex)},setLogData:function(t){null!=t&&(this.rid=t.rid,this.wheelIdx=t.wheel_idx,this.setVisible(!0),this.head.setVisible(!0),this.head.setData(t))},getSex:function(){return this.sex},setWheelInfo:function(t){t.out_pokers,t.flower_list;this.wheelInfo=t},setReady:function(t){t=t?t:0,this.isReady=1==t,this.icon_ready&&this.icon_ready.setVisible(this.isReady)},setOnline:function(t){this.head.setOnline(t),this.online=t,0==t&&this.setReady(0)},setScore:function(t){this.score=t,this.head&&this.head.setScore(t)},getScore:function(){return this.score},setAddScore:function(t){this.score+=t,this.head&&this.head.setScore(this.score)},setMaster:function(t){this.head&&this.head.setMaster(t)},startGame:function(){this.head&&this.head.setVisible(!0),this.icon_ready&&this.icon_ready.setVisible(!1)},setFlower:function(t,e){this.head&&this.head.setFlower(t,e)},initFlower:function(){this.flowerList=[],this.setFlower(!0,this.flowerList.length)},showFlower:function(){var t=DataMgr.gameCtrl.wheelInfos[this.wheelIdx];t&&(this.flowerList=t.flower_list||[]),this.setFlower(!0,this.flowerList.length)},hideFlower:function(){this.flowerList=[],this.setFlower(!1)},addFlowerPokers:function(t){this.flowerList.push(t),this.setFlower(!0,this.flowerList.length)},refreshFlowerPokers:function(t){this.flowerList=t,this.setFlower(!0,this.flowerList.length)},setResultStatus:function(){this.hideFlower()},showChatLab:function(t){function e(t){i.hideChatLab()}for(var i=this,a=0;a<chatCfgList.length;a++)if(chatCfgList[a]==t){var s=a+1;cc.log("idx",s),cc.log("sex",this.sex);var r=2==this.sex?"-w":"-m";playEffect(MUSIC_TYPE+"/talk/liaotian"+s+r+".mp3")}i.lab_chat.setString(t),i.bg_chat.width=i.lab_chat.width+40,i.grp_chat_txt.stopAllActions(),i.grp_chat_txt.setVisible(!0),i.grp_chat_txt.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(e)))},hideChatLab:function(){this.grp_chat_txt.setVisible(!1)},showChatFace:function(t){function e(t){i.hideChatFace()}var i=this;i.img_chat_face.stopAllActions(),i.img_chat_face.loadTexture(GetRealPath("res/uires/new/game/chat/"+t+".png")),i.img_chat_face.setVisible(!0),i.img_chat_face.setOpacity(0),i.img_chat_face.runAction(cc.sequence(cc.fadeIn(.4),cc.delayTime(1),cc.callFunc(e)))},hideChatFace:function(){this.img_chat_face.setVisible(!1)},showTalk:function(){this.icon_laba.setVisible(!0)},stopTalk:function(){this.icon_laba.setVisible(!1)},tap_btn_head:function(){if(!DataMgr.gameCtrl.isLog){var t=this.wheelIdx,e=DataMgr.gameCtrl.myWheelIdx;t!=e&&ModuleMgr.runDlg("NewGameFaceDlg",{headData:this._data,hit_index:e,hited_index:t},null,null)}}}),NewGameRoleCard.create=function(t,e,i){return new NewGameRoleCard(t,e,i)},ModuleMgr.registerModule("NewGameRoleCard",NewGameRoleCard),UIUtils.RegisterPathTemple("ui/new/game/NewGameRoleCard1.ui",NewGameRoleCard),NewGameRoleCard1=NewGameRoleCard.extend({uiPath:"ui/new/game/NewGameRoleCard1.ui",onLoaded:function(){NewGameRoleCard.prototype.onLoaded.call(this)}}),NewGameRoleCard1.create=function(t,e,i){return new NewGameRoleCard1(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameRoleCard1.ui",NewGameRoleCard1),NewGameRoleCard2=NewGameRoleCard.extend({uiPath:"ui/new/game/NewGameRoleCard2.ui",onLoaded:function(){NewGameRoleCard.prototype.onLoaded.call(this)}}),NewGameRoleCard2.create=function(t,e,i){return new NewGameRoleCard2(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameRoleCard2.ui",NewGameRoleCard2);var mjGame=mjGame||{};mjGame.Direction={NONE:0,TOP:1,LEFT:2,RIGHT:3,BOTTOM:4},mjGame.TileStatus={STAND:1,COVERING:2,UNCOVERING:3},mjGame.TilePlace={HAND:1,GROUP:2,DISCARD:3},NewGameCardBase=QPLayer.extend({uiPath:"ui/new/game/NewGameCardBase.ui",_num:0,_isSelect:!1,_oldY:null,_oldX:null,_scale:null,_touchEnable:!0,_direction:mjGame.Direction.BOTTOM,_tileStatus:mjGame.TileStatus.STAND,_tilePlace:mjGame.TilePlace.HAND,_originPos:null,_tingCards:[],_saveColor:null,_isSameColor:!1,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i);var a=this;this.addListener("SuccesSetTileBg",function(t){a.updateTileBg()}),a.addListener("SuccesShowOtherCard",function(t){if(a._isSameColor){var e=t.getUserData(),i=e.isShow,s=e.card;a.setTileColor(),a.isVisible()&&i&&a.getNum()==s&&a.setTileColor(cc.color(255,255,70))}})},initData:function(){this._num=0,this._isSelect=!1,this._touchEnable=!0,this._ckeckKingEnable=!0,this._saveColor=null},onLoaded:function(){},setTingArrow:function(t,e,i){t?this._tingCards=e:this._tingCards=[],t?i?(this.img_ting&&this.img_ting.setVisible(!1),this.img_duo&&this.img_duo.setVisible(!0)):this.img_ting&&this.img_ting.setVisible(!0):(this.img_ting&&this.img_ting.setVisible(!1),this.img_duo&&this.img_duo.setVisible(!1))},getTingCards:function(){return this._tingCards},_getAttribute:function(t,e,i){var a={};a.bgSrc="res/uires/new/common/0.png",a.cardSrc="res/uires/new/common/0.png",a.bgPos=cc.p(0,0),a.cardPos=cc.p(0,0),a.cardScale=1,a.cardRotation=0,a.flipX=!1,a.flipY=!1,a.isShowKing=!1,a.kingPos=cc.p(0,0);var s=cc.sys.localStorage.getItem("fzmj_game_setting_ck_color")||1,r=!1,n=MJ_KING_ARR||[];for(var o in n)n[o]==this._num&&(r=!0);var c=DataMgr.gameCtrl.deskInfo,l=c.info,_=DataMgr.gameCtrl.isLog;if(_){var u=DataMgr.gameCtrl.replayData;c=u.desk_info,l=u.desk_info}if(IsGameTypeNdmj(c.game_type)&&l&&0==l.spec_type){var h=DataMgr.gameCtrl.randPokerList||[];h[0]&&67!=h[0]&&(67==this._num?this._code=getCodeByNum(h[0]):this._num==h[0]&&(this._code=getCodeByNum(67)))}switch(t){case mjGame.Direction.BOTTOM:e==mjGame.TileStatus.STAND?(a.bgSrc="res/uires/new/game/card"+s+"/1.png",this._code>0&&(a.cardSrc="res/uires/new/game/tiles/"+this._code+".png",a.cardPos=cc.p(0,-6),a.isShowKing=r,a.kingPos=cc.p(0,62))):e==mjGame.TileStatus.UNCOVERING?(a.bgSrc="res/uires/new/game/card"+s+"/2.png",this._code>0&&(a.cardSrc="res/uires/new/game/tiles/"+this._code+".png",a.cardPos=cc.p(1,12),a.cardScale=.9,a.isShowKing=r,a.kingPos=cc.p(1,75.5))):e==mjGame.TileStatus.COVERING&&(a.bgSrc="res/uires/new/game/card"+s+"/2_1.png");break;case mjGame.Direction.TOP:e==mjGame.TileStatus.STAND?a.bgSrc="res/uires/new/game/card"+s+"/1_1.png":e==mjGame.TileStatus.UNCOVERING?(a.bgSrc="res/uires/new/game/card"+s+"/2.png",this._code>0&&(a.cardSrc="res/uires/new/game/tiles/"+this._code+".png",a.cardPos=cc.p(0,12),a.cardScale=.85,a.cardRotation=180,a.isShowKing=r,a.kingPos=cc.p(72,50))):e==mjGame.TileStatus.COVERING&&(a.bgSrc="res/uires/new/game/card"+s+"/2_1.png");break;case mjGame.Direction.LEFT:e==mjGame.TileStatus.STAND?a.bgSrc="res/uires/new/game/card"+s+"/3.png":e==mjGame.TileStatus.UNCOVERING?(a.bgSrc="res/uires/new/game/card"+s+"/4.png",this._code>0&&(a.cardSrc="res/uires/new/game/tiles/"+this._code+".png",a.cardPos=cc.p(-5,-18),a.cardScale=.52,a.cardRotation=90,a.isShowKing=r,a.kingPos=cc.p(44,54))):e==mjGame.TileStatus.COVERING&&(a.bgSrc="res/uires/new/game/card"+s+"/4_1.png");break;case mjGame.Direction.RIGHT:e==mjGame.TileStatus.STAND?(a.bgSrc="res/uires/new/game/card"+s+"/3.png",a.bgPos=cc.p(72,0),a.flipX=!0):e==mjGame.TileStatus.UNCOVERING?(a.bgSrc="res/uires/new/game/card"+s+"/4.png",i==mjGame.TilePlace.HAND&&(a.bgPos=cc.p(8,0)),this._code>0&&(a.cardSrc="res/uires/new/game/tiles/"+this._code+".png",a.cardPos=cc.p(-5,-18),a.cardScale=.52,a.cardRotation=-90,a.isShowKing=r,a.kingPos=cc.p(19,16))):e==mjGame.TileStatus.COVERING&&(a.bgSrc="res/uires/new/game/card"+s+"/4_1.png")}return a},setTitleStyle:function(t,e,i){this._direction=t,this._tileStatus=e,this._tilePlace=i;var a=this._getAttribute(t,e,i),s=1.25;this.img_bg.loadTexture(a.bgSrc,ccui.Widget.LOCAL_TEXTURE),this.img_bg.setFlippedX(a.flipX),this.img_bg.setPosition(a.bgPos),this.img_card.loadTexture(a.cardSrc,ccui.Widget.LOCAL_TEXTURE),this.img_card.setPosition(this.width/2+a.cardPos.x+a.bgPos.x,this.height/2+a.cardPos.y+a.bgPos.y),this.img_card.setScale(s*a.cardScale),this.img_card.setRotation(a.cardRotation),this.img_king.setPosition(a.kingPos.x+a.bgPos.x,a.kingPos.y+a.bgPos.y),this.img_king.setRotation(a.cardRotation),this.img_king.setScale(a.cardScale),this.setTileColor(cc.color(255,255,255)),this.setOpacity(255),this.img_king.setVisible(a.isShowKing),this.img_bg.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.img_bg.setVisible(!0),this.img_card.setVisible(!0)},this)))},updateTileBg:function(){var t=this._getAttribute(this._direction,this._tileStatus,this._tilePlace);this.img_bg.loadTexture(t.bgSrc,ccui.Widget.LOCAL_TEXTURE)},setTileColor:function(t,e){var i=this._saveColor||cc.color(255,255,255);t&&(i=t),e&&(this._saveColor=t),this.img_bg.setColor(i),this.img_king.setColor(i)},setOpacity:function(t){this.img_bg.setOpacity(t),this.img_card.setOpacity(t),this.img_king.setOpacity(t)},setData:function(t,e,i,a,s){this._num=parseInt(t),this._code=getCodeByNum(this._num),this._isSameColor=s||!1,this.setTitleStyle(e,i,a)},getNum:function(){return this._num},getCode:function(){return this._code},setSelect:function(t){this._isSelect=t,t?this.setPosition(this._originPos.x,this._originPos.y+30):this.setPosition(this._originPos.x,this._originPos.y)},isSelect:function(){return this._isSelect},setOriginPos:function(t){this._originPos=t},getOriginPos:function(){return this._originPos},getSize:function(){return this.img_bg.getContentSize()},discard:function(){cc.log("选择出牌-code",this._code),this.bolCardCanOut(this._num)&&(cc.log("可以出牌-num",this._num),ME_D.send_message_waiting(CMD_ROOM_MESSAGE,"desk_op",{oper:"deal_poker",poker_list:[this._num]}))},bolCardCanOut:function(t){return DataMgr.gameCtrl.curIndex!=DataMgr.gameCtrl.myWheelIdx?(ModuleMgr.showTipMsg("还未轮到您出牌"),!1):DataMgr.gameCtrl.curStep==MJ_STEP_PLAY||(ModuleMgr.showTipMsg("游戏不在进行中！"),!1)},bolSelect:function(){return this._isSelect},isCanTouch:function(){return this.isVisible()&&this._touchEnable},setTouchEnable:function(t){this._touchEnable=t}}),NewGameCardBase.create=function(t,e,i){return new NewGameCardBase(t,e,i)},ModuleMgr.registerModule("NewGameCardBase",NewGameCardBase),UIUtils.RegisterPathTemple("ui/new/game/NewGameCardBase.ui",NewGameCardBase),NewGameCard=QPLayer.extend({uiPath:"ui/new/game/NewGameCard1.ui",direction:mjGame.Direction.NONE,tileStatus:mjGame.TileStatus.STAND,tilePlace:mjGame.TilePlace.HAND,status:0,weavePokerList:[],onLoaded:function(){for(var t=0;t<=16;t++)this["item_tile"+t]&&this["item_tile"+t].setOriginPos(this["item_tile"+t].getPosition())},setTileData:function(t,e){return void 0==e?(this["item_tile"+t]&&this["item_tile"+t].setVisible(!1),void(this["item_tile"+t]&&this["item_tile"+t].setData(0,this.direction,this.tileStatus,this.tilePlace))):this.direction==mjGame.Direction.BOTTOM&&this.tileStatus==mjGame.TileStatus.STAND&&0==e?(this["item_tile"+t]&&this["item_tile"+t].setVisible(!1),void(this["item_tile"+t]&&this["item_tile"+t].setData(0,this.direction,this.tileStatus,this.tilePlace))):(this["item_tile"+t]&&this["item_tile"+t].setData(e,this.direction,this.tileStatus,this.tilePlace),void(this["item_tile"+t]&&this["item_tile"+t].setVisible(!0)))},getTileCode:function(t){this["item_tile"+t]&&this["item_tile"+t].getCode()},setTileColor:function(t,e){this["item_tile"+t]&&this["item_tile"+t].setTileColor(e)},setTileStatus:function(t){this.tileStatus=t},refreshPokers:function(t,e,i){if(t=t||[],0==this.status){this.refreshWeavePoker(t,e);var a=DataMgr.gameCtrl.totalCardNum,s=a-3*t.length,r=!1;i>s&&(r=!0),this.refreshStandPoker(t,r)}else this.refreshWeavePoker(t)},refreshStandPoker:function(t,e){if(this.direction!=mjGame.Direction.BOTTOM){var i=t.length;i=3*i;for(var a=DataMgr.gameCtrl.totalCardNum,s=a-i,r=1;r<=a;r++)r<=s?this.setTileData(r,0):this.setTileData(r,void 0);e&&this.setTileData(0,0),this.direction!=mjGame.Direction.BOTTOM&&this.setJump(0,!0)}},refreshWeavePoker:function(t,e){if(t=t||[],this.clearWeavePoker(),t.length>0){t.sort(function(t,e){return e.mj_action-t.mj_action});for(var i=0;i<t.length;i++){var a={};a.scale=1,a.pos=cc.p(0,0);var s=NewGameGroup,r=15,n=cc.size(0,0);switch(this.direction){case mjGame.Direction.TOP:s=NewGameGroup1,a.scale=.9,n=cc.size(216,130),a.pos=cc.p(this.width-n.width*a.scale-(n.width+r)*a.scale*i,0);break;case mjGame.Direction.LEFT:s=NewGameGroup2,a.scale=.75,n=cc.size(63,128),r=10,a.pos=cc.p(0,this.height-(n.height+35)*a.scale-(n.height+r)*a.scale*i);break;case mjGame.Direction.RIGHT:s=NewGameGroup3,a.scale=.75,n=cc.size(63,128),r=10,a.pos=cc.p(-this.width/2,(n.height+r)*a.scale*i);break;case mjGame.Direction.BOTTOM:s=NewGameGroup4,a.scale=.9,n=cc.size(216,130),a.pos=cc.p((n.width+r)*a.scale*i,0)}this.addWeavePoker(i,t[i],e,s,a,this.tileStatus)}}},addWeavePoker:function(t,e,i,a,s,r){var n=this;if(n.item_group){var o=function(){ModuleMgr.createNode(a,function(t){var o=a.create();o.setTileGroup(e,i,r),o.setPosition(s.pos),o.setScale(s.scale),o.setZOrder(-1),n.item_group.addChild(o),n.weavePokerList.push(o)})};o()}},clearWeavePoker:function(){this.item_group&&this.item_group.removeAllChildren(),this.weavePokerList=[]},playActionEfc:function(t,e){t=t||[],this.refreshWeavePoker(t,e),DataMgr.gameCtrl.isLog||this.refreshStandPoker(t,!0)},refreshResultPokers:function(t,e,i,a){this.setTileStatus(mjGame.TileStatus.UNCOVERING);var s=[];if(i){for(var r=!1,n=0;n<e.length;n++)r||e[n]!=i?s.push(e[n]):r=!0;this.setTileData(0,i),t&&this.setTileColor(0,cc.color(255,255,255))}else a?(s=e,this.setTileData(0,a),t&&this.setTileColor(0,cc.color(255,255,150))):(s=e,this.setTileData(0,void 0));for(var o=DataMgr.gameCtrl.totalCardNum,c=s.length,n=1;n<=o;n++)n<=c&&s[n-1]?this.setTileData(n,s[n-1]):this.setTileData(n,void 0);this.direction!=mjGame.Direction.BOTTOM&&this.setJump(0,!1)},setJump:function(t,e){var i=this["item_tile"+t];if(i&&(i.stopAllActions(),i.setPosition(i.getOriginPos()),e)){var a=cc.jumpBy(.8,cc.p(0,0),15,2),s=a.reverse(),r=cc.sequence(a,s).repeatForever();i.runAction(r)}},setResultStatus:function(){this.clearWeavePoker();for(var t=DataMgr.gameCtrl.totalCardNum,e=0;e<=t;e++)this.setTileData(e,void 0)}}),NewGameCard.create=function(t,e,i){return new NewGameCard(t,e,i)},ModuleMgr.registerModule("NewGameCard",NewGameCard),UIUtils.RegisterPathTemple("ui/new/game/NewGameCard1.ui",NewGameCard),NewGameCard1=NewGameCard.extend({uiPath:"ui/new/game/NewGameCard1.ui",direction:mjGame.Direction.TOP,onLoaded:function(){NewGameCard.prototype.onLoaded.call(this)}}),NewGameCard1.create=function(t,e,i){return new NewGameCard1(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameCard1.ui",NewGameCard1),NewGameCard2=NewGameCard.extend({uiPath:"ui/new/game/NewGameCard2.ui",direction:mjGame.Direction.LEFT,onLoaded:function(){NewGameCard.prototype.onLoaded.call(this)}}),NewGameCard2.create=function(t,e,i){return new NewGameCard2(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameCard2.ui",NewGameCard2),NewGameCard3=NewGameCard.extend({uiPath:"ui/new/game/NewGameCard3.ui",direction:mjGame.Direction.RIGHT,onLoaded:function(){NewGameCard.prototype.onLoaded.call(this)}}),NewGameCard3.create=function(t,e,i){return new NewGameCard3(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameCard3.ui",NewGameCard3),NewGameCard4=NewGameCard.extend({uiPath:"ui/new/game/NewGameCard4.ui",direction:mjGame.Direction.BOTTOM,onLoaded:function(){NewGameCard.prototype.onLoaded.call(this),this.initFlowerItem()},initFlowerItem:function(){this.flowerPokerClazz=GameFlowerItem,this.flowerPokerSize=cc.size(30,30),this.flowerPokerScale=1},checkFlower:function(){for(var t=1;t<=16;t++){var e=this["item_tile"+t];e&&e.isVisible()&&e.getNum()>=49&&this.addFlowerAction(e)}this.item_tile0&&this.item_tile0.isVisible()&&this.item_tile0.getNum()>=49&&this.addFlowerAction(this.item_tile0)},addFlowerAction:function(t){if(t){var e=DataMgr.gameCtrl.myWheelIdx,i=t.getContentSize(),a=t.getScale(),s=t.getPositionX()+i.width*a*.5,r=t.getPositionY()+i.height*a*.5-10*a,n=ccs.Armature.create("hua_pai");n.getAnimation().play("stand",-1,-1),n.setAnchorPoint(.5,.5),n.setPositionX(s),n.setPositionY(r),this.addChild(n);var o=this.getFlowerPokerCfg(0),c=o.pos,l=this.convertToWorldSpace(c),_=this.convertToNodeSpace(l);n.targetPos=_,n.idx=e,n.poker=t.getNum(),n.runAction(cc.Sequence.create(cc.DelayTime.create(.5),cc.ScaleTo.create(.1,.1),cc.CallFunc.create(function(){var t={idx:n.idx,poker:n.poker};cc.eventManager.dispatchCustomEvent("AddFlowerPokers",t),n.removeFromParent()})))}},getFlowerPokerCfg:function(t){var e=this,i=cc.p(0,0),a=cc.p(400,50),s=e.flowerPokerScale,r=e.flowerPokerSize,n=a.x-s*r.width*((t-1)%3),o=a.y-80*Math.floor((t-1)/3);i.x=n,i.y=o;var c={};return c.pos=i,c.zOrder=4e3-t,c},flowerAnimationEvent:function(t,e,i){if(e==ccs.MovementEventType.complete){var a=(t.targetPos,t.idx),s=t.poker;t.runAction(cc.Sequence.create(cc.CallFunc.create(function(){var e={idx:a,poker:s};cc.eventManager.dispatchCustomEvent("AddFlowerPokers",e),t.removeFromParent()})))}},onSuccessInit:function(){QPLayer.prototype.onSuccessInit.call(this);var t=this,e=cc.LayerColor.create(cc.color(0,0,0,0));e.setContentSize(cc.size(3*cc.winSize.width,3*cc.winSize.height)),e.setPosition(cc.p(-cc.winSize.width,-cc.winSize.height));var i=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e,i){return t.onTouchBegan(e,i)},onTouchMoved:function(e,i){t.onTouchMoved(e,i)},onTouchEnded:function(e,i){t.onTouchEnded(e,i)},onTouchCancelled:function(e,i){t.onTouchCancelled(e,i)}});e.onExit=function(){cc.LayerColor.prototype.onExit.call(e),cc.eventManager.removeListener(i)},cc.eventManager.addListener(i,e),t.addChild(e)},_beganTileIndex:-1,_beganTilePos:cc.p(0,0),_tileMoveY:0,onTouchBegan:function(t,e){var i=t.getLocation(),a=this.getTouchCardIndex(i);cc.log("touchPoint",i),cc.log("touchIndex",a);var s=this["item_tile"+a];return a<0||!s?(this._beganTileIndex=-1,!1):(this._beganTileIndex=a,this._beganTilePos=s.getPosition(),this._tileMoveY=0,!0)},onTouchMoved:function(t,e){var i=this._beganTileIndex,a=this["item_tile"+i];if(!(i<0)&&a){var s=t.getLocation(),r=this.grp_my_card.convertToNodeSpace(s),n=r.x-this._beganTilePos.x,o=r.y-this._beganTilePos.y;if(o>20&&(this._tileMoveY=o,cc.eventManager.dispatchCustomEvent("ShowDesktopLine",!0),a.setOpacity(150),this.item_moveTile)){var c=a.getNum();this.item_moveTile.setData(c,this.direction,this.tileStatus,this.tilePlace),this.item_moveTile.setVisible(!0);var l=a.getOriginPos();this.item_moveTile.setPosition(l.x+n-a.getSize().width/2,l.y+o)}}},onTouchEnded:function(t,e){var i=this._beganTileIndex,a=this["item_tile"+i];if(!(i<0)&&a){if(this._tileMoveY>0)this.item_moveTile&&this.item_moveTile.setVisible(!1),this.setAllTileDown(),this._tileMoveY>100&&a.discard();else{playEffect("card_click_effect.mp3");var s=cc.sys.localStorage.getItem("fzmj_game_setting_ck_click")||1;if(2==s)return cc.log("单击出牌"),a.setSelect(!1),this.setAllTileDown(),void a.discard();if(a.isSelect())return cc.log("双击出牌"),a.setSelect(!1),a.discard(),void this.setAllTileDown();cc.log("首次点击"),this.setAllTileDown(),a.setSelect(!0);var r=a.getTingCards();this.showTingCard(r.length>0,r),this.showSurplus(0==r.length,a.getNum()),this.showOtherCard(!0,a.getNum())}cc.eventManager.dispatchCustomEvent("ShowDesktopLine",!1)}},onTouchCancelled:function(t,e){this.onTouchEnded()},getTouchCardIndex:function(t,e){for(var i=1,a=1,s=1;s<=MY_TOTAL_CARD_NUM;s++)if(s!=e){var r=this["item_tile"+s],n=getNodeWorldRect(r);if(n.width=n.width*i,n.height=n.height*a,SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE){var o=ModuleMgr.getScreenRotation();o==-90?(n.x=n.x+10*i,n.height=n.height+20*a,r.bolSelect()&&(n.x=n.x+20*i,n.height=n.height+20*a)):90==o&&(n.x=n.x-10*i,n.height=n.height+20*a,r.bolSelect()&&(n.x=n.x-20*i,n.height=n.height+20*a)),n=ModuleMgr.switchNodeRect(n)}else r.bolSelect()&&(n.y=n.y-20*a,n.height=n.height+20*a);if(r&&r.isCanTouch()&&cc.rectContainsPoint(n,t))return s}if(0!=e){var c=this.item_tile0,n=getNodeWorldRect(c);if(n.width=n.width*i,n.height=n.height*a,SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE){var o=ModuleMgr.getScreenRotation();o==-90?(n.x=n.x+10*i,n.height=n.height+20*a,c.bolSelect()&&(n.x=n.x+20*i,n.height=n.height+20*a)):90==o&&(n.x=n.x-10*i,n.height=n.height+20*a,c.bolSelect()&&(n.x=n.x-20*i,n.height=n.height+20*a)),n=ModuleMgr.switchNodeRect(n)}else c.bolSelect()&&(n.y=n.y-20*a,n.height=n.height+20*a);if(c&&c.isCanTouch()&&cc.rectContainsPoint(n,t))return 0}return-1},setAllTileDown:function(){for(var t=0;t<=16;t++){var e="item_tile"+t,i=this[e];i&&i.isVisible()&&(i.setSelect(!1),i.setOpacity(255))}this.showTingCard(!1,[]),this.showSurplus(!1,0),this.showOtherCard(!1,0)},setTouchEnabled:function(t){for(var e=0;e<=16;e++){var i="item_tile"+e;this[i]&&this[i].setTouchEnable(t)}},checkTing:function(t){if(cc.log("出牌前检测听牌-isCheck",t),t){var e=!1,i=[],a=!1,s=DataMgr.gameCtrl.deskInfo;IsGameTypeNdmj(s.game_type)&&(a=!0,i=[mjGame.Common.CardType.JIAN_3]),this.setTingArrow(e,i,a)}else this.clearTingArrow()},getHeadCodeList:function(){for(var t=DataMgr.gameCtrl.deskInfo,e=t.info,i=DataMgr.gameCtrl.randPokerList||[],a=[],s=0;s<=16;s++){var r="item_tile"+s,n=this[r];if(n&&n.isVisible()&&n.getCode()>0){var o=n.getCode();i.length>0&&IsGameTypeNdmj(t.game_type)&&e&&0==e.spec_type&&i[0]&&67!=i[0]&&(o==getCodeByNum(67)?o=getCodeByNum(i[0]):o==getCodeByNum(i[0])&&(o=getCodeByNum(67))),a.push(o)}}return a},setTingArrow:function(t,e,i){t=t||!1,e=e||[];var a=this.getHeadCodeList(),s=0,r=0,n=DataMgr.gameCtrl.deskInfo,o=n.info,c=DataMgr.gameCtrl.randPokerList||[];c.length>0&&(IsGameTypeNdmj(n.game_type)&&o&&0==o.spec_type?(s=getCodeByNum(67),r=getCodeByNum(c[0])):(s=getCodeByNum(c[0]),r=s)),cc.log("king",s);for(var l=[],_=DataMgr.gameCtrl.myWheelInfo.weave_pokers,u=0;u<_.length;u++){var h=mjGame.Common.PaiXing.NO;switch(_[u].mj_action){case MJ_CHI:h=mjGame.Common.PaiXing.CHI;break;case MJ_PENG:h=mjGame.Common.PaiXing.PENG;break;case MJ_GANG:h=mjGame.Common.PaiXing.GANG_DIAN;break;case MJ_BU_GANG:h=mjGame.Common.PaiXing.GANG_MING;break;case MJ_AN_GANG:h=mjGame.Common.PaiXing.GANG_AN}l.push({cardList:_[u].poker_list,paixing:h})}for(var g=[],d=mjGame.Common.Func.isCanTing(a,l,s,t,e),u=0;u<d.length;u++)g.push(d[u]);if(i)for(var m=mjGame.Common.Func.isBig7DuiTing(a,l,s,t,e),u=0;u<m.length;u++){for(var f=m[u].dropCard,p=m[u].tingCards,M=null,C=0;C<g.length;C++)f==g[C].dropCard&&(M=C);if(null!=M){for(var D=0;D<p.length;D++)g[M].tingCards.push(p[D]);g[M].tingCards=unique(g[M].tingCards),g[M].tingCards.sort(function(t,e){return t-e})}else g.push(m[u])}for(var b=0,y=[],u=0;u<g.length;u++){var v={},E=g[u].dropCard;c.length>0&&IsGameTypeNdmj(n.game_type)&&o&&0==o.spec_type&&(E==getCodeByNum(67)?E=getCodeByNum(c[0]):E==getCodeByNum(c[0])&&(E=getCodeByNum(67))),v.dropCard=E,v.tingCards=[],v.totalNum=0;for(var I=0;I<g[u].tingCards.length;I++){var S=g[u].tingCards[I],P=4-DataMgr.gameCtrl.getAppearCountByTile(getNumByCode(S));P<0&&(P=0),v.totalNum+=P,v.tingCards.push({card:S,num:P})}v.totalNum>b&&E!=r&&(b=v.totalNum),y.push(v)}cc.log("newTingList",y);for(var T=0,w=0,u=0;u<y.length;u++)y[u].dropCard!=r&&(y[u].totalNum==b?T++:w++);cc.log("maxNum",b),cc.log("totalMax",T),cc.log("totalMin",w);for(var u=0;u<=16;u++){var N="item_tile"+u,A=this[N];if(A&&A.isVisible()){for(var L=[],k=0,R=0,I=0;I<y.length;I++)A.getCode()==y[I].dropCard&&(L=y[I].tingCards,k=y[I].totalNum),y[I].dropCard!=r&&R++;if(cc.log("notKingNum",R),L.length>0){var x=!1;k==b&&T<=2&&w>0&&R>1&&(x=!0),A.setTingArrow(!0,L,x)}}}},clearTingArrow:function(){for(var t=0;t<=16;t++){var e="item_tile"+t,i=this[e];i&&i.isVisible()&&i.setTingArrow(!1)}},showTingCard:function(t,e){cc.eventManager.dispatchCustomEvent("SuccesShowTingCard",{isShow:t,tingCards:e})},showSurplus:function(t,e){cc.eventManager.dispatchCustomEvent("SuccesShowSurplus",{isShow:t,card:e})},showOtherCard:function(t,e){cc.eventManager.dispatchCustomEvent("SuccesShowOtherCard",{isShow:t,card:e})}}),NewGameCard4.create=function(t,e,i){return new NewGameCard4(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameCard4.ui",NewGameCard4),NewGameDisCard=QPLayer.extend({uiPath:"ui/new/game/NewGameDisCard1.ui",direction:mjGame.Direction.NONE,tileStatus:mjGame.TileStatus.UNCOVERING,tilePlace:mjGame.TilePlace.DISCARD,outPokers:[],putOutArrowAni:null,sex:0,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){if(!this.putOutArrowAni){var t=ccs.Armature.create("arrow");t.getAnimation().play("stand",-1,1),t.setVisible(!1),this.addChild(t),this.putOutArrowAni=t}},setSex:function(t){this.sex=t},setTileData:function(t,e){return void 0==e?void(this["item_tile"+t]&&this["item_tile"+t].setVisible(!1)):(this["item_tile"+t]&&this["item_tile"+t].setData(e,this.direction,this.tileStatus,this.tilePlace,!0),void(this["item_tile"+t]&&this["item_tile"+t].setVisible(!0)))},refreshPokers:function(t){this.outPokers[this.direction]=gDup(t);for(var e=36,i=1;i<=e;i++)i<=this.outPokers[this.direction].length?this.setTileData(i,this.outPokers[this.direction][i-1]):this.setTileData(i,void 0)},addOutCard:function(t,e){this.outPokers[this.direction]=this.outPokers[this.direction]||[],this.outPokers[this.direction].push(t);var i=this.outPokers[this.direction].length;if(this.setTileData(i,t),!e){var a=t,s=DataMgr.gameCtrl.deskInfo;if(IsGameTypeNdmj(s.game_type)&&s.info&&0==s.info.spec_type){var r=DataMgr.gameCtrl.randPokerList||[];r[0]&&67!=r[0]&&(67==t?a=r[0]:t==r[0]&&(a=67))}var n=get_card_color(a),o=get_card_value(a),c="",l="%s/%s.mp3";MUSIC_DIFF_SEX&&(l=2==this.sex?"%s/woman/%s.mp3":"%s/man/%s.mp3"),n==LOGIC_COLOR_WAN?c=l.format(MUSIC_TYPE,"wan_"+o):n==LOGIC_COLOR_TIAO?c=l.format(MUSIC_TYPE,"tiao_"+o):n==LOGIC_COLOR_TONG?c=l.format(MUSIC_TYPE,"tong_"+o):n==LOGIC_COLOR_FENG?c=l.format(MUSIC_TYPE,"feng_"+o):n==LOGIC_COLOR_JIANG&&(c=l.format(MUSIC_TYPE,"jiang_"+o)),c&&playEffect(c)}},removeOutCard:function(){if(this.outPokers[this.direction]){var t=this.outPokers[this.direction].length;t>0&&(this.outPokers[this.direction].splice(-1,1),this.setTileData(t,void 0))}},setResultStatus:function(){for(var t=36,e=1;e<=t;e++)this.setTileData(e,void 0)},setOutPokers:function(t){this.outPokers[this.direction]=t},showPutOutArrow:function(){this.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){if(this.outPokers[this.direction]&&this.putOutArrowAni){var t=this.outPokers[this.direction].length,e=this["item_tile"+t];if(e){this.putOutArrowAni.setVisible(!0);var i=e.x,a=e.y,s=1;switch(this.direction){case mjGame.Direction.TOP:i+=e.width/2+2,a+=e.height/2,s=1/.45;break;case mjGame.Direction.LEFT:i+=e.width/2-2,a+=e.height/4,s=1/.7;break;case mjGame.Direction.RIGHT:i+=e.width/2-2,a+=e.height/4,s=1/.7;break;case mjGame.Direction.BOTTOM:i+=e.width/2+2,a+=e.height/2,s=1/.45}var r=e.getParent();this.putOutArrowAni.setPosition(i+r.x,a+r.y),this.putOutArrowAni.setScale(s)}}},this)))},hidePutOutArrowAni:function(){this.putOutArrowAni&&this.putOutArrowAni.setVisible(!1)}}),NewGameDisCard.create=function(t,e,i){return new NewGameDisCard(t,e,i)},ModuleMgr.registerModule("NewGameDisCard",NewGameDisCard),UIUtils.RegisterPathTemple("ui/new/game/NewGameDisCard1.ui",NewGameDisCard),NewGameDisCard1=NewGameDisCard.extend({uiPath:"ui/new/game/NewGameDisCard1.ui",direction:mjGame.Direction.TOP,onLoaded:function(){NewGameDisCard.prototype.onLoaded.call(this)}}),NewGameDisCard1.create=function(t,e,i){return new NewGameDisCard1(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameDisCard1.ui",NewGameDisCard1),NewGameDisCard2=NewGameDisCard.extend({uiPath:"ui/new/game/NewGameDisCard2.ui",direction:mjGame.Direction.LEFT,onLoaded:function(){NewGameDisCard.prototype.onLoaded.call(this)}}),NewGameDisCard2.create=function(t,e,i){return new NewGameDisCard2(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameDisCard2.ui",NewGameDisCard2),NewGameDisCard3=NewGameDisCard.extend({uiPath:"ui/new/game/NewGameDisCard3.ui",direction:mjGame.Direction.RIGHT,onLoaded:function(){NewGameDisCard.prototype.onLoaded.call(this)}}),NewGameDisCard3.create=function(t,e,i){return new NewGameDisCard3(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameDisCard3.ui",NewGameDisCard3),NewGameDisCard4=NewGameDisCard.extend({uiPath:"ui/new/game/NewGameDisCard4.ui",direction:mjGame.Direction.BOTTOM,onLoaded:function(){NewGameDisCard.prototype.onLoaded.call(this)}}),NewGameDisCard4.create=function(t,e,i){return new NewGameDisCard4(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameDisCard4.ui",NewGameDisCard4),
WindPointer=QPLayer.extend({uiPath:"ui/new/game/WindPointer.ui",_totalTs:15,_ts:0,_isCountdown:!1,_direction:mjGame.Direction.NONE,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i),this._isCountdown=!0},onLoaded:function(){},turn:function(t,e,i){this._direction=t;var a=0;switch(t){case mjGame.Direction.TOP:a=180;break;case mjGame.Direction.LEFT:a=90;break;case mjGame.Direction.RIGHT:a=-90;break;case mjGame.Direction.BOTTOM:a=0}if(this.item_pointer&&this.item_pointer.setRotation(a),this._ts=void 0===e?this._totalTs:e,i){var s=this._ts<10?"0"+this._ts:""+this._ts;this.lab_num&&this.lab_num.setString(s)}else this._action()},_action:function(){if(this._isCountdown){var t=cc.delayTime(1),e=new cc.CallFunc(function(){if(this._ts>=0){var t=this._ts<10?"0"+this._ts:""+this._ts;this.lab_num&&this.lab_num.setString(t);var e=this.getParent(),i=e.item_quick;i&&i.isVisible()&&this._ts<=3&&playEffect("timed.mp3")}this._ts--}.bind(this)),i=new cc.Sequence(e,t).repeatForever();this.stopAllActions(),this.runAction(i)}},setRoundNum:function(t){this._isCountdown=!1;var e=t<10?"0"+t:""+t;this.lab_num&&this.lab_num.setString(e)}}),WindPointer.create=function(t,e,i){return new WindPointer(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/WindPointer.ui",WindPointer),DetectionPointer=QPLayer.extend({uiPath:"ui/new/game/DetectionPointer.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.img_light&&this.img_light.runAction(cc.rotateBy(3,360).repeatForever()),this.img_point1&&this.img_point1.runAction(cc.sequence(cc.delayTime(2.5),cc.fadeIn(.2),cc.fadeOut(.2),cc.delayTime(.1)).repeatForever()),this.img_point2&&this.img_point2.runAction(cc.sequence(cc.delayTime(.5),cc.fadeIn(.2),cc.fadeOut(.2),cc.delayTime(2.1)).repeatForever()),this.img_point3&&this.img_point3.runAction(cc.sequence(cc.delayTime(1.5),cc.fadeIn(.2),cc.fadeOut(.2),cc.delayTime(1.1)).repeatForever())},setState:function(t){if(this.img_tips){var e=t?"detection4":"detection3";this.img_tips.loadTexture("res/uires/new/game/desktop/"+e+".png",ccui.Widget.LOCAL_TEXTURE)}}}),DetectionPointer.create=function(t,e,i){return new DetectionPointer(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/DetectionPointer.ui",DetectionPointer),NewGameShowKing=QPDlg.extend({uiPath:"ui/new/game/NewGameShowKing.ui",bolDlgAction:!1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){if(this.data){for(var t=this.data,e=t.pokerList||[],i=t.showKingType||1,a=t.func,s=1;s<=2;s++){var r=e[s-1];r?(cc.log("num====",r),this["item_king_"+s]&&this["item_king_"+s].setVisible(!0),this["item_king_"+s]&&this["item_king_"+s].setData(r,mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND)):this["item_king_"+s]&&this["item_king_"+s].setVisible(!1)}this.sortGrp("grp_king",15),this.ani_efc_1&&this.ani_efc_1.setVisible(!1),this.ani_efc_2&&this.ani_efc_2.setVisible(!1);var n=this["ani_efc_"+i];n&&(n.setVisible(!0),n.getAnimation().play("stand",-1,-1),n.getAnimation().setMovementEventCallFunc(this.animationEvent,this)),playEffect("kaijin.mp3");var o=this;o.scheduleOnce(function(){o.close(),a&&a()},2)}},animationEvent:function(t,e,i){e==ccs.MovementEventType.complete}}),NewGameShowKing.create=function(t,e,i){return new NewGameShowKing(t,e,i)},ModuleMgr.registerModule("NewGameShowKing",NewGameShowKing),NewGameKing=QPLayer.extend({uiPath:"ui/new/game/NewGameKing.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},initData:function(){this._num=0},onLoaded:function(){},setData:function(t){t=t||[],this.grp_1.setVisible(!1),this.grp_2.setVisible(!1),1==t.length?(this.grp_1.setVisible(!0),this.item_card_1_1.setData(t[0],mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND)):2==t.length&&(this.grp_2.setVisible(!0),this.item_card_2_1.setData(t[0],mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND),this.item_card_2_2.setData(t[1],mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND))}}),NewGameKing.create=function(t,e,i){return new NewGameKing(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameKing.ui",NewGameKing),NewGameGroup=QPLayer.extend({uiPath:"ui/new/game/NewGameGroup1.ui",direction:mjGame.Direction.NONE,tilePlace:mjGame.TilePlace.GROUP,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setTileGroup:function(t,e,i){var a=t.poker_list,s=(t.last_out_poker,t.last_out_poker_idx),r=DataMgr.gameCtrl.players.length-1,n=0,o=e-s;if(o<0&&(o+=r),cc.log("dir----",o),2==r)o>0&&(n=2,4==a.length&&(n=4));else if(3==r)switch(this.direction){case mjGame.Direction.LEFT:o>0&&(1==o?(n=2,4==a.length&&(n=4)):2==o&&(n=3));break;case mjGame.Direction.RIGHT:a=a.reverse(),o>0&&(1==o?n=3:2==o&&(n=2,4==a.length&&(n=4)));break;case mjGame.Direction.BOTTOM:o>0&&(1==o?n=1:2==o&&(n=3))}else if(4==r)switch(this.direction){case mjGame.Direction.TOP:a=a.reverse(),o>0&&(1==o?n=3:2==o?(n=2,4==a.length&&(n=4)):3==o&&(n=1));break;case mjGame.Direction.LEFT:o>0&&(n=o,2==o&&4==a.length&&(n=4));break;case mjGame.Direction.RIGHT:a=a.reverse(),o>0&&(1==o?n=3:2==o?(n=2,4==a.length&&(n=4)):3==o&&(n=1));break;case mjGame.Direction.BOTTOM:o>0&&(n=o,2==o&&4==a.length&&(n=4))}var c=mjGame.TileStatus.UNCOVERING,l=mjGame.TileStatus.UNCOVERING,_=!1;switch(t.mj_action){case MJ_CHI:n=0;break;case MJ_PENG:break;case MJ_GANG:break;case MJ_BU_GANG:_=!0;break;case MJ_AN_GANG:l=mjGame.TileStatus.COVERING,this.direction!=mjGame.Direction.BOTTOM&&i!=mjGame.TileStatus.UNCOVERING&&(c=mjGame.TileStatus.COVERING),n=0}for(var u=0;u<3;u++)this["item_tile"+(u+1)]&&this["item_tile"+(u+1)].setData(a[u],this.direction,l,this.tilePlace,!0);4==a.length&&this.item_tile4&&this.item_tile4.setData(a[3],this.direction,c,this.tilePlace,!0),n>0&&this["item_tile"+n]&&this["item_tile"+n].setTileColor(cc.color(150,228,239),!0),this.item_mark&&this.item_mark.setVisible(_)}}),NewGameGroup.create=function(t,e,i){return new NewGameGroup(t,e,i)},ModuleMgr.registerModule("NewGameGroup",NewGameGroup),UIUtils.RegisterPathTemple("ui/new/game/NewGameGroup1.ui",NewGameGroup),NewGameGroup1=NewGameGroup.extend({uiPath:"ui/new/game/NewGameGroup1.ui",direction:mjGame.Direction.TOP,onLoaded:function(){NewGameGroup.prototype.onLoaded.call(this)}}),NewGameGroup1.create=function(t,e,i){return new NewGameGroup1(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameGroup1.ui",NewGameGroup1),NewGameGroup2=NewGameGroup.extend({uiPath:"ui/new/game/NewGameGroup2.ui",direction:mjGame.Direction.LEFT,onLoaded:function(){NewGameGroup.prototype.onLoaded.call(this)}}),NewGameGroup2.create=function(t,e,i){return new NewGameGroup2(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameGroup2.ui",NewGameGroup2),NewGameGroup3=NewGameGroup.extend({uiPath:"ui/new/game/NewGameGroup2.ui",direction:mjGame.Direction.RIGHT,onLoaded:function(){NewGameGroup.prototype.onLoaded.call(this)}}),NewGameGroup3.create=function(t,e,i){return new NewGameGroup3(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameGroup2.ui",NewGameGroup3),NewGameGroup4=NewGameGroup.extend({uiPath:"ui/new/game/NewGameGroup1.ui",direction:mjGame.Direction.BOTTOM,onLoaded:function(){NewGameGroup.prototype.onLoaded.call(this)}}),NewGameGroup4.create=function(t,e,i){return new NewGameGroup4(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameGroup1.ui",NewGameGroup4),NewGameMyBtn=QPLayer.extend({uiPath:"ui/new/game/NewGameMyBtn.ui",delegate:null,isCanGuo:!0,actionList:[],gangModle:1,noGangPokerMap:{},ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},initData:function(){this._num=0},onLoaded:function(){for(var t=[{grp:"btn_peng",ani:"btn_peng"},{grp:"btn_gang",ani:"btn_gang"},{grp:"btn_chi",ani:"btn_chi"},{grp:"btn_ming",ani:"btn_mimg"},{grp:"btn_hu",ani:"btn_hu"},{grp:"btn_you",ani:"btn_youjin"},{grp:"btn_you_1",ani:"btn_danyou"},{grp:"btn_you_2",ani:"btn_shuangyou"},{grp:"btn_you_3",ani:"btn_sanyou"}],e=0;e<t.length;e++){var i=t[e],a=this[i.grp];if(a){var s=ccs.Armature.create(i.ani);s.x=63,s.y=63,s.getAnimation().play("stand",-1,1),a.addChild(s)}}var r=this,n=NewGameCardBase,o=function(){ModuleMgr.createNode(n,function(t){var e=new ccui.ImageView("res/uires/new/game/desktop/tileBg.png",ccui.Widget.LOCAL_TEXTURE);e.setScaleX(.55),e.setScaleY(.75),r.addChild(e,0),r.outTileBg=e;var i=n.create();i.setScaleX(.7/.55),i.setScaleY(.7/.75),i.setPosition(70,12),e.addChild(i),r.outTile=i})};o(),this.gangModle=1,this.noGangPokerMap={}},setData:function(t){this.setVisible(!1),t&&(this.delegate=t.delegate)},getActionList:function(){return this.actionList},setAction:function(){var t=DataMgr.gameCtrl.actionList||[];if(this.actionList=t,!t||t.length<=0)return void this.setVisible(!1);this.setVisible(!0),this.layer_mult_action&&this.layer_mult_action.setVisible(!1),this.btn_peng&&this.btn_peng.setVisible(!1),this.btn_gang&&this.btn_gang.setVisible(!1),this.btn_chi&&this.btn_chi.setVisible(!1),this.btn_hu&&this.btn_hu.setVisible(!1),this.btn_guo&&this.btn_guo.setVisible(!0),this.btn_ming&&this.btn_ming.setVisible(!1),this.btn_you&&this.btn_you.setVisible(!1),this.btn_you_1&&this.btn_you_1.setVisible(!1),this.btn_you_2&&this.btn_you_2.setVisible(!1),this.btn_you_3&&this.btn_you_3.setVisible(!1),this.outTileBg.setVisible(!1),this.isCanGuo=!0;for(var e=0;e<t.length;e++)if(t[e]==MJ_CHI)this.btn_chi&&this.btn_chi.setVisible(!0);else if(t[e]==MJ_PENG)this.btn_peng&&this.btn_peng.setVisible(!0);else if(t[e]==MJ_GANG)this.btn_gang&&this.btn_gang.setVisible(!0);else if(t[e]==MJ_HU){this.btn_hu&&this.btn_hu.setVisible(!0);for(var i=DataMgr.gameCtrl.actionHuTypes||[],a=0;a<i.length;a++){var s=i[a];if(s==MJ_HU_SINGLE_KING||s==MJ_HU_DOUBLE_KING||s==MJ_HU_THREE_KING){var r=this["btn_you_"+(s-MJ_HU_SINGLE_KING+1)];r&&(this.btn_hu.setVisible(!1),r.setVisible(!0)),s>=MJ_HU_DOUBLE_KING&&this.btn_guo&&this.btn_guo.setVisible(!1)}s==MJ_HU_FLOWER_KING&&this.btn_guo&&this.btn_guo.setVisible(!1)}}else if(t[e]==MJ_EXTRA)for(var i=DataMgr.gameCtrl.actionHuTypes||[],a=0;a<i.length;a++){if(i[a]==MJ_HU_CAN_SINGLE_KIND){this.btn_you&&this.btn_you.setVisible(!0),this.txt_you&&this.txt_you.setString("可单游");break}if(i[a]==MJ_HU_CAN_DOUBLE_KIND){this.btn_you&&this.btn_you.setVisible(!0),this.txt_you&&this.txt_you.setString("可双游");break}if(i[a]==MJ_HU_CAN_THREE_KIND){this.btn_you&&this.btn_you.setVisible(!0),this.txt_you&&this.txt_you.setString("可三游");break}}else t[e]==MJ_MING&&this.btn_ming&&this.btn_ming.setVisible(!0);this.sortGrp("grp_action",40,0,1);var n=DataMgr.gameCtrl.lastOutPoker,o=DataMgr.gameCtrl.lastOutPokerIdx,c=DataMgr.gameCtrl.myWheelIdx;n>0&&o!=c&&(this.outTile.setData(n,mjGame.Direction.BOTTOM,mjGame.TileStatus.UNCOVERING,mjGame.TilePlace.DISCARD),this.outTileBg.setVisible(!0)),this.outTileBg.setPosition(this.grp_action.x-160-165*t.length,this.grp_action.y-5)},clear:function(){var t=this;t.setVisible(!1),DataMgr.gameCtrl.actionList=[]},tap_btn_ming:function(){var t=this;this.delegate&&"function"==typeof this.delegate.checkCardTing&&this.delegate.checkCardTing();var t=this;t.setVisible(!1)},tap_btn_chi:function(){for(var t=this,e=DataMgr.gameCtrl.getChiList(),i=MJ_KING_ARR||[],a=[],s=0;s<e.length;s++){for(var r=!1,n=0;n<e[s].length;n++)for(var o in i)e[s][n]==i[o]&&(r=!0);r||a.push(e[s])}if(a.length<=0)return void ModuleMgr.showTipMsg("没办法吃！");var c=function(e){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_chi",poker_list:a[e]}),t.clear()};1==a.length?c(0):(t.layer_mult_action.setVisible(!0),t.layer_mult_action.setData(a,function(t){c(t)}))},setGangModle:function(t){this.gangModle=t},setNoGangPokerMap:function(t){t=t||{},this.noGangPokerMap=t},tap_btn_gang:function(t){for(var e=this,i=[],a=0;a<DataMgr.gameCtrl.myCards.length;a++)i.push(DataMgr.gameCtrl.myCards[a]);i.sort(sort_card);for(var s=analyse_card_data(i),r=DataMgr.gameCtrl.myWheelInfo.weave_pokers||[],n=[],a=0;a<r.length;a++){var o=r[a];o.mj_action==MJ_PENG&&n.push(o.poker_list[0])}var c=DataMgr.gameCtrl.lastOutPoker;if(c>0){for(var a=0;a<n.length;a++)if(n[a]==c)return ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:[c]}),void e.clear();for(var a=0;a<s.three_list.length;a++)if(s.three_list[a]==c)return ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:[c,c,c,c]}),void e.clear()}if(i.length%3!=2&&DataMgr.gameCtrl.lastDispatchPoker>0&&(i.push(DataMgr.gameCtrl.lastDispatchPoker),i.sort(sort_card),s=analyse_card_data(i)),s){var l=this.noGangPokerMap||{},_=[];if(2==this.gangModle){for(var a=0;a<n.length;a++)if(n[a]==DataMgr.gameCtrl.lastDispatchPoker&&!l[n[a]]){for(var u=[],h=0;h<4;h++)u.push(n[a]);_.push(u);break}}else for(var a=0;a<n.length;a++)for(var g=0;g<s.single_list.length;g++)if(n[a]==s.single_list[g]&&!l[n[a]]){for(var u=[],h=0;h<4;h++)u.push(n[a]);_.push(u)}for(var d=[],m=[],a=0;a<s.four_list.length;a++)a%4==0&&(m=[],d.push(m)),m.push(s.four_list[a]);var f=_.concat(d);if(f.length<0)return void ModuleMgr.showTipMsg("没办法杠！");var p=function(t){t<_.length?ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:[f[t][0]]}):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_gang",poker_list:f[t]}),e.clear()};if(1!=t)1==f.length?p(0):(e.layer_mult_action.setVisible(!0),e.layer_mult_action.setData(f,function(t){p(t)}));else for(var a=0;a<f.length;a++)if(f[a][0]==DataMgr.gameCtrl.lastDispatchPoker)return void p(a)}},tap_btn_you:function(){var t=this.delegate;if(t){t.unselectAllPoker();var e=null,i=DataMgr.gameCtrl.wheelInfos[DataMgr.gameCtrl.myWheelIdx];if(i){var a=i.extra_data||{};e=a.extra_poker}var s=arrayToMap(DataMgr.gameCtrl.actionHuTypes||[]),r=null;if(s[MJ_HU_CAN_DOUBLE_KIND]||s[MJ_HU_CAN_THREE_KIND]){var n=t.getCardItemList[DataMgr.gameCtrl.randPokerList[0]];if(r=n[n.length-1],!r){var n=t.getCardItemList[DataMgr.gameCtrl.randPokerList[1]];r=n[n.length-1]}}else if(s[MJ_HU_CAN_SINGLE_KIND]){e==DataMgr.gameCtrl.randPokerList[0]&&(e=67);var n=t.getCardItemList(e);r=n[n.length-1]}if(!r)return void this.tap_btn_guo();this.tap_btn_guo(),s[MJ_HU_CAN_DOUBLE_KIND]||s[MJ_HU_CAN_THREE_KIND]?t.tap_btn_out(r):s[MJ_HU_CAN_SINGLE_KIND]&&r.setSelect()}},tap_btn_you_1:function(){this.tap_btn_hu()},tap_btn_you_2:function(){this.tap_btn_hu()},tap_btn_you_3:function(){this.tap_btn_hu()},tap_btn_hu:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_hu"}),this.setVisible(!1)},tap_btn_guo:function(){if(cc.eventManager.dispatchCustomEvent("SuccesShowFinger"),this.isCanGuo){this.delegate&&this.delegate.bolTurnSelf()||(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_cancel"}),DataMgr.gameCtrl.actionList=[]),this.delegate&&"function"==typeof this.delegate.calGuo&&this.delegate.calGuo();var t=this;t.setVisible(!1)}},tap_btn_peng:function(){var t=DataMgr.gameCtrl.lastOutPoker;ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"action_peng",poker_list:[t,t,t]}),this.clear()}}),NewGameMyBtn.create=function(t,e,i){return new NewGameMyBtn(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameMyBtn.ui",NewGameMyBtn),NewGameMultAction=QPLayer.extend({uiPath:"ui/new/game/NewGameMultAction.ui",pokerList:[],callBack:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},setData:function(t,e){this.pokerList=t,this.callBack=e;var i=!1;t[0]!=t[1]&&(i=!0);for(var a=1;a<=4;a++){var s=t[a-1];if(s){var r={};r.poker_list=s,r.light=!0,this["item_action_"+a].setVisible(!0),this["item_action_"+a].setData(r),this["item_action_"+a].checkSelect(DataMgr.gameCtrl.lastOutPoker)}else this["item_action_"+a].setVisible(!1)}},tapCallBack:function(t){this.callBack&&this.callBack(t)},tap_item_action_1:function(){this.tapCallBack(0)},tap_item_action_2:function(){this.tapCallBack(1)},tap_item_action_3:function(){this.tapCallBack(2)},tap_item_action_4:function(){this.tapCallBack(3)}}),NewGameMultAction.create=function(t,e,i){return new NewGameMultAction(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameMultAction.ui",NewGameMultAction),NewGameActionItem=QPLayer.extend({uiPath:"ui/new/game/NewGameActionItem.ui",cardList:[],myWidth:0,myHeight:0,data:null,ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.setData(this.data)},setCardBg:function(t){},setData:function(t){if(!t)return void this.setVisible(!1);this.data=t,this.setVisible(!0);var e=t.poker_list||t,i=t.mj_action,a=t.light||!1,s=t.fang_pai||!1,r=t.last_out_poker_idx||0,n=t.last_out_poker||0;e.sort(sort_card),this.icon_light&&this.icon_light.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.icon_light.setVisible(a)},this)));for(var o=mjGame.Direction.BOTTOM,c=0;c<4;c++){var l=this["item_card_"+(c+1)];if(l)if(e[c])if(l.setVisible(!0),(BOL_AN_GANG_FANG_PAI||s||DataMgr.gameCtrl.isLog)&&i==MJ_AN_GANG&&3==c)l.setData(e[c],o,mjGame.TileStatus.UNCOVERING);else{var _=i==MJ_AN_GANG?mjGame.TileStatus.COVERING:mjGame.TileStatus.UNCOVERING;l.setData(e[c],o,_)}else l.setVisible(!1)}for(var c=0;c<4;c++){var u=this["arrow_"+(c+1)];u&&u.setVisible(!1)}if(1==WEAVE_POKER_SHOW_ARROW)if(i==MJ_CHI)for(var c=0;c<4;c++){var u=this["arrow_"+(c+1)];if(u&&e[c]==n){u.setVisible(!0);var h=this.getArrowRotation(r);u.setRotation(h)}}else if(i==MJ_PENG){if(e[0]==n){var u=this.arrow_2;if(u){u.setVisible(!0);var h=this.getArrowRotation(r);u.setRotation(h)}}}else if(e[0]==n){var u=this.arrow_4;if(u){u.setVisible(!0);var h=this.getArrowRotation(r);u.setRotation(h)}}},getArrowRotation:function(t){var e=DataMgr.gameCtrl.getChairIdByWheelIdx(t);return 1==e?0:2==e?-90:3==e?90:4==e?180:void 0},checkSelect:function(t){for(var e=1;e<=4;e++){var i=this["item_card_"+e];i&&i.getNum()==t&&i.setTileColor(cc.color(255,255,150))}},getMyWidth:function(){return this.getContentSize().width},getMyHeight:function(){return this.getContentSize().height}}),NewGameActionItem.create=function(t,e,i){return new NewGameActionItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameActionItem.ui",NewGameActionItem),NewGameResult=QPDlg.extend({uiPath:"ui/new/game/NewGameResult.ui",_isAlreadClose:!1,ctor:function(t,e,i){this.data=t||{isReconnect:!1},this.isLog=DataMgr.gameCtrl.isLog,this._isAlreadClose=!1,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=this;t.addListener("SuccessStartGame",function(e){t.close(),t._isAlreadClose=!0});var e=DataMgr.gameCtrl.resultData;cc.log("resultData",e);var i=gDup(e.details)||[];i=i.sort(function(t,e){return t.idx-e.idx});for(var a=0;a<i.length;a++){var s=i[a],r=s.idx||a+1,n=this["item_result"+r];n&&(n.setVisible(!0),n.setData(r))}this.data&&this.data.isReconnect?(this.btn_next.setVisible(!0),this.btn_desktop.setVisible(!1),this.btn_next.x=this.width/2,this.btn_exit.x=this.width/2):(this.btn_next.setVisible(!0),this.btn_desktop.setVisible(!0),this.btn_exit.x=this.width/2+180),this.isLog&&(this.btn_next.setVisible(!1),this.btn_exit.setVisible(!0))},tap_btn_next:function(){if(cc.log("继续"),!this._isAlreadClose){var t=DataMgr.gameCtrl.curStep;t!=MJ_STEP_SHOW_RESULT&&t!=MJ_STEP_GAME_END||(DataMgr.gameCtrl.isLog||(DataMgr.gameCtrl.curStep==MJ_STEP_GAME_END?cc.eventManager.dispatchCustomEvent("SuccessGameEnd"):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"score_end"})),cc.eventManager.dispatchCustomEvent("ClearResuleCard"),this.close()),this._isAlreadClose=!0}},tap_btn_exit:function(){console.log("result-exit SuccesLogExit"),cc.eventManager.dispatchCustomEvent("SuccesLogExit")},tap_btn_desktop:function(){this._isAlreadClose||(cc.eventManager.dispatchCustomEvent("ShowResultDesktopBtn"),this.close())}}),NewGameResult.create=function(t,e,i){return new NewGameResult(t,e,i)},ModuleMgr.registerModule("NewGameResult",NewGameResult),NewGameResultItem=QPLayer.extend({uiPath:"ui/new/game/NewGameResultItem.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setData:function(t){var e=gDup(DataMgr.gameCtrl.resultData),i=e.cur_score||{},a=e.details||[],s=DataMgr.gameCtrl.players[t];if(s&&s.info){var r=s.info;this.item_head&&this.item_head.setData(r),this.item_head&&this.item_head.setFrame(r.extra_data?r.extra_data.head:null);var n=toDecodeURIComponent(r.name);n=cutOffStr(n,10,!0),this.lab_name&&this.lab_name.setString(n)}var o=DataMgr.gameCtrl.lastWinIdx;this.img_banker&&this.img_banker.setVisible(o==t);var c=i["idx"+t]||0;c>=0?this.lab_score1&&this.lab_score1.setString("."+c):this.lab_score2&&this.lab_score2.setString("/"+c);var l={};for(var _ in a)a[_].idx==t&&(l=a[_]);var u=e.last_dispatch_poker||0,h=e.last_out_poker||0,g=e.last_out_poker_idx||0,d=l.poker_list||[];d.sort(sort_card),d=d.reverse();var m=0;h>0&&(m=g);for(var f=l.weave_pokers||[],p=e.cur_hu_types||[],M=0;M<p.length;M++)p[M]==MJ_HU_CATCH_KING&&MJ_KING_ARR[0]&&(e.win_idx==t&&(h=MJ_KING_ARR[0]),m=0);var C=this.game_card;C&&(C.setTouchEnabled(!1),e.win_idx==t?C.refreshResultPokers(!1,d,u,h):C.refreshResultPokers(!1,d),C.refreshWeavePoker(f,t));var D=this.getResultInfo(e,t,m);cc.log("infoStr",D),this.lab_info&&this.lab_info.setString(D)},getResultInfo:function(t,e,i){var a="",s=t.other_score||[],r=t.cur_hu_types||[],n={};for(var o in s)s[o].idx==e&&(n=s[o]);var c=n.flower_score||0,l=n.kind_score||0,_=n.pg_score||0,u=n.score_n||0;if(c>0&&(a+="花x"+c+"   "),l>0&&(a+="金x"+l+"   "),_>0&&(a+="杠x"+_+"   "),u>0?a+="连庄x"+u+"   ":u<0&&(a+="被抓庄x"+Math.abs(u)+"   "),t.win_idx==e){this.img_bg1&&this.img_bg1.setVisible(!1),this.img_bg2&&this.img_bg2.setVisible(!0),this.img_hu&&this.img_hu.setVisible(!0);for(var o=0;o<r.length;o++)a+=MJ_HU_NAME_TABLE[r[o]]+"   ";0==r.length&&(a+="放胡   ")}else i==e&&(a+="点炮   ");return a}}),NewGameResultItem.create=function(t,e,i){return new NewGameResultItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameResultItem.ui",NewGameResultItem),NewGameLastResult=QPDlg.extend({uiPath:"ui/new/game/NewGameLastResult.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this._super(),this.lab_roomId&&this.lab_roomId.setString("房间号: "+this.data.deskId),this.lab_round&&this.lab_round.setString("局数: "+this.data.curRound+"/"+this.data.round),this.lab_time&&this.lab_time.setString(this.getTimeStr()),this.lab_own&&this.lab_own.setString("创建者: "+this.data.ownerName),this.lab_roomType&&(this.data.union_rid?this.lab_roomType.setString("好友圈开房"):this.lab_roomType.setString("房主开房"));var t=gDup(this.data.players);t.sort(function(t,e){return t.idx-e.idx});for(var e=1;e<=t.length;e++)this["item_player"+e]&&(this["item_player"+e].setData(t[e-1]),this["item_player"+e].setVisible(!0));this.playInfo(),cc.sys.isNative?(this.btn_share.setVisible(!0),this.btn_close.setVisible(!0),this.btn_exit.setVisible(!0)):(this.btn_share2.setVisible(!0),this.btn_close2.setVisible(!0)),cc.sys.isNative||ModuleMgr.getDlg("NewGameDissolve")&&ModuleMgr.closeDlg("NewGameDissolve")},dlgActionEnd:function(){if(this._super(),!cc.sys.isNative){var t=getQueryString("lanscape_dev")||0;if(t)return;ModuleMgr.removeAllMsg();var e=this;setTimeout(function(){if(e.img_bg){var t=e.img_bg.height,i=winSizeWidthBigger.width,a=0,s=0;create_h5_cut_img(a,s,t,i)}},50)}},playInfo:function(){var t=DataMgr.gameCtrl.deskInfo,e=t.info,i="",a="";switch(t.game_type){case GAME_TYPE_FZMJ:if(i="福州麻将",e){a+=1==e.cost?"放胡均摊":"放胡单赔";var s=0;1==e.spec1&&(a+=",清一色",s++),1==e.spec3&&(a+=",可胡金龙",s++),1==e.spec2&&(a+=",单钓剩金不平胡",s++),1==e.spec4&&(a+=",金雀开口不平胡",s++),4==s&&this.lab_playInfo&&this.lab_playInfo.setFontSize(15)}break;case GAME_TYPE_NDMJ:i="宁德麻将",e&&(a+=1==e.cost?"放胡均摊":"放胡单赔",a+=1==e.spec_type?",白板为金":",开金")}var r="当前玩法: "+i+","+a;this.lab_playInfo&&this.lab_playInfo.setString(r)},getTimeStr:function(){var t=this.data.creatTime,e=new Date(1e3*t);return e.format("yyyy年MM月dd日 hh:mm")},tap_btn_share:function(){if(cc.log("微信分享"),cc.sys.isNative){var t="",e=function(){platform.shareImage(t,0)};t=saveScreenShot(e,90)}},tap_btn_close:function(){this.close(),this.data.dlgType&&1==this.data.dlgType||(0==DataMgr.gameCtrl.deskIdx?ModuleMgr.enterEnterScene():(DataMgr.gameCtrl.deskIdx=0,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"leave_desk"})))},tap_btn_close2:function(){this.tap_btn_close()},tap_btn_exit:function(){this.tap_btn_close()},onExit:function(){this._super(),cc.sys.isNative||remove_h5_cut_img()}}),NewGameLastResult.create=function(t,e,i){return new NewGameLastResult(t,e,i)},ModuleMgr.registerModule("NewGameLastResult",NewGameLastResult),NewGameLastResultItem=QPLayer.extend({uiPath:"ui/new/game/NewGameLastResultItem.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setData:function(t){this.item_head&&this.item_head.setData({headimgurl:t.headUrl}),this.item_head&&this.item_head.setFrame(t.extra_data?t.extra_data.head:null);var e=toDecodeURIComponent(t.name);e=cutOffStr(e,10,!0),this.lab_name&&this.lab_name.setString(e),this.lab_uid&&this.lab_uid.setString(t.accountUid),this.lab_score&&(t.score>=0?(this.lab_score.setColor(cc.color(255,0,0)),this.lab_score.setString("+"+t.score)):(this.lab_score.setColor(cc.color(0,0,0)),this.lab_score.setString(t.score)))}}),NewGameLastResultItem.create=function(t,e,i){return new NewGameLastResultItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/NewGameLastResultItem.ui",NewGameLastResultItem),XiShouAni=QPLayer.extend({uiPath:"ui/new/game/XiShouAni.ui",ctor:function(t,e,i){QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.startPlay()},startPlay:function(){var t=300,e=300,i=.25;this.img_hand1&&this.img_hand1.runAction(cc.sequence(cc.spawn(cc.fadeIn(.3),cc.moveTo(.3,cc.p(t,e))),cc.moveTo(i/2,cc.p(t-20,e-20)),cc.moveTo(i,cc.p(t+20,e+20)),cc.moveTo(i,cc.p(t-20,e-40)),cc.moveTo(i,cc.p(t+20,e+20)),cc.moveTo(i,cc.p(t-20,e-20)),cc.moveTo(i,cc.p(t+20,e+40)),cc.moveTo(i,cc.p(t-20,e-20)),cc.moveTo(i,cc.p(t+20,e+20)),cc.spawn(cc.fadeOut(.3),cc.moveTo(.3,cc.p(t+150,e-130))),cc.delayTime(.1),cc.callFunc(function(){this.close()},this)));var a=265;this.img_hand2&&this.img_hand2.runAction(cc.sequence(cc.spawn(cc.fadeIn(.3),cc.moveTo(.3,cc.p(a,e))),cc.moveTo(i/2,cc.p(a+20,e+20)),cc.moveTo(i,cc.p(a-20,e-20)),cc.moveTo(i,cc.p(a+20,e)),cc.moveTo(i,cc.p(a-20,e-20)),cc.moveTo(i,cc.p(a+20,e+20)),cc.moveTo(i,cc.p(a-20,e)),cc.moveTo(i,cc.p(a+20,e+20)),cc.moveTo(i,cc.p(a-20,e-20)),cc.spawn(cc.fadeOut(.3),cc.moveTo(.3,cc.p(t-150,e-130)))));var s=.5;this.img_pao1&&this.img_pao1.runAction(cc.sequence(cc.delayTime(.1),cc.fadeTo(s,220),cc.fadeTo(s,50),cc.rotateBy(0,-45),cc.fadeTo(s,200),cc.fadeTo(s,0))),this.img_pao2&&this.img_pao2.runAction(cc.sequence(cc.delayTime(.2),cc.fadeTo(s,220),cc.fadeTo(s,50),cc.rotateBy(0,45),cc.fadeTo(s,230),cc.fadeTo(s,0))),this.img_pao3&&this.img_pao3.runAction(cc.sequence(cc.delayTime(.3),cc.fadeTo(s,220),cc.fadeTo(s,50),cc.rotateBy(0,-45),cc.fadeTo(s,210),cc.fadeTo(s,0))),this.img_pao4&&this.img_pao4.runAction(cc.sequence(cc.delayTime(.4),cc.fadeTo(s,220),cc.fadeTo(s,50),cc.rotateBy(0,45),cc.fadeTo(s,190),cc.fadeTo(s,0)))}}),XiShouAni.create=function(t,e,i){return new XiShouAni(t,e,i)},ModuleMgr.registerModule("XiShouAni",XiShouAni),BaiShenAni=QPLayer.extend({uiPath:"ui/new/game/BaiShenAni.ui",ctor:function(t,e,i){QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){this.startPlay()},startPlay:function(){if(console.log("wang-BaiShenAni--startPlay"),this.img_baishen3&&this.img_baishen3.runAction(cc.spawn(cc.sequence(cc.scaleTo(.1,2),cc.scaleTo(.3,0)),cc.rotateBy(.4,180))),this.img_baishen1&&this.img_baishen1.runAction(cc.sequence(cc.spawn(cc.sequence(cc.scaleTo(.4,1.2),cc.scaleTo(.1,1)),cc.fadeIn(.5)),cc.delayTime(3.2),cc.fadeOut(.5))),this.img_baishen2&&this.img_baishen2.runAction(cc.sequence(cc.scaleTo(.4,1.2),cc.scaleTo(.1,1),cc.delayTime(3.2),cc.fadeOut(.5))),this.img_baishen4&&this.img_baishen4.runAction(cc.sequence(cc.delayTime(.5),cc.fadeTo(1,255),cc.fadeTo(1,50),cc.fadeTo(1,255),cc.fadeTo(.5,0))),this.img_baishen5&&this.img_baishen5.runAction(cc.sequence(cc.delayTime(.5),cc.scaleTo(.25,.5),cc.scaleTo(.25,0),cc.moveBy(0,cc.p(80,-5)),cc.scaleTo(.25,.5),cc.scaleTo(.25,0),cc.moveBy(0,cc.p(-60,-20)),cc.scaleTo(.25,.5),cc.scaleTo(.25,0),cc.moveBy(0,cc.p(30,-10)),cc.scaleTo(.25,.5),cc.scaleTo(.25,0),cc.moveBy(0,cc.p(-5,40)),cc.scaleTo(.25,.5),cc.scaleTo(.25,0),cc.moveBy(0,cc.p(-20,-20)),cc.scaleTo(.25,.5),cc.scaleTo(.25,0),cc.moveBy(0,cc.p(15,15)),cc.scaleTo(.25,.5),cc.scaleTo(.25,0))),this.img_baishen6&&this.img_baishen6.runAction(cc.sequence(cc.delayTime(.5),cc.fadeTo(.5,100),cc.spawn(cc.sequence(cc.fadeTo(1,80),cc.fadeTo(1,100),cc.fadeTo(1,80)),cc.rotateBy(3,90)),cc.fadeTo(.2,0),cc.callFunc(function(){console.log("wang-BaiShenAni--close"),this.close()},this))),this.img_baishen1)for(var t=0;t<8;t++){var e=new cc.Sprite("res/uires/new/ani/baishen1.png");e.setPosition(this.img_baishen1.x,this.img_baishen1.y),e.setOpacity(0),this.addChild(e,-1);var i=.7+.3*t;e.runAction(cc.sequence(cc.delayTime(i),cc.fadeTo(0,50),cc.spawn(cc.scaleTo(1,1.3),cc.fadeOut(1))))}}}),BaiShenAni.create=function(t,e,i){return new BaiShenAni(t,e,i)},ModuleMgr.registerModule("BaiShenAni",BaiShenAni),OutPokerTips=QPLayer.extend({uiPath:"ui/new/game/OutPokerTips.ui",ctor:function(t,e,i){t=t||this.uiPath,QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},setData:function(t){t>0?(this.item_tile&&this.item_tile.setData(t,mjGame.Direction.BOTTOM,mjGame.TileStatus.UNCOVERING,mjGame.TilePlace.DISCARD),this.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.setVisible(!0)},this)))):this.setVisible(!1)}}),OutPokerTips.create=function(t,e,i){return new OutPokerTips(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/OutPokerTips.ui",OutPokerTips),GameSettingDlg=QPDlg.extend({uiPath:"ui/new/game/GameSettingDlg.ui",bolDlgAction:!1,ctor:function(t,e,i){this.data=t,this.isLog=DataMgr.gameCtrl.isLog,this.replayData=DataMgr.gameCtrl.replayData,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this._initInfo(),this._optionData=[{name:"ck_bg",type:1,option:[1,2,3]},{name:"ck_size",type:1,option:[1,2]},{name:"ck_color",type:1,option:[1,2]},{name:"ck_click",type:1,option:[1,2]}],this._roomData=[];var t=cc.sys.localStorage.getItem("fzmj_game_setting_ck_bg")||1,e=cc.sys.localStorage.getItem("fzmj_game_setting_ck_size")||1,i=cc.sys.localStorage.getItem("fzmj_game_setting_ck_color")||1,a=cc.sys.localStorage.getItem("fzmj_game_setting_ck_click")||1;2==t?this._roomData.push("010"):3==t?this._roomData.push("001"):this._roomData.push("100"),2==e?this._roomData.push("01"):this._roomData.push("10"),2==i?this._roomData.push("01"):this._roomData.push("10"),2==a?this._roomData.push("01"):this._roomData.push("10"),this.initOption(),DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()||this.data.isPlaying?(this.btn_dissolve&&this.btn_dissolve.setVisible(!0),this.btn_exit&&this.btn_exit.setVisible(!1)):(this.btn_exit&&this.btn_exit.setVisible(!0),this.btn_dissolve&&this.btn_dissolve.setVisible(!1)),this.isLog&&(this.btn_exit&&this.btn_exit.setVisible(!0),this.btn_dissolve&&this.btn_dissolve.setVisible(!1));var s=cc.sys.localStorage.getItem("musicVolume"),r=cc.sys.localStorage.getItem("effectsVolume"),n="res/uires/new/setting/music_close.png",o="res/uires/new/setting/music_close.png";s>0&&(n="res/uires/new/setting/music_open.png"),r>0&&(o="res/uires/new/setting/music_open.png"),this.btn_music.loadTexture(GetRealPath(n)),this.btn_effect.loadTexture(GetRealPath(o))},_initInfo:function(){var t="",e=DataMgr.gameCtrl.deskInfo,i=e.info;switch(this.isLog&&(e=this.replayData.desk_info,i=this.replayData.desk_info),t+=e.full_round+"局",t+=","+e.full_num+"人",e.game_type){case GAME_TYPE_FZMJ:if(i){var a=0;1==i.cost?(t+=",放胡均摊",a++):(t+=",放胡单赔",a++),1==i.spec1&&(t+=",清一色",a++),1==i.spec3&&(t+=",可胡金龙",a++),1==i.spec2&&(t+=",单钓剩金不平胡",a++),1==i.spec4&&(t+=",金雀开口不平胡",a++),a>=5?this.lab_info&&this.lab_info.setFontSize(18):this.lab_info&&this.lab_info.setFontSize(22)}break;case GAME_TYPE_NDMJ:i&&(t+=1==i.cost?",放胡均摊":",放胡单赔",t+=1==i.spec_type?",白板为金":",开金")}this.lab_info&&this.lab_info.setString(t)},initOption:function(){
for(var t=gDup(this._roomData),e=0;e<this._optionData.length;e++)for(var i=this._optionData[e],a=t[e],s=0;s<a.length;s++)"1"==a[s]&&1==i.type&&this.OnSelectBtnEvent({name:"ended",target:this[i.name+s+"_btn"]},!0)},OnSelectEvent:function(t,e){if("selected"==t.name){var i=t.target.name,a=i.substr(0,i.length-1),s=parseInt(i.substr(i.length-1,1));this.setSelect(a,s,e)}else"unselected"==t.name&&t.target.setSelected(!0)},OnSelectBtnEvent:function(t,e){if("ended"==t.name){var i=t.target.name,a=i.substr(0,i.length-4),s={name:"selected",target:this[""+a]};this.OnSelectEvent(s,e)}},setSelect:function(t,e,i){for(var a=0,s=0;s<this._optionData.length;s++)this._optionData[s].name==t&&(a=s);this._roomData[a]="";for(var s=0;s<this._optionData[a].option.length;s++)s==e?this._roomData[a]+="1":this._roomData[a]+="0";this.refreshSelect(t,a,e),i||(cc.sys.localStorage.setItem("fzmj_game_setting_"+t,e+1),"ck_bg"==t?cc.eventManager.dispatchCustomEvent("SuccesSetDeskBg"):"ck_size"==t?cc.eventManager.dispatchCustomEvent("SuccesSetTileSize"):"ck_color"==t&&cc.eventManager.dispatchCustomEvent("SuccesSetTileBg"))},refreshSelect:function(t,e,i){for(var a=0;a<this._optionData[e].option.length;a++)this[t+a]&&this[t+a].setSelected(a==i)},tap_btn_dissolve:function(){this.tap_btn_back(!0)},tap_btn_exit:function(){this.tap_btn_back(!1)},tap_btn_back:function(t){if(this.isLog)return console.log("setting isLog==true"),void ModuleMgr.showConfirmCancelMsg("是否要退出房间?",function(){console.log("setting SuccesLogExit"),cc.eventManager.dispatchCustomEvent("SuccesLogExit")},function(){});var e=function(){cc.log("tap_btn_back---onOk"),t?ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"apply_dissolve"}):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"leave_desk"})},i=function(){},a="是否要退出房间?";t&&(a="是否要解散房间?"),ModuleMgr.showConfirmCancelMsg(a,e,i)},tap_btn_music:function(){var t=cc.sys.localStorage.getItem("musicVolume"),e="res/uires/new/setting/music_open.png";t>0&&(e="res/uires/new/setting/music_close.png"),this.btn_music.loadTexture(GetRealPath(e)),gSetMusic(t>0)},tap_btn_effect:function(){var t=cc.sys.localStorage.getItem("effectsVolume"),e="res/uires/new/setting/music_open.png";t>0&&(e="res/uires/new/setting/music_close.png"),this.btn_effect.loadTexture(GetRealPath(e)),gSetMusicEffect(t>0)},tap_btn_rule:function(){ModuleMgr.runDlg("GameRuleDlg")}}),GameSettingDlg.create=function(t,e,i){return new GameSettingDlg(t,e,i)},ModuleMgr.registerModule("GameSettingDlg",GameSettingDlg),GameChatDlg=QPDlg.extend({uiPath:"ui/new/game/GameChatDlg.ui",bolDlgAction:!1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e);var a=this;this.addListener("HideChatLayer",function(t){a.close()})},onLoaded:function(){for(var t=[],e=1;e<=9;e++){var i=Math.floor((e-1)/3),a=t[i]||[];a.push(e),t[i]=a}this.refreshList({name:"list_1",itemCell:GameChatFaceItem,list:t}),this.list_1.setBounceEnabled(!0),this.refreshList({name:"list_2",itemCell:GameChatTxtItem,list:chatCfgList}),this.list_2.setBounceEnabled(!0)},tap_btn_hide:function(){this.close()}}),GameChatDlg.create=function(t,e,i){return new GameChatDlg(t,e,i)},ModuleMgr.registerModule("GameChatDlg",GameChatDlg),GameChatTxtItem=QPListItem.extend({uiPath:"ui/new/game/GameChatTxtItem.ui",_txt:null,ctor:function(t,e,i){t=t||this.uiPath,QPListItem.prototype.ctor.call(this,t,e,i)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(t){t||this.setVisible(!1),this._txt=t,this.lab_txt.setString(this._txt)},tap_tap_touch:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",txt:this._txt}),cc.eventManager.dispatchCustomEvent("HideChatLayer")}}),GameChatTxtItem.create=function(t,e,i){return new GameChatTxtItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/GameChatTxtItem.ui",GameChatTxtItem),GameChatFaceItem=QPListItem.extend({uiPath:"ui/new/game/GameChatFaceItem.ui",_data:null,_indexArr:[],ctor:function(t,e,i){t=t||this.uiPath,QPListItem.prototype.ctor.call(this,t,e,i)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(t){t||this.setVisible(!1),this._data=t;var e=t;this._indexArr=e;for(var i=0;i<3;i++){var a=this["item_face_"+i];a&&(e[i]?(a.setVisible(!0),a.loadTexture("res/uires/new/game/chat/"+e[i]+".png")):a.setVisible(!1))}},sendFace:function(t){this._indexArr[t]&&(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",faceId:this._indexArr[t]}),cc.eventManager.dispatchCustomEvent("HideChatLayer"))},tap_item_face_0:function(){this.sendFace(0)},tap_item_face_1:function(){this.sendFace(1)},tap_item_face_2:function(){this.sendFace(2)}}),GameChatFaceItem.create=function(t,e,i){return new GameChatFaceItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/GameChatFaceItem.ui",GameChatFaceItem),GameLocationDlg=QPDlg.extend({uiPath:"ui/new/game/GameLocationDlg.ui",bolDlgAction:!1,ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=DataMgr.gameCtrl.deskInfo.full_num,e="item_pos"+t;if(this[e]&&this[e].setVisible(!0),DataMgr.gameCtrl.location)for(var i=0;i<DataMgr.gameCtrl.location.length;i++){var a=DataMgr.gameCtrl.players[i+1];if(null!=a){var s=a.info,r=DataMgr.gameCtrl.getChairIdxByRid(s.rid);this[e+"_head"+r]&&(this[e+"_head"+r].setData(s),this[e+"_head"+r].setFrame(s.extra_data?s.extra_data.head:null));var n=toDecodeURIComponent(s.name);n=cutOffStr(n,10,!0),this[e+"_name"+r]&&this[e+"_name"+r].setString(n),this[e+"_"+r]&&this[e+"_"+r].setVisible(!0);for(var o=DataMgr.gameCtrl.location[i],c=ConvertToJson(o.location),l=0;l<DataMgr.gameCtrl.location.length;l++)if(i!=l){var _=DataMgr.gameCtrl.players[l+1];if(null==_)continue;var u=_.info,h=DataMgr.gameCtrl.getChairIdxByRid(u.rid),g=DataMgr.gameCtrl.location[l],d=ConvertToJson(g.location),m="未检测到位置",f=cc.color(0,0,0);if(c&&c.longitude&&c.longitude!=-1&&d&&d.longitude&&d.longitude!=-1){var p=parseInt(gGetGreatCircleDistance(c.latitude,c.longitude,d.latitude,d.longitude));m=p+"米",p<=40&&(f=cc.color(255,0,0))}this[e+"_lab"+r+h]&&(this[e+"_lab"+r+h].setString(m),this[e+"_lab"+r+h].setColor(f),this[e+"_lab"+r+h].setVisible(!0))}}}}}),GameLocationDlg.create=function(t,e,i){return new GameLocationDlg(t,e,i)},ModuleMgr.registerModule("GameLocationDlg",GameLocationDlg);var GameInterFaceDlg_hit_time=0;NewGameFaceDlg=QPDlg.extend({uiPath:"ui/new/game/NewGameFaceDlg.ui",hit:null,hited:null,tapTime:0,faceInfo:null,faceIDMap:{},fullFace:16,ctor:function(t,e,i){this.headData=t.headData,this.hit=t.hit_index,this.hited=t.hited_index,this.faceInfo=CsvMgr.getDataWithFile("face"),QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){var t=toDecodeURIComponent(this.headData.name);if(this.lab_name&&this.lab_name.setString("昵称: "+t),this.lab_id&&this.lab_id.setString("ID: "+this.headData.account_uid),this.lab_ip&&this.lab_ip.setString("IP: "+this.headData.client_ip),this.item_head)if(this.item_head.setData(this.headData),ME_D.get_rid()==this.headData.rid){var e=DataMgr.propCtrl.getHeadPropInfo(),i=e?e.icon:null;this.item_head.setFrame(i)}else{var i=null;this.headData&&this.headData.extra_data&&""!=this.headData.extra_data.head&&(i=this.headData.extra_data.head),this.item_head.setFrame(i)}this.loadBtnTexture(),this.scheduleUpdate()},update:function(t){this.tapTime-=t},loadBtnTexture:function(){for(var t=1;t<=this.fullFace;++t)this["grp_"+t].setVisible(!1);if(this.faceInfo)for(var e=1,t=1;t<=this.fullFace;++t){var i=t+1e3;this.faceInfo[i]&&this.faceInfo[i].is_open&&(this.faceIDMap[e]=i,this["btn_"+e].loadTextureNormal("res/uires/face/texiao"+t+".png",ccui.Widget.PLIST_TEXTURE),this["btn_"+e].setScale((this.faceInfo[i].scale||100)/100),this["img_money_"+e].setVisible(this.faceInfo[i].money),this["lab_money_"+e].setVisible(this.faceInfo[i].money),this["lab_money_"+e].setString(this.faceInfo[i].money||0),this["grp_"+e].setVisible(!0),e++)}},OnTouch:function(t){if("ended"==t.name){var e=parseInt(t.target.name.substr(4,2));this.sendData(e)}},tap_btn_Close:function(){this.close()},sendData:function(t){var e=new Date;if(e.getTime()-GameInterFaceDlg_hit_time<3e3)return ModuleMgr.showTipMsg("操作过于频繁，请稍后操作！");GameInterFaceDlg_hit_time=e.getTime();var i=this.faceIDMap[t]||1,a=this.faceInfo[i];if(null!=this.hit&&null!=this.hited){var s={oper:"face",faceId:i,idx1:this.hit,idx2:this.hited};a.money||(s.oper="chat"),DataMgr.gameCtrl.isGameComplete&&DataMgr.gameCtrl.myWheelIdx?cc.eventManager.dispatchCustomEvent("FaceInter",s):ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",s)}this.close()}}),NewGameFaceDlg.create=function(t,e,i){return new NewGameFaceDlg(t,e,i)},ModuleMgr.registerModule("NewGameFaceDlg",NewGameFaceDlg),NewGameDissolve=QPDlg.extend({uiPath:"ui/new/game/NewGameDissolve.ui",time:0,passTime:0,ctor:function(t,e,i){t=t||this.uiPath,QPDlg.prototype.ctor.call(this,t,e,i);var a=this;this.addListener("AGREE_DISSOLVE",function(t){a.onRefresh()}),this.addListener("REFUSE_DISSOLVE",function(t){a.onRefresh(),a.close()})},onRefresh:function(){for(var t=!1,e=1;e<=4;e++)0==DataMgr.gameCtrl.dissovle[e]?this["txt_info"+e]&&this["txt_info"+e].loadTexture(GetRealPath("res/uires/new/common/dengdai.png")):1==DataMgr.gameCtrl.dissovle[e]?(this["txt_info"+e]&&this["txt_info"+e].loadTexture(GetRealPath("res/uires/new/common/tongyi.png")),e==DataMgr.gameCtrl.myWheelIdx&&(t=!0)):(this["txt_info"+e]&&this["txt_info"+e].loadTexture(GetRealPath("res/uires/new/common/jujue.png")),e==DataMgr.gameCtrl.myWheelIdx&&(t=!0));t?(this.btn_ok&&this.btn_ok.setVisible(!1),this.btn_cancel&&this.btn_cancel.setVisible(!1)):(this.btn_ok&&this.btn_ok.setVisible(!0),this.btn_cancel&&this.btn_cancel.setVisible(!0))},DoCancel:function(t){"ended"==t.name&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"refuse_dissolve"})},DoOk:function(t){"ended"==t.name&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"agree_dissolve"})},onLoaded:function(){this.onRefresh(),this.onAllUiLoaded();var t=DISSOLVE_TIME-(DataMgr.timeCtrl.getServerTime()-DataMgr.gameCtrl.deskTime);this.passTime=0,this.time=t,this.lab_time&&this.lab_time.setString(t),this.scheduleUpdate()},update:function(t){if(this.passTime+=t,this.time<=this.passTime)return this.lab_time&&this.lab_time.setString(0),this.slid_time&&this.slid_time.setPercent(0),this.close(),this.unscheduleUpdate(),void this.setVisible(!1);var e=this.time-this.passTime;if(e<.1)this.lab_time&&this.lab_time.setString(0),this.slid_time&&this.slid_time.setPercent(0);else{var i=parseInt(this.time-this.passTime);this.lab_time&&this.lab_time.setString(i),this.slid_time&&this.slid_time.setPercent(100*i/DISSOLVE_TIME)}},stop:function(){this.unscheduleUpdate(),this.passTime=0},onEnter:function(){QPLayer.prototype.onEnter.call(this),this.setLocalZOrder(1e4)},onAllUiLoaded:function(){for(var t=0,e=1;e<=4;e++){var i=DataMgr.gameCtrl.players[e];this["head"+e]&&this["txt_info"+e]&&(this["head"+e].setVisible(!1),this["txt_info"+e].setVisible(!1),i&&(t++,this["txt_info"+e].setVisible(!0),this["head"+e].setVisible(!0),this["head"+e].setData(i.info),this["head"+e].setNameColor(cc.color(153,0,0)),this["head"+e].setScoreVisible(!1),this["head"+e].setOnline(DataMgr.gameCtrl.online[e]),i.rid==DataMgr.gameCtrl.deskInfo.desk_own_rid&&this["head"+e].setOwer(!0)))}this.item_head_group&&(3==t?this.item_head_group.x=this.width/2+85:2==t?this.item_head_group.x=this.width/2+170:this.item_head_group.x=this.width/2)}}),NewGameDissolve.create=function(t,e,i){return new NewGameDissolve(t,e,i)},ModuleMgr.registerModule("NewGameDissolve",NewGameDissolve),NewGameLogLayer=NewGameLayer.extend({uiPath:"ui/new/game/NewGameLayer.ui",stepTimeCfg:null,userList:[],idxList:[],pokerList:[],dealList:[],weaveList:[],flowerList:[],_speedTime:1,_isPlayState:!0,ctor:function(t,e,i){t=t||this.uiPath,this.isLog=DataMgr.gameCtrl.isLog,this.replayData=DataMgr.gameCtrl.replayData,NewGameLayer.prototype.ctor.call(this,t,e,i)},onLoaded:function(){this.initData(),this.setDeskBg(),this.initUi(),this.initLogGameUI(),this.dealEventStack(),this.startPlay(0)},_flowerMap:[],getLogFlowerTime:function(){var t=0;if(this.replayData.first_poker_list&&this.replayData.flower_map&&this.replayData.flower_map.length>0){this._flowerMap=[];for(var e=0;e<this.replayData.flower_map.length;e++){var i=this.replayData.flower_map[e];if(i&&i.length>0)for(var a=0;a<i.length;a++)i[a].poker_list&&(this._flowerMap[a]=i[a])}this.playLogFixFlowerAction(0),t=this._flowerMap.length}return t},_flowerIdx:0,_nowMap:0,playLogFixFlowerAction:function(t){var e=this._flowerMap[t];if(!e)return void this.refreshLogremainNum();var i=this.getListIdxByWheelIdx(e.idx),a=this.getChairIdByWheelIdx(e.idx);this["game_card"+a]&&4==a&&this["game_card"+a].checkFlower(),this.cal_playEfc(e.idx,MJ_FLOWER),this.setPokerList(e.idx,"flowerList",e.flower_list),this["role_card"+a]&&this["role_card"+a].setFlower(!0,this.flowerList[i].length),this.setUserLogFlowerList(),this._nowMap=e,this.scheduleOnce(function(){this.setPokerList(this._nowMap.idx,"pokerList",this._nowMap.poker_list),this.refreshLogPoker(this._nowMap.idx,!0),this.isFirstFixFlower=!1},.5),this._flowerIdx=t+1,this.scheduleOnce(function(){this.playLogFixFlowerAction(this._flowerIdx)},1)},setUserLogFlowerList:function(){for(var t=[],e=[4,3,1,2],i=0;i<e.length;i++)for(var a=0;a<this.userList.length;a++){var s=this.getChairIdByWheelIdx(this.userList[a].wheel_idx);if(s==e[i]){var r={};r.name=this.userList[a].name;var n=this.flowerList[a];r.num=n.length,r.wheel_idx=this.userList[a].wheel_idx;for(var o=[],c=0;c<n.length;c++)o[n[c]]=o[n[c]]||0,o[n[c]]++;r.list=[];for(var c=0;c<o.length;c++)o[c]>0&&r.list.push({card:c,num:o[c]});t.push(r)}}DataMgr.gameCtrl.setUserLogFlowerList(t)},cal_user_poker_fix_flower:function(t){var e=this.getListIdxByWheelIdx(t.idx),i=this.getChairIdByWheelIdx(t.idx),a=this.flowerList[e],s=t.flower_list[a.length];this["game_card"+i]&&this["game_card"+i].setTileData(0,s),this["game_card"+i]&&4==i&&this["game_card"+i].checkFlower(),this.cal_playEfc(t.idx,MJ_FLOWER),this.addOnePokerToPokerList(t.idx,"flowerList",s),this["role_card"+i]&&this["role_card"+i].setFlower(!0,this.flowerList[e].length),this.setUserLogFlowerList(),this.subtractLastPokerNum(1)},_replayIndex:0,_lastDealIdx:0,_lastDealPoker:0,_dispatchNum:0,_firstDispatchPoker:0,startPlay:function(t){if(this._isPlayState){var e=this.replayData.steps;this._replayIndex=t;var i=e[t];if(i){var a=i.a,s=i.d,r=this.stepTimeCfg[""+i.a].time;switch(a){case"open_door":break;case"last_win_op_idx":this.cal_last_win_op_idx(s);break;case"rand_poker":break;case"wheel_rand_poker":break;case"op_idx":this.cal_op_idx(s);break;case"dispatch_poker":this._dispatchNum++,1==this._dispatchNum?r=this.replayData.first_poker_list?.5:0:2==this._dispatchNum&&this.replayData.first_poker_list?(this._firstDispatchPoker=s.poker_num,this.isFirstFixFlower=!0,r=this.getLogFlowerTime()):this.cal_dispatch_poker(s);break;case"deal_poker":this.cal_deal_poker(s);break;case"action_chi":this.cal_action_chi(s);break;case"action_peng":this.cal_action_peng(s);break;case"action_gang":this.cal_action_gang(s);break;case"action_hu":this.cal_action_hu(s);break;case"no_action":break;case"user_poker_fix_flower":this.cal_user_poker_fix_flower(s);break;case"show_card":break;case"show_result":this.cal_show_result(s);break;case"rand_mine_idx":break;case"rand_mine_list":}this.scheduleOnce(function(){this.startPlay(t+1)},this._speedTime*r)}}},cal_last_win_op_idx:function(t){var e=t.last_win_op_idx,i=this.getChairIdByWheelIdx(e);this["role_card"+i]&&this["role_card"+i].setMaster(!0),DataMgr.gameCtrl.lastWinIdx=e},cal_op_idx:function(t){var e=t.cur_op_idx,i=this.getChairIdByWheelIdx(e);this.item_turn.turn(i),this.item_turn.setVisible(!0)},cal_dispatch_poker:function(t){var e=t.idx,i=this.getChairIdByWheelIdx(e);this["game_card"+i]&&this["game_card"+i].setTileData(0,t.poker_num),this.addOnePokerToPokerList(e,"pokerList",t.poker_num),t.remain_poker_num>=0&&this.txt_last_num&&this.txt_last_num.setString(t.remain_poker_num),this._lastDealIdx=0,this._lastDealPoker=0},cal_deal_poker:function(t){playEffect("card_send_effect.mp3");var e=t.idx,i=this.getChairIdByWheelIdx(e);this["game_card"+i]&&this["game_card"+i].setTileData(0,void 0);for(var a=t.poker_list,s=0;s<a.length;s++)this.removeOnePokerToPokerList(e,"pokerList",a[s]),this.addOnePokerToPokerList(e,"dealList",a[s]),this._lastDealIdx=e,this._lastDealPoker=a[s];this.refreshLogPoker(e),this.refreshLogDealPoker(e),this.hidePutOutArrowAni();var r=this["game_disCard"+i],n=this.getListIdxByWheelIdx(e);r&&r.setOutPokers(this.dealList[n]),r&&r.showPutOutArrow();var o=this._lastDealPoker,c=this.replayData.desk_info;if(IsGameTypeNdmj(c.game_type)&&0==c.spec_type){var l=DataMgr.gameCtrl.randPokerList||[];l[0]&&67!=l[0]&&(67==this._lastDealPoker?o=l[0]:this._lastDealPoker==l[0]&&(o=67))}var _=get_card_color(o),u=get_card_value(o),h="",g="%s/%s.mp3";if(MUSIC_DIFF_SEX){var d=this["role_card"+i];g=d&&2==d.getSex()?"%s/woman/%s.mp3":"%s/man/%s.mp3"}_==LOGIC_COLOR_WAN?h=g.format(MUSIC_TYPE,"wan_"+u):_==LOGIC_COLOR_TIAO?h=g.format(MUSIC_TYPE,"tiao_"+u):_==LOGIC_COLOR_TONG?h=g.format(MUSIC_TYPE,"tong_"+u):_==LOGIC_COLOR_FENG?h=g.format(MUSIC_TYPE,"feng_"+u):_==LOGIC_COLOR_JIANG&&(h=g.format(MUSIC_TYPE,"jiang_"+u)),h&&playEffect(h)},cal_playEfc:function(t,e){var i=this.getChairIdByWheelIdx(t),a=this["item_actionEfc"+i],s=this["role_card"+i];a&&s&&(a.setSex(s.getSex()),a.setData({mj_action:e}))},cal_action_chi:function(t){var e=t.idx,i=t.poker_list;this.cal_playEfc(e,MJ_CHI);for(var a=0;a<i.length;a++)i[a]!=this._lastDealPoker&&this.removeOnePokerToPokerList(e,"pokerList",i[a]);this.removeOnePokerToPokerList(this._lastDealIdx,"dealList",this._lastDealPoker);var s={mj_action:MJ_CHI,last_out_poker_idx:this._lastDealIdx,last_out_poker:this._lastDealPoker,poker_list:i};this.addToWeaveList(e,s),this.refreshLogPoker(e),this.refreshLogDealPoker(this._lastDealIdx),this.refreshLogWeavePoker(e),this.hidePutOutArrowAni()},cal_action_peng:function(t){var e=t.idx,i=t.poker_list;this.cal_playEfc(e,MJ_PENG);for(var a=0;a<i.length-1;a++)this.removeOnePokerToPokerList(e,"pokerList",i[a]);this.removeOnePokerToPokerList(this._lastDealIdx,"dealList",this._lastDealPoker);var s={mj_action:MJ_PENG,last_out_poker_idx:this._lastDealIdx,last_out_poker:this._lastDealPoker,poker_list:[i[0],i[0],i[0]]};this.addToWeaveList(e,s),this.refreshLogPoker(e),this.refreshLogDealPoker(this._lastDealIdx),this.refreshLogWeavePoker(e),this.hidePutOutArrowAni()},cal_action_gang:function(t){for(var e=t.idx,i=t.poker_list,a=this.getListIdxByWheelIdx(e),s=this.getChairIdByWheelIdx(e),r=MJ_AN_GANG,n=this.weaveList[a],o=0;o<n.length;o++)n[o].mj_action==MJ_PENG&&n[o].last_out_poker==i[0]&&(r=MJ_BU_GANG,this._lastDealIdx=n[o].last_out_poker_idx,this._lastDealPoker=n[o].last_out_poker);if(r!=MJ_BU_GANG&&this._lastDealPoker>0&&(r=MJ_GANG),this.cal_playEfc(e,r),cc.log("type===",r),r==MJ_GANG){for(var o=0;o<i.length-1;o++)this.removeOnePokerToPokerList(e,"pokerList",i[o]);this.removeOnePokerToPokerList(this._lastDealIdx,"dealList",this._lastDealPoker);var c={mj_action:r,last_out_poker_idx:this._lastDealIdx,last_out_poker:this._lastDealPoker,poker_list:[i[0],i[0],i[0],i[0]]};this.addToWeaveList(e,c),this.refreshLogPoker(e),this.refreshLogDealPoker(this._lastDealIdx),this.refreshLogWeavePoker(e)}else if(r==MJ_AN_GANG){for(var o=0;o<i.length;o++)this.removeOnePokerToPokerList(e,"pokerList",i[o]);this["game_card"+s]&&this["game_card"+s].setTileData(0,void 0);var c={mj_action:r,last_out_poker_idx:0,last_out_poker:0,poker_list:[i[0],i[0],i[0],i[0]]};this.addToWeaveList(e,c),this.refreshLogPoker(e),this.refreshLogWeavePoker(e)}else if(r==MJ_BU_GANG){this.removeOnePokerToPokerList(e,"pokerList",i[0]),this["game_card"+s]&&this["game_card"+s].setTileData(0,void 0);var c={mj_action:r,last_out_poker_idx:this._lastDealIdx,last_out_poker:this._lastDealPoker,poker_list:[i[0],i[0],i[0],i[0]]};this.removeToWeaveList(e,MJ_PENG,i[0]),this.addToWeaveList(e,c),this.refreshLogDealPoker(e),this.refreshLogWeavePoker(e)}this.hidePutOutArrowAni()},cal_action_hu:function(t){var e=t.idx;DataMgr.gameCtrl.huTypeList=this.gatReplayDataResult().cur_hu_types,this.cal_playEfc(e,MJ_HU)},cal_show_result:function(t){var e=this;DataMgr.gameCtrl.resultData=t;var i=0;t.win_idx==-1&&(e.grp_liuju&&e.grp_liuju.setVisible(!0),e.ani_liuju&&e.ani_liuju.getAnimation().play("stand",-1,-1),e.ani_liuju&&e.ani_liuju.getAnimation().setMovementEventCallFunc(function(t,i,a){i==ccs.MovementEventType.complete&&e.grp_liuju.setVisible(!1)},e),i=2),this.scheduleOnce(function(){ModuleMgr.runDlg("NewGameResult")},i)},gatReplayDataResult:function(){for(var t=this.replayData.steps||[],e=0;e<t.length;e++){var i=t[e],a=i.a,s=i.d;if("show_result"==a)return s}return null},initData:function(){this.stepTimeCfg={open_door:{time:0},last_win_op_idx:{time:0},rand_poker:{time:0},wheel_rand_poker:{time:.1},op_idx:{time:0},dispatch_poker:{time:1},deal_poker:{time:1},action_chi:{time:1},action_gang:{time:1},action_peng:{time:1},action_hu:{time:1},no_action:{time:0},user_poker_fix_flower:{time:.5},show_card:{time:0},show_result:{time:2},rand_mine_idx:{time:12},rand_mine_list:{time:.1}},DataMgr.gameCtrl.analyseReplayData();var t=this.replayData.rand_pokers;if(t){DataMgr.gameCtrl.randPokerList=t;var e=this.replayData.desk_info;set_king_map(IsGameTypeNdmj(e.game_type)&&0==e.spec_type?[67]:t)}},initLogGameUI:function(){this.refreshLogDesktop(),this.checkKingGrp(),this.refreshLogPlayers(),this.onPokerLogInited(),this.replayData.first_poker_list||this.refreshLogremainNum(!0),this.dealEventStack()},refreshLogremainNum:function(t){for(var e=0,i=this.replayData.steps||[],a=0;a<i.length;a++){var s=i[a],r=s.a,n=s.d;if("dispatch_poker"==r){e=n.remain_poker_num-1,t&&e++;break}}this.txt_last_num&&this.txt_last_num.setString(e),this.grp_last_num&&this.grp_last_num.setVisible(!0)},refreshLogDesktop:function(){if(this.replayData){var t=this.replayData.cur_round||0,e=this.replayData.desk_info.full_round;this.lab_round.setString("局数:"+t+"/"+e),this.lab_roomId.setString("房号:"+this.replayData.idx),this.refreshGameTypeTxt(),this.replayData.first_poker_list?this.btn_flower&&this.btn_flower.setVisible(!0):this.btn_flower&&this.btn_flower.setVisible(!1)}},refreshLogPlayers:function(){var t=this.replayData.users,e=[];e=this.replayData.first_poker_list?this.replayData.first_poker_list:this.replayData.poker_list;for(var i=t.length,a=-1,s=0;s<i;s++)t[s].wheel_idx=s+1,t[s].rid==ME_D.get_user().rid&&(a=s);if(this.userList=[],this.pokerList=[],a>=0){for(var s=a;s<i;s++)this.userList.push(t[s]),this.pokerList.push(this.getSortPokerList(e[s]));for(var s=0;s<a;s++)this.userList.push(t[s]),this.pokerList.push(this.getSortPokerList(e[s]))}else{this.userList=gDup(t);for(var s=0;s<i;s++)this.pokerList.push(this.getSortPokerList(e[s]))}this.weaveList=[],this.dealList=[],this.flowerList=[],this.idxList=[],4==i?this.idxList=[4,3,1,2]:3==i?this.idxList=[4,3,2]:2==i&&(this.idxList=[4,1]);for(var s=0;s<i;s++)this.weaveList.push([]),this.dealList.push([]),this.flowerList.push([]),this["role_card"+this.idxList[s]]&&(this["role_card"+this.idxList[s]].setVisible(!0),this["role_card"+this.idxList[s]].setLogData(this.userList[s]),this["role_card"+this.idxList[s]].setScore(this.userList[s].score),this.replayData.first_poker_list&&this["role_card"+this.idxList[s]].initFlower())},getChairIdByWheelIdx:function(t){for(var e=0,i=0;i<this.userList.length;i++)t==this.userList[i].wheel_idx&&(e=this.idxList[i]);return e},getListIdxByWheelIdx:function(t){for(var e=0,i=0;i<this.userList.length;i++)t==this.userList[i].wheel_idx&&(e=i);return e},getUserByWheelIdx:function(t){for(var e=0;e<this.userList.length;e++)if(t==this.userList[e].wheel_idx)return this.userList[e];return null},setPokerList:function(t,e,i){var a=this.getListIdxByWheelIdx(t);this[""+e][a]=i},addOnePokerToPokerList:function(t,e,i){var a=this.getListIdxByWheelIdx(t);this[""+e][a].push(i)},removeOnePokerToPokerList:function(t,e,i){for(var a=this.getListIdxByWheelIdx(t),s=this[""+e][a].length-1;s>=0;s--)if(this[""+e][a][s]==i){this[""+e][a].splice(s,1);break}},addToWeaveList:function(t,e){var i=this.getListIdxByWheelIdx(t);this.weaveList[i].push(e),this.weaveList.sort(function(t,e){return e.mj_action-t.mj_action})},removeToWeaveList:function(t,e,i){for(var a=this.getListIdxByWheelIdx(t),s=this.weaveList[a].length-1;s>=0;s--)if(this.weaveList[a][s].mj_action==e&&this.weaveList[a][s].last_out_poker==i){this.weaveList[a].splice(s,1);break}},getSortPokerList:function(t){var e=gDup(t),i=this.replayData.desk_info;if(IsGameTypeNdmj(i.game_type)&&0==i.spec_type){var a=DataMgr.gameCtrl.randPokerList||[];67==a[0]?e.sort(sort_card):e.sort(sort_card_ndmjOpenKing)}else e.sort(sort_card);return e=e.reverse()},onPokerLogInited:function(){this.setTileSize();for(var t=0;t<this.idxList.length;t++){var e=this.idxList[t],i=this.pokerList[t];if(this["game_card"+e]){this["game_card"+e].setTileStatus(mjGame.TileStatus.UNCOVERING),17==i.length&&(this["game_card"+e].setTileData(0,i[0]),i.splice(0,1));for(var a=1;a<=16;a++)this["game_card"+e].setTileData(a,i[a-1]);this["game_card"+e].setVisible(!0)}this["game_disCard"+e]&&this["game_disCard"+e].setVisible(!0)}this.game_card4&&this.game_card4.setTouchEnabled(!1)},refreshLogPoker:function(t,e){var i=this.getChairIdByWheelIdx(t),a=this.getListIdxByWheelIdx(t),s=gDup(this.pokerList[a]);s=this.getSortPokerList(s);var r=s.length;if(r%3==2)if(e){if(this._firstDispatchPoker>0){for(var n=[],o=!1,c=0;c<s.length;c++)s[c]!=this._firstDispatchPoker||o?n.push(s[c]):o=!0;s=n}this["game_card"+i]&&this["game_card"+i].setTileData(0,this._firstDispatchPoker)}else this["game_card"+i]&&this["game_card"+i].setTileData(0,s[0]),s.splice(0,1);for(var c=1;c<=16;c++)this["game_card"+i]&&this["game_card"+i].setTileData(c,s[c-1])},refreshLogDealPoker:function(t){for(var e=this.getChairIdByWheelIdx(t),i=this.getListIdxByWheelIdx(t),a=1;a<=32;a++)this["game_disCard"+e]&&this["game_disCard"+e].setTileData(a,this.dealList[i][a-1])},refreshLogWeavePoker:function(t){var e=this.getChairIdByWheelIdx(t),i=this.getListIdxByWheelIdx(t);this["game_card"+e]&&this["game_card"+e].refreshWeavePoker(this.weaveList[i],t)},setTileSize:function(){if(this.game_card4){var t=(cc.winSize.height-30)/this.game_card4.width,e=cc.sys.localStorage.getItem("fzmj_game_setting_ck_size")||1;2==e&&(t=.85*t),this.game_card4.setScale(t)}},tap_btn_log_play:function(){this.btn_log_play.setVisible(!1),this.btn_log_stop.setVisible(!0),this._isPlayState=!0,this.startPlay(this._replayIndex+1)},tap_btn_log_stop:function(){this.btn_log_play.setVisible(!0),this.btn_log_stop.setVisible(!1),this._isPlayState=!1,this._speedTime=1,this.log_quickLight.setVisible(1!=this._speedTime)},tap_btn_log_quick:function(){1==this._speedTime?this._speedTime=.3:this._speedTime=1,this.log_quickLight.setVisible(1!=this._speedTime)}}),NewGameLogLayer.create=function(t,e,i){return new NewGameLogLayer(t,e,i)},ModuleMgr.registerModule("NewGameLogLayer",NewGameLogLayer),FlowerCardDlg=QPDlg.extend({uiPath:"ui/new/game/FlowerCardDlg.ui",ctor:function(t,e,i){this.data=t,QPDlg.prototype.ctor.call(this,this.uiPath,e)},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this);var t=this;t.addListener("SuccessStartGame",function(e){t.close()});for(var e=DataMgr.gameCtrl.getUserFlowerList(),i=0;i<e.length;i++)this["grp_flower"+(i+1)].setVisible(!0),this["lab_name"+(i+1)].setString(e[i].name),this["lab_flower"+(i+1)].setString("花番x"+e[i].num),e[i].list.length>0&&this.refreshList({name:"listView"+(i+1),itemCell:FlowerCardItem,list:e[i].list})}}),FlowerCardDlg.create=function(t,e,i){return new FlowerCardDlg(t,e,i)},ModuleMgr.registerModule("FlowerCardDlg",FlowerCardDlg),FlowerCardItem=QPListItem.extend({uiPath:"ui/new/game/FlowerCardItem.ui",data:null,ctor:function(t,e,i){this.data=t,QPListItem.prototype.ctor.call(this,this.uiPath,e,i)},setData:function(t){this.data=t,this.item_tile&&this.item_tile.setData(t.card,mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND,mjGame.TilePlace.HAND),this.lab_num&&this.lab_num.setString(t.num),this.grp_lab.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.grp_lab.setVisible(!0)},this)))}}),FlowerCardItem.create=function(t,e,i){return new FlowerCardItem(t,e,i)},ModuleMgr.registerModule("FlowerCardItem",FlowerCardItem),TingTips=QPLayer.extend({uiPath:"ui/new/game/TingTips.ui",data:null,_images:[],ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setTingList:function(t){t=t||[];var e=DataMgr.gameCtrl.deskInfo;IsGameTypeNdmj(e.game_type)&&e.info&&0==e.info.spec_type?t.sort(this.sort_code_ndmjOpenKing):t.sort(this.sort_code_normal),cc.log("tingList",t),this.refreshList({name:"listView",itemCell:TingTipsItem,list:t})},sort_code_ndmjOpenKing:function(t,e){var i=getNumByCode(t.card),a=getNumByCode(e.card);return MJ_KING_MAP[i]&&(i-=1e3),MJ_KING_MAP[a]&&(a-=1e3),DataMgr.gameCtrl.randPokerList[0]==i&&(i+=1e3),DataMgr.gameCtrl.randPokerList[0]==a&&(a+=1e3),i-a},sort_code_normal:function(t,e){var i=getNumByCode(t.card),a=getNumByCode(e.card);return MJ_KING_MAP[i]&&(i-=1e3),MJ_KING_MAP[a]&&(a-=1e3),i-a}}),TingTips.create=function(t,e,i){return new TingTips(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/TingTips.ui",TingTips),TingTipsItem=QPListItem.extend({uiPath:"ui/new/game/TingTipsItem.ui",_txt:null,ctor:function(t,e,i){t=t||this.uiPath,QPListItem.prototype.ctor.call(this,t,e,i)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(t){t||this.setVisible(!1),this.item_tile&&this.item_tile.setData(getNumByCode(t.card),mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND,mjGame.TilePlace.HAND),this.lab_num&&this.lab_num.setString(t.num)}}),TingTipsItem.create=function(t,e,i){return new TingTipsItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/TingTipsItem.ui",TingTipsItem),AlreadyTingTips=QPLayer.extend({uiPath:"ui/new/game/AlreadyTingTips.ui",data:null,_images:[],ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setTingList:function(t){var e=DataMgr.gameCtrl.deskInfo;IsGameTypeNdmj(e.game_type)&&e.info&&0==e.info.spec_type?t.sort(this.sort_code_ndmjOpenKing):t.sort(this.sort_code_normal),cc.log("tingList",t),this.refreshList({name:"listView",itemCell:AlreadyTingTipsItem,list:t})},sort_code_ndmjOpenKing:function(t,e){var i=getNumByCode(t.card),a=getNumByCode(e.card);return MJ_KING_MAP[i]&&(i-=1e3),MJ_KING_MAP[a]&&(a-=1e3),DataMgr.gameCtrl.randPokerList[0]==i&&(i+=1e3),DataMgr.gameCtrl.randPokerList[0]==a&&(a+=1e3),i-a},sort_code_normal:function(t,e){var i=getNumByCode(t.card),a=getNumByCode(e.card);return MJ_KING_MAP[i]&&(i-=1e3),MJ_KING_MAP[a]&&(a-=1e3),i-a}}),AlreadyTingTips.create=function(t,e,i){return new AlreadyTingTips(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/AlreadyTingTips.ui",AlreadyTingTips),AlreadyTingTipsItem=QPListItem.extend({uiPath:"ui/new/game/AlreadyTingTipsItem.ui",_txt:null,ctor:function(t,e,i){t=t||this.uiPath,QPListItem.prototype.ctor.call(this,t,e,i)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(t){t||this.setVisible(!1),this.item_tile&&this.item_tile.setData(getNumByCode(t.card),mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND,mjGame.TilePlace.HAND),this.lab_num&&this.lab_num.setString(t.num+"张")}}),AlreadyTingTipsItem.create=function(t,e,i){return new AlreadyTingTipsItem(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/AlreadyTingTipsItem.ui",AlreadyTingTipsItem),SurplusTips=QPLayer.extend({uiPath:"ui/new/game/SurplusTips.ui",data:null,_images:[],ctor:function(t,e,i){t=t||this.uiPath,UrlHead.prototype.ctor.call(this,t,e,i)},onLoaded:function(){},setData:function(t){t||this.setVisible(!1),this.item_tile&&this.item_tile.setData(t,mjGame.Direction.BOTTOM,mjGame.TileStatus.STAND,mjGame.TilePlace.HAND);var e=4-DataMgr.gameCtrl.getAppearCountByTile(t);e<0&&(e=0),this.lab_num&&this.lab_num.setString(e)}}),SurplusTips.create=function(t,e,i){return new SurplusTips(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/SurplusTips.ui",SurplusTips),SpecialHuEffect=QPLayer.extend({
uiPath:"ui/new/game/SpecialHuEffect.ui",_huTypes:[],_leaves:null,ctor:function(t,e,i){this._huTypes=[],this._leaves=[],QPLayer.prototype.ctor.call(this,this.uiPath,e,i)},onLoaded:function(){},showHuEffect:function(){if(!this.isVisible()){for(var t=1;t<=16;t++)this["grp_num"+t]&&this["grp_num"+t].setVisible(!1);this._resultData=DataMgr.gameCtrl.resultData,this._resultData&&this._resultData.cur_hu_types&&(this._huTypes=this._resultData.cur_hu_types);var e=this._sortList(this._gatHuTypsList());cc.log("huTypsList",e);var i=e.length;if(!(i>0&&this._resultData.win_idx==DataMgr.gameCtrl.myWheelIdx))return void ModuleMgr.runDlg("NewGameResult");this.scheduleOnce(function(){ModuleMgr.runDlg("GameResultShare")},3.2);for(var t=0;t<i;t++){var a=this["img_"+i+"_"+(t+1)];a&&(a.loadTexture("res/uires/new/game/huEffect/"+e[t].msg+".png",ccui.Widget.LOCAL_TEXTURE),a.setScale(a.getScale()*e[t].scale))}this["grp_num"+i]&&this["grp_num"+i].setVisible(!0),this.img_circle&&this.img_circle.setVisible(!0),this.img_flower&&this.img_flower.setVisible(!0),this.setScale(.8),this.setVisible(!0),this.runAction(cc.sequence(cc.callFunc(function(){this._leaves=this._createLeaves(),this.addChild(this._leaves,-1)},this),cc.scaleTo(.1,1),cc.delayTime(3),cc.callFunc(function(){this._leaves&&(this._leaves.removeFromParent(),this._leaves=null)},this),cc.scaleTo(.1,.8),cc.callFunc(function(){this.stopAllActions(),this.setVisible(!1)},this)))}},_gatHuTypsList:function(){for(var t=[],e=0;e<this._huTypes.length;e++){var i=this._huTypes[e];switch(i){case MJ_HU_ONE_COLOR_ALL:t.push({order:11,scale:1,msg:"qing"}),t.push({order:12,scale:.9,msg:"yi"}),t.push({order:13,scale:.9,msg:"se"});break;case MJ_HU_ONE_COLOR:t.push({order:11,scale:1,msg:"hun"}),t.push({order:12,scale:.9,msg:"yi"}),t.push({order:13,scale:.9,msg:"se"});break;case MJ_HU_QI_DUI:t.push({order:21,scale:1,msg:"xiao"}),t.push({order:22,scale:.9,msg:"qi"}),t.push({order:23,scale:.9,msg:"dui"});break;case MJ_HU_PENG_PENG:t.push({order:21,scale:1,msg:"peng"}),t.push({order:22,scale:.9,msg:"peng"}),t.push({order:23,scale:.9,msg:"hu"});break;case MJ_HU_ONE_FLOWER:t.push({order:31,scale:1,msg:"yi"}),t.push({order:32,scale:.9,msg:"zhang"}),t.push({order:33,scale:.9,msg:"hua2"});break;case MJ_HU_NO_FLOWER:t.push({order:31,scale:1,msg:"wu"}),t.push({order:32,scale:.9,msg:"hua2"}),t.push({order:33,scale:.9,msg:"wu"}),t.push({order:34,scale:.9,msg:"gang"});break;case MJ_HU_SINGLE_WAIT:t.push({order:41,scale:1,msg:"dan"}),t.push({order:42,scale:.9,msg:"diao"});break;case MJ_HU_SPARROW_KING:t.push({order:51,scale:1,msg:"jin"}),t.push({order:52,scale:.9,msg:"que"});break;case MJ_HU_DRAGON_KING:t.push({order:51,scale:1,msg:"jin"}),t.push({order:52,scale:.9,msg:"long"});break;case MJ_HU_GANG_KING:t.push({order:51,scale:1,msg:"jin"}),t.push({order:52,scale:.9,msg:"gang"});break;case MJ_HU_TIAN:t.push({order:61,scale:1,msg:"tian"}),t.push({order:62,scale:.9,msg:"hu"});break;case MJ_DI:t.push({order:61,scale:1,msg:"di"}),t.push({order:62,scale:.9,msg:"hu"})}}return t},_sortList:function(t){return t=t.sort(function(t,e){return t.order-e.order})},_createLeaves:function(){var t=new cc.Node,e=cc.delayTime(.45),i=cc.sequence(e,cc.callFunc(function(){for(var e=0;e<22;e++)if(Math.random()>.8){var i=this._createOneRoes();t.addChild(i)}},this));return t.runAction(cc.repeatForever(i)),t},_createOneRoes:function(){var t="res/uires/new/ani/meigui"+(Math.floor(100*Math.random())%2+1)+".png",e=new ccui.ImageView(t,ccui.Widget.LOCAL_TEXTURE);return e.setPosition(Math.random()*cc.winSize.height-cc.winSize.height/4,cc.winSize.width+100),this._leavesAction(e),e},_leavesAction:function(t){var e=5*Math.random()+2.5,i=t.x+Math.random()*cc.winSize.height*.5,a=cc.moveTo(e,i,-100),s=cc.rotateBy(2+5*Math.random(),Math.random()>.5?360:-360),r=cc.sequence(a,cc.callFunc(function(){t.removeFromParent()}));t.runAction(r),t.runAction(cc.repeatForever(s)),t.setScale(.8*Math.random()+.5),t.setOpacity(255*(.2*Math.random()+.8)),Math.random()>.5&&t.setSkewX(30*Math.random())}}),SpecialHuEffect.create=function(t,e,i){return new SpecialHuEffect(t,e,i)},UIUtils.RegisterPathTemple("ui/new/game/SpecialHuEffect.ui",SpecialHuEffect),GameResultShare=QPDlg.extend({uiPath:"ui/new/game/GameResultShare.ui",_isAlreadClose:!1,ctor:function(t,e,i){this.data=t,this._isAlreadClose=!1,QPDlg.prototype.ctor.call(this,this.uiPath,e)},onLoaded:function(){this._super();var t=this;t.addListener("SuccessStartGame",function(e){t.close(),t._isAlreadClose=!0});var e=gDup(DataMgr.gameCtrl.resultData),i=e.cur_score||{},a=e.details||[],s=e.win_idx,r=DataMgr.gameCtrl.players[s];if(r&&r.info){var n=r.info;this.item_head&&this.item_head.setData(n),this.item_head&&this.item_head.setFrame(n.extra_data?n.extra_data.head:null);var o=toDecodeURIComponent(n.name);o=cutOffStr(o,10,!0),this.lab_name&&this.lab_name.setString(o);var c=i["idx"+s]||0;this.lab_score&&this.lab_score.setString("分: "+c)}var l={};for(var _ in a)a[_].idx==s&&(l=a[_]);var u=e.last_dispatch_poker||0,h=e.last_out_poker||0,g=l.poker_list||[];g.sort(sort_card),g=g.reverse();for(var d=l.weave_pokers||[],m=e.cur_hu_types||[],f=0;f<m.length;f++)m[f]==MJ_HU_CATCH_KING&&MJ_KING_ARR[0]&&(h=MJ_KING_ARR[0]);var p=this.game_card;p&&(p.setTouchEnabled(!1),p.refreshResultPokers(!1,g,u,h),p.refreshWeavePoker(d,s)),cc.sys.isNative?(this.btn_share.setVisible(!0),this.btn_next.setVisible(!0)):(this.btn_share2.setVisible(!0),this.btn_next2.setVisible(!0))},dlgActionEnd:function(){if(this._super(),!cc.sys.isNative){var t=getQueryString("lanscape_dev")||0;if(t)return;var e=this;setTimeout(function(){if(e.img_share){var t=e.img_share.height,i=cc.winSize.height,a=0,s=0;create_h5_cut_img(a,s,t,i)}},150)}},tap_btn_share:function(){if(cc.sys.isNative){var t="",e=function(){platform.shareImage(t,0)};t=saveScreenShot(e,90)}},tap_btn_next:function(){this._isAlreadClose||(ModuleMgr.runDlg("NewGameResult"),this.close(),this._isAlreadClose=!0)},tap_btn_next2:function(){this.tap_btn_next()},onExit:function(){this._super(),cc.sys.isNative||remove_h5_cut_img()}}),GameResultShare.create=function(t,e,i){return new GameResultShare(t,e,i)},ModuleMgr.registerModule("GameResultShare",GameResultShare),GAME_WEB_URL="http://www.gongpaa.com",SHARE_URL="http://www.gongpaa.com/fjmj/",WEIXIN_CALLBACK_URL="http:/www.gongpaa.com",DOWN_RECORD_SERVER="http://www.gongpaa.com",GAME_WEB_PORT=":1338";var SOCKET_PORT="12345",HALL_TWO_URL="www.fuxiedu.cn",isQiYeQian=1==getQueryString("qiyeqian"),isTestServer="1"==(getQueryString("test")||"0"),PAY_PORT=GAME_WEB_PORT;"1"==isTestServer&&(GAME_WEB_PORT=":1338",PAY_PORT=":1338",GAME_WEB_URL="http://test.quanjianyou.com",SHARE_URL="http://test.quanjianyou.com/fjmj/",WEIXIN_CALLBACK_URL="http://test.quanjianyou.com",SOCKET_PORT="12345");var isLocal="1"==(getQueryString("local")||"0");isLocal&&(SOCKET_PORT="12345");var isDebug=getQueryString("debug")||0;if(0==isDebug&&(console.log=function(){}),TEST_POKERS=getQueryString("test_pokers")||null,TEST_POKERS)try{var testPokerMap=JSON.parse(TEST_POKERS);if(testPokerMap.user_pokers)for(var i=0;i<testPokerMap.user_pokers.length;i++)for(var locList=testPokerMap.user_pokers[i],j=0;j<locList.length;j++)locList[j]=parseInt(locList[j]);if(testPokerMap.remain_pokers)for(var i=0;i<testPokerMap.remain_pokers.length;i++)testPokerMap.remain_pokers[i]=parseInt(testPokerMap.remain_pokers[i]);testPokerMap.up_king&&(testPokerMap.up_king=parseInt(testPokerMap.up_king)),testPokerMap.down_king&&(testPokerMap.down_king=parseInt(testPokerMap.down_king)),TEST_POKERS=JSON.stringify(testPokerMap)}catch(t){}var designOrientation=null,winSizeWidthBigger={width:0,height:0},simulator="1"==(getQueryString("simulator")||"0");window&&(window.onerror=function(t,e,i,a,s){var r=JSON.stringify({msg:t,ext:s&&s.stack,rid:ME_D.get_rid(),url:e+"  line:"+i+" col:"+a});cc.sys.localStorage.setItem(GAME_TYPE+"_error_stack",r);var n={method:"POST",timeout:5e3,url:GAME_WEB_URL+GAME_WEB_PORT+"/apijserror",data:r};HttpNetworkRequest(n,function(t,e){t||cc.sys.localStorage.setItem(GAME_TYPE+"_error_stack","")})});var logSaveServer=function(t,e,i,a,s){var r=cc.sys.localStorage.getItem(GAME_TYPE+"_error_stack");if(r){var n={method:"POST",timeout:5e3,url:GAME_WEB_URL+GAME_WEB_PORT+"/apijserror",data:r};HttpNetworkRequest(n,function(t,e){t||cc.sys.localStorage.setItem(GAME_TYPE+"_error_stack","")})}},gInReview=!1;sdk_set_inview=function(t){};var pc_lanscape_dev=function(){if(!cc.sys.isNative&&!cc.sys.isMobile){var t="1"==(getQueryString("lanscape_dev")||"0");t&&(cc.view._initFrameSize=function(){var t=this._frameSize,e=__BrowserGetter.availWidth(this._frame),i=__BrowserGetter.availHeight(this._frame);t.width=i,t.height=e,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0})}};if(cc.game.onStart=function(){if(!cc.sys.isNative&&document.getElementById("cocosLoading")&&document.body.removeChild(document.getElementById("cocosLoading")),DataMgr&&"function"==typeof DataMgr.setGameType&&DataMgr.setGameType(),initAudio(),cc.view.enableRetina(!0),cc.view.adjustViewPort(!0),cc.view.resizeWithBrowserSize(!0),0==cc.sys.isNative){var t=function(){cc.eventManager.dispatchCustomEvent("screen_change")};cc.view.setResizeCallback(t)}pc_lanscape_dev(),setScreenSize(),cc.view.setOrientation(cc.ORIENTATION_PORTRAIT),cc.Device&&cc.Device.setKeepScreenOn&&cc.Device.setKeepScreenOn(!0),UIDataUtils.SetUIPrefix("res/"),ModuleMgr.runScene("LoginScene")},goHome=function(){DataMgr.accountCtrl.setDeskInfo({gameType:GAME_TYPE,deskIdx:DataMgr.gameCtrl.deskIdx}),jsb.UpdateZipMgr&&jsb.UpdateZipMgr.Instance().enterHall()},"undefined"!=typeof DataMgr&&DataMgr.accountCtrl&&DataMgr.accountCtrl.bolFromHall()){var winSize=cc.director.getWinSize();winSize.width<winSize.height?(designOrientation=SCREEN_ORIENTATION_PROTRAIT,winSizeWidthBigger.width=winSize.height,winSizeWidthBigger.height=winSize.width):(designOrientation=SCREEN_ORIENTATION_LANDSCAPE,winSizeWidthBigger.width=winSize.width,winSizeWidthBigger.height=winSize.height),cc.loader.releaseAll(),UIDataUtils.SetUIPrefix("res/"),DataMgr&&"function"==typeof DataMgr.setGameType&&DataMgr.setGameType(),designOrientation!=SCREEN_ORIENTATION_LANDSCAPE&&DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE);var deskInfo=DataMgr.accountCtrl.deskInfo;deskInfo&&DataMgr.accountCtrl.enterGameInfo.user&&(GAME_TYPE_FZMJ==deskInfo.gameType||GAME_TYPE_NDMJ==deskInfo.gameType?(DataMgr.accountCtrl.enterGameInfo.user.desk_idx=deskInfo.deskIdx,DataMgr.accountCtrl.enterGameInfo.user.game_type=GAME_TYPE):(DataMgr.accountCtrl.enterGameInfo.user.desk_idx=0,DataMgr.accountCtrl.enterGameInfo.user.game_type=GAME_TYPE)),DataMgr.clubCtrl.setUnionList(DataMgr.accountCtrl.unionList),NetMsg.msg_enter_game(DataMgr.accountCtrl.enterGameInfo),console.log("20190627 EnterScene"),ModuleMgr.enterEnterScene(!0)}else setTimeout(function(){cc.game.run()},500);